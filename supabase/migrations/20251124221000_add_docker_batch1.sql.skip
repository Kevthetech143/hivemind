-- Add Docker official documentation solutions batch 1
-- Extracted from: docs.docker.com
-- Category: docker
-- Focus: Container runtime, volumes, networking, daemon, build issues

INSERT INTO knowledge_entries (
    query, category, hit_frequency, solutions, prerequisites, success_indicators,
    common_pitfalls, success_rate, claude_version, last_verified, source_url
) VALUES (
    'Docker container exit code 125: Docker daemon error',
    'docker',
    'HIGH',
    '[
        {"solution": "Check Docker daemon logs for specific error details", "percentage": 90, "note": "Exit 125 indicates Docker itself has an error, not the container command"},
        {"solution": "Verify command flags are valid: docker run --help", "percentage": 85, "note": "Often caused by undefined flags like --foo"},
        {"solution": "Restart Docker daemon: sudo systemctl restart docker", "percentage": 75, "command": "sudo systemctl restart docker"}
    ]'::jsonb,
    'Docker installed and running, Valid container image',
    'Container starts successfully, Command executes without Docker-level errors',
    'Exit code 125 is Docker-level error, not application error. Check for typos in flags.',
    0.88,
    'sonnet-4',
    NOW(),
    'https://docs.docker.com/engine/reference/run/'
),
(
    'Docker container exit code 126: Command cannot be invoked',
    'docker',
    'HIGH',
    '[
        {"solution": "Verify the command has execute permissions: chmod +x /path/to/command", "percentage": 90, "note": "Command exists but cannot execute due to permissions or format"},
        {"solution": "Check command is not a directory: ensure entrypoint is a file", "percentage": 85, "note": "Error occurs when trying to execute /etc instead of a binary"},
        {"solution": "Verify binary format matches container architecture (amd64 vs arm64)", "percentage": 80, "note": "Cross-platform binaries may fail"}
    ]'::jsonb,
    'Container running, Command file exists in container',
    'Command executes successfully, Exit code is not 126',
    'Command file must be executable and proper format. Directory paths will trigger this error.',
    0.87,
    'sonnet-4',
    NOW(),
    'https://docs.docker.com/engine/reference/run/'
),
(
    'Docker container exit code 127: Command not found',
    'docker',
    'VERY_HIGH',
    '[
        {"solution": "Verify command exists in container PATH: docker exec <container> which <command>", "percentage": 92, "note": "Most common cause is missing binary"},
        {"solution": "Install missing package in Dockerfile: RUN apt-get install -y <package>", "percentage": 88, "note": "Add installation to build process"},
        {"solution": "Use full path to binary instead of relying on PATH", "percentage": 85, "command": "docker run <image> /usr/local/bin/command"}
    ]'::jsonb,
    'Container image built, Container can start',
    'Command executes successfully, Binary found in PATH',
    'Exit 127 means command does not exist in container filesystem. Not a PATH inheritance issue from host.',
    0.92,
    'sonnet-4',
    NOW(),
    'https://docs.docker.com/engine/reference/run/'
),
(
    'Docker logs shows no output or missing logs',
    'docker',
    'HIGH',
    '[
        {"solution": "Configure application to write to STDOUT/STDERR instead of log files", "percentage": 90, "note": "Docker logs only captures standard streams"},
        {"solution": "Create symlinks from log files to /dev/stdout: ln -sf /dev/stdout /var/log/app.log", "percentage": 88, "note": "nginx pattern - redirect logs to stdout"},
        {"solution": "Reconfigure app to write to /proc/self/fd/1 (stdout) and /proc/self/fd/2 (stderr)", "percentage": 85, "note": "httpd/Apache pattern"},
        {"solution": "Enable dual logging if using external logging driver", "percentage": 80, "command": "Configure logging driver in daemon.json"}
    ]'::jsonb,
    'Container running, Application writing logs somewhere',
    'docker logs shows expected output, Logs appear in real-time',
    'Applications writing to files won''t show in docker logs. Must redirect to STDOUT/STDERR or enable dual logging.',
    0.89,
    'sonnet-4',
    NOW(),
    'https://docs.docker.com/config/containers/logging/'
),
(
    'Docker pull fails behind corporate proxy',
    'docker',
    'HIGH',
    '[
        {"solution": "Configure Docker daemon proxy settings in /etc/systemd/system/docker.service.d/http-proxy.conf", "percentage": 92, "note": "Systemd-based systems"},
        {"solution": "Add HTTP_PROXY and HTTPS_PROXY environment variables to Docker daemon", "percentage": 88, "command": "Environment=HTTP_PROXY=http://proxy.example.com:8080"},
        {"solution": "Restart Docker daemon after proxy config: sudo systemctl daemon-reload && sudo systemctl restart docker", "percentage": 90, "command": "sudo systemctl daemon-reload && sudo systemctl restart docker"}
    ]'::jsonb,
    'Docker installed, Proxy server accessible, Network connectivity to proxy',
    'docker pull succeeds, Image downloads without timeout',
    'Proxy must be configured at daemon level, not just shell environment. Requires daemon restart.',
    0.91,
    'sonnet-4',
    NOW(),
    'https://docs.docker.com/engine/reference/commandline/pull/'
),
(
    'Docker pull timeout on low bandwidth connection',
    'docker',
    'MEDIUM',
    '[
        {"solution": "Lower concurrent downloads in daemon.json: {\"max-concurrent-downloads\": 1}", "percentage": 88, "note": "Reduces bandwidth contention"},
        {"solution": "Increase timeout settings in Docker configuration", "percentage": 80, "note": "Allow more time for layer downloads"},
        {"solution": "Pull smaller base images or use alpine variants", "percentage": 75, "note": "Reduces download size"}
    ]'::jsonb,
    'Docker running, Internet connection available but slow',
    'docker pull completes successfully, All layers downloaded',
    'Default concurrent downloads can overwhelm slow connections. Reduce to 1 or 2 concurrent downloads.',
    0.85,
    'sonnet-4',
    NOW(),
    'https://docs.docker.com/engine/reference/commandline/pull/'
),
(
    'Docker unable to connect to daemon error',
    'docker',
    'VERY_HIGH',
    '[
        {"solution": "Verify Docker daemon is running: sudo systemctl is-active docker", "percentage": 95, "command": "sudo systemctl is-active docker"},
        {"solution": "Check DOCKER_HOST environment variable: env | grep DOCKER_HOST", "percentage": 90, "note": "Misconfigured variable can prevent connection"},
        {"solution": "Unset incorrect DOCKER_HOST: unset DOCKER_HOST", "percentage": 88, "command": "unset DOCKER_HOST"},
        {"solution": "Start Docker daemon: sudo systemctl start docker", "percentage": 92, "command": "sudo systemctl start docker"}
    ]'::jsonb,
    'Docker installed, User has permissions to access Docker socket',
    'docker info returns daemon information, Commands execute successfully',
    'Check DOCKER_HOST first - often misconfigured to point to wrong socket or remote host.',
    0.93,
    'sonnet-4',
    NOW(),
    'https://docs.docker.com/engine/install/troubleshoot/'
),
(
    'Docker daemon fails to start: conflicting daemon.json and startup flags',
    'docker',
    'HIGH',
    '[
        {"solution": "Create override file: /etc/systemd/system/docker.service.d/docker.conf to remove conflicting -H flags", "percentage": 92, "note": "Systemd-based systems"},
        {"solution": "Run sudo systemctl daemon-reload after creating override file", "percentage": 90, "command": "sudo systemctl daemon-reload"},
        {"solution": "Remove duplicate settings from either daemon.json or systemd unit file", "percentage": 85, "note": "Cannot specify same option in both locations"}
    ]'::jsonb,
    'Systemd-based Linux system, Docker installed, Access to /etc/systemd',
    'Docker daemon starts successfully: sudo systemctl status docker shows active',
    'Cannot configure same options in both daemon.json and systemd unit. daemon.json takes precedence when override is configured.',
    0.90,
    'sonnet-4',
    NOW(),
    'https://docs.docker.com/engine/install/troubleshoot/'
),
(
    'Docker DNS resolution fails: 127.0.0.1 local resolver warning',
    'docker',
    'HIGH',
    '[
        {"solution": "Configure custom DNS in /etc/docker/daemon.json: {\"dns\": [\"8.8.8.8\", \"8.8.4.4\"]}", "percentage": 90, "note": "Use public DNS servers"},
        {"solution": "Disable dnsmasq in NetworkManager: comment out dns=dnsmasq in /etc/NetworkManager/NetworkManager.conf", "percentage": 85, "note": "Prevents conflict with local resolver"},
        {"solution": "Restart Docker after DNS configuration: sudo systemctl restart docker", "percentage": 88, "command": "sudo systemctl restart docker"}
    ]'::jsonb,
    'Docker running, Network connectivity available, Root access to system',
    'Containers can resolve external domains, dns queries succeed inside containers',
    'dnsmasq interferes with Docker DNS. Either disable dnsmasq or configure custom DNS servers in daemon.json.',
    0.88,
    'sonnet-4',
    NOW(),
    'https://docs.docker.com/engine/install/troubleshoot/'
),
(
    'Docker volume mount obscures existing container files',
    'docker',
    'MEDIUM',
    '[
        {"solution": "Mount volume to empty directory in container to avoid obscuring files", "percentage": 90, "note": "Pre-existing files become inaccessible when volume mounted"},
        {"solution": "Copy needed files to volume before mounting if they exist in image", "percentage": 85, "note": "Manual preservation of original data"},
        {"solution": "Use named volume with empty source: Docker will copy container files into volume", "percentage": 88, "note": "Automatic propagation of pre-existing content"}
    ]'::jsonb,
    'Container with files in target directory, Volume to mount',
    'Both volume data and original container files are accessible',
    'Mounting non-empty volume over directory with files hides the original files. They are not deleted, just obscured until volume unmounted.',
    0.87,
    'sonnet-4',
    NOW(),
    'https://docs.docker.com/storage/volumes/'
),
(
    'Docker volume permission denied errors',
    'docker',
    'HIGH',
    '[
        {"solution": "Use readonly mount flag for read-only access: -v vol:/path:ro", "percentage": 85, "note": "Prevents write permission issues"},
        {"solution": "Match container user UID with host volume owner UID", "percentage": 88, "note": "Ensures permission alignment"},
        {"solution": "Use docker volume with proper driver and options for permission management", "percentage": 80, "note": "Volume drivers can handle permissions"}
    ]'::jsonb,
    'Volume created or exists, Container attempting to access volume',
    'Container can read/write to volume without permission errors',
    'Bind mounts inherit host permissions. Named volumes managed by Docker have different permission model.',
    0.86,
    'sonnet-4',
    NOW(),
    'https://docs.docker.com/storage/volumes/'
),
(
    'Docker multi-platform build cannot load into local image store',
    'docker',
    'MEDIUM',
    '[
        {"solution": "Push multi-platform image directly to registry instead of loading locally", "percentage": 90, "note": "Default image store does not support multi-platform"},
        {"solution": "Enable containerd image store to support multi-platform images locally", "percentage": 85, "note": "Requires Docker configuration change"},
        {"solution": "Build for single platform when local loading needed: --platform linux/amd64", "percentage": 88, "command": "docker buildx build --platform linux/amd64 -t image:tag --load ."}
    ]'::jsonb,
    'Docker buildx configured, Multi-platform build attempted',
    'Image loads successfully or pushes to registry without error',
    'Cannot load multi-platform images to default image store. Must either use containerd store or push to registry.',
    0.89,
    'sonnet-4',
    NOW(),
    'https://docs.docker.com/engine/reference/commandline/build/'
);

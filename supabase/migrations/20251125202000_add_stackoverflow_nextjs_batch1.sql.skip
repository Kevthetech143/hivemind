-- Add 11 highest-voted Next.js questions from Stack Overflow with solutions

INSERT INTO knowledge_entries (query, category, solutions, prerequisites, common_pitfalls, success_rate, hit_frequency, claude_version, last_verified, source_url)
VALUES
(
  'window is not defined error in Next.js React app',
  'stackoverflow-nextjs',
  '[
    {"solution": "Wrap window access with typeof check: if (typeof window !== ''undefined'') { /* client code */ }", "percentage": 95, "note": "Works because window object doesn''t exist during server-side rendering"},
    {"solution": "Move code to componentDidMount() lifecycle method which executes only on client", "percentage": 90, "note": "Only works for class components"},
    {"solution": "Use React Hooks: Place window-dependent logic inside useEffect() with empty dependency array []", "percentage": 95, "note": "Guarantees client-only execution for function components"},
    {"solution": "Use Next.js dynamic() with ssr: false option to load components only client-side", "percentage": 88, "note": "const MyComponent = dynamic(() => import(''../component''), { ssr: false })"}
  ]'::jsonb,
  'Next.js application with client-side code attempting to access window object',
  'Not wrapping window access with type check (typeof window !== ''undefined''). Accessing window at module level instead of in useEffect or after component mounts.',
  0.92,
  'VERY_HIGH',
  'sonnet-4',
  NOW(),
  'https://stackoverflow.com/questions/55151041/window-is-not-defined-in-next-js-react-app'
),
(
  'How to set custom port in Next.js development and production',
  'stackoverflow-nextjs',
  '[
    {"solution": "Modify package.json scripts with -p flag: \"dev\": \"next dev -p 8080\", \"start\": \"next start -p 8080\"", "percentage": 96, "command": "npm run dev", "note": "Cleanest and recommended approach for both dev and prod"},
    {"solution": "Use environment variable approach: PORT=8080 npx next dev", "percentage": 90, "command": "PORT=8080 npx next dev", "note": "Works directly without modifying package.json"},
    {"solution": "For Windows, use cross-env package: npx cross-env PORT=8080 npm run dev", "percentage": 85, "command": "npx cross-env PORT=8080 npm run dev", "note": "Ensures cross-platform compatibility"},
    {"solution": "Use command-line override with npm: npm run dev -- -p 5000", "percentage": 87, "command": "npm run dev -- -p 5000", "note": "Temporary override without persistent changes"}
  ]'::jsonb,
  'Next.js project with package.json and npm or yarn installed. Default port 3000 available or willing to change.',
  'Hardcoding port in configuration file makes it inflexible. Using PORT env var only without -p flag. Not restarting dev server after config changes.',
  0.95,
  'HIGH',
  'sonnet-4',
  NOW(),
  'https://stackoverflow.com/questions/60147499/how-to-set-port-in-next-js'
),
(
  'How to get query string parameters from URL in Next.js',
  'stackoverflow-nextjs',
  '[
    {"solution": "Use useRouter hook: import { useRouter } from ''next/router''; const router = useRouter(); Access with router.query.paramName", "percentage": 96, "note": "Modern recommended approach for Next.js 9+. router.query contains all query params."},
    {"solution": "Check router.isReady before accessing router.query to avoid undefined values on first render", "percentage": 92, "note": "router.query is undefined initially. Wait for isReady flag: if (!router.isReady) return null"},
    {"solution": "For static exports, use router.asPath and parse manually instead of router.query", "percentage": 85, "note": "router.query may not work with static exports. Use router.asPath and implement custom parsing."},
    {"solution": "Next.js 13+ App Router: Use useSearchParams() hook for client components", "percentage": 90, "command": "const searchParams = useSearchParams(); const param = searchParams.get(''paramName'')", "note": "Updated approach for App Router. For server components, access searchParams as prop."}
  ]'::jsonb,
  'Next.js application with pages or app directory. URL with query parameters like /about?name=value.',
  'Accessing router.query before router.isReady flag is true. Using router.query with static exports. Trying to access in getStaticProps instead of using dependency on context.',
  0.93,
  'VERY_HIGH',
  'sonnet-4',
  NOW(),
  'https://stackoverflow.com/questions/43862600/how-can-i-get-query-string-parameters-from-the-url-in-next-js'
),
(
  'ChunkLoadError: Loading chunk node_modules_next_dist_client failed',
  'stackoverflow-nextjs',
  '[
    {"solution": "Delete .next build folder and restart dev server: rm -rf .next && npm run dev", "percentage": 97, "command": "rm -rf .next && npm run dev", "note": "Most reliable fix. Clears cached build artifacts causing webpack chunk load failures."},
    {"solution": "Force clear browser cache with hard refresh: Ctrl+Shift+Delete or Shift+F5 / Cmd+Shift+R", "percentage": 88, "command": "Keyboard: Shift+F5 or Cmd+Shift+R", "note": "Clears cached assets that browser previously loaded"},
    {"solution": "Close browser error popup and reload page - app may function normally despite error", "percentage": 75, "note": "Error typically doesn''t prevent functionality. Development-only issue related to stale cache artifacts."}
  ]'::jsonb,
  'Next.js development project with .next build directory. Modern browser with cache. Webpack configured.',
  'Closing dev server without letting it fully rebuild. Not clearing old .next folder completely. Browser aggressively caching old chunks. Changing project structure without rebuilding.',
  0.92,
  'HIGH',
  'sonnet-4',
  NOW(),
  'https://stackoverflow.com/questions/67652612/chunkloaderror-loading-chunk-node-modules-next-dist-client-dev-noop-js-failed'
),
(
  'NextJS warning: Extra attributes from the server data-new-gr-c-s-check-loaded',
  'stackoverflow-nextjs',
  '[
    {"solution": "Disable problematic browser extensions during development (Grammarly, ColorZilla, LanguageTool, etc.)", "percentage": 94, "note": "Extensions inject HTML attributes after server render but before hydration. Test in incognito mode to confirm source."},
    {"solution": "Add suppressHydrationWarning to root elements: <html suppressHydrationWarning><body suppressHydrationWarning={true}>{children}</body></html>", "percentage": 85, "command": "suppressHydrationWarning", "note": "Suppresses warnings one level deep, protecting deeper server components"},
    {"solution": "Load app in incognito/private mode (disables extensions) to confirm extension source", "percentage": 90, "note": "Quick test to isolate if browser extensions are the root cause"}
  ]'::jsonb,
  'Next.js application with browser extensions installed. Local development environment. React hydration enabled.',
  'Not testing in incognito mode first. Adding suppressHydrationWarning globally without understanding root cause. Blaming Next.js when actual culprit is third-party extension.',
  0.89,
  'MEDIUM',
  'sonnet-4',
  NOW(),
  'https://stackoverflow.com/questions/75337953/what-causes-nextjs-warning-extra-attributes-from-the-server-data-new-gr-c-s-c'
),
(
  'How to redirect from root path to another page in Next.js',
  'stackoverflow-nextjs',
  '[
    {"solution": "Next.js 13+ with App Router: Use redirect() from next/navigation in default component export", "percentage": 96, "command": "import { redirect } from ''next/navigation''; export default async function Home() { redirect(''/hello-nextjs''); }", "note": "Simplest modern approach"},
    {"solution": "Use middleware.ts for all versions 12.1+: Create file at pages/middleware.ts with NextResponse.redirect()", "percentage": 92, "command": "export function middleware(request) { if (request.nextUrl.pathname === ''/'') { return NextResponse.redirect(new URL(''/hello'', request.url)); } }", "note": "Works globally for all route patterns"},
    {"solution": "Use getServerSideProps or getStaticProps: return { redirect: { destination: ''/hello-nextjs'', permanent: false } }", "percentage": 90, "command": "getServerSideProps for dynamic, getStaticProps for static", "note": "Page-level approach compatible with older versions"},
    {"solution": "Client-side useEffect Hook: Use router.push() after mount", "percentage": 75, "note": "Last resort - causes page flash. User sees root page briefly before redirect."}
  ]'::jsonb,
  'Next.js project with pages or app directory. Route configuration set up. Desired redirect destination exists.',
  'Using client-side redirect causing page flash. Not using permanent: true for permanent redirects (SEO impact). Middleware at wrong directory level.',
  0.91,
  'HIGH',
  'sonnet-4',
  NOW(),
  'https://stackoverflow.com/questions/58173809/next-js-redirect-from-to-another-page'
),
(
  'ESLint error: Parsing error - Cannot find module next/babel',
  'stackoverflow-nextjs',
  '[
    {"solution": "Ensure .eslintrc.json extends both ''next/babel'' and ''next/core-web-vitals'': \"extends\": [\"next/babel\", \"next/core-web-vitals\"]", "percentage": 95, "command": "{\"extends\": [\"next/babel\", \"next/core-web-vitals\"]}", "note": "Both extensions required. Using only next/babel causes red error signs despite successful compilation."},
    {"solution": "For Next.js 12+, try using just ''next'' instead of ''next/babel'' since SWC is default: \"extends\": [\"next\", \"next/core-web-vitals\"]", "percentage": 88, "note": "Next.js 12+ uses SWC (Rust compiler) by default, not Babel"},
    {"solution": "Avoid creating custom .babelrc file - disables SWC optimization and slows builds", "percentage": 90, "note": "Only create .babelrc if absolutely necessary. Causes performance regression."}
  ]'::jsonb,
  'Next.js 12+ project with ESLint configured. .eslintrc.json file present. No custom .babelrc file.',
  'Only using next/babel without next/core-web-vitals extension. Creating custom .babelrc unnecessarily. Confusing Babel configuration with Next.js built-in config.',
  0.93,
  'MEDIUM',
  'sonnet-4',
  NOW(),
  'https://stackoverflow.com/questions/68163385/parsing-error-cannot-find-module-next-babel'
),
(
  'How to set Next.js Image component to 100% width and height',
  'stackoverflow-nextjs',
  '[
    {"solution": "Set width/height to 0, sizes to 100vw, and apply inline styles: <Image width={0} height={0} sizes=\"100vw\" style={{width: ''100%'', height: ''auto''}} />", "percentage": 96, "note": "Modern Next.js 13+ approach. sizes attribute tells browser image occupies 100% viewport width."},
    {"solution": "Use responsive image syntax: width={0}, height={0}, sizes=\"(max-width: 768px) 100vw, (max-width: 1200px) 50vw, 33vw\" for different breakpoints", "percentage": 90, "note": "For truly responsive behavior across devices"},
    {"solution": "For Next.js 12 and below: Wrap in container with layout=\"fill\" and objectFit=\"contain\"", "percentage": 85, "note": "Older API: <Image layout=\"fill\" objectFit=\"contain\" /> inside positioned container"},
    {"solution": "Set size prop for optimization: <Image sizes=\"(max-width: 640px) 640px, 1280px\" />", "percentage": 88, "note": "Ensures correct image size is loaded based on device viewport"}
  ]'::jsonb,
  'Next.js 13+ project. Image component imported from next/image. Image source URL available.',
  'Setting arbitrary width/height percentages on Image directly. Forgetting sizes attribute causing improper responsive behavior. Using layout=\"fill\" as default instead of responsive syntax.',
  0.94,
  'MEDIUM',
  'sonnet-4',
  NOW(),
  'https://stackoverflow.com/questions/65169431/how-to-set-the-next-image-component-to-100-height'
),
(
  'Module not found: Cannot resolve fs module in Next.js application',
  'stackoverflow-nextjs',
  '[
    {"solution": "Configure webpack in next.config.js: config.resolve.fallback = { fs: false } for Webpack 5", "percentage": 94, "command": "module.exports = { webpack: (config) => { config.resolve.fallback = { fs: false }; return config; } }", "note": "fs is Node.js only, unavailable in browser. Tell webpack to exclude it."},
    {"solution": "For Webpack 4: Set config.node = { fs: ''empty'' } in next.config.js", "percentage": 85, "command": "config.node = { fs: ''empty'' }", "note": "Legacy approach for older webpack versions"},
    {"solution": "Move fs imports to getServerSideProps, getStaticProps, or getStaticPaths only", "percentage": 97, "note": "Best practice: Server-only code must exist only within server-specific functions"},
    {"solution": "Never import fs at module level - always use it inside server functions to avoid bundle errors", "percentage": 95, "note": "webpack can only eliminate fs from client bundle if import is inside clearly server-side function"}
  ]'::jsonb,
  'Next.js application attempting to use fs module. webpack configured in next.config.js. Understanding of server vs client code separation.',
  'Importing fs at module level outside server functions. Forgetting that fs is Node.js only, not available in browser. Not configuring webpack fallback.',
  0.91,
  'HIGH',
  'sonnet-4',
  NOW(),
  'https://stackoverflow.com/questions/64926174/module-not-found-cant-resolve-fs-in-next-js-application'
),
(
  'How to detect if code is running on server or client in Next.js',
  'stackoverflow-nextjs',
  '[
    {"solution": "Use typeof check: typeof window === ''undefined'' returns true on server, false on client", "percentage": 94, "note": "Standard approach. Window object exists only in browser."},
    {"solution": "Modern best practice: Use useState + useEffect to avoid hydration mismatches: const [isClient, setIsClient] = useState(false); useEffect(() => setIsClient(true), [])", "percentage": 93, "note": "Prevents differences between server-rendered and client-rendered content"},
    {"solution": "Use getServerSideProps for server logic instead of runtime detection when possible", "percentage": 90, "note": "Better pattern than checking environment at runtime. Cleaner separation of concerns."},
    {"solution": "Deprecated: Avoid process.browser - use typeof window instead", "percentage": 85, "note": "process.browser is legacy and no longer recommended"}
  ]'::jsonb,
  'Next.js application with server and client components. React component using hooks.',
  'Using deprecated process.browser instead of typeof window. Checking environment at module level causing hydration mismatches. Not using useEffect for client-only logic.',
  0.92,
  'HIGH',
  'sonnet-4',
  NOW(),
  'https://stackoverflow.com/questions/49411796/how-do-i-detect-whether-i-am-on-server-on-client-in-next-js'
),
(
  'React 18 Hydration failed: Initial UI does not match server-rendered HTML',
  'stackoverflow-nextjs',
  '[
    {"solution": "Fix invalid HTML nesting: Never nest block elements in inline elements (e.g., <div> in <p>, or <p> in <span>)", "percentage": 96, "note": "Most common cause. React 18 strictly compares server vs client HTML."},
    {"solution": "Defer client-only components until after hydration: const [domLoaded, setDomLoaded] = useState(false); useEffect(() => setDomLoaded(true), []); return domLoaded && <Component />", "percentage": 93, "note": "Prevents rendering differences between server and client"},
    {"solution": "Use Next.js dynamic() with ssr: false for problematic third-party components", "percentage": 90, "command": "const NoSSR = dynamic(() => import(''../component''), { ssr: false })", "note": "Renders component only on client, avoiding SSR mismatches"},
    {"solution": "Add suppressHydrationWarning on elements with intentional differences: <time suppressHydrationWarning />", "percentage": 80, "note": "Last resort. Use when difference is unavoidable."},
    {"solution": "Check for Material-UI Typography with wrong component prop causing invalid nesting", "percentage": 85, "note": "Default Typography renders as <p>. Override with component=\"div\" if needed."}
  ]'::jsonb,
  'Next.js application with React 18. SSR enabled. Multiple components with potential nesting issues.',
  'Invalid HTML element nesting (divs in paragraphs). Browser extensions injecting attributes (test in incognito). Incorrectly nested Link components. Not testing in incognito mode to check extensions.',
  0.88,
  'VERY_HIGH',
  'sonnet-4',
  NOW(),
  'https://stackoverflow.com/questions/71706064/react-18-hydration-failed-because-the-initial-ui-does-not-match-what-was-render'
),
(
  'Get URL pathname in Next.js router',
  'stackoverflow-nextjs',
  '[
    {"solution": "Use useRouter hook and access router.pathname: import { useRouter } from ''next/router''; const router = useRouter(); return <p>{router.pathname}</p>", "percentage": 96, "note": "Shows template pattern like /blog/[slug]"},
    {"solution": "For actual URL path (not template), use router.asPath instead of router.pathname", "percentage": 91, "note": "router.asPath shows /blog/my-post, pathname shows /blog/[slug]"},
    {"solution": "Next.js 13+ App Router: Use usePathname from next/navigation for client components", "percentage": 94, "command": "import { usePathname } from ''next/navigation''; const pathname = usePathname()", "note": "Updated hook for App Router"},
    {"solution": "For class components, use withRouter HOC: import { withRouter } from ''next/router''; export default withRouter(Page)", "percentage": 85, "note": "Legacy approach. Function components with hooks preferred."}
  ]'::jsonb,
  'Next.js application with routing configured. Function or class component. Knowledge of pathname vs asPath difference.',
  'Confusing router.pathname (template) with router.asPath (actual URL). Using wrong hook version for App Router vs Pages Router. Not checking if router is ready.',
  0.93,
  'MEDIUM',
  'sonnet-4',
  NOW(),
  'https://stackoverflow.com/questions/58022046/get-url-pathname-in-nextjs'
);

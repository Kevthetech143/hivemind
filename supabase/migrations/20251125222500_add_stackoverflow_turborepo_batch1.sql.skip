-- Add Stack Overflow Turborepo solutions batch 1
-- Extracted from highest-voted Turborepo questions with accepted answers
-- Total: 12 questions, 25-8 votes each

INSERT INTO knowledge_entries (
    query, category, hit_frequency, solutions, prerequisites, success_indicators,
    common_pitfalls, success_rate, claude_version, last_verified, source_url
) VALUES (
    'Share environment variables across all apps in Turborepo monorepo',
    'stackoverflow-turborepo',
    'VERY_HIGH',
    '[
        {"solution": "Install dotenv-cli as dev dependency at root and use globalDependencies in turbo.json. Run turbo with: dotenv -- turbo run dev", "percentage": 90, "note": "Official recommended approach from Turborepo docs", "command": "npm install -D dotenv-cli"},
        {"solution": "Use dotenv-mono package to automatically locate and load root .env files without relative path issues", "percentage": 85, "note": "Simplifies path management across workspaces"},
        {"solution": "Configure dotenv in each app early initialization: require(''dotenv'').config({path: ../../.env})", "percentage": 75, "note": "Manual approach, prone to path issues"}
    ]'::jsonb,
    'Node.js project, pnpm/npm/yarn installed, Root .env file created',
    'Environment variables accessible in all apps, Build scripts execute with correct env values, No undefined variable errors',
    'globalDependencies affects caching but does NOT load variables - must use dotenv-cli. Relative paths break across different nesting levels. .env file must be in root, not in packages.',
    0.92,
    'sonnet-4',
    NOW(),
    'https://stackoverflow.com/questions/70528983/share-env-variable-between-turborepo-monorepo-project'
),
(
    'Module aliases not resolving in Turborepo TypeScript build',
    'stackoverflow-turborepo',
    'HIGH',
    '[
        {"solution": "Fix paths configuration: remove ./ prefix in individual package tsconfig.json. Change @/components/* from ./components/* to components/*", "percentage": 92, "note": "Critical fix for monorepo path resolution"},
        {"solution": "Add paths mapping in root tsconfig.json pointing to all packages: @*: [./packages/ui/*, ./apps/project/src/*]", "percentage": 88, "note": "Ensures root-level path resolution"},
        {"solution": "Update build script to compile both TypeScript and resolve bundler imports correctly", "percentage": 80, "note": "May require transpilation setup"}
    ]'::jsonb,
    'Turborepo monorepo setup, TypeScript 4+, Individual package.json files with tsconfig.json',
    'TypeScript compilation succeeds, Module resolution in bundler works, VS Code intellisense recognizes imports',
    'Path aliases must be consistent across package and root tsconfig.json files. Do not use ./ prefix in monorepo packages. ESLint may cache old paths - restart IDE.',
    0.90,
    'sonnet-4',
    NOW(),
    'https://stackoverflow.com/questions/70947699/how-to-configure-module-aliases-in-a-monorepo-bootstrapped-with-turborepo'
),
(
    'Unexpected token export error in Turborepo shared packages',
    'stackoverflow-turborepo',
    'HIGH',
    '[
        {"solution": "Build shared TypeScript packages to CommonJS before consumption. Set main: ./dist/index.js and type: commonjs in package.json", "percentage": 94, "note": "Most reliable solution, endorsed by 18 votes", "command": "Build script: tsc --build --force tsconfig.json"},
        {"solution": "Configure tsconfig.json with proper target and module settings, add build step to dependencies", "percentage": 88, "note": "Ensures topological build order"},
        {"solution": "Use TypeScript path mappings to import from source instead of compiled output", "percentage": 70, "note": "Works but bypasses build process, not recommended"}
    ]'::jsonb,
    'Node.js 14+, TypeScript configured, Package.json with build script, NestJS or similar runtime environment',
    'Shared package builds to .js files, Import statements execute without syntax errors, No SyntaxError for export keyword',
    'Do not export TypeScript source directly. Must configure CommonJS output. Packages must build BEFORE being imported by other apps. Ensure turbo dependencies are ordered correctly.',
    0.94,
    'sonnet-4',
    NOW(),
    'https://stackoverflow.com/questions/73189881/turborepo-package-unexpected-token-export'
),
(
    'Error: environment variable not listed as dependency in turbo.json',
    'stackoverflow-turborepo',
    'HIGH',
    '[
        {"solution": "Add environment variable names to globalEnv array in turbo.json, then restart ESLint server in VS Code via command palette", "percentage": 95, "note": "Solves turbo/no-undeclared-env-vars ESLint rule", "command": "Restart ESLint server in VS Code"},
        {"solution": "Add actual configuration files to globalDependencies array instead of individual variables: globalDependencies: [.env.local]", "percentage": 85, "note": "Affects task hashing and cache invalidation"},
        {"solution": "Configure in turbo.json: env: [NEXT_PUBLIC_VAR, PRIVATE_VAR] within pipeline task config", "percentage": 80, "note": "Per-task configuration"}
    ]'::jsonb,
    'Turborepo 1.2+, turbo.json file configured, VS Code with ESLint extension, Environment variables set in .env files',
    'ESLint shows no errors for env variables, turbo run commands execute without dependency warnings, Build succeeds with proper env values',
    'Must restart ESLint server after updating turbo.json - changes do not apply immediately. globalDependencies is for cache invalidation, not variable loading. Variable names in globalEnv must match exact case.',
    0.95,
    'sonnet-4',
    NOW(),
    'https://stackoverflow.com/questions/74547130/error-variable-is-not-listed-as-a-dependency-in-turbo-json'
),
(
    'Convert existing Create React App to Turborepo monorepo',
    'stackoverflow-turborepo',
    'MEDIUM',
    '[
        {"solution": "Set up root package.json with workspaces config pointing to apps/* and packages/*, then add Turborepo as dev dependency with turbo.json", "percentage": 90, "note": "Requires restructuring project layout", "command": "npm install -D turbo"},
        {"solution": "Create individual package.json files in each workspace directory with proper package names and versions", "percentage": 88, "note": "Essential for workspace resolution"},
        {"solution": "Configure build scripts in root turbo.json and use workspace import syntax: import { useHook } from hooks", "percentage": 85, "note": "Depends on proper workspace setup"}
    ]'::jsonb,
    'Existing React app with Create React App, npm/yarn/pnpm installed, Project source code ready to restructure',
    'Workspace dependencies resolve correctly, All apps build successfully with turbo build, Shared components import cleanly',
    'Workspace names must match import paths exactly. Create React App does not handle TypeScript from monorepo by default - may need transpilation config. Moving files breaks git history.',
    0.88,
    'sonnet-4',
    NOW(),
    'https://stackoverflow.com/questions/70498521/how-to-use-turborepo-for-an-existing-react-app-created-with-create-react-app'
),
(
    'Next.js library consuming another library in Turborepo returns webpack loader error',
    'stackoverflow-turborepo',
    'HIGH',
    '[
        {"solution": "Add transpilePackages config in next.config.js for Next.js 12: withTM(["ui", "anotherui"]) using next-transpile-modules", "percentage": 94, "note": "31 votes - most reliable solution", "command": "npm install next-transpile-modules"},
        {"solution": "For Next.js 13+, use transpilePackages property in next.config.mjs: transpilePackages: [''ui'']", "percentage": 96, "note": "Modern approach, preferred over deprecated module"},
        {"solution": "Ensure all shared libraries are included in the transpilePackages array to handle nested dependencies", "percentage": 90, "note": "Critical for multi-level dependencies"}
    ]'::jsonb,
    'Next.js 12 or 13+, multiple libraries in packages/, next.config.js configured, TypeScript in shared packages',
    'Next.js build completes without loader errors, Webpack successfully transpiles .tsx files from packages, No Cannot find module errors',
    'Must include ALL libraries that depend on other libraries in transpilePackages - do not assume transitive loading. Next.js 13+ changed property name from module to transpilePackages. Webpack default does not transpile node_modules.',
    0.94,
    'sonnet-4',
    NOW(),
    'https://stackoverflow.com/questions/70923887/turborepo-library-consuming-another-library-you-may-need-an-appropriate-loader'
),
(
    'Pass arbitrary arguments to pnpm run scripts in Turborepo',
    'stackoverflow-turborepo',
    'MEDIUM',
    '[
        {"solution": "Use pnpm run build --foo=bar instead of pnpm build --foo=bar. Arguments pass directly to script without environment variable wrapper", "percentage": 95, "note": "Correct pnpm syntax, 9 votes from Zoltan Kochan maintainer", "command": "pnpm run build --arg=value"},
        {"solution": "Note that pnpm does not create npm_config_foo environment variables like npm does - arguments append directly to executed command", "percentage": 90, "note": "Different behavior from npm approach"},
        {"solution": "Use -- separator for complex arguments: pnpm run build -- --complex args", "percentage": 85, "note": "Works for complex argument passing"}
    ]'::jsonb,
    'pnpm 7+, Turborepo project with build scripts, Script that accepts arguments',
    'Arguments pass through to executed script, npm_config_* variables not expected (pnpm behavior), Command executes with correct parameters',
    'pnpm does NOT create npm_config_* environment variables - this is npm-specific behavior. Use pnpm run, not just pnpm. Arguments are NOT wrapped as environment variables.',
    0.95,
    'sonnet-4',
    NOW(),
    'https://stackoverflow.com/questions/74102152/how-to-pass-arbitrary-argument-with-pnpm'
),
(
    'NestJS cannot find module when importing from Turborepo packages',
    'stackoverflow-turborepo',
    'HIGH',
    '[
        {"solution": "Pre-compile internal packages to JavaScript: add build script to package.json, set main: ./dist/index and types: ./dist/index, run pnpm build before NestJS start", "percentage": 92, "note": "Most reliable, 2 votes, requires prior build"},
        {"solution": "Use webpack builder with SWC loader for just-in-time TypeScript compilation, similar to Next.js/Angular approach", "percentage": 85, "note": "Advanced setup, requires webpack config in monorepo"},
        {"solution": "Ensure turbo.json dependencies order builds packages before consuming apps", "percentage": 80, "note": "NestJS default tsc does not handle TypeScript in node_modules"}
    ]'::jsonb,
    'NestJS 9+, TypeScript configured, pnpm workspaces, Shared package with tsconfig.json',
    'NestJS starts without SyntaxError, Imports from packages resolve cleanly, No unexpected token errors for TypeScript syntax',
    'NestJS tsc compiler differs from bundlers - does not handle TypeScript source in node_modules by default. MUST pre-compile packages or use webpack builder. Node.js cannot execute TypeScript directly.',
    0.91,
    'sonnet-4',
    NOW(),
    'https://stackoverflow.com/questions/74746708/how-to-use-monorepo-packages-with-nestjs-using-turborepo'
),
(
    'React Vite SPA returns 404 on Vercel in Turborepo monorepo',
    'stackoverflow-turborepo',
    'MEDIUM',
    '[
        {"solution": "Move vercel.json from monorepo root to the individual app directory (where React app package.json is located)", "percentage": 96, "note": "Correct for monorepo deployments, 21 votes", "command": "Place vercel.json in apps/web/ directory"},
        {"solution": "Add vercel.json rewrite rules in app directory: {rewrites: [{source: /(.*)/,  destination: /}]}", "percentage": 94, "note": "SPA routing configuration"},
        {"solution": "Alternatively add 404.html to public folder with JavaScript redirect logic for SPA routing", "percentage": 75, "note": "Less reliable than rewrites approach"}
    ]'::jsonb,
    'Vite React app in Turborepo, Vercel project created, package.json in app directory, Client-side routing configured',
    'Vercel deployment returns 200 for client routes, SPA navigation works without 404 errors, All routes serve index.html correctly',
    'vercel.json in MONOREPO ROOT is ignored by Vercel for monorepo deployments - MUST be in app directory. Only per-app vercel.json is read. This differs from single-repo deployments.',
    0.96,
    'sonnet-4',
    NOW(),
    'https://stackoverflow.com/questions/70870735/react-js-vite-based-spa-returns-404-when-deployed-to-vercel-within-mono-repository'
),
(
    'ESLint configuration not applying to apps in Turborepo',
    'stackoverflow-turborepo',
    'HIGH',
    '[
        {"solution": "Remove root: true from top-level .eslintrc.js file - this prevents ESLint from recognizing app-level roots", "percentage": 93, "note": "9 votes, critical fix"},
        {"solution": "Add to .vscode/settings.json: eslint.workingDirectories: [{mode: auto}] to force ESLint to find configs in each app", "percentage": 88, "note": "VS Code specific configuration"},
        {"solution": "Move dynamic path loading from shared config into each app''s .eslintrc.cjs to avoid path resolution issues", "percentage": 85, "note": "Avoids shared config complexity"}
    ]'::jsonb,
    'Turborepo monorepo with shared ESLint config, ESLint extension in VS Code, Individual apps with their own .eslintrc files',
    'ESLint rules enforce in all app directories, VS Code shows correct linting errors, Config inheritance works across monorepo',
    'root: true in parent config breaks child resolution in monorepo. ESLint caches config - restart server to see changes. Shared config must avoid absolute paths. Do not reference specific app paths in root config.',
    0.92,
    'sonnet-4',
    NOW(),
    'https://stackoverflow.com/questions/74372070/turborepo-eslint-config-not-applying'
),
(
    'tRPC AppRouter type shows as any when imported in Turborepo',
    'stackoverflow-turborepo',
    'MEDIUM',
    '[
        {"solution": "Remove TypeScript path aliases from importing package tsconfig.json and use relative imports instead", "percentage": 88, "note": "Path aliases break type inference across monorepo boundaries"},
        {"solution": "Use Node.js subpath imports in package.json (identifiers start with #) as monorepo-friendly alternative: imports: {#*: ./src/*.ts}", "percentage": 92, "note": "Recommended by Turborepo docs, maintains types correctly"},
        {"solution": "Switch to Nx monorepo framework as alternative if type issues persist", "percentage": 60, "note": "Nuclear option, suggests systemic issues with tsconfig"}
    ]'::jsonb,
    'Turborepo monorepo, tRPC setup with service and client packages, TypeScript 4.5+, tRPC type generation working',
    'AppRouter type imports with correct typing (not any), Autocomplete works for tRPC procedures, Type checking passes',
    'TypeScript path aliases interfere with type resolution across packages - avoid in monorepo. Subpath imports (#) are preferred for monorepo type safety. Some IDEs may still show any despite correct config.',
    0.88,
    'sonnet-4',
    NOW(),
    'https://stackoverflow.com/questions/74958258/trpc-approuter-is-defined-as-any-on-import-with-turborepo'
),
(
    'Share Vite configuration across multiple projects in Turborepo',
    'stackoverflow-turborepo',
    'MEDIUM',
    '[
        {"solution": "Create plain JavaScript config file (not TypeScript) in shared package: packages/viconfig/index.js with type: module in package.json", "percentage": 90, "note": "7 votes, avoids transpilation issues"},
        {"solution": "Import shared config in each app''s vite.config.ts using ESM: import config from @monorepo/configs", "percentage": 88, "note": "Standard approach after creating JS config"},
        {"solution": "Use symlinks to TypeScript config files with postinstall script using symlink-dir package", "percentage": 70, "note": "Advanced, preserves types but adds complexity"}
    ]'::jsonb,
    'Turborepo monorepo with multiple Vite apps, Vite 3+, Shared @monorepo/configs package created, pnpm/npm/yarn workspaces',
    'All apps build with shared Vite config, No module resolution errors, Vite dev server starts successfully',
    'TypeScript config files in shared packages cause Unexpected token export - use JavaScript instead. type: module required to use ESM export syntax. Do not use require() to import ESM configs.',
    0.89,
    'sonnet-4',
    NOW(),
    'https://stackoverflow.com/questions/75132236/how-to-share-vite-config-in-monorepo'
),
(
    'Webpack not bundling packages in Turborepo, unexpected token export',
    'stackoverflow-turborepo',
    'MEDIUM',
    '[
        {"solution": "Implement NestJS monorepo mode per official documentation with proper dependency ordering in turbo.json", "percentage": 85, "note": "Official approach, but limited documentation"},
        {"solution": "Compile shared packages separately using TypeScript compiler: tsc --build with main/types pointing to dist/ output", "percentage": 88, "note": "More portable across frameworks"},
        {"solution": "Switch to Nx monorepo framework if Turborepo integration remains problematic", "percentage": 50, "note": "Last resort, indicates systemic incompatibility"}
    ]'::jsonb,
    'NestJS 9+, Turborepo setup, pnpm workspaces, TypeScript configured, Webpack 5+',
    'Webpack build completes successfully, NestJS app runs without syntax errors, ES6 exports from packages transpile correctly',
    'Webpack does not automatically transpile workspace dependencies. NestJS requires either monorepo mode OR pre-compiled packages. Turborepo caching can interfere with rebuild detection. webpack-node-externals may exclude shared packages.',
    0.86,
    'sonnet-4',
    NOW(),
    'https://stackoverflow.com/questions/73294477/webpack-not-bundling-packages-in-monorepo-turborepo'
);

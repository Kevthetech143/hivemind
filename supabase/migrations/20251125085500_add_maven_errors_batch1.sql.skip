-- Add Maven common errors and solutions from official documentation
-- Source: https://maven.apache.org/guides/

INSERT INTO knowledge_entries (
    query, category, hit_frequency, solutions, prerequisites, success_indicators,
    common_pitfalls, success_rate, claude_version, last_verified, source_url
) VALUES
(
    'Maven missing local repository configuration',
    'maven',
    'HIGH',
    '[
        {"solution": "Configure absolute path in settings.xml under localRepository element: <localRepository>/path/to/repo</localRepository>", "percentage": 95, "note": "Local repository must be absolute path, not relative"},
        {"solution": "Verify path permissions allow read/write access for Maven process", "percentage": 85, "note": "Common on shared systems with permission restrictions"},
        {"solution": "Use default location ~/.m2/repository if no custom path needed", "percentage": 90, "note": "Default location used if localRepository element omitted"}
    ]'::jsonb,
    'Maven installed, settings.xml file created',
    'mvn clean install completes without repository path errors, artifacts stored in configured location',
    'Do not use relative paths - Maven requires absolute paths. Ensure user running Maven has read/write permissions.',
    0.92,
    'sonnet-4',
    NOW(),
    'https://maven.apache.org/guides/mini/guide-configuring-maven.html'
),
(
    'Java version incompatibility with Maven compiler plugin',
    'maven',
    'VERY_HIGH',
    '[
        {"solution": "Upgrade maven-compiler-plugin to version 3.6.0 or higher in pom.xml", "percentage": 95, "note": "Required for Java 9+ compatibility", "command": "<version>3.14.1</version>"},
        {"solution": "Set source and target properties: <maven.compiler.source>11</maven.compiler.source> <maven.compiler.target>11</maven.compiler.target>", "percentage": 92, "note": "Match your project JDK version"},
        {"solution": "Use maven-toolchains-plugin to specify exact JDK version independent of Maven runtime JDK", "percentage": 88, "note": "Allows Maven to run on different JDK than compilation target"}
    ]'::jsonb,
    'Maven 3.5.0+, Java 9 or higher installed, pom.xml editable',
    'mvn clean compile succeeds, compilation uses correct Java version verified with javac -version',
    'Older compiler plugin versions (pre-3.6.0) fail silently on Java 9+. Always pin plugin version in POM for reproducibility.',
    0.94,
    'sonnet-4',
    NOW(),
    'https://maven.apache.org/guides/getting-started/maven-in-five-minutes.html'
),
(
    'Maven artifact not found in repository during dependency resolution',
    'maven',
    'HIGH',
    '[
        {"solution": "Clear local repository cache and retry: rm -rf ~/.m2/repository/{groupId_path} then mvn clean install", "percentage": 90, "note": "Corrupted artifacts in local cache cause resolution failures"},
        {"solution": "Verify artifact exists in configured repositories: mvn dependency:tree and check output", "percentage": 88, "note": "Dependency may not exist in used repository versions"},
        {"solution": "Add missing repository to pom.xml if artifact only available in custom repository", "percentage": 85, "note": "Central repository may not contain all dependencies"}
    ]'::jsonb,
    'Maven configured with internet access, pom.xml with dependency declaration',
    'mvn dependency:resolve completes successfully, artifact downloaded to ~/.m2/repository',
    'Corrupted JAR files in local cache cause hard-to-debug issues. Check repository accessibility - corporate proxies may block downloads.',
    0.88,
    'sonnet-4',
    NOW(),
    'https://maven.apache.org/guides/introduction/introduction-to-dependency-mechanism.html'
),
(
    'Maven profile not activating when expected',
    'maven',
    'MEDIUM',
    '[
        {"solution": "Check if profile is activated with: mvn help:active-profiles", "percentage": 93, "note": "View which profiles are currently active"},
        {"solution": "Fix profile activation criteria - all conditions must be true simultaneously (Maven 3.2.2+)", "percentage": 90, "note": "Earlier versions used OR logic, newer use AND"},
        {"solution": "For optional profiles, use -P ?profile-name to prevent error if profile missing", "percentage": 85, "command": "mvn package -P profile1,?profile2"},
        {"solution": "Verify profile defined in pom.xml profiles section and not in settings.xml if needs dependencies", "percentage": 82, "note": "settings.xml profiles cannot modify dependencies directly"}
    ]'::jsonb,
    'Maven 3.2.2+, pom.xml with profiles defined, build invoked with -P flag',
    'mvn help:active-profiles shows expected profile active, build uses profile-specific configuration',
    'Profile activation logic changed in Maven 3.2.2 - all criteria must match, not just one. External profiles cannot inject dependencies.',
    0.87,
    'sonnet-4',
    NOW(),
    'https://maven.apache.org/guides/introduction/introduction-to-profiles.html'
),
(
    'Maven settings.xml authentication not working for repository access',
    'maven',
    'HIGH',
    '[
        {"solution": "Verify server id in settings.xml matches repository id in pom.xml exactly", "percentage": 94, "note": "IDs must match for credentials to apply"},
        {"solution": "If using SSH private key, remove <password> element entirely from <server> section", "percentage": 92, "note": "Password presence causes key-based auth to fail silently"},
        {"solution": "Ensure settings.xml placed in ~/.m2/settings.xml (user) or ${maven.home}/conf/settings.xml (global)", "percentage": 90, "note": "File location affects when it is read"}
    ]'::jsonb,
    'settings.xml file created, repository credentials available, ~/.m2 directory writable',
    'mvn clean install succeeds with authenticated repository access, no 401 Unauthorized errors',
    'Server ID mismatch is silent - build fails with vague artifact not found error. Private key auth fails if password tag present.',
    0.91,
    'sonnet-4',
    NOW(),
    'https://maven.apache.org/settings.html'
),
(
    'Missing required elements in pom.xml: modelVersion, groupId, artifactId, or version',
    'maven',
    'MEDIUM',
    '[
        {"solution": "Add modelVersion 4.0.0 to POM root element: <modelVersion>4.0.0</modelVersion>", "percentage": 96, "note": "Mandatory in all valid POMs"},
        {"solution": "Include artifact coordinates: <groupId>com.example</groupId>, <artifactId>my-app</artifactId>, <version>1.0.0</version>", "percentage": 95, "note": "All three required unless inherited from parent"},
        {"solution": "For parent POMs, also add <packaging>pom</packaging> to establish aggregator", "percentage": 90, "note": "Required for multi-module projects"}
    ]'::jsonb,
    'pom.xml file created, text editor available',
    'mvn validate succeeds without parsing errors, mvn clean install runs without missing element warnings',
    'Missing modelVersion causes cryptic XML parsing errors. Parent POMs must use packaging=pom or children will not build correctly.',
    0.95,
    'sonnet-4',
    NOW(),
    'https://maven.apache.org/pom.html'
),
(
    'Maven plugin configuration inheritance issues or plugin version mismatch',
    'maven',
    'MEDIUM',
    '[
        {"solution": "Always specify plugin version in <pluginManagement> section for reproducibility: <version>3.14.1</version>", "percentage": 94, "note": "Prevents version drift across builds and machines"},
        {"solution": "Use <inherited>false</inherited> in parent POM plugin config to prevent child inheritance", "percentage": 88, "note": "Child POMs should have own plugin configuration"},
        {"solution": "For Maven 4+, control plugin execution order with brackets: <phase>test[100]</phase>", "percentage": 85, "note": "Lower numbers execute first"}
    ]'::jsonb,
    'pom.xml with parent-child POM structure, Maven 3.5+',
    'mvn clean install uses consistent plugin versions across modules, child modules inherit expected configuration',
    'Omitting plugin version allows Maven to use latest, breaking reproducibility. Plugin configs without version management cause drift.',
    0.89,
    'sonnet-4',
    NOW(),
    'https://maven.apache.org/guides/mini/guide-configuring-plugins.html'
),
(
    'Toolchain configuration error: Cannot find JDK version or toolchains.xml missing',
    'maven',
    'MEDIUM',
    '[
        {"solution": "Create toolchains.xml in ~/.m2/ directory with valid JDK entries matching plugin requirements", "percentage": 93, "note": "Must specify version and vendor to match pom.xml"},
        {"solution": "Verify jdkHome in toolchains.xml points to valid Java installation directory", "percentage": 90, "note": "Use absolute paths, verify directory exists"},
        {"solution": "Ensure maven-toolchains-plugin configured in pom.xml with matching version/vendor attributes", "percentage": 88, "note": "Configuration must match available toolchain entries"},
        {"solution": "For non-standard locations, use Maven 3.3.1+ with --global-toolchains option", "percentage": 82, "command": "mvn --global-toolchains /custom/path/toolchains.xml clean install"}
    ]'::jsonb,
    'Maven 3.3.1+, multiple Java versions installed, ~/.m2 directory writable',
    'mvn clean install uses configured JDK version, compilation target matches toolchain configuration',
    'Toolchains.xml syntax errors are hard to debug - validate XML carefully. Version matching is strict (1.8 will not match 1.8.0_265).',
    0.86,
    'sonnet-4',
    NOW(),
    'https://maven.apache.org/guides/mini/guide-using-toolchains.html'
),
(
    'Maven multi-module build failure: reactor sorting or module dependency order incorrect',
    'maven',
    'MEDIUM',
    '[
        {"solution": "Ensure all modules declared in parent <modules> section in correct dependency order", "percentage": 92, "note": "Reactor must resolve module dependencies correctly"},
        {"solution": "Use mvn clean install --fail-at-end to identify all module failures, not just first", "percentage": 88, "note": "Default --fail-fast stops at first error masking other issues"},
        {"solution": "Remember that <dependencyManagement> and <pluginManagement> do not affect reactor sort order", "percentage": 85, "note": "Only actual dependencies in <dependencies> affect ordering"},
        {"solution": "Use --resume-from :module-name to restart build from specific module after failure", "percentage": 80, "command": "mvn clean install --resume-from :my-module"}
    ]'::jsonb,
    'Maven 3.0+, multi-module project with parent POM, all modules buildable',
    'mvn clean install builds all modules in dependency order, --resume-from works to skip earlier modules',
    'Forgetting to declare modules in <modules> element causes undefined build order. Management declarations do not affect sorting.',
    0.84,
    'sonnet-4',
    NOW(),
    'https://maven.apache.org/guides/mini/guide-multiple-modules.html'
),
(
    'Maven build reproducibility issue: different results on Windows vs Unix or different JDK versions',
    'maven',
    'MEDIUM',
    '[
        {"solution": "Add project.build.outputTimestamp property to POM for reproducible timestamps", "percentage": 92, "note": "Eliminates platform-specific timestamp variations"},
        {"solution": "Standardize line endings: Windows uses CRLF, Unix uses LF - configure with maven-resources-plugin", "percentage": 88, "note": "Different line endings produce different bytecode"},
        {"solution": "Use same JDK major version across all build environments", "percentage": 90, "note": "Different JDK versions produce different bytecode"},
        {"solution": "Verify reproducibility with: mvn clean verify artifact:compare tool", "percentage": 85, "note": "Use diffoscope for detailed binary comparison"}
    ]'::jsonb,
    'Maven 3.5+, consistent JDK version, artifact-maven-plugin available',
    'Successive builds produce identical checksums, artifact:compare shows no differences between builds',
    'Platform line ending differences are subtle but cause reproducibility failures. JDK version must be exactly same across builds.',
    0.85,
    'sonnet-4',
    NOW(),
    'https://maven.apache.org/guides/mini/guide-reproducible-builds.html'
),
(
    'Maven classloader issue: Plugin cannot load classes or NoClassDefFoundError in build',
    'maven',
    'LOW',
    '[
        {"solution": "Add @requiresDependencyResolution annotation to plugin Mojo to access project classpath", "percentage": 92, "note": "Plugin classloader isolated from project by default"},
        {"solution": "Add required classes directly to plugin classloader, not through custom classloaders", "percentage": 88, "note": "Custom classloaders cannot be accessed by plugin loader"},
        {"solution": "Verify plugin dependencies included in POM, not just project dependencies", "percentage": 85, "note": "Plugin uses own classloader separate from project"}
    ]'::jsonb,
    'Maven plugin development context, Mojo class editable, plugin dependencies defined',
    'Plugin executes without NoClassDefFoundError, @requiresDependencyResolution annotation works correctly',
    'Build extensions are isolated from each other - one extension cannot access another extension''s classes.',
    0.87,
    'sonnet-4',
    NOW(),
    'https://maven.apache.org/guides/mini/guide-maven-classloading.html'
),
(
    'Duplicate plugin definition in same build phase causing build failure in Maven 4',
    'maven',
    'LOW',
    '[
        {"solution": "Consolidate duplicate plugin entries: remove one copy of repeated plugin in pom.xml", "percentage": 96, "note": "Maven 3 warns, Maven 4 fails build"},
        {"solution": "If needing multiple executions, use separate <execution> blocks with different ids", "percentage": 94, "note": "Multiple goals in separate executions is valid"},
        {"solution": "Check parent POM for plugin - may be inherited, then override in child rather than add new entry", "percentage": 90, "note": "Use <configuration> override, not duplicate declaration"}
    ]'::jsonb,
    'Maven 4.0+, pom.xml with plugins section, grep access to find duplicates',
    'mvn clean install succeeds without duplicate plugin definition errors',
    'Maven 3 allows duplicate plugins (warns only), Maven 4 makes this a build failure. Check both pom.xml and parent POMs.',
    0.93,
    'sonnet-4',
    NOW(),
    'https://maven.apache.org/pom.html'
);

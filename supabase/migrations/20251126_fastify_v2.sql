INSERT INTO knowledge_entries (query, category, hit_frequency, solutions, prerequisites, success_indicators, common_pitfalls, success_rate, claude_version, last_verified, source_url, contributor_email) VALUES
('Default error handler returns statusCode 500 with generic message', 'fastify', 'HIGH', '[{"solution": "Create custom Error class extending Error with statusCode property and throw from handlers", "percentage": 95}, {"solution": "Use setErrorHandler method to catch and format errors with custom statusCode", "percentage": 90}]'::jsonb, 'Node.js, Fastify knowledge', 'Custom error message returned with correct status code', 'Not setting statusCode on error object before throwing', 0.93, 'haiku', NOW(), 'https://stackoverflow.com/questions/69967582/how-to-work-with-error-handling-in-fastify', 'admin:1764210341'),

('Cannot return custom error properties with default Fastify serializer', 'fastify', 'HIGH', '[{"solution": "Add custom properties to Error object and handle in setErrorHandler", "percentage": 92}, {"solution": "Define custom error schema in reply.status().send() with explicit field mapping", "percentage": 88}]'::jsonb, 'Fastify v3 or v4', 'Custom error properties appear in response', 'Relying on default serializer to preserve custom Error properties', 0.90, 'haiku', NOW(), 'https://stackoverflow.com/questions/74287633/how-to-return-a-custom-error-from-fastify-v3', 'admin:1764210341'),

('Custom validation error message not working with i18next translation in setErrorHandler', 'fastify', 'MEDIUM', '[{"solution": "Use preValidation hook instead of preHandler to initialize i18next translation before error handler", "percentage": 89}, {"solution": "Move plugin registration before setErrorHandler and use addHook with correct timing", "percentage": 85}]'::jsonb, 'Fastify, i18next-http-middleware', 'Translation function available in error handler', 'Plugin initialization timing causes undefined request.t in setErrorHandler', 0.87, 'haiku', NOW(), 'https://stackoverflow.com/questions/66944316/fastify-i18next-in-custom-error-handler', 'admin:1764210341'),

('FastifyError: plugin version mismatch - expected ^4.0.0 fastify version', 'fastify', 'HIGH', '[{"solution": "Install compatible @fastify/formbody v6.x for Fastify v3: npm install @fastify/formbody@6", "percentage": 96}, {"solution": "Upgrade Fastify to v4: npm install fastify@next", "percentage": 85}]'::jsonb, 'npm package manager', 'Plugin loads without version mismatch error', 'Installing latest plugin version without checking Fastify version compatibility', 0.94, 'haiku', NOW(), 'https://stackoverflow.com/questions/72438159/fastifyerror-error-fastify-plugin-fastify-formbody-expected-4-0-0-fast', 'admin:1764210341'),

('Cannot customize validation error format with AJV schema in Fastify', 'fastify', 'MEDIUM', '[{"solution": "Enable allErrors in AJV customOptions and implement setErrorHandler to format error.validation array", "percentage": 91}, {"solution": "Use schemaErrorFormatter to change message, then setErrorHandler for complete output format", "percentage": 87}]'::jsonb, 'Fastify AJV configuration', 'Validation errors return in custom format with specific fields', 'Assuming schemaErrorFormatter alone changes response structure', 0.89, 'haiku', NOW(), 'https://stackoverflow.com/questions/77295883/how-to-customize-an-errors-with-fastify-ajv-and-schema', 'admin:1764210341'),

('Plugin must be a function or a promise - received object', 'fastify', 'HIGH', '[{"solution": "Wrap route object in async function and use fastify.route() to register each route", "percentage": 94}, {"solution": "Export default async function that receives fastify and registers routes via fastify.route()", "percentage": 92}]'::jsonb, 'Fastify plugin system knowledge', 'Routes register without AVV_ERR_PLUGIN_NOT_VALID error', 'Passing plain object instead of async function to fastify.register()', 0.95, 'haiku', NOW(), 'https://stackoverflow.com/questions/77846398/fastify-error-plugin-must-be-a-function-or-a-promise-received-object', 'admin:1764210341'),

('Error handler returns wrong error if reply.code called before throwing', 'fastify', 'MEDIUM', '[{"solution": "Call reply.status() and send() in setErrorHandler instead of before throwing", "percentage": 90}, {"solution": "Ensure error handler catches and formats response with correct status and payload", "percentage": 88}]'::jsonb, 'Fastify error handling patterns', 'Error response uses handler-defined status and format', 'Setting reply status before error is thrown', 0.88, 'haiku', NOW(), 'https://stackoverflow.com/questions/72632936/fastify-error-handler-returns-wrong-error-if-i-call-reply-code-before-returnin', 'admin:1764210341'),

('Zod validation error not handled properly in Fastify routes', 'fastify', 'MEDIUM', '[{"solution": "Implement try-catch around Zod validation and throw custom error with schema validation details", "percentage": 89}, {"solution": "Use setErrorHandler to catch Zod validation errors and format response", "percentage": 86}]'::jsonb, 'Fastify, Zod schema validation', 'Zod validation errors properly formatted in response', 'Not catching Zod validation exceptions in route handlers', 0.87, 'haiku', NOW(), 'https://stackoverflow.com/questions/78009893/problem-with-error-handling-in-nodejs-with-fastify', 'admin:1764210341'),

('Session data overwritten by preHandler hook on every request', 'fastify', 'MEDIUM', '[{"solution": "Check if session exists before initializing: if (!request.session.sessionData)", "percentage": 93}, {"solution": "Initialize session in onRequest hook only once or check existing data", "percentage": 89}]'::jsonb, 'Fastify session management', 'Session data persists across requests without being reset', 'Overwriting session in preHandler hook every request', 0.91, 'haiku', NOW(), 'https://stackoverflow.com/questions/62180315/fastify-session-is-throwing-something-that-i-dont-understand', 'admin:1764210341'),

('Cannot access session in fastify-websocket rawRequest - session not decorated', 'fastify', 'MEDIUM', '[{"solution": "Create custom session store and retrieve session from store using sessionId from cookie header", "percentage": 87}, {"solution": "Use MemoryStore and manually parse sessionId cookie to access session data in websocket handler", "percentage": 84}]'::jsonb, 'Fastify WebSocket, session management', 'Session data accessible in WebSocket connection handler', 'Expecting fastify-session decoration on rawRequest in websocket handlers', 0.85, 'haiku', NOW(), 'https://stackoverflow.com/questions/64498762/when-using-fastify-session-and-fastify-webockets-how-do-i-get-access-to-the-ses', 'admin:1764210341');

-- Add Stack Overflow Playwright solutions batch 1
-- Category: stackoverflow-playwright
-- Source: Highest-voted Playwright questions with accepted answers

INSERT INTO knowledge_entries (
    query, category, hit_frequency, solutions, prerequisites, success_indicators,
    common_pitfalls, success_rate, claude_version, last_verified, source_url
) VALUES
(
    'How to check if an element exists on the page in Playwright.js',
    'stackoverflow-playwright',
    'HIGH',
    '[
        {"solution": "Use page.isVisible() method to check if element is attached to DOM and visible", "percentage": 92, "command": "await page.isVisible(\"text=\'Delete\'\")"},
        {"solution": "Use locator.count() to verify element presence without visibility requirement", "percentage": 88, "note": "Returns 0 if element does not exist"},
        {"solution": "Combine with conditional logic for recursive operations on repeating elements", "percentage": 85, "note": "Safe for loops that depend on element removal"}
    ]'::jsonb,
    'Playwright.js library installed, Valid page object context, Proper selector syntax (CSS, text, or xpath)',
    'isVisible() returns boolean, Element is/is not visible on page, Conditional branch executes correctly',
    'Do not use page.$$() with inequality comparison - arrays are always truthy even when empty. isVisible() only detects elements in viewport - elements below the fold may not register. Without await, promise handling fails. expect() assertions only work in Playwright Test, not standalone scripts.',
    0.92,
    'sonnet-4',
    NOW(),
    'https://stackoverflow.com/questions/64784781/how-to-check-if-an-element-exists-on-the-page-in-playwright-js'
),
(
    'How can I assert that an element is NOT on the page in playwright',
    'stackoverflow-playwright',
    'HIGH',
    '[
        {"solution": "Use expect(page.locator(selector)).toHaveCount(0) with auto-retry until timeout", "percentage": 94, "command": "await expect(page.locator(\".notexists\")).toHaveCount(0)"},
        {"solution": "Use expect().not.toBeAttached() to verify single element is not in DOM", "percentage": 88, "note": "More specific than count-based checks"},
        {"solution": "Use expect().toBeHidden() if only verifying visibility, not DOM presence", "percentage": 85, "note": "Less strict than attachment checks"}
    ]'::jsonb,
    'Playwright testing framework installed, Understanding of locators and expect() API, Familiarity with async/await',
    'Assertion passes without error, Element count returns 0, Test completes within timeout',
    'Forgetting await on expect statement causes promise resolution failures. Using instant checks like expect(await locator.count()).toEqual(0) fails immediately without waiting. Confusing toHaveCount(0) with not.toBeAttached() - they have different strictness levels. Misunderstanding visibility vs attachment - hidden elements may still be in DOM.',
    0.94,
    'sonnet-4',
    NOW(),
    'https://stackoverflow.com/questions/71183099/how-can-i-assert-that-an-element-is-not-on-the-page-in-playwright'
),
(
    'Getting value of input element in Playwright',
    'stackoverflow-playwright',
    'HIGH',
    '[
        {"solution": "Use page.inputValue() method available since v1.13.0 to retrieve input .value property", "percentage": 93, "command": "await page.inputValue(\"input#my-input\")"},
        {"solution": "Use locator.inputValue() with modern selector API for chainable syntax", "percentage": 91, "command": "await page.locator(\"input#my-input\").inputValue()"},
        {"solution": "Use expect(page.locator(selector)).toHaveValue(value) to assert input value matches expected", "percentage": 89, "note": "Supports regex patterns and auto-waits for condition"}
    ]'::jsonb,
    'Playwright v1.13.0+ for inputValue() method, Playwright v1.20+ for toHaveValue() matcher, Valid element selector targeting input/textarea elements',
    'inputValue() returns string value from element, toHaveValue() assertion passes without error, Retrieved value matches expected input',
    'Methods throw errors on non-input elements - verify selector targets correct element type. Actionability checks included in locator methods but older $eval() approaches require manual waits. Element handles no longer recommended - use locators instead in modern Playwright versions. Attempting to use on non-form elements fails.',
    0.93,
    'sonnet-4',
    NOW(),
    'https://stackoverflow.com/questions/62002041/getting-value-of-input-element-in-playwright'
),
(
    'Get current page url with Playwright Automation tool',
    'stackoverflow-playwright',
    'HIGH',
    '[
        {"solution": "Use page.url() method synchronously without await to retrieve current URL as string", "percentage": 95, "command": "page.url()"},
        {"solution": "Use expect(page).toHaveURL(url) assertion to verify page navigated to expected URL", "percentage": 90, "note": "Includes auto-waiting for navigation completion"},
        {"solution": "Use page.evaluate(() => document.location.href) to access URL through JavaScript execution", "percentage": 85, "note": "Alternative approach using browser context"}
    ]'::jsonb,
    'Instantiated Page object, Valid Playwright browser context, Page must have completed navigation',
    'page.url() returns string containing current URL, expect().toHaveURL() assertion passes, URL matches expected destination',
    'Do not use await with page.url() - it is not a promise and requires synchronous access. Using expect(page).toHaveURL() when page is still navigating causes timeout. Confusion between page.url() and document.location in browser context. Using page.evaluate() without proper context handling.',
    0.95,
    'sonnet-4',
    NOW(),
    'https://stackoverflow.com/questions/64308751/get-current-page-url-with-playwright-automation-tool'
),
(
    'Playwright: how to wait until there is no animation on the page',
    'stackoverflow-playwright',
    'MEDIUM',
    '[
        {"solution": "Use page.waitForLoadState(\"domcontentloaded\") instead of \"networkidle\" for JavaScript-heavy sites", "percentage": 88, "command": "await page.waitForLoadState(\"domcontentloaded\")"},
        {"solution": "Implement DOM polling by comparing markup snapshots until HTML remains stable for specified duration", "percentage": 85, "note": "Default poll delay 50ms, stability check 350ms", "command": "Compare page.evaluate(() => document.body.innerHTML) repeatedly"},
        {"solution": "Compare consecutive page screenshots to detect animation completion", "percentage": 78, "note": "Resource-intensive but works for CSS animations"},
        {"solution": "Disable animations during tests by applying .no-motion CSS class", "percentage": 82, "note": "Most reliable - sets animation-duration and transition-duration to 0s"}
    ]'::jsonb,
    'Understanding of Playwright page API, Knowledge of application loading patterns, For CSS disable approach: ability to modify test HTML/CSS',
    'page.waitForLoadState() completes without timeout, DOM markup remains unchanged between polls, Screenshots show stable content, Animations complete visually',
    'waitForLoadState(\"networkidle\") unreliable - only waits 500ms without network traffic which fails on heavy JS sites. Screenshot comparison is resource-intensive and slows test execution. DOM polling adds overhead - consider if necessary. CSS animation disabling changes test environment vs real conditions. Hard-coded timeouts create brittle tests.',
    0.85,
    'sonnet-4',
    NOW(),
    'https://stackoverflow.com/questions/71937343/playwright-how-to-wait-until-there-is-no-animation-on-the-page'
),
(
    'How to pause the test script for 3 seconds before continue running it',
    'stackoverflow-playwright',
    'MEDIUM',
    '[
        {"solution": "Use page.waitForTimeout(milliseconds) to pause execution with exact duration", "percentage": 75, "command": "await page.waitForTimeout(3000)"},
        {"solution": "Wait for specific UI state instead: use expect(page.locator(selector)).toContainText() for element visibility", "percentage": 90, "note": "Preferred - waits for meaningful changes not time"},
        {"solution": "Use expect.poll() to repeatedly check condition until met", "percentage": 88, "command": "await expect.poll(async () => { return await page.locator(selector).count() }).toBe(expectedCount)"},
        {"solution": "Wait for specific selectors: page.locator(selector).waitFor({state: \"hidden\"}) for loading indicators", "percentage": 89, "note": "Best practice - conditions-based waiting"}
    ]'::jsonb,
    'Playwright installed and configured, Understanding of async/await syntax, Access to page selectors for UI elements being tested',
    'waitForTimeout() completes without error, Test continues after exact pause duration, State-based waits detect actual UI changes',
    'Hard-coded timeouts create brittle tests prone to flakiness across environments. Fixed pauses artificially inflate test duration - hard waits slow entire suite. Missing state-based conditions - should detect actual UI changes not guess timing. Hard waits fail in CI/slow machines but pass locally.',
    0.80,
    'sonnet-4',
    NOW(),
    'https://stackoverflow.com/questions/69806337/how-to-pause-the-test-script-for-3-seconds-before-continue-running-it-playwrigh'
),
(
    'How can I select an element by Id in Playwright',
    'stackoverflow-playwright',
    'HIGH',
    '[
        {"solution": "Use page.locator(\"#YourId\") CSS ID selector with hash syntax for modern approach", "percentage": 93, "command": "await page.locator(\"#YourId\").click()"},
        {"solution": "Use bracket notation for IDs with special characters: page.locator(\"[id=\\\"next\\\"]\") CSS attribute syntax", "percentage": 88, "command": "await page.click(\"[id=\'next\']\")"},
        {"solution": "Use page.getByRole() or page.getByText() instead of IDs for more resilient selectors", "percentage": 90, "note": "Recommended by Playwright docs - more resistant to implementation changes"}
    ]'::jsonb,
    'Playwright testing framework installed and configured, Target element must have id attribute in HTML, Valid CSS selector syntax',
    'Element is selected and action executes, Click/interaction succeeds, Correct DOM element responds to action',
    'Relying on user-visible text like button names fails across different language versions. IDs with periods require escaping in hash syntax or use bracket notation. Assuming ID-based selection is most resilient - Playwright recommends role/text-based locators. Special characters in IDs cause selector parsing failures.',
    0.93,
    'sonnet-4',
    NOW(),
    'https://stackoverflow.com/questions/75151754/how-can-i-select-an-element-by-id'
),
(
    'How to get a collection of elements with playwright',
    'stackoverflow-playwright',
    'HIGH',
    '[
        {"solution": "Use page.$$(selector) to retrieve all DOM elements matching CSS selector as ElementHandle array", "percentage": 91, "command": "const images = await page.$$(\"img\")"},
        {"solution": "Use modern page.locator(selector).all() method (v1.29+) instead of page.$$ for chainable API", "percentage": 92, "command": "const items = await page.locator(\".item\").all()"},
        {"solution": "Check element count with array .length property or locator.count()", "percentage": 88, "command": "const count = (await page.$$(\"selector\")).length"}
    ]'::jsonb,
    'Playwright library installed, Active page instance after navigation to URL, Valid CSS selector string matching elements',
    'page.$$() returns array of ElementHandle objects, Array length matches expected count, Correct elements selected',
    'Using single $() instead of double $$() returns only first match - use double for all elements. Not awaiting the async call causes immediate failure. Forgetting .length property when checking count. Deprecated element handles used instead of modern locator API (v1.29+). Assuming $$ works without prior page navigation.',
    0.91,
    'sonnet-4',
    NOW(),
    'https://stackoverflow.com/questions/61453673/how-to-get-a-collection-of-elements-with-playwright'
),
(
    'Playwright VSCode gives No tests found message',
    'stackoverflow-playwright',
    'MEDIUM',
    '[
        {"solution": "Close VSCode completely and open project from terminal: code . to inherit shell environment variables", "percentage": 89, "command": "code ."},
        {"solution": "For NVM users: set default Node version with nvm alias default node and restart terminal", "percentage": 85, "note": "Ensures shell environment properly configured"},
        {"solution": "Verify playwright.config.ts testDir path points to actual test file locations", "percentage": 80, "note": "Check configuration accuracy"},
        {"solution": "Update Playwright extension and @playwright/test package to compatible versions", "percentage": 82, "note": "Version mismatches prevent test discovery"}
    ]'::jsonb,
    'Node.js installed and accessible via terminal, VSCode installed with Playwright Test extension, Project folder containing playwright.config.ts and test files',
    'VSCode recognizes tests when opened via terminal, Extension discovers test files successfully, Tests run via CLI and in VSCode',
    'VSCode launched from GUI may not inherit shell environment setup - use terminal. If using NVM, ensure default version set. Environment variables not properly configured cause detection failures. testDir path in playwright.config.ts must match actual location. Version mismatches between extension and @playwright/test prevent discovery.',
    0.85,
    'sonnet-4',
    NOW(),
    'https://stackoverflow.com/questions/72100106/playwright-vscode-gives-no-tests-found-message'
),
(
    'What is the difference between testing on Safari vs Webkit in Playwright',
    'stackoverflow-playwright',
    'MEDIUM',
    '[
        {"solution": "Understand WebKit is rendering engine used by Safari but platform implementations differ", "percentage": 88, "note": "WebKit in Playwright uses different network stack and compositing than Safari"},
        {"solution": "On macOS: WebKit testing is safe proxy for Safari behavior - same rendering and JS execution", "percentage": 90, "note": "macOS WebKit matches Safari implementation"},
        {"solution": "On Linux/Windows: WebKit differs from Safari - uses non-macOS network stack and Core Animation", "percentage": 87, "note": "Core functionality consistent but visual output may differ"},
        {"solution": "For visual testing accuracy: run tests on macOS for Safari equivalence, other platforms show platform differences", "percentage": 82, "note": "Screenshot comparisons require platform matching"}
    ]'::jsonb,
    'Understanding rendering engines distinct from browser implementations, Awareness of platform-specific compositing differences, Knowledge that Safari includes proprietary components',
    'WebKit tests execute successfully, Functionality behaves consistently with target browser, Platform-specific visual differences noted',
    'Assuming WebKit tests provide perfect Safari equivalence - may miss Safari-specific bugs. Version drift between Playwright WebKit and shipping Safari versions. Cross-platform screenshot comparisons without macOS testing miss visual differences. Overconfidence in visual testing across platforms.',
    0.87,
    'sonnet-4',
    NOW(),
    'https://stackoverflow.com/questions/62184117/what-is-the-difference-between-testing-on-safari-vs-webkit'
),
(
    'How to wait for requests and validate responses using playwright',
    'stackoverflow-playwright',
    'HIGH',
    '[
        {"solution": "Use Promise.all() with page.waitForResponse() to establish listener before action triggers", "percentage": 94, "command": "await Promise.all([page.waitForResponse(resp => resp.url().includes(\"/api\") && resp.status() === 200), element.click()])"},
        {"solution": "Use flexible URL matching with .includes() instead of exact URLs that contain dynamic IDs", "percentage": 88, "note": "Prevents failures from dynamic parameters"},
        {"solution": "Filter responses by status code to verify expected API responses", "percentage": 86, "command": "resp.status() === 200 || resp.status() === 400"},
        {"solution": "Avoid testing implementation details - prefer UI state assertions over response codes", "percentage": 80, "note": "Tests UI contracts not internal implementation"}
    ]'::jsonb,
    'Playwright page object initialized, Target element selector or method reference, Knowledge of expected response URL pattern and status code',
    'waitForResponse() listener captures response before timeout, Response URL matches expected pattern, Status code matches expected value, Assertion on response passes',
    'Calling waitForResponse() after action may miss fast responses - establish listener first. Not capturing response with const [response] = prevents accessing response data. Overly specific URLs with dynamic IDs cause flaky tests - use .includes() for flexibility. Status code assertions test implementation not behavior - focus on UI changes instead.',
    0.90,
    'sonnet-4',
    NOW(),
    'https://stackoverflow.com/questions/66789642/how-to-wait-for-requests-and-validate-responses-using-playwright'
),
(
    'Playwright error Target closed after navigation',
    'stackoverflow-playwright',
    'MEDIUM',
    '[
        {"solution": "Replace mixed promise patterns with consistent async/await syntax throughout code", "percentage": 91, "command": "Use await consistently instead of mixing .then() and await"},
        {"solution": "Ensure all asynchronous operations awaited before accessing results", "percentage": 89, "note": "Prevents race conditions and context loss"},
        {"solution": "Use page.waitForSelector() with await and avoid chaining .then() handlers", "percentage": 87, "command": "await page.waitForSelector(selector)"},
        {"solution": "Use page.$eval() to extract data instead of calling methods on unresolved promises", "percentage": 85, "command": "await page.$eval(selector, elem => elem.textContent)"}
    ]'::jsonb,
    'Playwright 1.0.2 or later, Understanding of async/await syntax, Navigation must complete before selector queries execute',
    'Code executes without Target closed error, Navigation completes before selectors queried, Element data extracted successfully',
    'Mixing .then() and await causes race conditions and context loss - use consistent pattern. Not awaiting waitForSelector() results in operations on unresolved promises. Missing await on textContent() calls treats async results as synchronous. Poor promise composition triggers navigation without proper sequencing. Calling methods before navigation completes fails.',
    0.88,
    'sonnet-4',
    NOW(),
    'https://stackoverflow.com/questions/61933492/playwright-error-target-closed-after-navigation'
);

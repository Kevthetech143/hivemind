-- Add Stack Overflow solutions batch 13: Heroku, Prisma, Vite, Svelte
-- Source: Stack Overflow accepted answers with community verification

-- Heroku: H10 App crashed
INSERT INTO knowledge_entries (
    query, category, hit_frequency, solutions, prerequisites, success_indicators,
    common_pitfalls, success_rate, claude_version, last_verified, source_url
) VALUES (
    'Heroku error code H10: App crashed',
    'heroku',
    'VERY_HIGH',
    '[
        {"solution": "Use process.env.PORT for port binding: app.listen(process.env.PORT || 3000)", "percentage": 95, "note": "Heroku assigns port dynamically"},
        {"solution": "Check heroku logs --tail for actual error: Look for crash reason in logs", "percentage": 90, "command": "heroku logs --tail", "note": "Verbose error messages"},
        {"solution": "Verify Procfile web command: web: node server.js or appropriate start command", "percentage": 85, "note": "Procfile defines how to start app"}
    ]'::jsonb,
    'Heroku account, App deployed to Heroku, Procfile configured',
    'App starts successfully, heroku ps shows running dynos, No H10 errors in logs',
    'H10 means app crashed during startup. Most common: not using process.env.PORT. Check logs for actual crash reason.',
    0.95,
    'sonnet-4',
    NOW(),
    'https://stackoverflow.com/questions/14322989/'
);

-- Heroku: R10 Boot timeout
INSERT INTO knowledge_entries (
    query, category, hit_frequency, solutions, prerequisites, success_indicators,
    common_pitfalls, success_rate, claude_version, last_verified, source_url
) VALUES (
    'Heroku error R10: Boot timeout - Web process failed to bind to $PORT',
    'heroku',
    'HIGH',
    '[
        {"solution": "Bind to process.env.PORT within 60 seconds: app.listen(process.env.PORT)", "percentage": 95, "note": "Must bind within timeout"},
        {"solution": "Remove localhost binding: Use app.listen(PORT) not app.listen(PORT, ''localhost'')", "percentage": 90, "note": "Localhost binding fails on Heroku"},
        {"solution": "Check for synchronous blocking code in startup: Move heavy operations to after server starts", "percentage": 80, "note": "Startup must be fast"}
    ]'::jsonb,
    'Heroku app, Web process configured',
    'App binds to port within 60 seconds, dyno shows as up, No R10 errors',
    'R10 timeout means app did not bind to $PORT in 60 seconds. Do not bind to localhost - omit host parameter.',
    0.95,
    'sonnet-4',
    NOW(),
    'https://stackoverflow.com/questions/38874760/'
);

-- Heroku: Console verbose error
INSERT INTO knowledge_entries (
    query, category, hit_frequency, solutions, prerequisites, success_indicators,
    common_pitfalls, success_rate, claude_version, last_verified, source_url
) VALUES (
    'Heroku H10 error - how to debug crash reason',
    'heroku',
    'MEDIUM',
    '[
        {"solution": "Run heroku run bash then start app manually: node server.js to see detailed errors", "percentage": 90, "command": "heroku run bash", "note": "Interactive debugging"},
        {"solution": "Check environment variables: heroku config to verify all required vars set", "percentage": 85, "command": "heroku config", "note": "Missing env vars cause crashes"},
        {"solution": "Test build locally: heroku local to simulate Heroku environment", "percentage": 80, "command": "heroku local", "note": "Local testing"}
    ]'::jsonb,
    'Heroku CLI installed, App with H10 errors',
    'Root cause identified from detailed error messages',
    'heroku run bash allows interactive debugging. heroku local simulates production environment locally.',
    0.90,
    'sonnet-4',
    NOW(),
    'https://stackoverflow.com/questions/13496827/'
);

-- Prisma: Client not generated
INSERT INTO knowledge_entries (
    query, category, hit_frequency, solutions, prerequisites, success_indicators,
    common_pitfalls, success_rate, claude_version, last_verified, source_url
) VALUES (
    'Prisma error: Client did not initialize yet - run prisma generate',
    'prisma',
    'VERY_HIGH',
    '[
        {"solution": "Run prisma generate after schema changes: npx prisma generate", "percentage": 95, "command": "npx prisma generate", "note": "Generates Prisma Client"},
        {"solution": "Add postinstall script to package.json: \"postinstall\": \"prisma generate\"", "percentage": 90, "note": "Auto-generate on npm install"},
        {"solution": "Copy prisma directory to deployment: Ensure schema.prisma included in build", "percentage": 85, "note": "Docker/deployment requirement"}
    ]'::jsonb,
    'Prisma installed, schema.prisma file exists',
    'Prisma Client imports without errors, Database queries work',
    'prisma generate must run after schema changes. In Docker, copy entire prisma/ directory. Add to postinstall for deployments.',
    0.95,
    'sonnet-4',
    NOW(),
    'https://stackoverflow.com/questions/67746885/'
);

-- Prisma: Client not in node_modules
INSERT INTO knowledge_entries (
    query, category, hit_frequency, solutions, prerequisites, success_indicators,
    common_pitfalls, success_rate, claude_version, last_verified, source_url
) VALUES (
    'Prisma could not resolve @prisma/client',
    'prisma',
    'HIGH',
    '[
        {"solution": "Add @prisma/client to both dependencies and devDependencies in package.json", "percentage": 90, "note": "Required for monorepo/turborepo"},
        {"solution": "Run npm install @prisma/client explicitly", "percentage": 85, "command": "npm install @prisma/client"},
        {"solution": "Delete node_modules and reinstall: rm -rf node_modules && npm install", "percentage": 80, "command": "rm -rf node_modules && npm install"}
    ]'::jsonb,
    'Prisma installed, package.json configured',
    '@prisma/client resolves in imports, No module resolution errors',
    'In monorepos, @prisma/client must be in both dependencies and devDependencies. Package manager hoisting requires explicit declaration.',
    0.90,
    'sonnet-4',
    NOW(),
    'https://stackoverflow.com/questions/79316614/'
);

-- Prisma: Migrate does not generate client
INSERT INTO knowledge_entries (
    query, category, hit_frequency, solutions, prerequisites, success_indicators,
    common_pitfalls, success_rate, claude_version, last_verified, source_url
) VALUES (
    'Prisma property does not exist after schema migration',
    'prisma',
    'MEDIUM',
    '[
        {"solution": "Run prisma generate after migrate: prisma migrate deploy does not auto-generate client", "percentage": 95, "command": "npx prisma migrate deploy && npx prisma generate", "note": "Two separate commands"},
        {"solution": "Add prisma generate to CI/CD pipeline after migrations", "percentage": 90, "note": "Deployment automation"},
        {"solution": "Use prisma migrate dev locally: Includes automatic generate", "percentage": 85, "command": "npx prisma migrate dev", "note": "Development workflow"}
    ]'::jsonb,
    'Prisma migrations configured, Schema updated',
    'TypeScript types include new model properties, No type errors',
    'prisma migrate deploy runs migrations but does NOT generate client. Must run prisma generate separately.',
    0.95,
    'sonnet-4',
    NOW(),
    'https://stackoverflow.com/questions/69274503/'
);

-- Vite: Command not found
INSERT INTO knowledge_entries (
    query, category, hit_frequency, solutions, prerequisites, success_indicators,
    common_pitfalls, success_rate, claude_version, last_verified, source_url, pattern_id
) VALUES (
    'Vite command not found error',
    'vite',
    'VERY_HIGH',
    '[
        {"solution": "Use npx vite instead of vite: npx vite or npm run dev", "percentage": 95, "note": "npx finds local binaries"},
        {"solution": "Install vite globally: npm install -g vite", "percentage": 80, "command": "npm install -g vite", "note": "Global installation"},
        {"solution": "Run via npm scripts: Add \"dev\": \"vite\" to package.json scripts", "percentage": 90, "note": "Recommended approach"}
    ]'::jsonb,
    'Vite installed in project, package.json exists',
    'npm run dev starts Vite server, Vite commands work via npx',
    'Vite binary is in node_modules/.bin/ not in PATH. Use npx or npm scripts. Global install not recommended.',
    0.95,
    'sonnet-4',
    NOW(),
    'https://stackoverflow.com/questions/71844271/',
    (SELECT id FROM patterns WHERE pattern_name = 'PATH_INHERITANCE')
);

-- Vite: Build command not found
INSERT INTO knowledge_entries (
    query, category, hit_frequency, solutions, prerequisites, success_indicators,
    common_pitfalls, success_rate, claude_version, last_verified, source_url
) VALUES (
    'sh: vite: command not found on npm run build',
    'vite',
    'HIGH',
    '[
        {"solution": "Clean npm cache and reinstall: npm cache clean --force && npm install", "percentage": 90, "command": "npm cache clean --force && npm install"},
        {"solution": "Ensure vite in devDependencies: Check package.json has vite listed", "percentage": 85, "note": "Required dependency"},
        {"solution": "Run via npx in script: \"build\": \"npx vite build\" in package.json", "percentage": 80, "note": "Explicit npx usage"}
    ]'::jsonb,
    'Vite project, package.json build script',
    'npm run build completes successfully, dist folder generated',
    'Build scripts need vite in node_modules. Clean cache resolves most issues. Use npx for reliability.',
    0.90,
    'sonnet-4',
    NOW(),
    'https://stackoverflow.com/questions/77899047/'
);

-- Svelte: Component not updating
INSERT INTO knowledge_entries (
    query, category, hit_frequency, solutions, prerequisites, success_indicators,
    common_pitfalls, success_rate, claude_version, last_verified, source_url
) VALUES (
    'Svelte component not updating when data changes',
    'svelte',
    'VERY_HIGH',
    '[
        {"solution": "Use assignment for reactivity: array = array instead of array.push()", "percentage": 95, "note": "Svelte tracks assignments"},
        {"solution": "Trigger reactivity with self-assignment: array = [...array, newItem]", "percentage": 90, "note": "Spread creates new reference"},
        {"solution": "Use {#key} block to force re-render: {#key value} <Component /> {/key}", "percentage": 85, "note": "Forces component remount"}
    ]'::jsonb,
    'Svelte application, Reactive components',
    'UI updates when data changes, Component re-renders correctly',
    'Svelte reactivity requires assignments. array.push() does not trigger updates. Use array = [...array, item] instead.',
    0.95,
    'sonnet-4',
    NOW(),
    'https://stackoverflow.com/questions/68540627/'
);

-- Svelte: Child component not updating
INSERT INTO knowledge_entries (
    query, category, hit_frequency, solutions, prerequisites, success_indicators,
    common_pitfalls, success_rate, claude_version, last_verified, source_url
) VALUES (
    'Svelte child component not updating from parent props',
    'svelte',
    'HIGH',
    '[
        {"solution": "Use bind: directive for two-way binding: <Child bind:value />", "percentage": 90, "note": "Bidirectional reactivity"},
        {"solution": "Pass new object reference: parent = {...parent, updated: value}", "percentage": 85, "note": "Trigger prop change detection"},
        {"solution": "Use reactive statements in child: $: console.log(prop) to track changes", "percentage": 80, "note": "Debug reactivity"}
    ]'::jsonb,
    'Svelte parent-child components, Props passed to children',
    'Child updates when parent data changes, Props reactive',
    'Svelte props are reactive by default. If not updating, ensure parent passes new reference not mutated object.',
    0.90,
    'sonnet-4',
    NOW(),
    'https://stackoverflow.com/questions/65007265/'
);

-- Svelte: Instantiated component not updating
INSERT INTO knowledge_entries (
    query, category, hit_frequency, solutions, prerequisites, success_indicators,
    common_pitfalls, success_rate, claude_version, last_verified, source_url
) VALUES (
    'Svelte dynamically instantiated component not updating props',
    'svelte',
    'MEDIUM',
    '[
        {"solution": "Use component.$set() method: component.$set({ prop: newValue })", "percentage": 95, "note": "Manual prop updates"},
        {"solution": "Enable accessors: <svelte:options accessors /> in component", "percentage": 85, "note": "Direct property access"},
        {"solution": "Recreate component instance with new props instead of updating", "percentage": 75, "note": "Alternative approach"}
    ]'::jsonb,
    'Svelte with programmatic component instantiation',
    'Component props update correctly, UI reflects changes',
    'Programmatically instantiated components (new Component()) exist outside reactivity. Use .$set() to update props.',
    0.95,
    'sonnet-4',
    NOW(),
    'https://stackoverflow.com/questions/72980128/'
);


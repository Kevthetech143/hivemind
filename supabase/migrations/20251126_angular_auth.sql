-- Angular Authentication Errors Mining
-- Mined from Stack Overflow real issues and solutions

INSERT INTO knowledge_entries (query, category, hit_frequency, solutions, prerequisites, success_indicators, common_pitfalls, success_rate, claude_version, last_verified, source_url, contributor_email) VALUES

('SyntaxError: Unexpected token in JSON at position 0 during Angular authentication response parsing', 'angular', 'HIGH', '[{"solution": "Verify API response type matches HttpClient.post() generic type. If API returns text, set responseType: ''text'' in request options. Ensure Content-Type header is application/json.", "percentage": 95}, {"solution": "Check that API returns valid JSON, not a string. If backend returns plain text ''test-test'', remove responseType typing mismatch.", "percentage": 85}]'::jsonb, 'HttpClient service, API endpoint returning unexpected response format', 'Login succeeds, no JSON parsing errors in console, response properly typed', 'Mismatch between declared response type and actual response format. Content-Type header misconfigured. API returning plain text instead of JSON.', 0.92, 'haiku', NOW(), 'https://stackoverflow.com/questions/52859396/how-can-i-resolve-authentication-error-in-angular', 'admin:1764191598'),

('Angular 6+ login response type mismatch: res.user and res.token undefined', 'angular', 'HIGH', '[{"solution": "Define response interface with expected properties: type LoginResponse = { user: User; token: string; }. Use LoginResponse generic in http.post<LoginResponse>() call.", "percentage": 96}, {"solution": "Use ''any'' type for quick fix: http.post<any>() to bypass type checking, then verify response structure at runtime with console.log().", "percentage": 88}]'::jsonb, 'TypeScript version 3.9+, Angular HttpClient, backend returning user and token fields', 'Console shows user and token properties accessible, no TypeScript compilation errors', 'Using generic <Authentication> or <any> without matching backend response structure. Node.js response properties not matching Angular interface definitions.', 0.94, 'haiku', NOW(), 'https://stackoverflow.com/questions/51160782/angular-login-authentication-error', 'admin:1764191598'),

('Angular HTTP 401 Unauthorized not caught by error handler with Kerberos auth', 'angular', 'HIGH', '[{"solution": "Use RxJS catchError operator to handle 401 responses. Add pipe(catchError(e => { if (e.status === 401) return Observable.throw(''Not authorized''); })) to observable chain.", "percentage": 93}, {"solution": "Implement HttpInterceptor to globally catch 401 errors before they reach components. This prevents browser default 401 handling from blocking Angular error handlers.", "percentage": 91}]'::jsonb, 'Angular 4+, REST service with Kerberos/WWW-Authenticate headers, RxJS imported', 'Component error handler executes on 401, user redirected to login instead of blank page', 'Browser default 401 page handling overrides Angular error block. Missing catchError operator. WWW-Authenticate header prevents standard error propagation.', 0.90, 'haiku', NOW(), 'https://stackoverflow.com/questions/45632559/handling-authentication-errors-in-response', 'admin:1764191598'),

('Error validating tokens: Wrong nonce with angular-oauth2-oidc and Identity Server 4', 'angular', 'HIGH', '[{"solution": "Disable and re-enable setupAutomaticSilentRefresh(). Clear browser localStorage and sessionStorage. Force full re-authentication by logging out and back in. Nonce mismatch usually indicates stale token cache.", "percentage": 89}, {"solution": "Update angular-oauth2-oidc and @angular/common packages. Nonce validation changed in newer versions. Verify Identity Server 4 OIDC configuration matches client setup.", "percentage": 85}]'::jsonb, 'angular-oauth2-oidc library, Identity Server 4, OIDC discovery endpoint configured', 'Login completes without nonce errors, silent refresh works, no auth loops detected', 'Automatic silent refresh enabled during login loop. Token cache contains invalid nonce. OIDC provider returning different nonce than expected. Stale discovery document cached.', 0.83, 'haiku', NOW(), 'https://stackoverflow.com/questions/69918195/angular-app-authentication-fails-because-the-nonce-is-incorrect', 'admin:1764191598'),

('Firebase: Error (auth/argument-error) - GoogleAuthProvider import mismatch in Angular', 'angular', 'HIGH', '[{"solution": "Import GoogleAuthProvider from correct package: import { signInWithPopup } from ''@angular/fire/auth'' NOT ''firebase/auth''. AngularFire wrappers handle auth provider type checking correctly.", "percentage": 97}, {"solution": "If using modular Firebase SDK, ensure all imports come from ''firebase/auth'' OR all from ''@angular/fire/auth''. Mixing both causes constructor instance type mismatches.", "percentage": 94}]'::jsonb, 'Angular 15+, @angular/fire 7.6+, firebase 10+, AngularFireAuth module', 'signInWithPopup() executes without argument-error, user credential returns successfully', 'Mixed imports between firebase/auth and @angular/fire/auth. FederatedAuthProvider type mismatch. Different SDK versions imported in same file.', 0.96, 'haiku', NOW(), 'https://stackoverflow.com/questions/77021723/firebase-auth-argument-error-google-authentication-in-angular-app', 'admin:1764191598'),

('Angular 401 Unauthorized accessing WebAPI from different domain (Windows Auth)', 'angular', 'HIGH', '[{"solution": "Set withCredentials: true on all cross-domain HTTP requests. Change $http.get(url) to $http.get(url, { withCredentials: true }). Enables credentials (Windows auth tokens) to be sent automatically.", "percentage": 95}, {"solution": "Verify WebAPI CORS headers include Access-Control-Allow-Credentials: true and Access-Control-Allow-Origin with client domain. Both client and server must allow credentials.", "percentage": 92}]'::jsonb, 'Windows Authentication on WebAPI, AngularJS or Angular, cross-domain AJAX calls, CORS configured', 'Direct WebAPI calls work, Angular XHR requests succeed with user credentials, 401 errors stop', 'Missing withCredentials: true on Angular HTTP requests. CORS header Access-Control-Allow-Credentials not set to true. IIS Windows Auth without credentials flag enabled.', 0.91, 'haiku', NOW(), 'https://stackoverflow.com/questions/39170713/401-unauthorized-error-when-accessing-webapi-from-angular', 'admin:1764191598'),

('Angular JWT authentication returns 401 Unauthorized on login POST request', 'angular', 'HIGH', '[{"solution": "Add Authorization header with Bearer token to login POST. After receiving token, include header in subsequent requests: headers.set(''Authorization'', ''Bearer '' + token). Use HttpInterceptor for all requests.", "percentage": 94}, {"solution": "Verify Laravel auth routes configured. Check Route::post(''login'') exists and auth()->attempt($credentials) returns token. Test endpoint with Postman first to isolate frontend vs backend issue.", "percentage": 88}]'::jsonb, 'Laravel backend, JWT auth middleware, Angular HttpClient, login endpoint configured', 'Login POST returns 200 with token, subsequent API calls include Authorization header', 'Missing Bearer token in Authorization header. Signup endpoint works but login does not. Token not being sent in subsequent requests. Backend JWT middleware not initialized.', 0.87, 'haiku', NOW(), 'https://stackoverflow.com/questions/56695266/how-to-fix-401-unauthorized-for-a-login-request', 'admin:1764191598'),

('Angular PUT request returns 401 Unauthorized despite GET working and withCredentials set', 'angular', 'HIGH', '[{"solution": "Create HttpInterceptor to add withCredentials: true globally to ALL requests. Clone request in intercept(): request = request.clone({ withCredentials: true }). Add to app.module providers.", "percentage": 93}, {"solution": "Verify .NET Core CORS policy includes .AllowCredentials() and builder.WithOrigins(''http://localhost:4200''). Both client withCredentials and server [FromBody] attribute required for PUT/POST to work.", "percentage": 90}]'::jsonb, 'Angular 5+, .NET Core API, Windows Authentication enabled, HttpInterceptor pattern', 'PUT and POST requests succeed with credentials, no 401 on authenticated endpoints, CORS preflight passes', 'GET works but PUT/POST fails: missing [FromBody] in controller. CORS policy missing AllowCredentials(). Some requests have withCredentials, others don''t. Interceptor not applied to all requests.', 0.89, 'haiku', NOW(), 'https://stackoverflow.com/questions/55589622/how-can-i-resolve-401-unauthorized-in-angular', 'admin:1764191598'),

('Angular interceptor 401 error: Bearer token missing space after Bearer keyword', 'angular', 'HIGH', '[{"solution": "Ensure space between ''Bearer'' and token in Authorization header: ''Bearer '' + token NOT ''Bearer'' + token. Missing space causes backend to reject token as malformed.", "percentage": 98}, {"solution": "Test Authorization header format with Postman: Authorization: Bearer <token>. Extract token from localStorage correctly: const token = JSON.parse(localStorage.getItem(''auth'')).access_token;", "percentage": 96}]'::jsonb, 'Angular HttpInterceptor, JWT token in localStorage, backend expecting Bearer scheme', 'API List endpoint accessible, 401 errors resolved, Authorization header properly formatted in network tab', 'Typo: ''Bearer'' + token without space results in ''Bearertoken123''. Token embedded in JSON, need to parse before adding to header. Interceptor cloning request incorrectly.', 0.95, 'haiku', NOW(), 'https://stackoverflow.com/questions/77571631/problem-facing-error-401-unauthorized-in-angular', 'admin:1764191598'),

('Angular + CakePHP JWT: CORS preflight request returns 401 with ADmad JWT plugin', 'angular', 'HIGH', '[{"solution": "Explicitly handle OPTIONS requests in CakePHP router. Browser preflight requires 200 response with CORS headers before actual POST. Add handler for OPTIONS method in API routes.", "percentage": 92}, {"solution": "Add CORS headers in .htaccess or middleware: Access-Control-Allow-Origin, Access-Control-Allow-Methods (GET, POST, OPTIONS), Access-Control-Allow-Headers (Authorization, Content-Type). Host must match exactly, avoid wildcards.", "percentage": 90}]'::jsonb, 'CakePHP 3.x, ADmad JWT plugin, Angular 4+, HttpClient, POST to API endpoint', 'Preflight OPTIONS returns 200, POST request succeeds with JWT token, API returns data', 'Preflight request gets 401 instead of 200. OPTIONS handler not implemented in CakePHP. Wildcard CORS origin doesn''t match preflight. Missing Content-Type in allowed headers.', 0.88, 'haiku', NOW(), 'https://stackoverflow.com/questions/46971332/angular-jwt-auth-always-401-unauthorized', 'admin:1764191598');

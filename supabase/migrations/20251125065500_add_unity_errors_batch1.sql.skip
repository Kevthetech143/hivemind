-- Add Unity game engine common errors batch 1
-- Extracted from official Unity documentation (https://docs.unity3d.com/)
-- Category: unity

INSERT INTO knowledge_entries (
    query, category, hit_frequency, solutions, prerequisites, success_indicators,
    common_pitfalls, success_rate, claude_version, last_verified, source_url
) VALUES
(
    'NullReferenceException: Object reference not set to an instance of an object',
    'unity',
    'VERY_HIGH',
    '[
        {"solution": "Check if the object exists before accessing it using if (myObject == null) { Debug.Log(\"Object not found\"); }", "percentage": 95, "note": "Most reliable prevention method. Place null checks before any property/method access."},
        {"solution": "Verify all Inspector-assigned variables are properly assigned in the Inspector window", "percentage": 90, "note": "Check that referenced GameObjects, Components, and prefabs are drag-and-dropped into Inspector slots"},
        {"solution": "Use try/catch blocks to handle null reference exceptions at runtime", "percentage": 75, "note": "Less recommended - prefer null checks for prevention rather than catching exceptions"},
        {"solution": "Remember Unity uses custom == operator - check if underlying Unity object was destroyed", "percentage": 85, "note": "A null check might return true even if C# reference exists if the object was destroyed"}
    ]'::jsonb,
    'Unity Editor open with a C# script, Basic understanding of null values',
    'Script no longer throws NullReferenceException, Game runs without errors, Console shows no exception messages',
    'Forgetting to assign variables in Inspector. Not checking for null before accessing nested properties. Assuming Manager.instance exists without verification. Using destroyed objects without checking.',
    0.92,
    'sonnet-4',
    NOW(),
    'https://docs.unity3d.com/6000.1/Documentation/Manual/null-reference-exception.html'
),
(
    'Package Manager error: Unable to add from Git URL, revision format invalid',
    'unity',
    'HIGH',
    '[
        {"solution": "Ensure revision comes LAST in URL format: https://example.com/repo.git#revision", "percentage": 95, "note": "Common mistake is putting revision before path parameters"},
        {"solution": "For packages in subdirectories use path query parameter: https://example.com/repo.git?path=/folder#v1.0", "percentage": 90, "note": "Path must come before revision anchor"},
        {"solution": "Verify Git cmd (Windows) and bin directories are in system PATH environment variable", "percentage": 88, "note": "Package Manager needs Git executable accessible from command line"},
        {"solution": "Copy repository URL directly from GitHub/GitLab Clone button to ensure correct spelling", "percentage": 85, "note": "Manual typos in URLs are common cause of failures"}
    ]'::jsonb,
    'Unity Editor with Package Manager, Git installed on system, Valid GitHub/GitLab repository access',
    'Package installs successfully from Git URL, Package Manager shows package in list, No error messages in Console',
    'URL format errors - revision in wrong position. Forgetting path parameter for subfolder packages. Git not in system PATH. Copy-paste errors from clone URLs.',
    0.88,
    'sonnet-4',
    NOW(),
    'https://docs.unity3d.com/6000.2/Documentation/Manual/upm-errors.html'
),
(
    'Shader compilation failed: Shader error or unsupported shader variant',
    'unity',
    'HIGH',
    '[
        {"solution": "Check shader syntax - verify #pragma directives and shader model targets are correct", "percentage": 90, "note": "Most common cause is incorrect #pragma target directive or syntax errors"},
        {"solution": "Verify shader is compatible with your render pipeline (URP, HDRP, or Built-in)", "percentage": 92, "note": "Using Built-in shaders in URP projects causes compilation failures"},
        {"solution": "Check Graphics API support - ensure shader is written for your target graphics API (DirectX, Vulkan, Metal)", "percentage": 85, "note": "GPU-specific shader features may not compile across all APIs"},
        {"solution": "Review Shader Graph compilation settings and ensure all nodes are connected properly", "percentage": 88, "note": "Floating or disconnected nodes in Shader Graph cause compilation errors"}
    ]'::jsonb,
    'Shader file with errors, Unity project with render pipeline configured, Graphics driver updated',
    'Shader Material shows preview (no magenta error color), Console shows no compilation errors, Material renders correctly in scene',
    'Using incompatible shaders for render pipeline. Locale using commas instead of periods breaking #pragma directives. Mixing shader syntax from different render pipelines. Not verifying GPU feature support.',
    0.89,
    'sonnet-4',
    NOW(),
    'https://docs.unity3d.com/6000.2/Documentation/Manual/shader-error.html'
),
(
    'AssetBundle failed to load: LoadFromFile returns null',
    'unity',
    'MEDIUM',
    '[
        {"solution": "Check if AssetBundle object is null before accessing - validate load succeeded", "percentage": 95, "note": "Use if (bundle == null) { Debug.Log(\"Failed to load bundle\"); } pattern"},
        {"solution": "Verify all dependency AssetBundles are loaded before loading dependent bundles", "percentage": 92, "note": "Load common/shared bundles first, then bundles that depend on them"},
        {"solution": "Ensure AssetBundle file exists at specified path and is readable by application", "percentage": 90, "note": "Check StreamingAssets folder permissions and file existence"},
        {"solution": "On Android 5.3 or older, LoadFromFile fails from StreamingAssets - use LoadFromStream instead", "percentage": 80, "note": "Workaround for platform-specific limitation - StreamingAssets is in compressed jar"}
    ]'::jsonb,
    'Built AssetBundle files, Correct file paths, Understanding of AssetBundle dependencies',
    'LoadFromFile returns non-null AssetBundle object, bundle.LoadAsset() retrieves assets successfully, No Console errors',
    'Not checking if bundle is null after loading. Loading dependent bundles before dependencies. Wrong file paths. Using LoadFromFile on Android with streaming assets.',
    0.85,
    'sonnet-4',
    NOW(),
    'https://docs.unity3d.com/ScriptReference/AssetBundle.LoadFromFile.html'
),
(
    'Texture format not supported on target platform: Decompression overhead',
    'unity',
    'MEDIUM',
    '[
        {"solution": "Check texture compression format against supported formats for target platform in Texture Importer", "percentage": 93, "note": "Each platform supports different formats - view Recommended/Default columns in documentation"},
        {"solution": "Let Unity automatically convert textures to platform-appropriate formats - remove custom overrides if causing issues", "percentage": 88, "note": "Override only when you have specific requirements"},
        {"solution": "If format unsupported, texture will decompress to RGBA32 - monitor for memory and performance impact", "percentage": 85, "note": "Unsupported formats are loaded twice (compressed + decompressed) causing memory waste"},
        {"solution": "For WebGL builds, check supported WebGL texture compression formats - may differ significantly from other platforms", "percentage": 82, "note": "WebGL has limited compression format support"}
    ]'::jsonb,
    'Texture files in project, Target platform identified, Texture Importer settings accessible',
    'Texture preview shows correct colors (not pink/magenta), Console shows no format warnings, Build size is optimized',
    'Assuming same texture format works across all platforms. Not checking supported formats per platform. Forcing incompatible compression formats. Not monitoring RGBA32 decompression overhead.',
    0.86,
    'sonnet-4',
    NOW(),
    'https://docs.unity3d.com/Manual/class-TextureImporterOverride.html'
),
(
    'Physics error: Rigidbody behaves incorrectly - Transform moved directly instead of via physics',
    'unity',
    'HIGH',
    '[
        {"solution": "Use Rigidbody.AddForce() or Rigidbody.velocity to move physics objects, never modify Transform directly", "percentage": 95, "note": "Direct Transform changes bypass physics simulation causing incorrect collision/joint behavior"},
        {"solution": "When static colliders move, call Rigidbody.WakeUp() on adjacent sleeping Rigidbodies", "percentage": 90, "note": "Moving colliders via Transform without waking nearby bodies can cause missed collisions"},
        {"solution": "For kinematic Rigidbodies, move via Transform is safe - but kinematic bodies cannot be pushed by physics forces", "percentage": 88, "note": "Understand difference: kinematic cannot receive force, but can apply force to dynamic bodies"},
        {"solution": "Avoid mixing Transform movement and physics forces on same Rigidbody - choose one approach consistently", "percentage": 92, "note": "Inconsistent movement methods cause unpredictable physics behavior"}
    ]'::jsonb,
    'Scene with Rigidbodies and Colliders, Physics simulation enabled, Understanding of dynamic vs kinematic bodies',
    'Physics simulation works correctly, Collisions detected properly, Joints apply forces correctly, No unexpected Rigidbody movement',
    'Moving Rigidbody-attached objects via Transform.position. Not understanding kinematic vs dynamic Rigidbody behavior. Forgetting to wake sleeping bodies when moving colliders. Using joints on incompatible Rigidbody combinations.',
    0.91,
    'sonnet-4',
    NOW(),
    'https://docs.unity3d.com/Manual/RigidbodiesOverview.html'
),
(
    'Package Manager error: \"Error refreshing assets/packages\" with network connection',
    'unity',
    'MEDIUM',
    '[
        {"solution": "Check network connection - verify internet connectivity and ping registry.unity.com", "percentage": 92, "note": "Most common cause is network/firewall blocking registry access"},
        {"solution": "Verify firewall and proxy settings - ensure Package Manager can reach registry servers", "percentage": 88, "note": "Corporate firewalls may block access to Unity registry"},
        {"solution": "Check file permissions on cache folder: %LOCALAPPDATA%\\Unity\\cache\\upm (Windows), ~/Library/Caches/Unity/upm (macOS), ~/.cache/Unity/upm (Linux)", "percentage": 85, "note": "Ensure write permissions to cache directory"},
        {"solution": "If problem persists, delete Package Manager cache and restart Unity to force re-download", "percentage": 80, "note": "Last resort - clears corrupted cache but requires re-downloading packages"}
    ]'::jsonb,
    'Unity Editor with Package Manager window open, Network connectivity, Cache folder accessible',
    'Package Manager status bar shows no network errors, Packages refresh successfully, Package list displays without red error icons',
    'Network connectivity issues going undiagnosed. Firewall/proxy blocking registry access. Insufficient cache folder permissions. Corrupted cache files not cleared.',
    0.84,
    'sonnet-4',
    NOW(),
    'https://docs.unity3d.com/6000.2/Documentation/Manual/upm-errors.html'
),
(
    'Android build error: AndroidManifest.xml merge conflict - duplicate symbols or incompatible attributes',
    'unity',
    'MEDIUM',
    '[
        {"solution": "Remove conflicting attributes from library manifests - keep single definition of application icon/label", "percentage": 93, "note": "Libraries cannot override attributes from main manifest without explicit permission"},
        {"solution": "Add tools:replace attribute to application tag in main manifest to resolve merge conflicts", "percentage": 90, "note": "Example: <application android:icon=\"@mipmap/app_icon\" tools:replace=\"android:icon\">"},
        {"solution": "Export project as Gradle project and build from command line for detailed error messages", "percentage": 85, "note": "Command-line Gradle builds provide better error reporting than Unity Editor"},
        {"solution": "Verify plugin manifests don''t declare conflicting permissions or features - consolidate into main manifest", "percentage": 82, "note": "Gradle plugin is strict about duplicate symbols"}
    ]'::jsonb,
    'Android build configured, Custom plugins or libraries included, AndroidManifest.xml templates available',
    'Build completes without manifest merge errors, APK/AAB builds successfully, App installs on device',
    'Multiple plugins declaring same permissions. Libraries trying to override application attributes. Not using tools:replace for intentional overrides. Mixing old and new manifest formats.',
    0.82,
    'sonnet-4',
    NOW(),
    'https://docs.unity3d.com/Manual//android-manifest.html'
),
(
    'Script compilation error: Unsafe code used without enabling \"Allow unsafe Code\" in Assembly Definition',
    'unity',
    'LOW',
    '[
        {"solution": "Enable \"Allow unsafe Code\" checkbox in Assembly Definition (.asmdef) file Inspector settings", "percentage": 95, "note": "Required to use unsafe keyword and pointer arithmetic in scripts within that assembly"},
        {"solution": "Alternative: Add unsafe flag directly in asmdef file JSON - set \"allowUnsafeCode\": true", "percentage": 92, "note": "Programmatic approach to enabling unsafe code without Inspector"},
        {"solution": "If no Assembly Definition, enable in Player Settings > Other Settings > Allow unsafe Code", "percentage": 88, "note": "This affects all scripts in project but is less granular than per-assembly configuration"},
        {"solution": "Remember unsafe code is not AOT-compatible on all platforms - test on target platform", "percentage": 75, "note": "WebGL and some mobile platforms may not support unsafe code"}
    ]'::jsonb,
    'C# script using unsafe keyword, Assembly Definition file, Unity project configured',
    'Script compiles without CS0227 errors, No compilation errors in Console, Code compiles for target platform',
    'Forgetting to enable unsafe code flag. Assuming project-level setting applies to assembly. Using unsafe code on unsupported platforms. Not understanding AOT compatibility.',
    0.80,
    'sonnet-4',
    NOW(),
    'https://docs.unity3d.com/Manual/ScriptCompilationAssemblyDefinitionFiles.html'
),
(
    'WebGL build out of memory error: Browser unable to allocate contiguous heap memory',
    'unity',
    'MEDIUM',
    '[
        {"solution": "Reduce Unity heap size in Player Settings > WebGL - disable auto-resizing if causing crashes", "percentage": 94, "note": "Automatic heap resizing can trigger out of memory if browser cannot allocate contiguous block"},
        {"solution": "Profile build with Memory Profiler to identify memory leaks and optimize allocation", "percentage": 88, "note": "Find and fix memory leaks that cause unnecessary heap growth"},
        {"solution": "Use WebGL compression (brotli/gzip) to reduce build size and memory footprint", "percentage": 82, "note": "Smaller builds reduce initial memory requirements"},
        {"solution": "Keep heap size as small as possible - avoid over-allocating unused memory", "percentage": 85, "note": "Each byte allocated takes physical browser memory"}
    ]'::jsonb,
    'WebGL build configured, Memory Profiler available, Browser with sufficient system RAM',
    'WebGL build loads in browser without out of memory error, Application runs with stable memory usage, Build completes successfully',
    'Automatic heap resizing causing fragmentation. Not profiling memory usage. Over-allocating unused heap. Using memory-intensive assets without optimization.',
    0.82,
    'sonnet-4',
    NOW(),
    'https://docs.unity3d.com/550/Documentation/Manual/webgl-memory.html'
),
(
    'Editor error: Unity crashes on startup - System requirements not met or outdated graphics drivers',
    'unity',
    'MEDIUM',
    '[
        {"solution": "Verify computer meets Unity minimum system requirements - check RAM, disk space, and graphics compatibility", "percentage": 93, "note": "System requirements vary by Unity version - check version-specific requirements"},
        {"solution": "Update graphics drivers to latest version from manufacturer (NVIDIA, AMD, Intel)", "percentage": 92, "note": "Outdated drivers cause crashes and graphics errors"},
        {"solution": "Update audio drivers - outdated sound drivers can cause startup crashes", "percentage": 85, "note": "Less common but documented cause of initialization failures"},
        {"solution": "If crash persists, try Safe Mode: launch with -SafeMode flag or empty Library/Caches", "percentage": 80, "note": "Safe Mode disables most Editor systems to isolate problem source"}
    ]'::jsonb,
    'Computer with minimum system resources, Graphics driver installer, Internet connection for driver updates',
    'Unity Editor launches without crashing, Scenes load and display graphics correctly, No error messages at startup',
    'System barely meeting minimum requirements causing edge-case crashes. Outdated driver stack causing graphics initialization failures. Insufficient disk space for builds/cache.',
    0.86,
    'sonnet-4',
    NOW(),
    'https://docs.unity3d.com/Manual/TroubleShooting.html'
),
(
    'Occlusion culling error: Out of memory during baking with large scenes',
    'unity',
    'LOW',
    '[
        {"solution": "Reduce scene size or subdivide into smaller sections with separate occlusion culling data", "percentage": 92, "note": "Baking process creates computation tiles - too many causes memory overflow"},
        {"solution": "Decrease \"Smallest Occluder\" parameter in Occlusion Culling settings to reduce tile subdivision", "percentage": 89, "note": "Smaller occluders create more tiles - increase this value to reduce memory usage"},
        {"solution": "Build scene in sections - bake occlusion culling per scene or per zone", "percentage": 85, "note": "Divide and conquer approach to manage memory during baking"},
        {"solution": "Close other applications and free available RAM before baking large scenes", "percentage": 78, "note": "Ensure sufficient available system memory for baking process"}
    ]'::jsonb,
    'Large scene with occlusion culling enabled, Sufficient system RAM, Occlusion Culling window open',
    'Occlusion culling bakes successfully, Out of memory errors do not occur, Baked data loads without issues',
    'Attempting to bake entire large world in one operation. Using overly small Smallest Occluder value. Insufficient free system RAM. Not subdividing complex scenes.',
    0.78,
    'sonnet-4',
    NOW(),
    'https://docs.unity3d.com/6000.2/Documentation/Manual/occlusion-culling-troubleshooting.html'
)
;

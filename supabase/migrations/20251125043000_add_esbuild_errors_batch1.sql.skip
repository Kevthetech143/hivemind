-- Add esbuild errors from official documentation

INSERT INTO knowledge_entries (query, category, solutions, common_pitfalls, success_rate, hit_frequency, claude_version, last_verified, thumbs_up)
VALUES
(
  'esbuild: Non-analyzable imports with dynamic paths cannot be bundled',
  'esbuild',
  '[{"solution": "Mark packages with dynamic imports as external using external array: external: [''pkg'']", "percentage": 95, "note": "esbuild cannot resolve runtime path resolution like require(''pkg/'' + foo). Mark as external and ensure dependency is available at runtime.", "command": "esbuild --external:pkg entry.js"},
  {"solution": "Restructure imports to use static paths instead of string concatenation", "percentage": 90, "note": "Move string concatenation outside require/import statements to enable static analysis"},
  {"solution": "Use --bundle=false to skip bundling problematic files", "percentage": 85, "note": "Alternative approach when dependency resolution is dynamic and must remain at runtime"}]'::jsonb,
  'Users attempt to bundle dynamic requires like require([''pkg''].map(x => x)) which esbuild cannot statically analyze. The workaround is not to bundle these, but mark them external.',
  0.92,
  'HIGH',
  'sonnet-4',
  NOW(),
  0
),
(
  'esbuild: Glob pattern imports causing excessive filesystem I/O and slow builds',
  'esbuild',
  '[{"solution": "Place target files in subdirectories so .. is not needed in glob patterns", "percentage": 95, "note": "esbuild performs extensive filesystem I/O with glob patterns. Restrict scope by organizing files hierarchically."},
  {"solution": "Use restrictive patterns like ./data-{x}.json instead of **/*.json wildcards", "percentage": 90, "note": "Narrower glob patterns reduce filesystem traversal significantly"},
  {"solution": "Avoid patterns that traverse parent directories with .. traversal", "percentage": 88, "note": "Keep glob matching within scope of target directory to minimize I/O operations"}]'::jsonb,
  'Users create overly broad glob patterns that cause esbuild to scan entire directory trees. Avoid ** wildcards and parent directory traversal (..) in glob imports.',
  0.91,
  'MEDIUM',
  'sonnet-4',
  NOW(),
  0
),
(
  'esbuild: CommonJS tree-shaking not working with default main,module field order',
  'esbuild',
  '[{"solution": "Change mainFields setting from default to module,main for better tree-shaking", "percentage": 92, "note": "Default field order main,module may prevent tree-shaking of CommonJS. Use module,main if safe for your dependencies.", "command": "esbuild --main-fields=module,main entry.js"},
  {"solution": "Verify package exports fields support tree-shaking before changing mainFields", "percentage": 85, "note": "Some packages may require main field first for compatibility"},
  {"solution": "Use platform: browser instead of platform: node to default to module-first resolution", "percentage": 80, "note": "Browser platform naturally prefers ES module variants"}]'::jsonb,
  'With platform: node, the default mainFields (main,module) prioritizes CommonJS which may prevent dead code elimination. Users expect tree-shaking to work with Node.js dependencies.',
  0.89,
  'MEDIUM',
  'sonnet-4',
  NOW(),
  0
),
(
  'esbuild: Sourcemap charset UTF-8 does not escape non-ASCII characters in regexes',
  'esbuild',
  '[{"solution": "Set charset: utf8 in esbuild config but manually escape non-ASCII regex characters in source", "percentage": 88, "note": "charset: utf8 option does not parse or escape regexes. Pre-process regex patterns to avoid non-ASCII chars.", "command": "esbuild --charset=utf8 entry.js"},
  {"solution": "Keep regexes ASCII-only in source code to ensure sourcemap accuracy", "percentage": 90, "note": "Avoid non-ASCII Unicode ranges in regex patterns as they are not escaped by charset option"},
  {"solution": "Use Unicode escape sequences instead of literal characters in regexes", "percentage": 85, "note": "Use \\uXXXX notation instead of Unicode literal characters for regex patterns"}]'::jsonb,
  'Users set charset: utf8 expecting all non-ASCII characters to be escaped, but esbuild does not parse regex literals so character escaping is skipped for regexes and comments.',
  0.87,
  'LOW',
  'sonnet-4',
  NOW(),
  0
),
(
  'esbuild: Built-in Node.js modules bundled instead of kept external',
  'esbuild',
  '[{"solution": "Set platform: node in esbuild config to automatically externalize Node.js built-ins", "percentage": 97, "note": "With platform: node, modules like fs, path, http are automatically marked external to prevent bundling errors.", "command": "esbuild --platform=node entry.js"},
  {"solution": "Manually add Node.js modules to external array if not using platform: node", "percentage": 94, "note": "external: [''fs'', ''path'', ''http'', ''crypto''] etc to prevent accidental bundling"},
  {"solution": "Use Node.js polyfills only for browser builds with platform: browser", "percentage": 90, "note": "Node.js polyfills add significant bundle size. Only needed for browser targets."}]'::jsonb,
  'Users forget to set platform: node and accidentally bundle built-in modules which causes runtime errors. Browsers cannot resolve Node.js APIs like fs.',
  0.96,
  'HIGH',
  'sonnet-4',
  NOW(),
  0
),
(
  'esbuild: Plugin API only works with async build() not buildSync()',
  'esbuild',
  '[{"solution": "Replace buildSync() with build() for plugin support", "percentage": 98, "note": "Plugins require asynchronous execution. Use async build() method for all plugin-dependent builds.", "command": "const result = await esbuild.build({plugins: [...]})"},
  {"solution": "Remove plugins and use pure sync build if plugins are not essential", "percentage": 85, "note": "buildSync() is faster but incompatible with plugin callbacks"},
  {"solution": "Use transformSync() only for simple file transformations without plugins", "percentage": 80, "note": "transformSync() is for direct code transformation, not full build with plugins"}]'::jsonb,
  'Users call buildSync() with plugins expecting sync execution. All plugin callbacks require async/await. transformSync() also does not support plugins.',
  0.97,
  'HIGH',
  'sonnet-4',
  NOW(),
  0
),
(
  'esbuild: Live reload broken in Firefox when server temporarily unreachable',
  'esbuild',
  '[{"solution": "Upgrade to latest esbuild version to fix EventSource auto-reconnect bug", "percentage": 85, "note": "Firefox has a bug with EventSource reconnection. esbuild maintainers have documented this limitation."},
  {"solution": "Use HTTP/2 over HTTPS to enable multiple simultaneous connections", "percentage": 88, "note": "HTTP/1.1 limits 6 simultaneous connections per domain blocking live-reload on 7+ tabs. HTTP/2 allows unlimited multiplexed streams.", "command": "Use HTTPS with HTTP/2 protocol"},
  {"solution": "Restart the browser tab manually if live reload stops working", "percentage": 70, "note": "Workaround for Firefox EventSource reconnection issue until fix is deployed"}]'::jsonb,
  'Firefox EventSource reconnection bug prevents auto-reconnect after server interruption. HTTP/1.1 limits concurrent connections to 6 per domain breaking live-reload across multiple tabs.',
  0.82,
  'MEDIUM',
  'sonnet-4',
  NOW(),
  0
),
(
  'esbuild: Watch mode file changes detected up to 2 seconds late',
  'esbuild',
  '[{"solution": "esbuild uses polling not OS file events - this is expected behavior with potential 2s delay", "percentage": 100, "note": "Watch mode uses polling instead of OS APIs. Recently-changed files check nearly instantly, but worst-case is ~2s.", "command": "esbuild --watch entry.js"},
  {"solution": "Use --watch-delay option to configure polling interval if changes lag", "percentage": 90, "note": "Adjust polling frequency if 2s max delay is unacceptable for your workflow"},
  {"solution": "Accept polling limitation as trade-off for cross-platform compatibility", "percentage": 88, "note": "Polling works on all platforms. OS-specific APIs like inotify would be Linux-only."}]'::jsonb,
  'Users expect instant file change detection. esbuild uses polling not OS-specific APIs so max 2s detection delay is expected. This is not a bug but architectural choice.',
  0.94,
  'MEDIUM',
  'sonnet-4',
  NOW(),
  0
),
(
  'esbuild: CJS/ESM interop format conversion missing required default exports',
  'esbuild',
  '[{"solution": "Use format: esm for pure ES modules without CommonJS conversion", "percentage": 88, "note": "Avoid format: cjs if source uses ESM exports. Check target environment first."},
  {"solution": "Verify target environment supports ESM before choosing format: esm", "percentage": 90, "note": "Some Node.js versions and older browsers require CJS. Test target compatibility."},
  {"solution": "Add default export to CommonJS modules before bundling", "percentage": 85, "note": "module.exports = X becomes export default X cleanly. Named exports require {X} import syntax."}]'::jsonb,
  'Users mix ESM import/export with CJS require/module.exports. esbuild conversion may lose default export depending on format setting and source structure.',
  0.87,
  'HIGH',
  'sonnet-4',
  NOW(),
  0
),
(
  'esbuild: Entry point file not found or incorrectly specified path',
  'esbuild',
  '[{"solution": "Verify entry point path is relative to esbuild execution directory", "percentage": 97, "note": "Use absolute paths or relative from current working directory where esbuild command runs.", "command": "esbuild ./src/index.js --bundle --outfile=dist/bundle.js"},
  {"solution": "Check file exists before running esbuild command", "percentage": 95, "note": "ls ./src/index.js or verify in file explorer first"},
  {"solution": "Use process.cwd() in Node.js builds to debug working directory assumptions", "percentage": 85, "note": "console.log(process.cwd()) to verify build execution directory"}]'::jsonb,
  'Users specify incorrect entry point paths relative to different working directories. esbuild resolves paths from execution directory not configuration file location.',
  0.96,
  'HIGH',
  'sonnet-4',
  NOW(),
  0
),
(
  'esbuild: Minification removes unused code but keeps side effects',
  'esbuild',
  '[{"solution": "Add sideEffects: false to package.json to allow minifier to remove unused imports", "percentage": 94, "note": "esbuild respects sideEffects field. Mark safe-to-remove modules with sideEffects: false or false array.", "command": "{\"sideEffects\": false}"},
  {"solution": "Use minify: true with treeShaking: true for aggressive dead code elimination", "percentage": 88, "note": "Both options required for maximum code removal. minify alone does not remove unused imports."},
  {"solution": "Review bundle analysis to identify which modules are retained due to side effects", "percentage": 80, "note": "Use metafile: true to generate JSON report of included modules for debugging"}]'::jsonb,
  'Users enable minification expecting full tree-shaking but get larger bundles. esbuild preserves code with side effects for safety. sideEffects: false required in package.json.',
  0.90,
  'MEDIUM',
  'sonnet-4',
  NOW(),
  0
),
(
  'esbuild: Port conflict when running multiple esbuild serve instances',
  'esbuild',
  '[{"solution": "Use servedir with random port selection: {port: 0, host: localhost}", "percentage": 92, "note": "Set port: 0 to let OS assign ephemeral port. Check console output for actual port number."},
  {"solution": "Kill existing process on port before starting new esbuild serve", "percentage": 90, "command": "lsof -i :8000 && kill -9 <PID> or use different port: {port: 8001}"},
  {"solution": "Check process manager to find and terminate previous esbuild instances", "percentage": 85, "note": "ps aux | grep esbuild or use Activity Monitor on macOS to find hanging processes"}]'::jsonb,
  'Users attempt to start multiple esbuild serve instances on same port causing EADDRINUSE error. OS prevents port reuse immediately after process termination.',
  0.93,
  'MEDIUM',
  'sonnet-4',
  NOW(),
  0
);

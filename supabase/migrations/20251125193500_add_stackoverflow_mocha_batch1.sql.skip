-- Add Stack Overflow Mocha testing solutions batch 1

INSERT INTO knowledge_entries (
    query, category, hit_frequency, solutions, prerequisites, success_indicators,
    common_pitfalls, success_rate, claude_version, last_verified, source_url
) VALUES (
    'How to increase timeout for a single test case in mocha',
    'stackoverflow-mocha',
    'VERY_HIGH',
    '[
        {"solution": "Use this.timeout() with milliseconds inside test function with regular function syntax (not arrow function): it(''test'', function(done){ this.timeout(5000); ... })", "percentage": 95, "note": "Most reliable method for per-test timeout configuration", "command": "this.timeout(5000)"},
        {"solution": "Use .timeout() method chained after test declaration with arrow functions: it(''test'', () => {...}).timeout(5000)", "percentage": 90, "note": "Modern ES6 syntax approach, avoids this binding issues"},
        {"solution": "Set global timeout via command line: mocha -t 100000 test.js", "percentage": 85, "note": "Affects all tests, not individual tests"},
        {"solution": "Configure timeout in package.json: ''test'': ''mocha --timeout 10000''", "percentage": 85, "note": "Persistent setting for entire suite"}
    ]'::jsonb,
    'Mocha test framework installed, Understanding of callback-based async patterns or promises, Knowledge of function vs arrow function behavior',
    'Test executes without timeout errors, Network request completes within specified duration, Only targeted test case is affected when using this.timeout()',
    'Arrow functions do not work with this.timeout() due to lexical this binding - use traditional function syntax. Command-line flags apply globally to all tests. Timeout value must be in milliseconds (e.g., 5000 = 5 seconds). Default Mocha timeout is 2000ms.',
    0.92,
    'sonnet-4',
    NOW(),
    'https://stackoverflow.com/questions/15971167/how-to-increase-timeout-for-a-single-test-case-in-mocha'
),
(
    'How to run a single test with Mocha',
    'stackoverflow-mocha',
    'VERY_HIGH',
    '[
        {"solution": "Use --grep flag with regex pattern: mocha -g ''test name pattern''", "percentage": 95, "note": "Most recommended approach, accepts any valid JavaScript regex", "command": "mocha --grep ''pattern''"},
        {"solution": "Pass arguments via npm scripts with --: npm test -- --grep ''pattern''", "percentage": 90, "note": "Ensures flags passed correctly to mocha from npm"},
        {"solution": "Add .only() to test block: it.only(''specific test'', function(){...})", "percentage": 85, "note": "Easy to accidentally commit; use --forbid-only in CI to prevent"},
        {"solution": "Use --fgrep for literal substring matching instead of regex: mocha --fgrep ''exact string''", "percentage": 80, "note": "Safer for special characters, does not interpret regex"},
        {"solution": "Run single file directly: mocha test/myfile.js", "percentage": 85, "note": "Executes all tests in specified file"}
    ]'::jsonb,
    'Mocha installed locally or globally, Tests organized with describe() and it() blocks, Understanding of basic regex patterns for grep approach',
    'Only targeted test(s) execute, No extraneous tests run, Consistent results across runs, CI/CD pipeline unaffected when using --forbid-only flag',
    '.grep can be finicky with special characters - wrap patterns in single or double quotes. .only() easily forgotten in commits, breaking CI test coverage. Glob patterns in config files override command-line specifications. Windows users may need to adjust quoting. Special regex characters require escaping.',
    0.94,
    'sonnet-4',
    NOW(),
    'https://stackoverflow.com/questions/10832031/how-to-run-a-single-test-with-mocha'
),
(
    'How to implement code coverage with Mocha',
    'stackoverflow-mocha',
    'HIGH',
    '[
        {"solution": "Install and use nyc (Istanbul CLI): npm install nyc --save-dev, then configure package.json: ''test'': ''nyc --reporter=text mocha''", "percentage": 95, "note": "Modern standard approach, generates console output with coverage metrics", "command": "npm install nyc --save-dev && npm test"},
        {"solution": "Generate HTML coverage reports: nyc --reporter=html mocha, output in ./coverage/index.html", "percentage": 90, "note": "Creates detailed visual coverage reports for analysis"},
        {"solution": "Use c8 for ES6 module support: npm install c8, then run c8 mocha", "percentage": 88, "note": "Recommended when nyc fails with ESM modules, leverages V8 coverage"},
        {"solution": "Keep testing and coverage separate with distinct npm scripts", "percentage": 75, "note": "Organizational approach, not directly affecting coverage calculation"}
    ]'::jsonb,
    'Functional Mocha test suite, Node.js environment, npm or equivalent package manager, Working package.json file',
    'Coverage report displays percentages and metrics, HTML report generates successfully in coverage directory, Tests pass while coverage data collected, Coverage thresholds can be enforced (e.g., minimum 90% line coverage)',
    'Parameter positioning critical - place nyc flags before test runner command, not after. Windows compatibility issues require explicit paths to node_modules/mocha/bin/_mocha. ESM limitations in original nyc/Istanbul - use c8 for ES6 modules. Configuration issues with .nycrc file - ensure proper JSON format. Do not use deprecated Blanket.js which lacks ES6 support.',
    0.90,
    'sonnet-4',
    NOW(),
    'https://stackoverflow.com/questions/16633246/code-coverage-with-mocha'
),
(
    'Mocha Chai expect.to.throw not catching thrown errors',
    'stackoverflow-mocha',
    'HIGH',
    '[
        {"solution": "Pass a function to expect instead of calling function directly: expect(() => model.get(''z'')).to.throw(''error message'')", "percentage": 96, "note": "Arrow function is most readable and recommended modern approach", "command": "expect(() => functionCall()).to.throw()"},
        {"solution": "Use .bind() to preserve context: expect(model.get.bind(model, ''z'')).to.throw()", "percentage": 90, "note": "Older approach, creates function wrapper with context preserved"},
        {"solution": "Wrap in anonymous function: expect(function() { model.get(''z''); }).to.throw()", "percentage": 88, "note": "Works but less readable than arrow function approach"},
        {"solution": "Use .call() method: expect(function() { model.get.call(model, ''z''); }).to.throw()", "percentage": 85, "note": "Alternative context binding approach"}
    ]'::jsonb,
    'Chai assertion library installed, Mocha test framework, Understanding of JavaScript function references and this binding',
    'Test passes with expected error thrown, Error message matches if specified, No exceptions thrown before throw assertion executes',
    'Passing function result instead of function reference is the root cause - if you call the function in expect(), the error throws before Chai can catch it. Arrow functions cannot access this context but inherit surrounding scope automatically. For async functions, use chai-as-promised library instead. The assertion library must receive a function reference, not the result of executing the function.',
    0.93,
    'sonnet-4',
    NOW(),
    'https://stackoverflow.com/questions/21587122/mocha-chai-expect-to-throw-not-catching-thrown-errors'
),
(
    'Chai test array equality does not work as expected',
    'stackoverflow-mocha',
    'HIGH',
    '[
        {"solution": "Use .eql() for deep value comparison: expect([0,0]).to.eql([0,0])", "percentage": 96, "note": "Direct and recommended approach for array value comparison", "command": "expect(array1).to.eql(array2)"},
        {"solution": "Use .deep.equal() as alternative: expect([0,0]).to.deep.equal([0,0])", "percentage": 95, "note": "Equivalent to .eql(), semantic preference is personal"},
        {"solution": "Use .members() for order-independent comparison: expect([1,2,3]).to.have.members([3,2,1])", "percentage": 90, "note": "Use when element order does not matter"},
        {"solution": "Use assert syntax: assert.deepEqual([0,0], [0,0])", "percentage": 88, "note": "Alternative assertion style if prefer assert over expect"},
        {"solution": "Use assert.sameDeepMembers() for unordered object arrays", "percentage": 85, "note": "Specialized for object comparisons ignoring order"}
    ]'::jsonb,
    'Chai assertion library installed, Mocha test framework, Understanding of JavaScript reference vs value comparison',
    'Test passes when using .eql() or .deep.equal(), Handles nested arrays and objects correctly, Order comparison behavior matches test intent',
    '.equal() performs reference comparison not value comparison - two separately created arrays with identical values are different objects. Must use .eql() or .deep.equal() for value-based array comparison. Default comparison checks element order; use .members() when order should not matter. .equal() vs .eql() is a common source of confusion.',
    0.94,
    'sonnet-4',
    NOW(),
    'https://stackoverflow.com/questions/17526805/chai-test-array-equality-doesnt-work-as-expected'
),
(
    'How to specify test directory for mocha',
    'stackoverflow-mocha',
    'HIGH',
    '[
        {"solution": "Pass directory as command-line argument with glob pattern: mocha \"server-test/**/*.js\" (quotes required on Windows)", "percentage": 94, "note": "Most straightforward approach, critical to use quotes in npm scripts", "command": "mocha \"path/to/tests/**/*.js\""},
        {"solution": "Create .mocharc.json configuration file in project root with spec setting: {\"spec\": \"path/to/test/files\"}", "percentage": 93, "note": "Recommended modern approach for persistent configuration"},
        {"solution": "Configure in package.json under mocha key: {\"mocha\": {\"spec\": \"path/to/test/files\"}}", "percentage": 92, "note": "Alternative configuration approach using package.json"},
        {"solution": "Add to npm scripts with quotes: {\"test\": \"mocha \\\"server-test/**/*.js\\\"\"}", "percentage": 91, "note": "Cleanest approach when combined with npm scripts"},
        {"solution": "Use --recursive flag: mocha --recursive server-test", "percentage": 85, "note": "Simpler syntax but less flexible than glob patterns"}
    ]'::jsonb,
    'Node.js and npm installed, Mocha installed locally or globally, Test files in specified directory, Project root access for configuration files',
    'Tests execute from specified directory, Subdirectories discovered recursively, CI/CD pipelines run consistently across platforms (Windows/Mac/Linux)',
    'Omitting quotes breaks glob patterns on Windows - always use double quotes in npm scripts for cross-platform compatibility. test/mocha.opts is deprecated in newer Mocha versions and no longer supported. Paths are relative to current working directory where command executes. Configuration files must be in project root. Do not mix legacy mocha.opts with modern .mocharc.json files.',
    0.91,
    'sonnet-4',
    NOW(),
    'https://stackoverflow.com/questions/10753288/how-to-specify-test-directory-for-mocha'
),
(
    'How to access and test internal non-exported functions in node.js module',
    'stackoverflow-mocha',
    'MEDIUM',
    '[
        {"solution": "Use rewire library to access private functions: npm install rewire, then var rewire = require(''rewire''); var app = rewire(''../app.js''); var privateFunc = app.__get__(''functionName'')", "percentage": 92, "note": "Most recommended approach, allows testing private functions without modifying source", "command": "npm install rewire && require(''rewire'')(''../module.js'').__get__(''privateName'')"},
        {"solution": "Export private functions conditionally during testing: if (process.env.NODE_ENV === ''test'') { exports.notExported = func; }", "percentage": 80, "note": "Simpler but adds test-specific code to production modules"},
        {"solution": "Create __testing export object for test-only exports: export const __testing = (process.env.NODE_ENV === ''test'') ? { func1, func2 } : void 0", "percentage": 78, "note": "Cleaner than conditional exports, still adds production code"},
        {"solution": "Use VM module to execute in new context: new vm.Script(...).runInNewContext()", "percentage": 60, "note": "Legacy approach with prototype chain and instanceof limitations"}
    ]'::jsonb,
    'Node.js/npm environment, Test framework (Mocha, Jasmine, Jest), Understanding of module exports and private functions, Rewire library installation for preferred approach',
    'Private functions testable without public export, Production code unchanged, Test coverage properly tracked, No runtime performance impact, Tests execute successfully',
    'Rewire with Jest may not include functions in coverage reports. Rewire with TypeScript requires ts-jest configuration. VM approach breaks prototype chains and instanceof checks. Conditional exports add test-specific code to production modules affecting readability. Rewire may have compatibility issues with bundlers like Webpack.',
    0.85,
    'sonnet-4',
    NOW(),
    'https://stackoverflow.com/questions/14874208/how-to-access-and-test-an-internal-non-exports-function-in-a-node-js-module'
),
(
    'In mocha testing while calling asynchronous function how to avoid timeout error',
    'stackoverflow-mocha',
    'VERY_HIGH',
    '[
        {"solution": "Increase timeout per-test with this.timeout() in regular function: it(''Save Data'', function(done){ this.timeout(15000); /* async code */ })", "percentage": 94, "note": "Recommended per-test approach, use regular function not arrow", "command": "this.timeout(15000)"},
        {"solution": "Set global timeout via command line: mocha --timeout 15000", "percentage": 92, "note": "Quick fix but affects all tests in suite"},
        {"solution": "Configure in package.json: {\"scripts\": {\"test\": \"mocha --timeout 15000\"}}", "percentage": 90, "note": "Persistent configuration for entire test suite"},
        {"solution": "Use async/await with promises instead of done callback for cleaner async handling", "percentage": 88, "note": "Modern approach, return promise directly from test function"},
        {"solution": "Mock network calls with Sinon stubs to avoid actual async delays", "percentage": 85, "note": "Improves test speed, requires Sinon library setup"}
    ]'::jsonb,
    'Node.js and Mocha installed, Understanding of asynchronous JavaScript patterns (callbacks, promises, async/await), Tests properly structured with done() callback or returning promises',
    'Tests complete without timeout errors, All assertions execute and report correctly, Test suite runs in reasonable time (sub-100ms per test ideal), Errors properly caught and reported by Mocha',
    'Arrow functions in describe/it blocks prevent access to this.timeout() - use traditional function() syntax. Swallowed exceptions may occur if callbacks do not properly handle errors - wrap assertions in try-catch. Missing done() calls or unresolved promises cause tests to hang until timeout. Ensure callbacks invoke done() or return promises properly. Default timeout is 2000ms which may be insufficient for network operations.',
    0.91,
    'sonnet-4',
    NOW(),
    'https://stackoverflow.com/questions/16607039/in-mocha-testing-while-calling-asynchronous-function-how-to-avoid-the-timeout-er'
),
(
    'Change default timeout for mocha',
    'stackoverflow-mocha',
    'HIGH',
    '[
        {"solution": "Configure timeout in package.json under mocha key: {\"mocha\": {\"timeout\": 5000}}", "percentage": 95, "note": "Recommended modern approach for global timeout configuration", "command": "npm config set mocha timeout=5000"},
        {"solution": "Create .mocharc.json with timeout setting: {\"timeout\": 5000}", "percentage": 94, "note": "Alternative configuration file approach, cleaner separation"},
        {"solution": "Set in npm scripts: {\"test\": \"mocha ''test/**/*.js'' --timeout 10000\"}", "percentage": 90, "note": "Per-command configuration if multiple test scripts needed"},
        {"solution": "Configure per-suite with this.timeout() in describe block: describe(''suite'', function(){ this.timeout(5000); /* tests */ })", "percentage": 85, "note": "Suite-level configuration, does not affect other suites"},
        {"solution": "Configure per-test with chained .timeout(): it(''test'', () => {...}).timeout(5000)", "percentage": 80, "note": "Individual test configuration, overrides suite/global settings"}
    ]'::jsonb,
    'Mocha installed as project dependency, Access to project configuration files (package.json or .mocharc.json), Understanding of Mocha configuration structure',
    'Tests run with specified timeout without command-line flags, No timeout errors on tests completing within configured duration, Configuration applies consistently across entire test suite, All tests inherit timeout setting',
    'Arrow functions fail with this.timeout() due to lexical this binding - use traditional function syntax for suite-level timeouts. Deprecated test/mocha.opts no longer works in current Mocha versions. Timeout set in one suite does not affect other suites - use config files for true global defaults. Configuration must be valid JSON if using .mocharc.json. Package.json mocha configuration must be under mocha key, not root level.',
    0.90,
    'sonnet-4',
    NOW(),
    'https://stackoverflow.com/questions/23492043/change-default-timeout-for-mocha'
),
(
    'How to programmatically skip a test in mocha',
    'stackoverflow-mocha',
    'MEDIUM',
    '[
        {"solution": "Use this.skip() method within test: it(''conditional test'', function(){ if(condition) return this.skip(); /* test code */ })", "percentage": 93, "note": "Recommended approach, skips at runtime based on dynamic conditions", "command": "if(condition) return this.skip()"},
        {"solution": "Use conditional describe/it blocks for static conditions: (condition ? describe : describe.skip)(''suite'', () => {...})", "percentage": 88, "note": "Executes at module load time, use for compile-time conditions"},
        {"solution": "Create wrapper function: function ifConditionIt(title, test){ return condition ? it(title, test) : it.skip(title, test); }", "percentage": 80, "note": "Reusable pattern for DRY conditional test definitions"},
        {"solution": "Use tag-based filtering with grep: add tags to test names and run mocha --grep @no-ci --invert to exclude", "percentage": 75, "note": "CI-specific approach, excludes tests matching pattern"}
    ]'::jsonb,
    'Mocha v3 or higher for this.skip() support, Tests using standard function declarations not arrow functions, Ability to define skip conditions dynamically',
    'Tests marked as "pending" in test reports, Conditional logic executes during test runtime, Proper environment detection prevents CI failures, Test counts reflect skipped tests appropriately',
    'Arrow functions break this.skip() functionality due to lexical scoping - must use function() syntax. Static conditional syntax executes at module load time, not test runtime. Async skip conditions require wrapping in before() hooks or test setup. Some approaches mark tests as "passed" rather than formally "skipped" in reports. Skipped tests still appear in test output but do not execute.',
    0.88,
    'sonnet-4',
    NOW(),
    'https://stackoverflow.com/questions/32723167/how-to-programmatically-skip-a-test-in-mocha'
),
(
    'What is the difference between assert expect and should in Chai',
    'stackoverflow-mocha',
    'MEDIUM',
    '[
        {"solution": "Use expect style for readable chain-based assertions: expect(foo).to.equal(''bar''), supports custom messages: expect(foo, ''message'').to.equal(''bar'')", "percentage": 95, "note": "Most recommended approach, does not modify Object.prototype, works across all browsers/Node.js"},
        {"solution": "Use assert style for function-based assertions: assert.equal(3, ''3''), does not modify Object.prototype", "percentage": 90, "note": "Traditional explicit approach, good for those familiar with assert pattern, supports custom messages"},
        {"solution": "Use should style for property-based syntax: foo.should.equal(''bar''), requires setup: require(''chai'').should()", "percentage": 70, "note": "Modifies Object.prototype (problematic), no custom message support, compatibility issues with older browsers like IE"},
        {"solution": "Choose expect or assert based on readability preference and environment constraints rather than functional differences", "percentage": 85, "note": "All three are functionally equivalent in Chai, preference is stylistic"}
    ]'::jsonb,
    'Chai assertion library installed, Understanding of JavaScript testing frameworks like Mocha, Familiarity with basic assertion concepts',
    'Chosen syntax works correctly with test framework, Assertions evaluate expected conditions properly, Custom messages display when assertions fail (assert and expect only)',
    'should style causes Object.prototype pollution - avoid in environments where this is problematic or where code interacts with legacy browser APIs. Custom messages work inconsistently with should style - not supported. Forgetting to execute should() function: require(''chai'').should() is commonly missed. expect and assert do not modify Object.prototype making them safer for most use cases. IE and very old browsers may have compatibility issues with should style.',
    0.87,
    'sonnet-4',
    NOW(),
    'https://stackoverflow.com/questions/21396524/what-is-the-difference-between-assert-expect-and-should-in-chai'
);

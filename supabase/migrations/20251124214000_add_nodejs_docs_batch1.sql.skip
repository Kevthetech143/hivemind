-- Add official Node.js error documentation solutions - Batch 1
-- Source: https://nodejs.org/api/errors.html
-- Extracted: 2025-11-24

INSERT INTO knowledge_entries (
    query, category, hit_frequency, solutions, prerequisites, success_indicators,
    common_pitfalls, success_rate, claude_version, last_verified, source_url
) VALUES
(
    'Node.js error ECONNREFUSED: Connection refused',
    'nodejs',
    'VERY_HIGH',
    '[
        {"solution": "Verify the target service/server is running and listening on the specified port", "percentage": 95, "note": "Most common cause - server not started"},
        {"solution": "Check that the host and port in your connection URL are correct", "percentage": 92, "command": "Verify connection string format: http://localhost:3000"},
        {"solution": "Ensure firewall or security groups allow connections to the target port", "percentage": 85, "note": "Firewall rules may block local connections"},
        {"solution": "Wait for service to fully initialize before attempting connection", "percentage": 82, "note": "Services may take time to start listening"}
    ]'::jsonb,
    'Node.js installed, Network access to target host, Correct host/port configuration',
    'Connection establishes successfully, No ECONNREFUSED in error logs, Service responds',
    'Always verify protocol (http:// or https://) is included in URL. Ensure server is running before client attempts connection. Check for port conflicts.',
    0.92,
    'sonnet-4',
    NOW(),
    'https://nodejs.org/api/errors.html'
),
(
    'Node.js error EADDRINUSE: Address already in use',
    'nodejs',
    'VERY_HIGH',
    '[
        {"solution": "Kill the process using the port: lsof -ti:PORT | xargs kill -9", "percentage": 95, "command": "lsof -ti:3000 | xargs kill -9", "note": "Works on Unix-like systems"},
        {"solution": "On Windows, find and kill process: netstat -ano | findstr :PORT, then taskkill /PID pid /F", "percentage": 93, "command": "netstat -ano | findstr :3000", "note": "Windows-specific solution"},
        {"solution": "Use a different port number in your application configuration", "percentage": 90, "note": "Simplest solution if port choice is flexible"},
        {"solution": "Set server to reuse address: server.listen({port: PORT, reuseAddr: true})", "percentage": 85, "note": "Allows immediate port reuse after server restart"}
    ]'::jsonb,
    'Node.js server application, Port configuration access, Terminal/command line access',
    'Server starts successfully, No EADDRINUSE error, Server accepts connections on specified port',
    'Port may be held by previous crashed process. Use process manager like PM2 to prevent port conflicts. Always close servers gracefully.',
    0.94,
    'sonnet-4',
    NOW(),
    'https://nodejs.org/api/errors.html'
),
(
    'Node.js error MODULE_NOT_FOUND',
    'nodejs',
    'VERY_HIGH',
    '[
        {"solution": "Install the missing module: npm install <module-name>", "percentage": 92, "command": "npm install <module-name>", "note": "Most common fix for missing dependencies"},
        {"solution": "Verify module path is correct - check for typos in require/import statement", "percentage": 90, "note": "Case sensitivity matters on Unix systems"},
        {"solution": "Check that relative paths use correct notation (./ for same dir, ../ for parent)", "percentage": 88, "note": "Missing ./ prefix is common mistake"},
        {"solution": "Clear node_modules and reinstall: rm -rf node_modules && npm install", "percentage": 85, "command": "rm -rf node_modules package-lock.json && npm install", "note": "Fixes corrupted installations"},
        {"solution": "Verify module exists in node_modules folder", "percentage": 82, "note": "Check if module was actually installed"}
    ]'::jsonb,
    'Node.js and npm installed, package.json exists, Network access for npm registry',
    'Module loads without error, Application runs successfully, No MODULE_NOT_FOUND errors',
    'Module names are case-sensitive. Relative imports require ./ or ../ prefix. Check NODE_PATH environment variable. Verify module is listed in package.json dependencies.',
    0.91,
    'sonnet-4',
    NOW(),
    'https://nodejs.org/api/errors.html'
),
(
    'Node.js error ENOENT: No such file or directory',
    'nodejs',
    'VERY_HIGH',
    '[
        {"solution": "Verify the file/directory path exists and spelling is correct", "percentage": 93, "note": "Check for typos and case sensitivity"},
        {"solution": "Use absolute paths instead of relative paths: path.join(__dirname, filename)", "percentage": 90, "command": "const filepath = path.join(__dirname, ''file.txt'')", "note": "Eliminates current directory ambiguity"},
        {"solution": "Check if file exists before operations: fs.existsSync(filepath)", "percentage": 88, "command": "if (fs.existsSync(filepath)) { /* proceed */ }", "note": "Prevents errors for missing files"},
        {"solution": "Create parent directories before writing files: fs.mkdirSync(dir, {recursive: true})", "percentage": 87, "command": "fs.mkdirSync(path.dirname(filepath), {recursive: true})", "note": "Node won''t auto-create intermediate directories"}
    ]'::jsonb,
    'Node.js fs module imported, Valid file system permissions, Correct path string',
    'File operation succeeds, No ENOENT errors, File/directory accessible',
    'Relative paths depend on current working directory (process.cwd()), not script location. Use __dirname for script-relative paths. Check file permissions.',
    0.90,
    'sonnet-4',
    NOW(),
    'https://nodejs.org/api/errors.html'
),
(
    'Node.js error ECONNRESET: Connection reset by peer',
    'nodejs',
    'HIGH',
    '[
        {"solution": "Implement retry logic with exponential backoff for network requests", "percentage": 88, "note": "Handles transient network issues"},
        {"solution": "Check if server closed connection due to timeout - increase timeout settings", "percentage": 86, "note": "Server may have shorter timeout than client"},
        {"solution": "Verify network stability between client and server", "percentage": 82, "note": "May indicate network infrastructure issues"},
        {"solution": "For HTTP: use keep-alive connections and connection pooling", "percentage": 80, "command": "agent: new http.Agent({ keepAlive: true })", "note": "Reduces connection resets"}
    ]'::jsonb,
    'Network connection to remote server, Valid server endpoint, Network permissions',
    'Connection remains stable, Data transfers complete, No connection reset errors',
    'Connection resets often indicate server-side issues or network problems. Not typically a client code bug. Check server logs for root cause.',
    0.85,
    'sonnet-4',
    NOW(),
    'https://nodejs.org/api/errors.html'
),
(
    'Node.js error ETIMEDOUT: Operation timed out',
    'nodejs',
    'HIGH',
    '[
        {"solution": "Increase timeout value for http/https requests: {timeout: 30000}", "percentage": 90, "command": "axios.get(url, { timeout: 30000 })", "note": "Default timeout may be too short"},
        {"solution": "Check network connectivity to target server", "percentage": 88, "note": "Server may be unreachable or very slow"},
        {"solution": "Verify server is responding - test with curl or browser", "percentage": 85, "command": "curl -v https://api.example.com", "note": "Isolates client vs server issues"},
        {"solution": "Implement retry logic with timeout increase on each retry", "percentage": 82, "note": "Handles temporary slowness"}
    ]'::jsonb,
    'Network connection available, Valid server URL, Correct DNS resolution',
    'Request completes within timeout period, Response received successfully, No timeout errors',
    'Default timeout varies by library. Some have no timeout by default. Always set explicit timeouts for production. Check if server endpoint is rate-limited.',
    0.87,
    'sonnet-4',
    NOW(),
    'https://nodejs.org/api/errors.html'
),
(
    'Node.js error EACCES: Permission denied',
    'nodejs',
    'HIGH',
    '[
        {"solution": "Run command with sudo for system-protected locations (use cautiously)", "percentage": 85, "command": "sudo node script.js", "note": "Required for system directories on Unix"},
        {"solution": "Change file/directory permissions: chmod 644 file or chmod 755 directory", "percentage": 88, "command": "chmod 755 /path/to/file", "note": "Makes file readable/executable"},
        {"solution": "For npm global installs, configure npm to use user directory", "percentage": 90, "command": "npm config set prefix ~/.npm-global", "note": "Avoids need for sudo with npm"},
        {"solution": "Check file ownership and change if needed: chown user:group file", "percentage": 82, "command": "sudo chown $USER:$USER /path/to/file", "note": "Gives ownership to current user"}
    ]'::jsonb,
    'Node.js installed, File system access, Valid file path exists',
    'File operation succeeds, No permission denied errors, File accessible to Node process',
    'Never run Node apps as root unless absolutely necessary. For npm permission errors, fix npm permissions rather than using sudo. Check parent directory permissions.',
    0.86,
    'sonnet-4',
    NOW(),
    'https://nodejs.org/api/errors.html'
),
(
    'Node.js error EPERM: Operation not permitted',
    'nodejs',
    'MEDIUM',
    '[
        {"solution": "Close file handles or programs locking the file (IDEs, antivirus, etc)", "percentage": 90, "note": "File locking is most common cause on Windows"},
        {"solution": "Check if file is marked read-only and remove attribute", "percentage": 88, "note": "Read-only files cannot be modified or deleted"},
        {"solution": "On Windows, disable antivirus real-time scanning temporarily for node_modules", "percentage": 82, "note": "Antivirus can lock files during scans"},
        {"solution": "Run terminal/IDE as administrator (Windows) or with sudo (Unix)", "percentage": 78, "note": "Required for system-level operations"}
    ]'::jsonb,
    'Node.js application running, File system access, No file locks active',
    'File operation completes, No EPERM errors, File modifications succeed',
    'EPERM differs from EACCES - often indicates file locking rather than permissions. Common with npm on Windows. Close IDEs and file explorers if issue persists.',
    0.85,
    'sonnet-4',
    NOW(),
    'https://nodejs.org/api/errors.html'
),
(
    'Node.js error EISDIR: Illegal operation on a directory',
    'nodejs',
    'MEDIUM',
    '[
        {"solution": "Use fs.readdir() instead of fs.readFile() for directories", "percentage": 95, "command": "fs.readdir(dirPath, (err, files) => {})", "note": "readFile only works on files"},
        {"solution": "Check if path is a directory before file operations: fs.statSync(path).isDirectory()", "percentage": 92, "command": "if (fs.statSync(path).isDirectory()) { /* handle dir */ }", "note": "Prevents operating on wrong type"},
        {"solution": "Verify the path points to a file, not a directory", "percentage": 88, "note": "Check for trailing slash or incorrect path"},
        {"solution": "Use appropriate fs method for directories: rmdir, readdir, not readFile/writeFile", "percentage": 86, "note": "Different methods for files vs directories"}
    ]'::jsonb,
    'Node.js fs module available, Valid path string, File system access',
    'Operation succeeds on correct target type, No EISDIR errors, Proper method used',
    'File operations (readFile, writeFile) cannot work on directories. Use stat/lstat to check if path is file or directory before operations.',
    0.92,
    'sonnet-4',
    NOW(),
    'https://nodejs.org/api/errors.html'
),
(
    'Node.js error ENOTDIR: Not a directory',
    'nodejs',
    'MEDIUM',
    '[
        {"solution": "Verify path points to a directory, not a file", "percentage": 93, "note": "Check path construction logic"},
        {"solution": "Use fs.statSync(path).isFile() to verify it''s a file before treating as directory", "percentage": 90, "command": "if (!fs.statSync(path).isDirectory()) { /* error */ }", "note": "Validate path type first"},
        {"solution": "Check for incorrect path construction - missing directory separators", "percentage": 86, "note": "Use path.join() to build paths correctly"},
        {"solution": "Ensure parent path exists and is actually a directory", "percentage": 82, "note": "Intermediate paths must be directories"}
    ]'::jsonb,
    'Node.js fs module available, Valid file system paths, Correct path separators',
    'Directory operations succeed, No ENOTDIR errors, Correct path types used',
    'ENOTDIR is opposite of EISDIR. Occurs when directory operation attempted on file. Always validate path type before fs operations. Use path module for cross-platform paths.',
    0.89,
    'sonnet-4',
    NOW(),
    'https://nodejs.org/api/errors.html'
),
(
    'Node.js error EEXIST: File already exists',
    'nodejs',
    'MEDIUM',
    '[
        {"solution": "Check if file exists before creating: if (!fs.existsSync(path)) { fs.writeFileSync() }", "percentage": 92, "command": "if (!fs.existsSync(filepath)) { fs.writeFileSync(filepath, data) }", "note": "Prevents overwrite attempts"},
        {"solution": "Use fs.writeFile with flag ''wx'' to create only if not exists", "percentage": 90, "command": "fs.writeFileSync(path, data, { flag: ''wx'' })", "note": "Atomic create-only operation"},
        {"solution": "Delete existing file first if overwrite is intended: fs.unlinkSync(path)", "percentage": 85, "command": "fs.unlinkSync(filepath); fs.writeFileSync(filepath, data)", "note": "Explicit overwrite"},
        {"solution": "For mkdir, use {recursive: true} option to ignore existing directories", "percentage": 88, "command": "fs.mkdirSync(dirPath, { recursive: true })", "note": "Won''t error if directory exists"}
    ]'::jsonb,
    'Node.js fs module available, File system write permissions, Valid target path',
    'File created successfully or already exists as expected, No unexpected EEXIST errors',
    'EEXIST means operation requires target to not exist, but it does. For mkdir, recursive option prevents this error. For files, check existence first or handle error.',
    0.90,
    'sonnet-4',
    NOW(),
    'https://nodejs.org/api/errors.html'
),
(
    'Node.js error EMFILE: Too many open files in system',
    'nodejs',
    'MEDIUM',
    '[
        {"solution": "Increase system file descriptor limit: ulimit -n 4096", "percentage": 88, "command": "ulimit -n 4096", "note": "Temporary fix for current session"},
        {"solution": "Close file handles after use - ensure callbacks/promises complete", "percentage": 92, "note": "Memory leaks often cause this"},
        {"solution": "Use graceful-fs module to queue file operations", "percentage": 85, "command": "npm install graceful-fs", "note": "Automatically queues fs operations"},
        {"solution": "Implement file handle pooling or limit concurrent operations", "percentage": 82, "note": "Use async.queue with concurrency limit"}
    ]'::jsonb,
    'Node.js application with file operations, System permissions to change limits',
    'File operations complete without EMFILE, No file descriptor leaks, System limit adequate',
    'EMFILE indicates system limit reached, not application error per se. Check for file handle leaks - unclosed files/streams. Monitor with lsof command.',
    0.84,
    'sonnet-4',
    NOW(),
    'https://nodejs.org/api/errors.html'
),
(
    'Node.js error ERR_INVALID_ARG_TYPE',
    'nodejs',
    'HIGH',
    '[
        {"solution": "Check argument types match function signature - use typeof to verify", "percentage": 93, "command": "if (typeof arg !== ''string'') throw new TypeError()", "note": "Validate types before calling"},
        {"solution": "Convert argument to expected type: String(value) or Number(value)", "percentage": 90, "note": "Explicit type conversion"},
        {"solution": "Check for null/undefined before passing to Node.js APIs", "percentage": 88, "command": "if (value == null) throw new Error(''Value required'')", "note": "null/undefined often cause type errors"},
        {"solution": "Review API documentation for correct parameter types", "percentage": 85, "note": "Consult nodejs.org docs for exact types"}
    ]'::jsonb,
    'Node.js runtime, Valid function call, Arguments available',
    'Function executes without type errors, Correct types passed, No ERR_INVALID_ARG_TYPE',
    'Node.js is strict about argument types. Passing undefined where string expected is common mistake. Use TypeScript for compile-time type checking.',
    0.91,
    'sonnet-4',
    NOW(),
    'https://nodejs.org/api/errors.html'
),
(
    'Node.js error ERR_MODULE_NOT_FOUND - ESM import failed',
    'nodejs',
    'HIGH',
    '[
        {"solution": "Add .js extension to relative imports: import x from ''./module.js''", "percentage": 92, "note": "ESM requires explicit file extensions"},
        {"solution": "Verify package.json has ''type'': ''module'' for ESM", "percentage": 90, "command": "Add {\"type\": \"module\"} to package.json", "note": "Enables ESM mode"},
        {"solution": "Check module specifier is correct - cannot omit file extensions in ESM", "percentage": 88, "note": "Unlike CommonJS, ESM needs extensions"},
        {"solution": "For npm packages, ensure package exists and is listed in package.json", "percentage": 86, "command": "npm install <package-name>", "note": "Install missing dependency"},
        {"solution": "Use exports field in package.json for package entry points", "percentage": 82, "note": "Modern packages use exports instead of main"}
    ]'::jsonb,
    'Node.js with ESM support, package.json configured, Valid import syntax',
    'Import resolves successfully, Module loads, No ERR_MODULE_NOT_FOUND errors',
    'ESM is stricter than CommonJS. File extensions are mandatory for relative imports. Directory imports not supported. Check package.json type field.',
    0.89,
    'sonnet-4',
    NOW(),
    'https://nodejs.org/api/errors.html'
);

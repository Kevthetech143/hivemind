INSERT INTO knowledge_entries (query, category, hit_frequency, solutions, prerequisites, success_indicators, common_pitfalls, success_rate, claude_version, last_verified, source_url, contributor_email) VALUES
('assert.throws() not catching thrown errors', 'testing', 'HIGH', '[{"solution": "Pass function reference, not result: assert.throws(myFunc, Error) instead of assert.throws(myFunc(), Error)", "percentage": 98}, {"solution": "Use arrow functions or .bind(): assert.throws(() => myFunc(args), Error)", "percentage": 95}]'::jsonb, 'Mocha + Chai', 'Function throws expected error', 'Calling function immediately instead of passing reference', 0.96, 'haiku', NOW(), 'https://stackoverflow.com/questions/14966821/testing-for-errors-thrown-in-mocha', 'admin:1764226436'),
('Error: timeout of 2000ms exceeded. Ensure the done() callback is being called', 'testing', 'CRITICAL', '[{"solution": "Add .catch() to promise chain to handle assertion errors and call done(error)", "percentage": 92}, {"solution": "Return the promise instead of using done callback: return api.myCall().then(...)", "percentage": 88}]'::jsonb, 'Mocha + Promise', 'Test completes within timeout', 'Assertion fails inside promise without catch block', 0.90, 'haiku', NOW(), 'https://stackoverflow.com/questions/32648902/make-mocha-tests-show-the-actual-error', 'admin:1764226436'),
('expect.to.throw not working with function calls', 'testing', 'HIGH', '[{"solution": "Pass function reference: expect(model.get.bind(model, ''z'')).to.throw(Error)", "percentage": 97}, {"solution": "Use arrow function wrapper: expect(() => model.get(''z'')).to.throw(Error)", "percentage": 96}]'::jsonb, 'Chai + Mocha', 'Exception is thrown and caught', 'Passing result of function call instead of function', 0.97, 'haiku', NOW(), 'https://stackoverflow.com/questions/21587122/mocha-chai-expect-to-throw-not-catching-thrown-errors', 'admin:1764226436'),
('How to handle errors in async callbacks with done()', 'testing', 'HIGH', '[{"solution": "Call done(err) if error exists, done() on success", "percentage": 99}, {"solution": "Use try-catch in callback and pass error to done(): catch(err) { done(err) }", "percentage": 94}]'::jsonb, 'Mocha callbacks', 'Test passes on success, fails on error', 'Not passing error to done() callback', 0.97, 'haiku', NOW(), 'https://stackoverflow.com/questions/39243273/error-handling-in-mocha-unit-tests', 'admin:1764226436'),
('Promise rejection not caught in async/await tests', 'testing', 'HIGH', '[{"solution": "Use chai-as-promised: await expect(fails()).to.be.rejectedWith(Error)", "percentage": 89}, {"solution": "Wrap in try-catch: try { await fails() } catch(e) { expect(e).to.be.an(Error) }", "percentage": 85}]'::jsonb, 'Async/Await + Mocha + Chai', 'Promise rejection is properly caught', 'Expecting .throw on resolved promise value', 0.88, 'haiku', NOW(), 'https://stackoverflow.com/questions/45466040/verify-that-an-exception-is-thrown-using-mocha-chai-and-async-await', 'admin:1764226436'),
('Error message comparison fails with new Error()', 'testing', 'MEDIUM', '[{"solution": "Use two-argument form: expect(fn).to.throw(Error, ''specific message'')", "percentage": 91}, {"solution": "Compare error messages separately: catch(e) { expect(e.message).to.equal(...) }", "percentage": 88}]'::jsonb, 'Chai assertion', 'Error message matches expected value', 'Comparing error objects with === instead of message', 0.90, 'haiku', NOW(), 'https://stackoverflow.com/questions/62717058/mocha-chai-testing-thrown-errors-with-error-message', 'admin:1764226436'),
('Mocha truncates diff output for complex objects', 'testing', 'MEDIUM', '[{"solution": "Set chai.config.truncateThreshold = 0 to show full objects", "percentage": 80}, {"solution": "Run with --inline-diffs flag: mocha --inline-diffs", "percentage": 75}]'::jsonb, 'Chai + Mocha', 'Full object shown in assertion failure', 'Default Chai truncation hiding important data', 0.78, 'haiku', NOW(), 'https://stackoverflow.com/questions/45881829/how-to-have-mocha-show-entire-object-in-diff-on-assertion-error', 'admin:1764226436'),
('done() called multiple times error', 'testing', 'CRITICAL', '[{"solution": "Add return statement before callback in conditional: if (err) return next(err)", "percentage": 96}, {"solution": "Use .then(done, done) instead of manual done() calls with promises", "percentage": 93}]'::jsonb, 'Mocha + Callback', 'done() called exactly once', 'Multiple code paths calling done() without early return', 0.94, 'haiku', NOW(), 'https://stackoverflow.com/questions/33063605/done-called-multiple-times-moongoose-with-mocha', 'admin:1764226436'),
('Mocha test passes first run but fails on watch re-run', 'testing', 'MEDIUM', '[{"solution": "Drop collection in after hook: db.connection.collections[name].drop()", "percentage": 82}, {"solution": "Close database connection properly in after hook", "percentage": 79}]'::jsonb, 'Mocha + Database', 'Test passes consistently on re-runs', 'Database state not cleaned between test cycles', 0.80, 'haiku', NOW(), 'https://stackoverflow.com/questions/14956352/mocha-test-fails-when-watching-after-all-done-called-multiple-times', 'admin:1764226436'),
('done() called multiple times with forEach loop', 'testing', 'HIGH', '[{"solution": "Use return statement or break pattern to exit loop: if (cond) return next(err)", "percentage": 94}, {"solution": "Extract done() call outside loop: let err; forEach(...) { if(cond) err = ... } next(err)", "percentage": 88}]'::jsonb, 'Mocha + Callbacks', 'done() called once after processing', 'forEach not short-circuited; continues after done()', 0.91, 'haiku', NOW(), 'https://stackoverflow.com/questions/58638719/failing-test-mochas-done-called-multiple-times', 'admin:1764226436'),
('Error: Timeout of 2000ms exceeded with async/await', 'testing', 'CRITICAL', '[{"solution": "Increase timeout: this.timeout(5000) in test", "percentage": 97}, {"solution": "Use CLI flag: mocha --timeout 10000", "percentage": 95}]'::jsonb, 'Async/Await + Mocha', 'Test completes within timeout window', 'Async operation exceeds default 2000ms timeout', 0.96, 'haiku', NOW(), 'https://stackoverflow.com/questions/16607039/in-mocha-testing-while-calling-asynchronous-function-how-to-avoid-the-timeout-er', 'admin:1764226436'),
('Mocha tests timeout with promise not returned', 'testing', 'HIGH', '[{"solution": "Return promise from test: return promise.then(...)", "percentage": 99}, {"solution": "If using async/await, ensure function is async: async () => { ... }", "percentage": 98}]'::jsonb, 'Promise + Mocha', 'Promise resolves and test completes', 'Promise created but not returned to Mocha', 0.99, 'haiku', NOW(), 'https://stackoverflow.com/questions/53953389/mocha-async-await-test-failed-with-timeout', 'admin:1764226436'),
('Programmatically skip tests in Mocha', 'testing', 'MEDIUM', '[{"solution": "Use this.skip() inside test: if (condition) { this.skip() }", "percentage": 97}, {"solution": "Use xit() prefix or describe.skip() to disable entire blocks", "percentage": 92}]'::jsonb, 'Mocha', 'Test skipped conditionally without error', 'Attempting to conditionally skip with exit/return', 0.95, 'haiku', NOW(), 'https://stackoverflow.com/questions/32723167/how-to-programmatically-skip-a-test-in-mocha', 'admin:1764226436'),
('Database connection not closed causing timeout', 'testing', 'HIGH', '[{"solution": "Close connection in after hook: after((done) => { db.close(done) })", "percentage": 93}, {"solution": "Use root-level hooks before first describe() to manage connection", "percentage": 88}]'::jsonb, 'Mocha + Database', 'Tests complete and process exits', 'Database connection remains open after tests', 0.91, 'haiku', NOW(), 'https://stackoverflow.com/questions/13898783/where-to-delete-database-and-close-connection-after-all-tests-using-mocha', 'admin:1764226436'),
('Mocha cannot detect unhandled exceptions in listeners', 'testing', 'MEDIUM', '[{"solution": "Remove Mocha listener: Mocha.process.removeListener(''uncaughtException'')", "percentage": 76}, {"solution": "Use allowUncaught() and manual exception handling", "percentage": 68}]'::jsonb, 'Mocha + Error handling', 'Global listener receives unhandled exceptions', 'Mocha installs own listener that overrides custom ones', 0.72, 'haiku', NOW(), 'https://stackoverflow.com/questions/39354331/how-can-i-prevent-mocha-from-trapping-unhandled-exceptions', 'admin:1764226436'),
('Socket hang up with HTTP testing', 'testing', 'MEDIUM', '[{"solution": "Ensure done() is called in request callback", "percentage": 87}, {"solution": "Add timeout and error handling: .timeout(5000)", "percentage": 82}]'::jsonb, 'Supertest + Mocha', 'HTTP request completes without hang', 'Missing done() call in request callback chain', 0.85, 'haiku', NOW(), 'https://stackoverflow.com/questions/55013043/mocha-node-http-testing-socket-hang-up', 'admin:1764226436'),
('Mocha tests never exit after completion', 'testing', 'HIGH', '[{"solution": "Add --exit flag: mocha --exit", "percentage": 98}, {"solution": "Close server and connections in after hook", "percentage": 95}]'::jsonb, 'Mocha + Server', 'Mocha exits with status code 0', 'Server or connections still listening after tests', 0.96, 'haiku', NOW(), 'https://stackoverflow.com/questions/46614446/mocha-tests-running-forever', 'admin:1764226436'),
('Uncaught AssertionError in async code', 'testing', 'HIGH', '[{"solution": "Wrap assertion in try-catch: try { assert(...) } catch(e) { done(e) }", "percentage": 93}, {"solution": "Use .then(done, done) to catch any errors", "percentage": 88}]'::jsonb, 'Mocha + Chai', 'Assertion errors properly reported', 'Assertion fails inside async callback without try-catch', 0.91, 'haiku', NOW(), 'https://stackoverflow.com/questions/30507170/mocha-test-fails-with-assertionerror', 'admin:1764226436'),
('Testing uncaught exceptions with process.nextTick', 'testing', 'MEDIUM', '[{"solution": "Remove Mocha listener, add own, then reattach: process.listeners(''uncaughtException'').pop()", "percentage": 72}, {"solution": "Use process.prependOnceListener() in Node 6+", "percentage": 84}]'::jsonb, 'Node.js + Mocha', 'Uncaught exception caught by custom listener', 'Mocha listener prevents custom handlers from executing', 0.78, 'haiku', NOW(), 'https://stackoverflow.com/questions/9025095/how-can-i-test-uncaught-errors-in-mocha', 'admin:1764226436'),
('Database setup best practices for Mocha tests', 'testing', 'MEDIUM', '[{"solution": "Use root-level before/after hooks in alphabetically first file", "percentage": 86}, {"solution": "Open connection once, reuse across all test files", "percentage": 81}]'::jsonb, 'Mocha + Database', 'Single connection reused across all tests', 'Opening new connection for each test file', 0.84, 'haiku', NOW(), 'https://stackoverflow.com/questions/47450779/best-practice-and-most-efficient-way-to-setup-a-database-connection-for-mocha-te', 'admin:1764226436');

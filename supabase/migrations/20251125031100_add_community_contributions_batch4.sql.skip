-- Community contributions batch 4 (PostgreSQL and Supabase fixes)
-- 3 entries from recent migration debugging

INSERT INTO knowledge_entries (
    query, category, hit_frequency, solutions, prerequisites, success_indicators,
    common_pitfalls, success_rate, claude_version, last_verified, source_url
) VALUES
(
    'PostgreSQL syntax error with Unicode arrow character in SQL migration file',
    'postgres',
    'MEDIUM',
    '[
        {
            "solution": "Replace Unicode arrow characters (→) with ASCII equivalents (->)",
            "percentage": 95,
            "command": "Find and replace → with -> in text editor",
            "note": "PostgreSQL parser expects ASCII characters in SQL text"
        },
        {
            "solution": "Use ASCII-only characters in SQL files - avoid Unicode symbols like →, ←, ↔, •, ✓",
            "percentage": 90,
            "note": "Prevents syntax errors across different PostgreSQL clients and encodings"
        }
    ]'::jsonb,
    'SQL migration file with Unicode characters, PostgreSQL database, File editing access',
    'Migration applies without syntax errors, SQL parser accepts all characters, No encoding-related failures',
    'Copying from documentation/websites that use Unicode formatting. Text editors auto-converting -- to em dash. Not checking migration files before applying.',
    0.95,
    'sonnet-4',
    NOW(),
    'community-contribution'
),
(
    'PostgreSQL syntax error at or near - backslash escape doesn''t work for single quotes',
    'postgres',
    'HIGH',
    '[
        {
            "solution": "Use double single quotes ('''') to escape quotes in PostgreSQL string literals, not backslash",
            "percentage": 95,
            "command": "Replace backslash-quote with double-quote in text editor",
            "note": "PostgreSQL standard: ''don''''t'' not ''don\\''t''"
        },
        {
            "solution": "Use dollar-quoted strings for complex text: $$text with ''quotes''$$ instead of ''text with ''''quotes''''''",
            "percentage": 85,
            "note": "Cleaner for multi-line strings or text with many quotes"
        }
    ]'::jsonb,
    'PostgreSQL database, SQL file with escaped quotes, Understanding of PostgreSQL string literals',
    'Query executes without syntax errors, Strings with quotes display correctly, Migration applies successfully',
    'Using MySQL/JavaScript backslash escaping in PostgreSQL. Forgetting PostgreSQL follows SQL standard (double quotes). Mixing escape styles in same query.',
    0.95,
    'sonnet-4',
    NOW(),
    'community-contribution'
),
(
    'Supabase migration duplicate key error - multiple files same timestamp',
    'supabase',
    'HIGH',
    '[
        {
            "solution": "Rename migration files to have unique timestamps - increment by 100-500",
            "percentage": 95,
            "command": "mv 20251125024000_file1.sql 20251125024500_file1.sql",
            "note": "Each migration needs unique timestamp prefix"
        },
        {
            "solution": "Check existing migrations before creating new ones: ls supabase/migrations/*.sql | tail -5",
            "percentage": 90,
            "note": "See latest timestamps to avoid conflicts"
        },
        {
            "solution": "Use supabase migration new command which auto-generates unique timestamps",
            "percentage": 85,
            "command": "supabase migration new migration_name",
            "note": "Official CLI prevents timestamp collisions"
        }
    ]'::jsonb,
    'Supabase project, Multiple migration files, CLI access for renaming',
    'supabase db push succeeds without duplicate key errors, All migrations appear in schema_migrations table, No timestamp conflicts in migrations directory',
    'Multiple developers creating migrations simultaneously with same timestamp. Copying migration files without renaming. Not checking schema_migrations table for existing versions.',
    0.95,
    'sonnet-4',
    NOW(),
    'community-contribution'
);

-- MongoDB Error Codes - Official Docs Mining
-- Source: mongodb.com/docs/manual/reference/error-codes/
-- Mined: 2025-11-25

INSERT INTO knowledge_entries (
    query, category, hit_frequency, solutions, prerequisites, success_indicators,
    common_pitfalls, success_rate, claude_version, last_verified, source_url
) VALUES (
    'MongoDB error: E11000 - Duplicate key error',
    'mongodb',
    'CRITICAL',
    $$[{"solution": "Check for existing unique indexes on the field. Drop the duplicate index using db.collection.dropIndex(). Ensure application logic prevents duplicate inserts. Verify unique constraint is intentional before reapplying.", "percentage": 95, "note": "Most common write error in MongoDB"}]$$::jsonb,
    'MongoDB connection, collection access, index visibility',
    'Insert operation succeeds without E11000 error. Duplicate check query returns expected results.',
    'Forgetting to drop old indexes before reapplying constraints. Not checking application logic for duplicate handling.',
    0.95,
    'sonnet-4',
    NOW(),
    'https://www.mongodb.com/docs/manual/reference/error-codes/'
),
(
    'MongoDB error: 13 - Not authorized to access database',
    'mongodb',
    'CRITICAL',
    $$[{"solution": "Verify credentials in connection string. Check user roles: db.getUser(username). Grant necessary roles: db.grantRolesToUser(username, [{role: ''readWrite'', db: ''dbname''}]). Recreate user if needed with correct authentication database.", "percentage": 92, "note": "Authentication database often defaults to ''admin''"}]$$::jsonb,
    'Admin access to MongoDB, knowledge of user/role structure',
    'Connection succeeds with credentials. db.auth() returns 1. User can read/write collections.',
    'Wrong authentication database. Incorrect role names. Typos in credentials.',
    0.92,
    'sonnet-4',
    NOW(),
    'https://www.mongodb.com/docs/manual/reference/error-codes/'
),
(
    'MongoDB error: 10107 - Not master',
    'mongodb',
    'HIGH',
    $$[{"solution": "Wait for replica set election to complete (30-60 seconds). Check replica set status: rs.status(). Ensure secondary node is not being queried for writes. Set readPreference to ''primary'' for write operations.", "percentage": 88, "note": "Common during replica set failover or maintenance"}]$$::jsonb,
    'Replica set configured, network connectivity to all nodes',
    'rs.status() shows healthy primary. Writes succeed after waiting. readPreference is correctly set.',
    'Querying secondary for writes. Not waiting for election. Network partitions.',
    0.88,
    'sonnet-4',
    NOW(),
    'https://www.mongodb.com/docs/manual/reference/error-codes/'
),
(
    'MongoDB error: 50 - Exceeded time limit',
    'mongodb',
    'HIGH',
    $$[{"solution": "Add indexes to slow queries: db.collection.createIndex({field: 1}). Increase maxTimeMS: collection.find().maxTimeMS(10000). Break large operations into smaller batches. Check query execution plan: db.collection.find(query).explain(''executionStats'').", "percentage": 90, "note": "Query optimization may resolve root cause"}]$$::jsonb,
    'Query analysis tools, understanding of MongoDB indexing, batch operation design',
    'Query completes within timeout. Execution plan shows index usage. Batch operations succeed.',
    'Not creating indexes. Setting timeouts too low. Full collection scans on large datasets.',
    0.90,
    'sonnet-4',
    NOW(),
    'https://www.mongodb.com/docs/manual/reference/error-codes/'
),
(
    'MongoDB error: 11000 - Duplicate key index',
    'mongodb',
    'CRITICAL',
    $$[{"solution": "Similar to E11000. Identify duplicate values: db.collection.aggregate([{$group: {_id: ''$field'', count: {$sum: 1}}}]). Remove duplicates or rebuild index. Use db.collection.dropIndex() then createIndex().", "percentage": 93, "note": "Legacy error code, often seen in older MongoDB versions"}]$$::jsonb,
    'Write access to collection, ability to identify duplicates',
    'Index recreation succeeds. No duplicate key errors on subsequent writes.',
    'Not removing underlying duplicate data. Trying to recreate index while duplicates exist.',
    0.93,
    'sonnet-4',
    NOW(),
    'https://www.mongodb.com/docs/manual/reference/error-codes/'
),
(
    'MongoDB error: 91 - ShardKeyNotFound',
    'mongodb',
    'MEDIUM',
    $$[{"solution": "Ensure shard key field exists in all documents: db.collection.find({shardKeyField: {$exists: false}}). Add missing field to documents: db.collection.updateMany({shardKeyField: {$exists: false}}, {$set: {shardKeyField: null}}). Verify shard key definition.", "percentage": 85, "note": "Occurs when inserting documents without shard key in sharded cluster"}]$$::jsonb,
    'Sharded cluster setup, collection schema knowledge',
    'All documents contain shard key field. Inserts into sharded collection succeed.',
    'Not checking for null shard keys. Changing shard key after sharding.',
    0.85,
    'sonnet-4',
    NOW(),
    'https://www.mongodb.com/docs/manual/reference/error-codes/'
),
(
    'MongoDB error: 26 - NamespaceNotFound',
    'mongodb',
    'MEDIUM',
    $$[{"solution": "Verify collection exists: db.getCollectionNames(). Create collection if needed: db.createCollection(''collectionName''). Check for typos in collection name. Verify database context with db.getName().", "percentage": 89, "note": "Often caused by typos or accessing non-existent collection"}]$$::jsonb,
    'Database connection, collection schema knowledge',
    'Collection appears in getCollectionNames(). Operations on collection succeed without NamespaceNotFound.',
    'Typos in collection names. Operating on wrong database. Case sensitivity in names.',
    0.89,
    'sonnet-4',
    NOW(),
    'https://www.mongodb.com/docs/manual/reference/error-codes/'
),
(
    'MongoDB error: 14 - Authentication failed',
    'mongodb',
    'CRITICAL',
    $$[{"solution": "Verify username and password are correct. Check authentication database in connection string (authSource parameter). Reset user password: db.changeUserPassword(username, newPassword). Ensure SCRAM-SHA-1 or SCRAM-SHA-256 mechanism is supported.", "percentage": 91, "note": "Different from authorization errors"}]$$::jsonb,
    'Admin credentials, user management access',
    'Authentication succeeds. User can execute commands on target database.',
    'Incorrect authSource parameter. Wrong mechanism negotiation. Special characters in password not escaped.',
    0.91,
    'sonnet-4',
    NOW(),
    'https://www.mongodb.com/docs/manual/reference/error-codes/'
),
(
    'MongoDB error: 9 - FailedToParse',
    'mongodb',
    'MEDIUM',
    $$[{"solution": "Validate BSON syntax in query documents. Check JSON formatting in filter queries. Verify field names are strings. Use MongoDB shell validation: db.collection.find({validJSON}). Test query with db.collection.validate().", "percentage": 87, "note": "Often in application driver queries"}]$$::jsonb,
    'Understanding of BSON format, JSON syntax knowledge',
    'Query parses without errors. Operations execute successfully.',
    'Unquoted field names. Invalid BSON types. Mixing JSON and BSON syntax.',
    0.87,
    'sonnet-4',
    NOW(),
    'https://www.mongodb.com/docs/manual/reference/error-codes/'
),
(
    'MongoDB error: 6 - WriteConflict',
    'mongodb',
    'MEDIUM',
    $$[{"solution": "Retry write operation with exponential backoff. Use transactions with caution on sharded clusters. Check for concurrent updates on same document. Consider increasing transaction timeout: maxCommitTimeMS. Reduce transaction scope to fewer operations.", "percentage": 82, "note": "Transactional operation conflict"}]$$::jsonb,
    'Transaction support enabled, understanding of MVCC model',
    'Write operation succeeds on retry. No conflicts detected in logs.',
    'Long-running transactions. Too many documents in single transaction. Hotspot documents.',
    0.82,
    'sonnet-4',
    NOW(),
    'https://www.mongodb.com/docs/manual/reference/error-codes/'
),
(
    'MongoDB error: 64 - WriteConcernFailed',
    'mongodb',
    'HIGH',
    $$[{"solution": "Check replica set health: rs.status(). Verify write concern settings match available nodes. Reduce write concern level from majority to 1 for testing. Ensure all replica set members are online. Check network connectivity between nodes.", "percentage": 86, "note": "Write replicated to insufficient nodes"}]$$::jsonb,
    'Replica set configuration, write concern understanding',
    'rs.status() shows all nodes healthy. Write operations acknowledge correctly.',
    'Requesting write concern majority with insufficient nodes. Network partitions.',
    0.86,
    'sonnet-4',
    NOW(),
    'https://www.mongodb.com/docs/manual/reference/error-codes/'
),
(
    'MongoDB error: 10334 - BSONObjectTooLarge',
    'mongodb',
    'MEDIUM',
    $$[{"solution": "Split large documents into smaller ones. Use BSON binary type for large data (not strings). Store large files in GridFS: db.fs.files and db.fs.chunks. Compress data before storing. Remove unnecessary fields from documents.", "percentage": 88, "note": "BSON document limit is 16MB"}]$$::jsonb,
    'Knowledge of document design, GridFS familiarity',
    'Documents stored successfully. File operations use GridFS. Document size under 16MB.',
    'Storing entire files as strings. Including raw binary data without GridFS.',
    0.88,
    'sonnet-4',
    NOW(),
    'https://www.mongodb.com/docs/manual/reference/error-codes/'
),
(
    'MongoDB error: 40 - DuplicateKeyOnInsert',
    'mongodb',
    'CRITICAL',
    $$[{"solution": "Check existing indexes: db.collection.getIndexes(). Remove duplicate index entries or recreate with db.collection.dropIndex() and db.collection.createIndex(). Validate unique constraint is necessary. Consider using sparse index if nulls are valid.", "percentage": 94, "note": "Insert-specific duplicate key variant"}]$$::jsonb,
    'Index management access, understanding of unique constraints',
    'Insert operations succeed without errors. Index validation returns clean results.',
    'Creating multiple indexes on same field. Not using sparse indexes for nullable fields.',
    0.94,
    'sonnet-4',
    NOW(),
    'https://www.mongodb.com/docs/manual/reference/error-codes/'
),
(
    'MongoDB error: 10156 - NotPrimaryNoSecondaryOk',
    'mongodb',
    'MEDIUM',
    $$[{"solution": "Ensure read operations use secondary replicas with readPreference set to ''secondaryPreferred''. Verify all replica set nodes are synchronized. Check connection pooling configuration in driver. Use rs.status() to verify replica set health.", "percentage": 84, "note": "Secondary read attempt during primary unavailability"}]$$::jsonb,
    'Replica set configuration, driver settings knowledge',
    'Reads execute with correct readPreference. Secondary reads succeed when primary down.',
    'Hardcoding primary server address. Not using replica set aware drivers.',
    0.84,
    'sonnet-4',
    NOW(),
    'https://www.mongodb.com/docs/manual/reference/error-codes/'
),
(
    'MongoDB error: 12586 - CommandNotSupported',
    'mongodb',
    'MEDIUM',
    $$[{"solution": "Check MongoDB server version: db.version(). Verify command exists in current version. Use version-specific syntax. Upgrade MongoDB if command is only in newer versions. Check deployment mode (sharded vs standalone) supports the command.", "percentage": 83, "note": "Command not available in current MongoDB version or deployment"}]$$::jsonb,
    'Knowledge of MongoDB version features, server version info',
    'Server version supports command. Command executes without error.',
    'Using bleeding-edge syntax on older servers. Not checking feature compatibility.',
    0.83,
    'sonnet-4',
    NOW(),
    'https://www.mongodb.com/docs/manual/reference/error-codes/'
);

-- Add Stack Overflow esbuild solutions batch 1
-- Mining highest-voted esbuild questions from Stack Overflow
-- Total entries: 12

INSERT INTO knowledge_entries (
    query, category, hit_frequency, solutions, prerequisites, success_indicators,
    common_pitfalls, success_rate, claude_version, last_verified, source_url
) VALUES (
    'How to configure Vite to allow JSX syntax in JS files with esbuild',
    'stackoverflow-esbuild',
    'HIGH',
    '[
        {"solution": "Create custom Vite plugin using transformWithEsbuild to treat .js files as JSX, configured with loader: ''jsx'' and jsx: ''automatic''", "percentage": 95, "note": "Official Vite approach, works for both dev and production"},
        {"solution": "Configure optimizeDeps.esbuildOptions with loader mapping {'.js': 'jsx'} in Vite config", "percentage": 85, "note": "Must be combined with plugin, esbuild options alone insufficient"}
    ]'::jsonb,
    'Vite installed, @vitejs/plugin-react package, React project',
    'JSX syntax accepted in .js files without errors during dev and production builds, transformWithEsbuild successfully processes files',
    'esbuild loader config alone does not work for both dev and prod - must use transformWithEsbuild. Pattern matching in plugin prevents unnecessary transformation of node_modules.',
    0.92,
    'sonnet-4',
    NOW(),
    'https://stackoverflow.com/questions/74620427/how-to-configure-vite-to-allow-jsx-syntax-in-js-files'
),
(
    'Using Tailwind CSS with esbuild bundler - integration methods',
    'stackoverflow-esbuild',
    'HIGH',
    '[
        {"solution": "Run Tailwind CLI separately from esbuild using command: npx tailwindcss -i ./src/app.css -o ./public/app.css --minify, execute both with npm-run-all in parallel", "percentage": 90, "note": "Recommended method, simpler than PostCSS integration"},
        {"solution": "Use esbuild-style-plugin with PostCSS to integrate Tailwind as PostCSS plugin directly in esbuild config", "percentage": 85, "note": "Better for complex PostCSS workflows"}
    ]'::jsonb,
    'Node.js with npm, Tailwind CSS installed, esbuild configured',
    'Tailwind CSS classes applied correctly in output, CSS file generates without errors, production build minifies correctly',
    'CSS filename same as JS file (e.g., app.tsx and app.css) causes issues - rename files or import CSS in JS. PostCSS integration more complex than Tailwind CLI approach.',
    0.88,
    'sonnet-4',
    NOW(),
    'https://stackoverflow.com/questions/70716940/using-tailwind-css-with-esbuild-the-process'
),
(
    'Get esbuild to watch for changes, rebuild, and restart Express server',
    'stackoverflow-esbuild',
    'HIGH',
    '[
        {"solution": "Use esbuild JavaScript API with context() and watch() methods: let ctx = await esbuild.context({...}); await ctx.watch(); Note: call watch() without await or Node will exit immediately", "percentage": 95, "note": "Official esbuild recommended approach"},
        {"solution": "Use npm-run-all or concurrently to run multiple npm scripts in parallel for esbuild watch and server restart", "percentage": 85, "note": "Alternative for complex watch scenarios"},
        {"solution": "Implement esbuild plugin with onEnd() callback to trigger server restart on rebuild", "percentage": 80, "note": "Most flexible for custom logic"}
    ]'::jsonb,
    'esbuild 0.17+, Express server setup, Node.js for running scripts',
    'Files rebuild on save without Node exiting, server restarts automatically after rebuild, no manual restart needed',
    'CRITICAL: watch() function must be called without await - with await Node process exits immediately. Separate scripts needed for production builds without watch mode.',
    0.91,
    'sonnet-4',
    NOW(),
    'https://stackoverflow.com/questions/72971679/get-esbuild-to-watch-for-changes-rebuild-and-restart-express-server'
),
(
    'Vite production build errors: is not a constructor for node_modules dependencies',
    'stackoverflow-esbuild',
    'MEDIUM',
    '[
        {"solution": "Set commonjsOptions: { include: [] } and optimizeDeps.disabled: false in Vite config for version 3", "percentage": 85, "note": "Workaround for Vite 3 with @rollup/plugin-commonjs v22"},
        {"solution": "Update to Vite 6.0 where issue was permanently fixed", "percentage": 90, "note": "Best long-term solution"}
    ]'::jsonb,
    'Vite v3 project with CommonJS dependencies, esbuild as bundler',
    'Production build completes without constructor errors, dependencies resolve correctly in bundled output',
    'This is version-specific - Vite 5.1+ removed optimizeDeps.disabled config entirely. Issue fixed in Vite 6.0. Works differently for Vue vs React projects.',
    0.82,
    'sonnet-4',
    NOW(),
    'https://stackoverflow.com/questions/70454977/vite-production-build-errors-is-not-a-constructor-for-node-modules'
),
(
    'How to setup custom esbuild with SCSS, PurgeCSS and LiveServer',
    'stackoverflow-esbuild',
    'MEDIUM',
    '[
        {"solution": "Create esbuild.mjs config file with esbuild-sass-plugin for SCSS, integrate PostCSS with autoprefixer, use separate esbuild_watch.mjs with @compodoc/live-server for auto-reload", "percentage": 90, "note": "Comprehensive full-stack solution"},
        {"solution": "Use esbuild-plugin-purgecss-2 with glob-all to scan HTML files for unused CSS and remove it", "percentage": 85, "note": "Adds PurgeCSS optimization layer"}
    ]'::jsonb,
    '"type": "module" in package.json, esbuild-sass-plugin, postcss, autoprefixer, esbuild-plugin-purgecss-2 installed',
    'SCSS compiles to CSS with autoprefixer rules applied, unused CSS removed from bundle, live-server auto-reloads on file changes',
    'esbuild cannot serve and watch simultaneously - must choose one. HMR not supported natively - use file watching instead. SCSS URL resolution may need additional config.',
    0.86,
    'sonnet-4',
    NOW(),
    'https://stackoverflow.com/questions/70325815/how-to-setup-custom-esbuild-with-scss-purgecss-liveserver'
),
(
    'esbuild not bundling files into a single output file',
    'stackoverflow-esbuild',
    'MEDIUM',
    '[
        {"solution": "Create single entry point file that imports all other files, then pass only that entry point to esbuild instead of multiple entry points", "percentage": 95, "note": "Official recommended approach"},
        {"solution": "Use stdin option with import statements: stdin: { contents: ''import \"./file1.js\"\nimport \"./file2.js\"'' }", "percentage": 90, "note": "Inline entry point alternative"}
    ]'::jsonb,
    'Multiple source files to bundle, esbuild installed and configured',
    'Single output file created with all dependencies bundled together, bundle size reasonable after minification',
    'Multiple entry points ALWAYS create separate output files - this is by design. Bundling means including dependencies, not simple concatenation. Must consolidate through single entry point.',
    0.89,
    'sonnet-4',
    NOW(),
    'https://stackoverflow.com/questions/63086520/esbuild-not-bundling-files-into-a-single-output'
),
(
    'How to do multiple bundles with Vite build',
    'stackoverflow-esbuild',
    'MEDIUM',
    '[
        {"solution": "Create separate Vite config files (vite.config.lib.dev.ts, vite.config.lib.prod.ts) with different build settings, execute sequentially in npm script: vite build --config vite.config.lib.dev.ts && vite build --config vite.config.lib.prod.ts", "percentage": 90, "note": "Official multi-config approach"},
        {"solution": "Set emptyDir: false in build.rollupOptions to preserve output from first build before second build runs", "percentage": 85, "note": "Critical to prevent output directory clearing"}
    ]'::jsonb,
    'Vite project with multiple entry points, TypeScript (for .ts config files)',
    'Multiple build configs execute without errors, output directories contain correct bundles, all chunks properly generated',
    'Vite clears output directory before each build by default - MUST set emptyDir: false. Using && vs || changes error handling. Alternative --mode flag approach requires manual sequential execution.',
    0.87,
    'sonnet-4',
    NOW(),
    'https://stackoverflow.com/questions/74390015/how-to-do-multiple-bundles-with-vite'
),
(
    'How to generate single file ESM bundle using esbuild for Node.js',
    'stackoverflow-esbuild',
    'MEDIUM',
    '[
        {"solution": "Accept architectural limitation - cannot have ESM format, single-file output, and Node.js compatibility all together due to CommonJS dependencies", "percentage": 75, "note": "Documented limitation by ecosystem"},
        {"solution": "Use alternative bundlers Webpack, Rollup, or Bun which have better ESM/Node.js support", "percentage": 80, "note": "Better for mixed module environments"}
    ]'::jsonb,
    'Node.js project with mostly ESM dependencies, understanding of CommonJS vs ESM',
    'Bundle generates without mixed module format errors, all dependencies properly handled',
    'Most Node.js libraries use CommonJS - bundlers struggle with mixed module formats. Setting platform: neutral tries to bundle native packages like fs causing errors. This is fundamental limitation not specific to esbuild.',
    0.70,
    'sonnet-4',
    NOW(),
    'https://stackoverflow.com/questions/76630431/how-to-generate-a-single-file-esm-bundle-using-esbuild-for-node-js'
),
(
    'ETXTBSY error when installing esbuild in Docker container',
    'stackoverflow-esbuild',
    'MEDIUM',
    '[
        {"solution": "Rollback Node.js version - use node:20.2.0-bullseye-slim instead of node:20.3.0-bullseye-slim or newer versions with file locking issues", "percentage": 92, "note": "Most reliable fix, version-specific issue"},
        {"solution": "Explicitly set Docker platform: FROM --platform=linux/amd64 node:19.5.0", "percentage": 85, "note": "Addresses architecture-specific issues"},
        {"solution": "On Docker Desktop M1 Mac: disable ''Use Rosetta for x86/amd64 emulation'' in settings to resolve Rosetta-related file locking", "percentage": 80, "note": "Hardware-specific workaround"}
    ]'::jsonb,
    'Docker container with Node.js, attempting to install esbuild via npm',
    'npm install completes successfully, esbuild binary validates without ETXTBSY error, container builds without spawn errors',
    'ETXTBSY (errno -26) is file locking issue during binary execution validation. Issue appears in Node 20.3.0+ on certain architectures. May relate to Docker emulation layers or file system permissions.',
    0.84,
    'sonnet-4',
    NOW(),
    'https://stackoverflow.com/questions/76461515/etxtbsy-error-when-installing-esbuild-in-docker-container'
),
(
    'When using esbuild with external React I get Dynamic require error',
    'stackoverflow-esbuild',
    'HIGH',
    '[
        {"solution": "Search dist folder for require(''react'') to identify problematic dependency, add that package to esbuild external config option to exclude from bundle", "percentage": 92, "note": "Identifies root cause approach"},
        {"solution": "Install the problematic dependency if missing so it resolves during build instead of embedding require() calls", "percentage": 88, "note": "Alternative if dependency truly external"},
        {"solution": "Use external-global plugin approach or banner workaround for complex cases", "percentage": 70, "note": "Less reliable workarounds"}
    ]'::jsonb,
    'esbuild configured with React as external, npm packages installed, dist folder accessible',
    'ESM bundle builds without Dynamic require errors, React properly handled as external, no CommonJS require calls in output',
    'Issue originates from dependencies using CommonJS internally (e.g., @emotion/styled, @mui/icons-material) not your source code. external config marks packages as dependencies, not global variables.',
    0.90,
    'sonnet-4',
    NOW(),
    'https://stackoverflow.com/questions/68423950/when-using-esbuild-with-external-react-i-get-dynamic-require-of-react-is-not-s'
),
(
    'How to wrap Vite build in IIFE with bundled dependencies',
    'stackoverflow-esbuild',
    'LOW',
    '[
        {"solution": "Create custom Rollup plugin in rollupOptions with generateBundle hook that wraps final JS code in IIFE function: (() => { code })()", "percentage": 90, "note": "Proper plugin-based approach, works with multiple entry points"},
        {"solution": "Use banner/footer config for simple wrapping", "percentage": 70, "note": "Simpler but less reliable with complex bundles"}
    ]'::jsonb,
    'Vite with Vue (or similar framework), multiple entry points, path.resolve available',
    'Output JavaScript files wrapped in IIFE, all dependencies properly bundled and inlined, scripts execute correctly in browser',
    'Direct esbuild format: ''iife'' breaks with multiple inputs - leaves imports as CommonJS require() instead of inlining. inlineDynamicImports option causes errors. Plugin approach more reliable.',
    0.85,
    'sonnet-4',
    NOW(),
    'https://stackoverflow.com/questions/73713323/how-to-wrap-vite-build-in-iife-and-still-have-all-the-dependencies-bundled-into'
),
(
    'esbuild configuration for optimizing bundle size and performance',
    'stackoverflow-esbuild',
    'HIGH',
    '[
        {"solution": "Enable minification with minify: true, set target to specific browser versions using target: ''es2020'' or similar", "percentage": 92, "note": "Basic optimization approach"},
        {"solution": "Use sourcemap: false in production to reduce output, enable only in development", "percentage": 88, "note": "Reduces file size significantly"},
        {"solution": "Configure external packages to prevent bundling large dependencies like React, lodash", "percentage": 85, "note": "Moves dependencies outside bundle"}
    ]'::jsonb,
    'esbuild configuration file, target environment specified',
    'Bundle size reduced, build completes without errors, minified output valid JavaScript',
    'Minification may require adjusting target version for compatibility. Sourcemaps useful for debugging but add file size. External config must match actual dependency resolution strategy.',
    0.89,
    'sonnet-4',
    NOW(),
    'https://stackoverflow.com/questions/tagged/esbuild?tab=votes'
),
(
    'esbuild plugin development and custom loader implementation',
    'stackoverflow-esbuild',
    'MEDIUM',
    '[
        {"solution": "Implement onResolve hook to customize module resolution and onLoad hook to transform file contents", "percentage": 88, "note": "Core plugin API for custom loaders"},
        {"solution": "Use namespace to prevent infinite loops when resolving same path multiple times in plugin chain", "percentage": 85, "note": "Important for complex plugin interactions"},
        {"solution": "Return undefined from hooks to allow other plugins to handle resolution", "percentage": 82, "note": "Enables plugin composition"}
    ]'::jsonb,
    'esbuild installed, JavaScript/TypeScript knowledge, understanding of module resolution',
    'Custom loader processes files correctly, plugin integrates with other plugins without conflicts, esbuild build completes successfully',
    'Plugins execute in order - early onResolve can prevent later plugins from running. onLoad must return { contents } for text or { loader } for format specification. Namespace prevents infinite recursion.',
    0.84,
    'sonnet-4',
    NOW(),
    'https://stackoverflow.com/questions/tagged/esbuild?tab=votes'
);

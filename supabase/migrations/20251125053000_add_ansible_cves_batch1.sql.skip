-- Add Ansible CVEs from Red Hat Security Advisories batch 1
-- Source: https://access.redhat.com/security/security-updates

INSERT INTO knowledge_entries (
    query, category, hit_frequency, solutions, prerequisites, success_indicators,
    common_pitfalls, success_rate, claude_version, last_verified, source_url
) VALUES (
    'CVE-2024-8775: Exposure of Sensitive Information in Ansible Vault Files Due to Improper Logging',
    'cve',
    'HIGH',
    '[
        {"solution": "Update ansible-core to version 2.15.13 or later (RHSA-2024:10762) or 2.16.13+ (RHSA-2024:8969)", "percentage": 95, "note": "Official Red Hat patch resolves vault file logging exposure"},
        {"solution": "For Ansible Automation Platform 2.4: Update ansible-core component to 2.15.13-1", "percentage": 90, "command": "yum update ansible-core-2.15.13-1"},
        {"solution": "Audit existing Ansible logs for exposed vault content; rotate affected secrets", "percentage": 85, "note": "Prevention measure after patching"}
    ]'::jsonb,
    'Access to Red Hat repositories, ansible-core installed, admin privileges on target systems',
    'ansible-core version verify shows 2.15.13+ or 2.16.13+, No vault content in system logs',
    'Vault files may be logged in task output when using certain modules. Always verify logs after patching. Check ANSIBLE_LOG_PATH configuration.',
    0.95,
    'sonnet-4',
    NOW(),
    'https://access.redhat.com/errata/RHSA-2024:10762'
),
(
    'CVE-2024-9902: Ansible-core user may read/write unauthorized content due to improper permissions',
    'cve',
    'HIGH',
    '[
        {"solution": "Update ansible-core to 2.15.13+ (RHSA-2024:10762) or 2.16.13+ (RHSA-2024:8969)", "percentage": 95, "note": "Resolves permission bypass vulnerability"},
        {"solution": "Apply RHSA-2024:8969 update for Execution Environments on RHEL 8/9", "percentage": 92, "command": "yum update ansible-core-2.16.13 ansible-core-2.17.6"},
        {"solution": "Review file permissions on Ansible working directories and restrict access appropriately", "percentage": 85, "note": "Defense-in-depth: minimize permission scope"}
    ]'::jsonb,
    'ansible-core installed, RHEL 8 or RHEL 9 system, yum package manager access',
    'ansible-core version reports 2.15.13+ or 2.16.13+, File permission checks show restricted access',
    'Vulnerability affects content accessibility. Do not rely on filesystem permissions alone. Apply patch immediately.',
    0.95,
    'sonnet-4',
    NOW(),
    'https://access.redhat.com/errata/RHSA-2024:10762'
),
(
    'CVE-2024-45801: XSS vulnerability in automation-controller via prototype pollution in dompurify',
    'cve',
    'MEDIUM',
    '[
        {"solution": "Update automation-controller to version 4.5.13+ for Red Hat Ansible Automation Platform 2.4", "percentage": 95, "note": "Official patch for XSS via prototype pollution"},
        {"solution": "For RHEL 8/9: Apply automation-controller 4.5.13-1 package update", "percentage": 92, "command": "yum update automation-controller-4.5.13-1"},
        {"solution": "Implement Web Application Firewall rules to filter XSS payloads as interim measure", "percentage": 70, "note": "Temporary protection pending patch"}
    ]'::jsonb,
    'Red Hat Ansible Automation Platform 2.4 installed, RHEL 8 or 9, root/admin access',
    'automation-controller version shows 4.5.13+, No XSS warnings in browser console, Web interface loads without errors',
    'Prototype pollution attacks can bypass input validation. Always update dompurify library. Test DOM integrity after update.',
    0.92,
    'sonnet-4',
    NOW(),
    'https://access.redhat.com/errata/RHSA-2024:10762'
),
(
    'CVE-2024-45296: Regular Expression Denial of Service (ReDoS) in automation-controller path-to-regexp',
    'cve',
    'MEDIUM',
    '[
        {"solution": "Update automation-controller to 4.5.13+ for Ansible Automation Platform 2.4", "percentage": 95, "note": "Fixes ReDoS in path-to-regexp dependency"},
        {"solution": "Apply yum package update: automation-controller 4.5.13-1", "percentage": 92, "command": "yum update automation-controller-4.5.13-1"},
        {"solution": "Monitor CPU usage during route parsing; rate-limit if necessary during interim period", "percentage": 75, "note": "Temporary mitigation before patch deployment"}
    ]'::jsonb,
    'Ansible Automation Platform 2.4, path-to-regexp module in use, RHEL 8/9 system',
    'Controller version 4.5.13+, Route parsing completes within expected timeframe, No excessive CPU spikes',
    'ReDoS vulnerabilities are triggered by malicious regex patterns. Input validation should complement patching.',
    0.92,
    'sonnet-4',
    NOW(),
    'https://access.redhat.com/errata/RHSA-2024:10762'
),
(
    'CVE-2024-0690: Information leak in tasks that ignore ANSIBLE_NO_LOG configuration',
    'cve',
    'MEDIUM',
    '[
        {"solution": "Update ansible-core to 2.15.9+ or 2.16.3+ depending on your version stream", "percentage": 95, "note": "Fixes ANSIBLE_NO_LOG bypass"},
        {"solution": "For RHEL 8: Update ansible-core to 2.16.3-2.el8 or later", "percentage": 93, "command": "yum update ansible-core-2.16.3-2.el8"},
        {"solution": "Audit playbooks using ANSIBLE_NO_LOG; verify sensitive data protection in execution logs", "percentage": 85, "note": "Post-patch verification critical"}
    ]'::jsonb,
    'ansible-core installed, RHEL 8 or compatible, ANSIBLE_NO_LOG used in playbooks',
    'ansible-core --version shows 2.16.3+, Sensitive data not visible in logs with ANSIBLE_NO_LOG set, Test playbooks confirm data masking',
    'Some task types may bypass ANSIBLE_NO_LOG. Review output handlers and custom callbacks. Test with sensitive variables.',
    0.93,
    'sonnet-4',
    NOW(),
    'https://access.redhat.com/errata/RHSA-2024:0733'
),
(
    'CVE-2023-43804: Cookie leakage across origins during HTTP redirects in automation-controller',
    'cve',
    'MEDIUM',
    '[
        {"solution": "Update automation-controller to 4.5.1+ for urllib3 vulnerability patch", "percentage": 95, "note": "Fixes cross-origin cookie transmission"},
        {"solution": "Apply package update: automation-controller 4.5.1 or later", "percentage": 92, "command": "yum update automation-controller-4.5.1"},
        {"solution": "Review redirect policies; implement HTTP Strict-Transport-Security (HSTS) header", "percentage": 80, "note": "Defense-in-depth practice"}
    ]'::jsonb,
    'automation-controller installed, urllib3 dependency present, HTTPS endpoints configured',
    'Controller version 4.5.1+, Redirect chains preserve cookie security, No cross-domain auth tokens leaked',
    'urllib3 redirect handling can expose auth cookies. Always use HTTPS. Test redirects with security tools.',
    0.92,
    'sonnet-4',
    NOW(),
    'https://access.redhat.com/errata/RHSA-2024:0733'
),
(
    'CVE-2024-41989: Memory exhaustion in django.utils.numberformat.floatformat() automation-controller',
    'cve',
    'MEDIUM',
    '[
        {"solution": "Update automation-controller to 4.6.2+ for Django vulnerability patch", "percentage": 95, "note": "Fixes floatformat memory exhaustion"},
        {"solution": "Apply RHSA-2024:8534 update: automation-controller 4.6.2", "percentage": 92, "command": "yum update automation-controller-4.6.2"},
        {"solution": "Limit input size for number formatting operations; validate numeric inputs", "percentage": 80, "note": "Input validation as interim protection"}
    ]'::jsonb,
    'Ansible Automation Platform 2.5, automation-controller component, RHEL 8/9 system',
    'automation-controller version 4.6.2+, Memory usage stable during number formatting, No DoS condition achieved',
    'Attack requires specific number format strings. Validate all user-supplied numeric inputs. Monitor memory during tests.',
    0.92,
    'sonnet-4',
    NOW(),
    'https://access.redhat.com/errata/RHSA-2024:8534'
),
(
    'CVE-2024-45230: Denial of Service in django.utils.html.urlize() automation-controller',
    'cve',
    'MEDIUM',
    '[
        {"solution": "Update automation-controller to 4.6.2+ per RHSA-2024:8534 for Django urlize fix", "percentage": 95, "note": "Resolves DoS through pathological URLs"},
        {"solution": "Apply package: automation-controller 4.6.2-1 on RHEL 8/9", "percentage": 92, "command": "yum update automation-controller-4.6.2"},
        {"solution": "Implement URL length validation; set maximum URL input limits in forms", "percentage": 80, "note": "Preventive input validation"}
    ]'::jsonb,
    'Ansible Automation Platform 2.5, urlize feature active, RHEL environment',
    'Controller version 4.6.2+, URL processing completes normally, No service degradation from malformed URLs',
    'urlize DoS triggered by extremely long or specially crafted URLs. Always validate URL inputs. Test with fuzzing.',
    0.92,
    'sonnet-4',
    NOW(),
    'https://access.redhat.com/errata/RHSA-2024:8534'
),
(
    'CVE-2024-10033: Cross-Site Scripting vulnerability in automation-gateway',
    'cve',
    'MEDIUM',
    '[
        {"solution": "Update automation-gateway to 2.5.3+ per RHSA-2024:8534", "percentage": 95, "note": "Fixes XSS vulnerability"},
        {"solution": "Apply package update: automation-gateway 2.5.3-1 on RHEL systems", "percentage": 92, "command": "yum update automation-gateway-2.5.3"},
        {"solution": "Implement Content Security Policy (CSP) headers as defense-in-depth", "percentage": 80, "note": "Browser-based XSS protection layer"}
    ]'::jsonb,
    'automation-gateway component installed, RHEL 8/9 system, admin access',
    'Gateway version 2.5.3+, No script execution in gateway UI, CSP headers present in responses',
    'XSS in gateway can compromise token security. Apply CSP headers. Test user input sanitization thoroughly.',
    0.92,
    'sonnet-4',
    NOW(),
    'https://access.redhat.com/errata/RHSA-2024:8534'
),
(
    'CVE-2024-22189: Memory exhaustion attack against QUIC connection ID in receptor',
    'cve',
    'MEDIUM',
    '[
        {"solution": "Update receptor to 1.4.9+ per RHSA-2024:8534 for quic-go patch", "percentage": 95, "note": "Fixes QUIC memory exhaustion attack"},
        {"solution": "Apply package: receptor 1.4.9-1 on Ansible Automation Platform 2.5", "percentage": 92, "command": "yum update receptor-1.4.9"},
        {"solution": "Implement rate limiting on connection attempts; monitor memory on receptor processes", "percentage": 80, "note": "Network-level DoS mitigation"}
    ]'::jsonb,
    'Ansible Automation Platform 2.5 with receptor, QUIC protocol enabled, RHEL 8/9',
    'receptor version 1.4.9+, Memory stable under normal and elevated connection loads, Connection timeout defaults appropriate',
    'QUIC attack requires sending many specially-crafted packets. Enable firewall rate limiting. Monitor receptor memory.',
    0.92,
    'sonnet-4',
    NOW(),
    'https://access.redhat.com/errata/RHSA-2024:8534'
),
(
    'CVE-2024-53908: Potential SQL injection in HasKey(lhs, rhs) on Oracle databases',
    'cve',
    'HIGH',
    '[
        {"solution": "Update automation-controller to 4.6.6+ per RHSA-2025:0340 for SQL injection fix", "percentage": 95, "note": "Resolves HasKey Oracle SQL injection"},
        {"solution": "Apply critical patch: automation-controller 4.6.6 on Ansible Automation Platform 2.5", "percentage": 95, "command": "yum update automation-controller-4.6.6"},
        {"solution": "Audit database queries using HasKey function; use parameterized queries", "percentage": 85, "note": "Code review for similar injection patterns"}
    ]'::jsonb,
    'Ansible Automation Platform 2.5, Oracle database backend, admin database access',
    'Controller version 4.6.6+, HasKey queries execute safely, SQL injection payloads rejected in tests',
    'SQL injection via HasKey on Oracle is critical. Use parameterized queries exclusively. Audit custom query code.',
    0.95,
    'sonnet-4',
    NOW(),
    'https://access.redhat.com/errata/RHSA-2025:0340'
),
(
    'CVE-2024-53907: Denial of Service in django.utils.html.strip_tags() automation-controller',
    'cve',
    'HIGH',
    '[
        {"solution": "Update automation-controller to 4.6.6+ per RHSA-2025:0340 for Django DoS fix", "percentage": 95, "note": "Patches strip_tags DoS vulnerability"},
        {"solution": "Apply critical update: automation-controller 4.6.6-1 on RHEL 8/9", "percentage": 95, "command": "yum update automation-controller-4.6.6"},
        {"solution": "Limit HTML input size in all web forms; implement timeout on strip_tags operations", "percentage": 85, "note": "Input validation and operational safeguards"}
    ]'::jsonb,
    'Ansible Automation Platform 2.5, Django HTML processing active, RHEL 8/9 system',
    'Controller version 4.6.6+, strip_tags completes within expected time, No service disruption from malicious HTML',
    'DoS triggered by pathologically nested HTML tags. Validate input size. Set reasonable timeouts.',
    0.95,
    'sonnet-4',
    NOW(),
    'https://access.redhat.com/errata/RHSA-2025:0340'
),
(
    'CVE-2024-11079: Unsafe Tagging Bypass via hostvars Object in Ansible-Core',
    'cve',
    'MEDIUM',
    '[
        {"solution": "Update ansible-core to 2.16.14+ per RHSA-2024:11145 for tagging bypass fix", "percentage": 95, "note": "Resolves hostvars unsafe tag bypass"},
        {"solution": "Apply patch: ansible-core 2.16.14 on Ansible Automation Platform 2.5", "percentage": 92, "command": "yum update ansible-core-2.16.14"},
        {"solution": "Review playbooks accessing hostvars; ensure no unsafe content processed as safe", "percentage": 85, "note": "Audit critical variable handling"}
    ]'::jsonb,
    'ansible-core installed, Automation Platform 2.5, RHEL 8/9, playbooks using hostvars',
    'ansible-core version 2.16.14+, hostvars correctly tagged as safe/unsafe, No unsafe variable execution',
    'hostvars can bypass safety tagging. Review Jinja2 filters applied to hostvars. Test unsafe content handling.',
    0.92,
    'sonnet-4',
    NOW(),
    'https://access.redhat.com/errata/RHSA-2024:11145'
),
(
    'CVE-2024-11483: Improper Scope Handling in OAuth2 Tokens for Ansible Automation Platform',
    'cve',
    'MEDIUM',
    '[
        {"solution": "Update automation-gateway to 2.5.20241218+ per RHSA-2024:11145 for OAuth scope fix", "percentage": 95, "note": "Encrypts OAuth tokens at rest, fixes scope handling"},
        {"solution": "Apply critical update: automation-gateway 2.5.20241218 on RHEL 8/9", "percentage": 95, "command": "yum update automation-gateway-2.5.20241218"},
        {"solution": "Verify OAuth token encryption enabled; audit OAuth scope configurations", "percentage": 85, "note": "Verify encryption and scope restrictions in use"}
    ]'::jsonb,
    'Ansible Automation Platform 2.5, OAuth2 authentication active, automation-gateway deployed',
    'Gateway version 2.5.20241218+, OAuth tokens encrypted at rest, Token scope restrictions enforced correctly',
    'OAuth scope bypass can grant excessive permissions. Encrypt all tokens. Use minimal required scopes.',
    0.95,
    'sonnet-4',
    NOW(),
    'https://access.redhat.com/errata/RHSA-2024:11145'
);

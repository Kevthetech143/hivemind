INSERT INTO knowledge_entries (query, category, hit_frequency, solutions, prerequisites, success_indicators, common_pitfalls, success_rate, claude_version, last_verified, source_url, contributor_email) VALUES
('Mongoose ValidationError: Custom error messages with required fields', 'orm', 'HIGH', '[{"solution": "Use tuple format in required constraint: required: [true, ''Custom message'']", "percentage": 95}, {"solution": "Access errors via err.errors[fieldName].message in error handler", "percentage": 90}]'::jsonb, 'Mongoose schema definition', 'Custom error messages appear in validation responses', 'Forgetting to pass message as second element in array', 0.93, 'haiku', NOW(), 'https://stackoverflow.com/questions/63402084/', 'admin:1764226196'),
('Mongoose CastError: Cast to ObjectId failed for invalid ID format', 'orm', 'HIGH', '[{"solution": "Validate ID format with mongoose.Types.ObjectId.isValid() before queries", "percentage": 92}, {"solution": "Use try-catch with findById to handle cast errors gracefully", "percentage": 88}]'::jsonb, 'Mongoose model with ObjectId fields', 'findById succeeds without CastError', 'Passing invalid string format to ObjectId conversion', 0.90, 'haiku', NOW(), 'https://stackoverflow.com/questions/17223517/', 'admin:1764226196'),
('Mongoose MissingSchemaError: Schema hasn''t been registered for model', 'orm', 'HIGH', '[{"solution": "Define schema with mongoose.model() BEFORE importing in routes", "percentage": 94}, {"solution": "Ensure models are initialized in app.js before route files are required", "percentage": 91}]'::jsonb, 'Express app initialization', 'No MissingSchemaError thrown on model usage', 'Requiring route file before model registration completes', 0.92, 'haiku', NOW(), 'https://stackoverflow.com/questions/18420920/', 'admin:1764226196'),
('Mongoose OverwriteModelError: Cannot overwrite model once compiled', 'orm', 'HIGH', '[{"solution": "Use pattern: mongoose.models[''ModelName''] || mongoose.model(''ModelName'', schema)", "percentage": 96}, {"solution": "Check if model exists before calling mongoose.model()", "percentage": 93}]'::jsonb, 'Multiple model registrations in test/dev environments', 'Model reloads without OverwriteModelError', 'Calling mongoose.model() multiple times with same name', 0.94, 'haiku', NOW(), 'https://stackoverflow.com/questions/28688437/', 'admin:1764226196'),
('Mongoose E11000 duplicate key error on unique index', 'orm', 'CRITICAL', '[{"solution": "Use sparse indexes: {unique: true, sparse: true} to allow multiple nulls", "percentage": 91}, {"solution": "Drop problematic indexes and recreate with correct configuration", "percentage": 87}]'::jsonb, 'Unique constraint on schema field', 'Duplicate entries can be inserted without E11000 error', 'Applying unique constraint without sparse flag on optional fields', 0.89, 'haiku', NOW(), 'https://stackoverflow.com/questions/24430220/', 'admin:1764226196'),
('Mongoose ParallelSaveError: Can''t save() the same doc multiple times in parallel', 'orm', 'HIGH', '[{"solution": "Avoid calling save() multiple times in parallel on same document", "percentage": 94}, {"solution": "Use Promise.all() to sequence saves or clone document before parallel saves", "percentage": 89}]'::jsonb, 'Document with concurrent save() calls', 'Document saves without parallel conflicts', 'Calling save() inside async callbacks that execute in parallel', 0.91, 'haiku', NOW(), 'https://stackoverflow.com/questions/50698794/', 'admin:1764226196'),
('Mongoose TypeError: mongoose.Schema is not a function', 'orm', 'MEDIUM', '[{"solution": "Use mongoose.Schema not mongoose.Schema() - Schema is a class not instance", "percentage": 96}, {"solution": "Change: var Schema = mongoose.Schema; to avoid Schema constructor", "percentage": 94}]'::jsonb, 'Mongoose import statement', 'Schema definitions execute without TypeError', 'Calling mongoose.Schema() with parentheses instead of referencing class', 0.95, 'haiku', NOW(), 'https://stackoverflow.com/questions/31838878/', 'admin:1764226196'),
('Mongoose ValidationError: Check for validation errors by error.name', 'orm', 'HIGH', '[{"solution": "Test with: if (err.name === ''ValidationError'') { iterate err.errors }", "percentage": 93}, {"solution": "Loop through err.errors with for..in to get field-specific messages", "percentage": 90}]'::jsonb, 'Save operation with schema validators', 'Field-level validation messages display correctly', 'Not checking err.name before accessing err.errors', 0.91, 'haiku', NOW(), 'https://stackoverflow.com/questions/14407007/', 'admin:1764226196'),
('Mongoose findByIdAndUpdate not returning updated document', 'orm', 'HIGH', '[{"solution": "Add { new: true } option: findByIdAndUpdate(id, update, { new: true })", "percentage": 97}, {"solution": "Pass update object directly - do not use $set wrapper in Mongoose", "percentage": 95}]'::jsonb, 'findByIdAndUpdate with update object', 'Updated document returned without additional $set nesting', 'Forgetting { new: true } returns old document; using $set incorrectly', 0.96, 'haiku', NOW(), 'https://stackoverflow.com/questions/55777285/', 'admin:1764226196'),
('Mongoose MongoServerSelectionError: connect ECONNREFUSED', 'orm', 'CRITICAL', '[{"solution": "Use IPv4 explicitly: mongoose.connect(''mongodb://127.0.0.1/db'')", "percentage": 88}, {"solution": "Add family: 4 option for IPv4: {family: 4, useUnifiedTopology: true}", "percentage": 91}]'::jsonb, 'MongoDB connection string setup', 'Connection to MongoDB succeeds', 'Mongoose defaults to IPv6 (::1) when localhost unavailable', 0.89, 'haiku', NOW(), 'https://stackoverflow.com/questions/69840504/', 'admin:1764226196'),
('Mongoose BulkWriteError: insertMany with duplicate keys and ordered flag', 'orm', 'MEDIUM', '[{"solution": "Use {ordered: false} to continue after errors: Model.insertMany(docs, {ordered: false})", "percentage": 92}, {"solution": "Catch BulkWriteError and check writeErrors array for failed inserts", "percentage": 87}]'::jsonb, 'insertMany operation with duplicate handling', 'Partial inserts succeed even with some duplicates', 'Relying on ordered: true (default) which stops on first duplicate', 0.89, 'haiku', NOW(), 'https://stackoverflow.com/questions/66171716/', 'admin:1764226196'),
('Mongoose ObjectId Argument error: 12 bytes or 24 hex characters', 'orm', 'HIGH', '[{"solution": "Validate with mongoose.Types.ObjectId.isValid(string) before usage", "percentage": 94}, {"solution": "Ensure parameter contains valid MongoDB ObjectId format (24 hex chars)", "percentage": 91}]'::jsonb, 'ObjectId creation from user input', 'ObjectId created without argument validation error', 'Passing arbitrary strings to mongoose.Types.ObjectId()', 0.92, 'haiku', NOW(), 'https://stackoverflow.com/questions/61902916/', 'admin:1764226196'),
('Mongoose populate() with missing reference creates null values', 'orm', 'MEDIUM', '[{"solution": "Check for null before mapping: user.role ? user.role.name : null", "percentage": 93}, {"solution": "Use optional chaining to safely access nested properties", "percentage": 89}]'::jsonb, 'Schema with ref fields and populate', 'Maps execute without "Cannot read property map of undefined" error', 'Not validating populated references before accessing properties', 0.90, 'haiku', NOW(), 'https://stackoverflow.com/questions/55673440/', 'admin:1764226196'),
('Mongoose pre() save middleware with arrow function loses this context', 'orm', 'HIGH', '[{"solution": "Use function keyword not arrow: schema.pre(''save'', async function(next))", "percentage": 98}, {"solution": "Access isModified() on function context: this.isModified(''field'')", "percentage": 96}]'::jsonb, 'Pre-save middleware implementation', 'this.isModified() works and password hashing executes', 'Using arrow functions in pre() hooks where this context needed', 0.97, 'haiku', NOW(), 'https://stackoverflow.com/questions/66839427/', 'admin:1764226196'),
('Mongoose Connection error: MongoDB daemon not running', 'orm', 'CRITICAL', '[{"solution": "Start mongod service: brew services start mongodb-community", "percentage": 90}, {"solution": "Check MongoDB port 27017 is open: netstat -an | grep 27017", "percentage": 88}]'::jsonb, 'MongoDB installation and setup', 'Successful connection to local MongoDB', 'MongoDB service stopped or not configured', 0.87, 'haiku', NOW(), 'https://stackoverflow.com/questions/20386464/', 'admin:1764226196'),
('Mongoose error.name check for MongoError instead of instanceof', 'orm', 'MEDIUM', '[{"solution": "Check error.name === ''MongoError'' && error.code === 11000", "percentage": 92}, {"solution": "Use mongoose.mongo.MongoError for instanceof comparison if needed", "percentage": 85}]'::jsonb, 'Error handling in promise catch blocks', 'E11000 errors properly identified and handled', 'Using instanceof with require(''mongodb-core'') instead of mongoose.mongo', 0.88, 'haiku', NOW(), 'https://stackoverflow.com/questions/56178664/', 'admin:1764226196'),
('Mongoose ValidationError: Access nested field error messages', 'orm', 'MEDIUM', '[{"solution": "Use: Object.values(err.errors).map(e => e.message)", "percentage": 94}, {"solution": "Iterate with for..in loop to get field name and message pair", "percentage": 91}]'::jsonb, 'Schema validation on save', 'Error messages extracted without accessing undefined properties', 'Trying to access err.errors.fieldName.message without checking structure', 0.92, 'haiku', NOW(), 'https://stackoverflow.com/questions/61498478/', 'admin:1764226196'),
('Mongoose NestJS error handling with @Catch and MongoError', 'orm', 'MEDIUM', '[{"solution": "@Catch(MongoError) to intercept MongoDB errors in NestJS", "percentage": 89}, {"solution": "Use AllExceptionsFilter globally: app.useGlobalFilters(new AllExceptionsFilter())", "percentage": 86}]'::jsonb, 'NestJS application with Mongoose integration', 'HTTP exceptions thrown with appropriate status codes', 'Not returning promise from create() in controller method', 0.85, 'haiku', NOW(), 'https://stackoverflow.com/questions/50864001/', 'admin:1764226196'),
('Mongoose VersionError: No matching document found for version check', 'orm', 'LOW', '[{"solution": "Increment __v manually if document deleted: doc.__v++", "percentage": 87}, {"solution": "Use findOneAndUpdate with $inc operator for version management", "percentage": 84}]'::jsonb, 'Concurrent document updates with versioning', 'Version conflicts resolved without VersionError', 'Attempting updates when document version mismatched', 0.82, 'haiku', NOW(), 'https://stackoverflow.com/questions/45223025/', 'admin:1764226196'),
('Mongoose StrictMode error: Setting undefined fields fails silently', 'orm', 'MEDIUM', '[{"solution": "Define all fields in schema or set strict: false on save()", "percentage": 89}, {"solution": "Use schema.add() to extend schema with new fields dynamically", "percentage": 82}]'::jsonb, 'Schema with strict mode enabled', 'Fields save to database without schema definition', 'Trying to set fields not defined in schema with strict mode', 0.85, 'haiku', NOW(), 'https://stackoverflow.com/questions/26818071/', 'admin:1764226196'),
('Mongoose findOne returns null when query parameters missing', 'orm', 'MEDIUM', '[{"solution": "Check for null: const doc = await Model.findOne(query); if (!doc) {...}", "percentage": 93}, {"solution": "Use lean() for read-only documents to improve performance", "percentage": 87}]'::jsonb, 'findOne query in async handler', 'Null check prevents accessing undefined properties', 'Assuming findOne always returns document without null check', 0.90, 'haiku', NOW(), 'https://stackoverflow.com/questions/34241970/', 'admin:1764226196'),
('Mongoose exec() without callback in middleware hooks', 'orm', 'MEDIUM', '[{"solution": "Always use .exec(callback) or await in async: await Model.findOne(query)", "percentage": 91}, {"solution": "Return promise from query: return Model.findOne(query)", "percentage": 88}]'::jsonb, 'Query in pre-middleware hook', 'Queries execute and callbacks trigger correctly', 'Using .exec() with implicit promise handling in middleware', 0.89, 'haiku', NOW(), 'https://stackoverflow.com/questions/47517266/', 'admin:1764226196'),
('Mongoose DocumentNotFoundError: Document expected but not returned', 'orm', 'MEDIUM', '[{"solution": "Verify _id exists: await Model.countDocuments({_id: id})", "percentage": 88}, {"solution": "Use findByIdAndUpdate with new: true to return null if not found", "percentage": 85}]'::jsonb, 'findByIdAndUpdate with options object', 'Method returns document or null without throwing error', 'Assuming findByIdAndUpdate always finds document', 0.86, 'haiku', NOW(), 'https://stackoverflow.com/questions/68886666/', 'admin:1764226196'),
('Mongoose ReferenceError: Model is not defined in routes', 'orm', 'MEDIUM', '[{"solution": "Require model at top of route file: const Model = require(''../models/Model'')", "percentage": 95}, {"solution": "Check model registration completes before route imports", "percentage": 92}]'::jsonb, 'Express route file requiring Mongoose model', 'Routes execute without ReferenceError on model access', 'Route file loaded before model definition or incorrect require path', 0.93, 'haiku', NOW(), 'https://stackoverflow.com/questions/52248729/', 'admin:1764226196'),
('Mongoose field validation: minlength and maxlength array validators', 'orm', 'MEDIUM', '[{"solution": "Use tuple format: minlength: [5, ''Message''] for custom error", "percentage": 94}, {"solution": "Check err.errors[field].kind to distinguish validation types", "percentage": 89}]'::jsonb, 'Schema field with length constraints', 'Validation errors include custom messages', 'Passing validator rules as non-tuple values', 0.91, 'haiku', NOW(), 'https://stackoverflow.com/questions/74623252/', 'admin:1764226196'),
('Mongoose populate recursive references causing infinite loops', 'orm', 'LOW', '[{"solution": "Limit populate depth: populate({ path: ''ref'', select: ''field1 field2'' })", "percentage": 86}, {"solution": "Use select() to exclude circular reference fields from population", "percentage": 83}]'::jsonb, 'Self-referential schema with populate', 'Population completes without maximum call stack exceeded error', 'Populating self-referential fields without depth limits', 0.80, 'haiku', NOW(), 'https://stackoverflow.com/questions/70046274/', 'admin:1764226196');

-- Add 10 highest voted Node.js questions from Stack Overflow
-- Category: stackoverflow-nodejs
-- Source: https://stackoverflow.com/questions/tagged/node.js?tab=votes

INSERT INTO knowledge_entries (query, category, solutions, common_pitfalls, success_rate, hit_frequency, claude_version, last_verified, thumbs_up)
VALUES
(
  'What is the difference between tilde (~) and caret (^) in package.json?',
  'stackoverflow-nodejs',
  '[{"solution": "Tilde (~) allows only patch version updates: ~1.2.3 permits versions from 1.2.3 to <1.3.0", "percentage": 95, "note": "More conservative approach, only backward-compatible bug fixes"}, {"solution": "Caret (^) allows minor and patch version updates: ^1.2.3 permits versions from 1.2.3 to <2.0.0", "percentage": 95, "note": "npm default since v5, includes backward-compatible new functionality"}, {"solution": "Override npm default with npm config set save-prefix=''~'' or npm config set save-prefix=''''", "percentage": 85, "command": "npm config set save-prefix=''~''", "note": "Set globally to change default behavior for all projects"}]'::jsonb,
  'Pre-1.0.0 versions behave differently: caret restricts updates based on which digit is leftmost non-zero. Common confusion: caret is NOT recommended for unstable (0.x) versions.',
  0.95,
  'VERY_HIGH',
  'sonnet-4',
  NOW(),
  0
),
(
  'Using async/await with a forEach loop does not wait for promises',
  'stackoverflow-nodejs',
  '[{"solution": "Use for...of loop for sequential execution: ''for (const file of files) { await fs.readFile(file) }''", "percentage": 95, "note": "forEach callback returns promise which forEach ignores. for...of waits for each iteration."}, {"solution": "Use Promise.all with map for parallel execution: ''await Promise.all(files.map(async (file) => { await fs.readFile(file) }))''", "percentage": 95, "note": "Better performance when operations are independent"}, {"solution": "Use for await...of for modern ES2018+ syntax: ''for await (const contents of files.map(file => fs.readFile(file))) { console.log(contents) }''", "percentage": 90, "note": "Cleanest syntax but requires Node.js 10+"}]'::jsonb,
  'forEach immediately returns without waiting. Async functions inside forEach callbacks execute but parent function proceeds. This causes race conditions or undefined behavior in subsequent code.',
  0.95,
  'VERY_HIGH',
  'sonnet-4',
  NOW(),
  0
),
(
  'How do I pass command line arguments to a Node.js program?',
  'stackoverflow-nodejs',
  '[{"solution": "Access arguments through process.argv array: ''const args = process.argv.slice(2)'' skips node executable and script path", "percentage": 98, "note": "Built-in, no dependencies required. process.argv[2] is first custom arg."}, {"solution": "Use process.argv directly in forEach: ''process.argv.forEach((val, idx) => console.log(idx + '': '' + val))''", "percentage": 95, "note": "Index 0=node, Index 1=script.js, Index 2+=your args"}, {"solution": "For complex flag parsing use libraries: Minimist (lightweight), Commander.js (full-featured), or Yargs (sophisticated)", "percentage": 85, "command": "npm install minimist", "note": "Only needed for --flag=value or complex argument structures"}]'::jsonb,
  'Forgetting process.argv includes node path (index 0) and script path (index 1). Directly using process.argv[0] gets ''node'' not your first argument.',
  0.98,
  'VERY_HIGH',
  'sonnet-4',
  NOW(),
  0
),
(
  'Find the version of an installed npm package',
  'stackoverflow-nodejs',
  '[{"solution": "Use npm list for local packages: ''npm list <package-name>'' or ''npm list --depth=0'' for all direct deps", "percentage": 98, "note": "--depth=0 shows only direct dependencies, faster output without nested deps"}, {"solution": "For globally installed packages: ''npm list -g --depth=0''", "percentage": 95, "note": "Lists globally installed packages with versions"}, {"solution": "Check package.json directly or use npm info: ''cat package.json | grep version'' or ''npm info <package>'' for latest version (not installed)", "percentage": 85, "note": "IMPORTANT: npm info shows LATEST available version on npm registry, not installed version"}]'::jsonb,
  'Using npm view <package> version returns latest available version on npm registry, not the installed version. Use npm list for installed version.',
  0.98,
  'VERY_HIGH',
  'sonnet-4',
  NOW(),
  0
),
(
  'Difference between dependencies, devDependencies, and peerDependencies',
  'stackoverflow-nodejs',
  '[{"solution": "dependencies: Packages required to run app in production. Install automatically and shared transitively.", "percentage": 98, "note": "If A needs B and B needs C, all three install. These are production-critical."}, {"solution": "devDependencies: Packages needed only for development (test frameworks, build tools, transpilers). Excluded with npm install --omit=dev", "percentage": 98, "note": "Test runners, Babel, webpack, ESLint, etc. Not used in production."}, {"solution": "peerDependencies: Packages that parent project must have installed. Signals compatibility, not auto-installed. Prevents version conflicts in plugins.", "percentage": 95, "note": "Ideal for plugin architectures. Framework plugins expect host project has the framework."}]'::jsonb,
  'Including devDependencies in peerDependencies causes unnecessary bloat. peerDependencies are NOT auto-installed like dependencies; they signal requirements. Using dependencies for build tools wastes production bundle size.',
  0.97,
  'VERY_HIGH',
  'sonnet-4',
  NOW(),
  0
),
(
  'Error "error:0308010C:digital envelope routines::unsupported" in Node.js and webpack',
  'stackoverflow-nodejs',
  '[{"solution": "Update dependencies to versions compatible with modern Node.js. Most projects with this error have newer versions available.", "percentage": 95, "note": "Best long-term solution. Addresses root cause not symptom. Recommended by npm maintainers."}, {"solution": "Temporary workaround: export NODE_OPTIONS=--openssl-legacy-provider before build", "percentage": 85, "command": "export NODE_OPTIONS=--openssl-legacy-provider (Unix/macOS)\nset NODE_OPTIONS=--openssl-legacy-provider (Windows CMD)\n$env:NODE_OPTIONS = \"--openssl-legacy-provider\" (PowerShell)", "note": "Temporary only. Security/vulnerability concerns make this suboptimal."}, {"solution": "Downgrade Node.js to v16 using nvm: nvm install 16 && nvm use 16", "percentage": 70, "command": "nvm install 16 && nvm use 16", "note": "Not recommended. Misses security patches and bug fixes in newer versions."}]'::jsonb,
  'Legacy OpenSSL provider flags mask the problem instead of fixing it. Downgrading Node.js loses security benefits and modern features. Dependencies likely have patched versions available.',
  0.90,
  'HIGH',
  'sonnet-4',
  NOW(),
  0
),
(
  'How to exit in Node.js process gracefully',
  'stackoverflow-nodejs',
  '[{"solution": "Use process.exitCode = 1 to set exit code and allow pending operations to complete before exiting", "percentage": 98, "note": "Preferred approach. Non-blocking. Allows event loop to drain asynchronous operations."}, {"solution": "Use process.exit() to force immediate termination with optional exit code: process.exit(0 for success, 1 for error)", "percentage": 85, "note": "NOT recommended for normal cases as it interrupts async operations and truncates output"}, {"solution": "In Node REPL: Ctrl+C twice, Ctrl+D (Unix/Linux/Mac), or type .exit and press Enter", "percentage": 90, "note": "For interactive shell only"}]'::jsonb,
  'Using process.exit() forces immediate termination, potentially interrupting asynchronous operations and truncating pending output. Always prefer process.exitCode for graceful shutdown.',
  0.95,
  'HIGH',
  'sonnet-4',
  NOW(),
  0
),
(
  'How to update Node.js and npm to latest versions',
  'stackoverflow-nodejs',
  '[{"solution": "Use Node Version Manager (nvm): nvm install node && nvm use node (latest) or nvm install <version>", "percentage": 95, "command": "nvm install node\nnvm use node", "note": "Official npm recommendation. Avoids permission issues with direct installers."}, {"solution": "Update npm separately: npm install npm@latest -g or npm update -g npm", "percentage": 90, "command": "npm install npm@latest -g", "note": "Can update npm before updating Node.js"}, {"solution": "AVOID: Do not use sudo with npm install -g commands. This causes permission problems.", "percentage": 100, "note": "Common mistake. Using sudo with global installs creates permission conflicts and prevents future updates."}]'::jsonb,
  'Using sudo with npm install -g causes permission issues and conflicts. Direct Node installers place npm in directories with local permissions, causing problems. nvm solves all permission issues.',
  0.93,
  'VERY_HIGH',
  'sonnet-4',
  NOW(),
  0
),
(
  'Writing to files in Node.js using fs module',
  'stackoverflow-nodejs',
  '[{"solution": "Use fs.writeFile() async method: fs.writeFile(path, content, callback) - callback receives error param", "percentage": 98, "note": "Non-blocking, preferred in production. Does not halt program execution."}, {"solution": "Use fs.writeFileSync() for synchronous writes: fs.writeFileSync(path, content) - halts execution until complete", "percentage": 85, "note": "Simpler but blocks event loop. Unsuitable for high-concurrency applications."}, {"solution": "Use fs.promises.writeFile() for async/await: await fs.promises.writeFile(path, content)", "percentage": 95, "note": "Modern approach. Cleaner syntax than callbacks. Available since Node 12+."}, {"solution": "Use fs.createWriteStream() for large files or sequential writes: const stream = fs.createWriteStream(path)", "percentage": 90, "note": "Memory efficient for large data. Returns stream object with write() method."}]'::jsonb,
  'Using writeFileSync() blocks the event loop and halts all other operations. In high-concurrency environments this causes performance degradation. Always prefer async methods (writeFile or fs.promises).',
  0.96,
  'VERY_HIGH',
  'sonnet-4',
  NOW(),
  0
),
(
  'Do I commit the package-lock.json file to version control?',
  'stackoverflow-nodejs',
  '[{"solution": "YES: Commit package-lock.json to version control. Ensures all developers use exact same dependency versions.", "percentage": 98, "note": "Best practice. Prevents ''works on my machine'' issues caused by dependency version differences."}, {"solution": "Add node_modules/ to .gitignore. Lock file provides version information, node_modules are reproducible.", "percentage": 95, "command": "Add to .gitignore: node_modules/\nnode_modules/*", "note": "Lock file is lightweight (KB). node_modules is heavy (GB). CI/CD runs npm install to reconstruct."}, {"solution": "For libraries (published npm packages): Consider omitting package-lock.json and letting consumers choose versions", "percentage": 80, "note": "Some teams prefer flexibility. Package.json constraints usually sufficient for published packages."}]'::jsonb,
  'Omitting package-lock.json causes version drift across team members and CI/CD. Different developers get different transitive dependency versions leading to bugs in production. Always commit lock files.',
  0.96,
  'HIGH',
  'sonnet-4',
  NOW(),
  0
),
(
  'What is the --save option for npm install?',
  'stackoverflow-nodejs',
  '[{"solution": "npm install --save adds package to dependencies in package.json. Default in npm v5+, no longer necessary to specify.", "percentage": 98, "note": "Legacy flag. npm install alone defaults to --save behavior since v5."}, {"solution": "npm install --save-dev (or -D) adds package to devDependencies for development-only packages", "percentage": 98, "command": "npm install --save-dev <package>\nnpm install -D <package>", "note": "Use for testing frameworks, build tools, linters"}, {"solution": "npm install --no-save installs package without modifying package.json", "percentage": 85, "command": "npm install --no-save <package>", "note": "Rarely used. Only for temporary testing."}, {"solution": "Before npm v5: --save was required or package.json would not update. Now automatic.", "percentage": 80, "note": "Historical context: npm v5 (2017) made --save default, eliminating the requirement."}]'::jsonb,
  'Forgetting npm v5+ defaults to --save. Beginners still specify --save unnecessarily. Not using -D or --save-dev for development packages bloats production dependencies.',
  0.97,
  'HIGH',
  'sonnet-4',
  NOW(),
  0
);

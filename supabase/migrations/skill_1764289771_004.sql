INSERT INTO knowledge_entries (query, category, type, solutions, executable_type, prerequisites, common_pitfalls, success_indicators, preview_summary, source_url, contributor_email)
VALUES (
  'Billing Automation - Build automated billing systems for recurring payments, invoicing, subscription lifecycle, and dunning management',
  'claude-code',
  'skill',
  '[{"solution": "Subscription Lifecycle Management", "cli": {"macos": "python3 << END\nfrom datetime import datetime, timedelta\nsub_end = datetime.now() + timedelta(days=30)\nprint(f''Subscription active until {sub_end}'')\nEND", "linux": "python3 << END\nfrom datetime import datetime, timedelta\nsub_end = datetime.now() + timedelta(days=30)\nprint(f''Subscription active until {sub_end}'')\nEND", "windows": "python3 << END\nfrom datetime import datetime, timedelta\nsub_end = datetime.now() + timedelta(days=30)\nprint(f''Subscription active until {sub_end}'')\nEND" }, "manual": "Define subscription states: trial -> active -> past_due -> canceled. Track current_period_start, current_period_end, billing_cycle_day. Implement methods: start_trial(), activate(), mark_past_due(), cancel().", "note": "Track both trial end date and current period for accurate state management" }, {"solution": "Billing Cycle Processing", "cli": {"macos": "python3 << END\nfrom datetime import datetime\ninv_id = datetime.now().strftime(''INV-%Y%m%d%H%M%S'')\nprint(inv_id)\nprint(''Subtotal: $99.00'')\nprint(''Tax: $10.89'')\nprint(''Total: $109.89'')\nEND", "linux": "python3 << END\nfrom datetime import datetime\ninv_id = datetime.now().strftime(''INV-%Y%m%d%H%M%S'')\nprint(inv_id)\nprint(''Subtotal: $99.00'')\nprint(''Tax: $10.89'')\nprint(''Total: $109.89'')\nEND", "windows": "python3 << END\nfrom datetime import datetime\ninv_id = datetime.now().strftime(''INV-%Y%m%d%H%M%S'')\nprint(inv_id)\nprint(''Subtotal: $99.00'')\nprint(''Tax: $10.89'')\nprint(''Total: $109.89'')\nEND" }, "manual": "Check if billing due. Generate invoice with line items and tax. Attempt payment. On success: mark paid, advance period. On failure: mark past_due, start dunning.", "note": "Always finalize invoice before attempting payment" }, {"solution": "Dunning Management", "cli": {"macos": "python3 << END\nfrom datetime import datetime, timedelta\nfor i, days in enumerate([3, 7, 14], 1):\n    next_retry = datetime.now() + timedelta(days=days)\n    print(f''Attempt {i}: {next_retry.strftime(\\\"%Y-%m-%d\\\")}'') \nEND", "linux": "python3 << END\nfrom datetime import datetime, timedelta\nfor i, days in enumerate([3, 7, 14], 1):\n    next_retry = datetime.now() + timedelta(days=days)\n    print(f''Attempt {i}: {next_retry.strftime(\\\"%Y-%m-%d\\\")}'') \nEND", "windows": "python3 << END\nfrom datetime import datetime, timedelta\nfor i, days in enumerate([3, 7, 14], 1):\n    next_retry = datetime.now() + timedelta(days=days)\n    print(f''Attempt {i}: {next_retry.strftime(\\\"%Y-%m-%d\\\")}'') \nEND" }, "manual": "Create DunningAttempt with attempt_number and next_retry. Define schedule (day 3,7,14). Send email before each retry. On recovery: mark paid. On exhausted: cancel subscription.", "note": "Gradual retry improves recovery rates vs aggressive cancellation" }, {"solution": "Proration Calculation", "cli": {"macos": "python3 -c \"total=30;days=15;old=99;new=199;print(f''Proration: ${((new-old)/total)*days:.2f}'')\"", "linux": "python3 -c \"total=30;days=15;old=99;new=199;print(f''Proration: ${((new-old)/total)*days:.2f}'')\"", "windows": "python3 -c \"total=30;days=15;old=99;new=199;print(f''Proration: ${((new-old)/total)*days:.2f}'')\"" }, "manual": "Calculate days in period. Credit unused portion. Charge new plan prorated. Net = new charge - credit. For seats, prorate without refund for removed seats.", "note": "Accurate proration requires careful date arithmetic" }, {"solution": "Tax Calculation by Region", "cli": {"macos": "echo Regional tax rates calculated", "linux": "echo Regional tax rates calculated", "windows": "echo Regional tax rates calculated" }, "manual": "Determine jurisdiction from customer location. Look up applicable rate. Calculate tax. Include in total. For EU: validate VAT number. Store jurisdiction and type.", "note": "Maintain lookup table for all markets served" }, {"solution": "Invoice Generation", "cli": {"macos": "cat > invoice.py <<''EOF''\nclass Invoice:\n  id=''INV123''; total=109.89\n  def to_html(self): return f''<h1>Invoice {self.id}</h1><p>Total: ${self.total}</p>''\nEOF", "linux": "cat > invoice.py <<''EOF''\nclass Invoice:\n  id=''INV123''; total=109.89\n  def to_html(self): return f''<h1>Invoice {self.id}</h1><p>Total: ${self.total}</p>''\nEOF", "windows": "cat > invoice.py <<''EOF''\nclass Invoice:\n  id=''INV123''; total=109.89\n  def to_html(self): return f''<h1>Invoice {self.id}</h1><p>Total: ${self.total}</p>''\nEOF" }, "manual": "Create Invoice class. Implement add_line_item(). Finalize() to compute total. Implement to_html() and to_pdf(). HTML for email delivery, PDF for archival.", "note": "Store HTML for preview and PDF for print/archive" }, {"solution": "Usage-Based Billing", "cli": {"macos": "echo Tiered billing calculation: 100 units at 10 dollars plus 50 units at 8 dollars equals 1400 dollars", "linux": "echo Tiered billing calculation: 100 units at 10 dollars plus 50 units at 8 dollars equals 1400 dollars", "windows": "echo Tiered billing calculation: 100 units at 10 dollars plus 50 units at 8 dollars equals 1400 dollars" }, "manual": "Track usage events. Aggregate for period. Apply model (per-unit/tiered/volume). Calculate in each tier. Add to invoice as line item.", "note": "Tiered pricing rewards high-volume customers" }, {"solution": "Stripe Payment Integration", "cli": {"macos": "pip install stripe && python3 -c \"import stripe; print(''Stripe ready'')\"", "linux": "pip install stripe && python3 -c \"import stripe; print(''Stripe ready'')\"", "windows": "pip install stripe && python3 -c \"import stripe; print(''Stripe ready'')\"" }, "manual": "Use Stripe SDK. Look up saved payment method. Create charge in cents. Handle errors. Store transaction_id. Implement retry.", "note": "Convert dollars to cents for Stripe (multiply 100)" }, {"solution": "Audit Trail Logging", "cli": {"macos": "cat > log.py <<''EOF''\nfrom datetime import datetime\nprint(f''[{datetime.now()}] CHARGE: Sub 123 - $99.00 (success)'')\nEOF", "linux": "cat > log.py <<''EOF''\nfrom datetime import datetime\nprint(f''[{datetime.now()}] CHARGE: Sub 123 - $99.00 (success)'')\nEOF", "windows": "cat > log.py <<''EOF''\nfrom datetime import datetime\nprint(f''[{datetime.now()}] CHARGE: Sub 123 - $99.00 (success)'')\nEOF" }, "manual": "Log: event_type, subscription_id, invoice_id, amount, status, timestamp, metadata. Log all operations. Store details for reconciliation.", "note": "Audit trail essential for compliance and dispute resolution" }]'::jsonb,
  'script',
  'Python 3.7+, Stripe account, email service, database, understanding of recurring billing',
  'Incorrect proration causing disputes. Aggressive dunning damaging relationships. Missing tax calculation. Hardcoded billing intervals. Silent payment failures. No audit trail.',
  'Subscriptions transition correctly (trial->active->past_due->canceled). Invoices accurate with tax. Dunning retries scheduled. Proration applied correctly. Tiered pricing works. Payments tracked. Audit logged.',
  'Build automated billing systems for SaaS with subscriptions, invoicing, dunning, and tax calculation',
  'https://skillsmp.com/skills/wshobson-agents-plugins-payment-processing-skills-billing-automation-skill-md',
  'admin:HAIKU_SKILL_1764289714_96235'
);

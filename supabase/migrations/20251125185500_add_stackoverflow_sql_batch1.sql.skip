-- Add 12 highest-voted Stack Overflow SQL questions with solutions

INSERT INTO knowledge_entries (query, category, solutions, common_pitfalls, success_rate, hit_frequency, claude_version, last_verified, source_url)
VALUES
(
  'What is the difference between INNER JOIN and OUTER JOIN?',
  'stackoverflow-sql',
  '[{"solution": "INNER JOIN returns only rows where the join condition is true for both tables. Use when you need matching records from both tables.", "percentage": 95, "command": "SELECT * FROM A INNER JOIN B ON A.id = B.id;", "note": "OUTER JOIN (LEFT, RIGHT, FULL) returns matching rows plus unmatched rows with NULL values"}, {"solution": "OUTER JOIN returns matching rows from both tables plus unmatched rows from the outer table(s) with NULL values. Use when preserving rows from one or both tables is important.", "percentage": 92, "command": "SELECT * FROM A LEFT OUTER JOIN B ON A.id = B.id;", "note": "LEFT OUTER JOIN keeps all left table rows, RIGHT OUTER JOIN keeps all right table rows, FULL OUTER JOIN keeps rows from both"}, {"solution": "Understand the logical processing order: 1) Generate cross join, 2) Filter rows where ON condition is true, 3) For outer joins, add back unmatched rows with NULL values. INNER JOIN stops at step 2.", "percentage": 88, "note": "The query optimizer handles execution efficiency regardless of implementation strategy"}]'::jsonb,
  'Adding a WHERE clause with conditions on the outer-joined table can unintentionally convert outer joins to inner joins. Place such conditions in the ON clause instead if you want to preserve outer-joined rows.',
  0.95,
  'VERY_HIGH',
  'sonnet-4',
  NOW(),
  'https://stackoverflow.com/questions/38549/what-is-the-difference-between-inner-join-and-outer-join'
),
(
  'How do I UPDATE from a SELECT in SQL Server?',
  'stackoverflow-sql',
  '[{"solution": "Use UPDATE with FROM and INNER JOIN: UPDATE Table_A SET Table_A.col1 = Table_B.col1 FROM Table_A INNER JOIN Table_B ON Table_A.id = Table_B.id WHERE condition. This is SQL Server''s standard syntax.", "percentage": 96, "command": "UPDATE Table_A SET Table_A.col1 = Table_B.col1, Table_A.col2 = Table_B.col2 FROM Table_A INNER JOIN Table_B ON Table_A.id = Table_B.id WHERE Table_A.col3 = ''value'';", "note": "Most efficient and readable approach for SQL Server"}, {"solution": "Use MERGE statement for SQL Server 2008+: MERGE INTO YourTable T USING other_table S ON T.id = S.id WHEN MATCHED THEN UPDATE SET col1 = S.col1. Provides ANSI-standard syntax.", "percentage": 90, "command": "MERGE INTO YourTable T USING other_table S ON T.id = S.id WHEN MATCHED THEN UPDATE SET col1 = S.col1, col2 = S.col2;", "note": "More portable across databases, supports additional WHEN clauses"}, {"solution": "For MySQL use different syntax: UPDATE Table_A, Table_B SET Table_A.col1 = Table_B.col1 WHERE Table_A.id = Table_B.id. Each database has proprietary syntax.", "percentage": 85, "command": "UPDATE table1, table2 SET table1.col1 = table2.col1 WHERE table1.id = table2.id;", "note": "MySQL uses comma-separated tables instead of FROM clause"}]'::jsonb,
  'Omitting the JOIN condition results in updating all rows incorrectly. Not filtering unchanged rows causes unnecessary index recalculations and trigger executions. One-to-many joins without aggregate functions produce undeterministic results. Failing to account for nullable columns in WHERE clauses leads to missing updates.',
  0.96,
  'VERY_HIGH',
  'sonnet-4',
  NOW(),
  'https://stackoverflow.com/questions/2334712/how-do-i-update-from-a-select-in-sql-server'
),
(
  'How to add a column with a default value to an existing table in SQL Server?',
  'stackoverflow-sql',
  '[{"solution": "Use ALTER TABLE with ADD and CONSTRAINT DEFAULT: ALTER TABLE {TableName} ADD {ColumnName} {DataType} {NULL|NOT NULL} CONSTRAINT {ConstraintName} DEFAULT {DefaultValue}. If NOT NULL, the default is applied to existing rows automatically.", "percentage": 97, "command": "ALTER TABLE MyTable ADD MyColumn INT NOT NULL DEFAULT(0);", "note": "Simple and straightforward for non-empty tables with NOT NULL requirement"}, {"solution": "For nullable columns with WITH VALUES clause: ALTER TABLE SomeTable ADD SomeCol BIT NULL CONSTRAINT D_SomeTable_SomeCol DEFAULT (0) WITH VALUES. This backfills existing rows with the default value.", "percentage": 95, "command": "ALTER TABLE [schema].[tablename] ADD [columnname] INT DEFAULT (0) WITH VALUES;", "note": "Ensure WITH VALUES is specified to populate existing rows"}, {"solution": "For large tables, use a three-step approach: 1) Add column as nullable without default, 2) Update values in batches to avoid table locks, 3) Alter to NOT NULL. This prevents 4-8 minute locks on massive tables.", "percentage": 92, "command": "ALTER TABLE MyTable ADD NewCol INT NULL; UPDATE MyTable SET NewCol = 0; ALTER TABLE MyTable ALTER COLUMN NewCol INT NOT NULL;", "note": "Critical for tables with millions of rows to avoid application downtime"}]'::jsonb,
  'If you specify NOT NULL without a default on a non-empty table, the ALTER TABLE statement fails. Nullable columns remain NULL unless WITH VALUES is explicitly added. Adding NOT NULL columns to massive tables locks the entire table for 4-8 minutes. The WITH VALUES clause is crucial for applying defaults to existing rows.',
  0.97,
  'VERY_HIGH',
  'sonnet-4',
  NOW(),
  'https://stackoverflow.com/questions/92082/how-to-add-a-column-with-a-default-value-to-an-existing-table-in-sql-server'
),
(
  'How does database indexing work?',
  'stackoverflow-sql',
  '[{"solution": "An index creates a separate sorted data structure containing indexed field values and pointers to original records. Instead of scanning every row (linear search requiring ~N/2 block accesses), a binary search on the sorted index requires only logâ‚‚(N) accesses. This provides exponential performance improvements for large tables.", "percentage": 94, "command": "CREATE INDEX idx_email ON users(email); SELECT * FROM users WHERE email = ''user@example.com'';", "note": "Trade-off: faster reads but slower INSERT/UPDATE/DELETE operations and additional disk space usage (~28%)"}, {"solution": "Index on columns frequently used in WHERE clauses and JOIN conditions. Effective for fields with high cardinality (many unique values) and on large tables where query performance matters. Avoid indexing very low cardinality columns (e.g., boolean with 2 values) and small tables.", "percentage": 91, "command": "CREATE INDEX idx_user_status ON users(status); -- Only if status has many unique values", "note": "A well-designed index can improve query speed by 100-1000x depending on data distribution"}, {"solution": "Consider composite indexes for queries using multiple columns. Index columns used in WHERE/JOIN before columns used only for output. Monitor index usage and remove unused indexes to reduce write overhead.", "percentage": 88, "command": "CREATE INDEX idx_user_lookup ON users(department, last_name) WHERE is_active = 1;", "note": "Filtered indexes reduce storage and improve write performance by indexing only active records"}]'::jsonb,
  'Indexing every column leads to slower INSERT/UPDATE/DELETE operations and wasted disk space. Low cardinality indexes (like boolean fields) rarely provide performance benefits and slow writes. Frequently updated fields with indexes become bottlenecks. Composite indexes are effective only when queries use columns in the defined order.',
  0.94,
  'HIGH',
  'sonnet-4',
  NOW(),
  'https://stackoverflow.com/questions/1108/how-does-database-indexing-work'
),
(
  'How can I prevent SQL injection in PHP?',
  'stackoverflow-sql',
  '[{"solution": "Use prepared statements with PDO: $stmt = $pdo->prepare(''SELECT * FROM users WHERE name = :name''); $stmt->execute([''name'' => $name]);. Set PDO::ATTR_EMULATE_PREPARES to false to ensure true server-side prepared statements. This separates SQL structure from data completely.", "percentage": 98, "command": "$pdo->setAttribute(PDO::ATTR_EMULATE_PREPARES, false); $stmt = $pdo->prepare(''SELECT * FROM users WHERE name = :name''); $stmt->execute([''name'' => $name]);", "note": "Most reliable and recommended approach. Works with all SQL databases."}, {"solution": "Use modern MySQLi with execute_query: $result = $db->execute_query(''SELECT * FROM users WHERE name = ?'', [$name]);. For older versions, use bind_param: $stmt->bind_param(''s'', $name);. Never string-concatenate user input into SQL.", "percentage": 97, "command": "$result = $db->execute_query(''SELECT * FROM employees WHERE name = ?'', [$name]);", "note": "PHP 8.2+ supports execute_query directly on mysqli object"}, {"solution": "For dynamic query structure (not just data), use whitelisting: $orders = [''name'', ''price'', ''qty'']; $key = array_search($_GET[''sort''], $orders); $orderby = $orders[$key] ?? ''name''; Then use: SELECT * FROM table ORDER BY `$orderby`. Never dynamically construct WHERE conditions.", "percentage": 85, "command": "// Whitelist allowed columns: $allowed = [''id'', ''name'', ''email'']; $col = in_array($_GET[''col''], $allowed) ? $_GET[''col''] : ''id''; $query = \"SELECT * FROM users ORDER BY `$col`\";", "note": "Only for parts where structure must be dynamic, never for values"}]'::jsonb,
  'Never rely on escaping functions like mysql_real_escape_string() - they are insufficient. Never concatenate user input directly into SQL strings. String-based validation is not reliable for injection prevention. Dynamic WHERE conditions constructed from user input are extremely dangerous even with escaping. Comment-based injection tricks (using -- or /**/) bypass many naive protections.',
  0.98,
  'VERY_HIGH',
  'sonnet-4',
  NOW(),
  'https://stackoverflow.com/questions/60174/how-can-i-prevent-sql-injection-in-php'
),
(
  'Finding and deleting duplicate values in a SQL table',
  'stackoverflow-sql',
  '[{"solution": "Find duplicates using GROUP BY: SELECT name, email, COUNT(*) FROM users GROUP BY name, email HAVING COUNT(*) > 1. This groups records by specified columns and shows only those appearing more than once. Works across all SQL databases.", "percentage": 96, "command": "SELECT name, email, COUNT(*) as duplicate_count FROM users GROUP BY name, email HAVING COUNT(*) > 1;", "note": "Most universal approach. Shows only the columns in GROUP BY plus aggregates."}, {"solution": "Find duplicate rows with full record information using window functions: SELECT * FROM (SELECT *, ROW_NUMBER() OVER (PARTITION BY name, email ORDER BY id) AS rn FROM users) t WHERE rn > 1. Modern and efficient approach supported by SQL Server, PostgreSQL, Oracle, MySQL 8+.", "percentage": 94, "command": "SELECT * FROM (SELECT *, ROW_NUMBER() OVER (PARTITION BY name, email ORDER BY id) AS rn FROM users) duplicates WHERE rn > 1;", "note": "Returns complete row information for all duplicates except the first"}, {"solution": "Delete duplicates safely preserving one record per group: DELETE FROM users WHERE id NOT IN (SELECT MIN(id) FROM users GROUP BY name, email). This keeps the first occurrence (lowest ID) and removes all duplicates.", "percentage": 95, "command": "DELETE FROM users WHERE id NOT IN (SELECT MIN(id) FROM users GROUP BY name, email);", "note": "Critical: Test on production backup first. Always SELECT the same query before DELETE to verify what will be removed"}]'::jsonb,
  'The GROUP BY approach only shows aggregated count, not complete row data. Self-join methods scale poorly with large datasets and many duplicates per group. DELETE without WHERE IN subquery deletes the wrong records. Forgetting to test the selection query before deletion causes data loss. Using the wrong ORDER BY column in window functions keeps the wrong records.',
  0.95,
  'HIGH',
  'sonnet-4',
  NOW(),
  'https://stackoverflow.com/questions/2594829/finding-and-deleting-duplicate-values-in-a-sql-table'
),
(
  'Concatenate text from multiple rows into a single text string',
  'stackoverflow-sql',
  '[{"solution": "MySQL uses GROUP_CONCAT(): SELECT GROUP_CONCAT(name SEPARATOR '', '') FROM people;. Simple and efficient for concatenating values from multiple rows.", "percentage": 96, "command": "SELECT id, GROUP_CONCAT(name ORDER BY name SEPARATOR '', '') as names FROM people GROUP BY id;", "note": "MySQL-specific function. Supports ORDER BY and custom separators. Default separator is comma."}, {"solution": "PostgreSQL and SQL Server 2017+ use STRING_AGG(): SELECT STRING_AGG(name, '', '') FROM people;. Modern standard function providing better compatibility.", "percentage": 95, "command": "SELECT STRING_AGG(name, '', '') WITHIN GROUP (ORDER BY name) FROM people;", "note": "PostgreSQL and SQL Server 2017+. Similar syntax to STRING_AGG in most databases."}, {"solution": "SQL Server 2005-2016 use FOR XML PATH with STUFF: SELECT STUFF((SELECT '','' + name FROM people FOR XML PATH(''''), TYPE).value(''text()[1]'',''nvarchar(max)''), 1, 1, ''). Complex but works on older versions.", "percentage": 88, "command": "SELECT STUFF((SELECT '','' + name FROM people FOR XML PATH(''''), TYPE).value(''text()[1]'',''nvarchar(max)''), 1, 1, '');", "note": "XML methods may escape special characters like & < > to entity codes. Requires STUFF to remove leading delimiter."}, {"solution": "Oracle 11g+ use LISTAGG(): SELECT LISTAGG(name, '', '') WITHIN GROUP (ORDER BY name) FROM people;. Oracle-specific aggregate function.", "percentage": 93, "command": "SELECT LISTAGG(name, '', '') WITHIN GROUP (ORDER BY name) FROM people;", "note": "Oracle-specific. Includes WITHIN GROUP for ordering. Similar to PostgreSQL STRING_AGG."}]'::jsonb,
  'Variable-based concatenation approaches (using COALESCE) are unsupported in SQL Server and unreliable across versions. XML-based FOR XML PATH methods escape special characters to entity codes requiring post-processing. Default separator for GROUP_CONCAT is comma but SEPARATOR clause must be explicitly specified. Order of concatenation is non-deterministic without ORDER BY clause. Maximum string length varies by database (GROUP_CONCAT has max length default).',
  0.94,
  'HIGH',
  'sonnet-4',
  NOW(),
  'https://stackoverflow.com/questions/194852/concatenate-text-from-multiple-rows-into-a-single-text-string'
),
(
  'How to return only the Date from a SQL Server DateTime datatype',
  'stackoverflow-sql',
  '[{"solution": "SQL Server 2008+: Use CAST or CONVERT to DATE datatype: SELECT CAST(GETDATE() AS DATE) or SELECT CONVERT(DATE, GETDATE()). Returns true DATE without time component. Most efficient modern syntax.", "percentage": 98, "command": "SELECT CAST(GETDATE() AS DATE) as today; -- Returns only date like 2025-11-25", "note": "Recommended approach for SQL Server 2008 and later. Simplest and most readable."}, {"solution": "All SQL Server versions: Use DATEADD/DATEDIFF to set time to midnight: SELECT DATEADD(dd, 0, DATEDIFF(dd, 0, GETDATE())). Returns datetime with time 00:00:00.000. Performs better than string conversion approaches.", "percentage": 96, "command": "SELECT DATEADD(dd, 0, DATEDIFF(dd, 0, GETDATE())) as today_midnight;", "note": "Uses approximately 1/3rd of the CPU time compared to CONVERT to VARCHAR approaches. Works on all SQL Server versions."}, {"solution": "Performance hierarchy: DATEADD/DATEDIFF is fastest, CAST to DATE is second-fastest and simplest, CONVERT to VARCHAR is slowest. Avoid string conversions as they require implicit type conversions back to datetime.", "percentage": 92, "command": "-- Benchmark comparison on large datasets\nSELECT CAST(datetime_col AS DATE) FROM large_table; -- ~90ms\nSELECT DATEADD(dd, 0, DATEDIFF(dd, 0, datetime_col)) FROM large_table; -- ~100ms\nSELECT CONVERT(VARCHAR(10), datetime_col, 111) FROM large_table; -- ~300ms", "note": "Performance differences become significant with millions of rows"}]'::jsonb,
  'Avoid converting DATETIME to DATE when time values are very close to midnight (23:59:59.999) as rounding can shift dates. Using DATETIME2 datatype mitigates rounding issues compared to DATETIME. CONVERT to VARCHAR with implicit conversion back to datetime defeats the purpose and is slowest approach. Simply removing time portion as a string does not return actual DATE datatype, causing type conversion issues in subsequent operations.',
  0.98,
  'HIGH',
  'sonnet-4',
  NOW(),
  'https://stackoverflow.com/questions/113045/how-to-return-only-the-date-from-a-sql-server-datetime-datatype'
),
(
  'What''s the difference between INNER JOIN, LEFT JOIN, RIGHT JOIN and FULL JOIN?',
  'stackoverflow-sql',
  '[{"solution": "INNER JOIN returns only matching records from both tables. Returns rows when there is a match in both tables. Use when you need data that exists in both tables simultaneously. Represents the intersection in a Venn diagram.", "percentage": 96, "command": "SELECT table1.column1, table2.column2 FROM table1 INNER JOIN table2 ON table1.common_field = table2.common_field;", "note": "Most restrictive join. Returns empty result if no matches exist."}, {"solution": "LEFT JOIN (or LEFT OUTER JOIN) retrieves all records from the left table plus matching records from the right table. Unmatched right-table columns display NULL values. Use when preserving all left-table records while optionally matching right-table data.", "percentage": 95, "command": "SELECT table1.column1, table2.column2 FROM table1 LEFT JOIN table2 ON table1.common_field = table2.common_field;", "note": "All left table rows guaranteed to appear. Right table rows may be NULL."}, {"solution": "RIGHT JOIN (or RIGHT OUTER JOIN) retrieves all records from the right table plus matching records from the left table. Mirror of LEFT JOIN - prioritizes the right table''s completeness. Unmatched left columns display NULL.", "percentage": 93, "command": "SELECT table1.column1, table2.column2 FROM table1 RIGHT JOIN table2 ON table1.common_field = table2.common_field;", "note": "Equivalent to LEFT JOIN with table order reversed. Many developers avoid RIGHT JOIN in favor of rewriting as LEFT JOIN."}, {"solution": "FULL JOIN (or FULL OUTER JOIN) combines results from both left and right outer joins. Returns all selected values from both tables with NULL values filling unmatched pairs. Use when you need comprehensive data from both tables regardless of matching status.", "percentage": 92, "command": "SELECT table1.column1, table2.column2 FROM table1 FULL JOIN table2 ON table1.common_field = table2.common_field;", "note": "Not supported in MySQL. Order matters for OUTER JOINs but not for INNER JOIN."}]'::jsonb,
  'Order matters for OUTER JOINs (LEFT, RIGHT, FULL) but not for INNER JOIN operations, as directional preference affects which table''s unmatched records appear. Adding WHERE clause conditions on the joined table can convert OUTER JOINs to INNER JOINs - place such conditions in ON clause to preserve the outer join semantics. Right joins are confusing and best avoided by rewriting as left joins. MySQL does not support FULL OUTER JOIN, requiring UNION of LEFT and RIGHT joins instead.',
  0.96,
  'VERY_HIGH',
  'sonnet-4',
  NOW(),
  'https://stackoverflow.com/questions/5706437/whats-the-difference-between-inner-join-left-join-right-join-and-full-join'
),
(
  'Inserting multiple rows in a single SQL query',
  'stackoverflow-sql',
  '[{"solution": "SQL Server 2008+, MySQL, PostgreSQL, SQLite 3.7.11+: Use multi-row VALUES syntax: INSERT INTO MyTable (Column1, Column2) VALUES (''value1'', 1), (''value2'', 2), (''value3'', 3);. Simple, readable, and efficient.", "percentage": 97, "command": "INSERT INTO MyTable (First, Last) VALUES (''Fred'', ''Smith''), (''John'', ''Smith''), (''Michael'', ''Smith'');", "note": "Standard modern syntax. Simplest approach for all major databases."}, {"solution": "For more than 1,000 rows in SQL Server, use INSERT...SELECT with VALUES: INSERT INTO MyTable SELECT V.* FROM (VALUES(''John'', 123), (''Jane'', 124)) V(Column1, Column2);. Bypasses SQL Server''s 1000-row VALUES limit.", "percentage": 95, "command": "INSERT INTO MyTable (Column1, Column2, Column3) SELECT V.Column1, V.Column2, V.Column3 FROM (VALUES(''John'', 123, ''Office''), (''Jane'', 124, ''Office'')) V(Column1, Column2, Column3);", "note": "Required for bulk inserts exceeding 1000 rows in SQL Server."}, {"solution": "SQL Server 2005 legacy: Use UNION ALL approach: INSERT INTO MyTable SELECT ''First'' as Col1, 1 as Col2 UNION ALL SELECT ''Second'', 2;. Older but still functional syntax.", "percentage": 85, "command": "INSERT INTO MyTable (FirstCol, SecondCol) SELECT ''First'' as FirstCol, 1 as SecondCol UNION ALL SELECT ''Second'', 2;", "note": "Supported in older SQL Server versions but multi-row VALUES is preferred in modern versions."}]'::jsonb,
  'SQL Server has a practical limit of ~1000 rows per multi-row VALUES clause. Exceeding this requires INSERT...SELECT with VALUES. Single multi-row INSERT executes triggers once with all records, versus multiple single-row INSERTs executing triggers repeatedly - critical performance difference. Optimal batch size typically ranges between 10 and 100 rows depending on column count and constraint checks. Network overhead reduction is significant when inserting thousands of rows.',
  0.97,
  'HIGH',
  'sonnet-4',
  NOW(),
  'https://stackoverflow.com/questions/452859/inserting-multiple-rows-in-a-single-sql-query'
),
(
  'Select first row in each GROUP BY group',
  'stackoverflow-sql',
  '[{"solution": "PostgreSQL: Use DISTINCT ON clause for simplest syntax: SELECT DISTINCT ON (customer) id, customer, total FROM purchases ORDER BY customer, total DESC, id;. Elegantly returns one row per group while maintaining flexibility. Often fastest for PostgreSQL.", "percentage": 96, "command": "SELECT DISTINCT ON (customer) id, customer, total FROM purchases ORDER BY customer, total DESC;", "note": "PostgreSQL extension. Returns first row based on ORDER BY. Very efficient."}, {"solution": "Cross-database using window functions with CTE: WITH summary AS (SELECT id, customer, total, ROW_NUMBER() OVER(PARTITION BY customer ORDER BY total DESC) AS rank FROM purchases) SELECT * FROM summary WHERE rank = 1;. Works on SQL Server, PostgreSQL, Oracle, MySQL 8+.", "percentage": 94, "command": "WITH ranked AS (SELECT *, ROW_NUMBER() OVER (PARTITION BY customer ORDER BY purchase_date DESC) AS rn FROM purchases) SELECT * FROM ranked WHERE rn = 1;", "note": "Most portable approach. Standard SQL syntax supported by all modern databases."}, {"solution": "Self-join pattern for database-agnostic results: SELECT purchases.* FROM purchases LEFT JOIN purchases p ON p.customer = purchases.customer AND purchases.total < p.total WHERE p.total IS NULL;. Filters to rows where no higher value exists per group.", "percentage": 88, "command": "SELECT t1.* FROM purchases t1 LEFT JOIN purchases t2 ON t1.customer = t2.customer AND t1.id < t2.id WHERE t2.id IS NULL;", "note": "Works on all databases but scales poorly with many rows per group"}]'::jsonb,
  'DISTINCT ON only works in PostgreSQL - not portable to other databases. ROW_NUMBER() with CTE requires correct ORDER BY column choice - wrong ORDER BY keeps wrong records. Self-join approach scales poorly with large group sizes and many rows per customer. Forgetting to filter WHERE rank = 1 returns all rows. Using MIN(id) instead of ROW_NUMBER() and HAVING COUNT()=1 requires complex aggregation logic.',
  0.94,
  'HIGH',
  'sonnet-4',
  NOW(),
  'https://stackoverflow.com/questions/3800551/select-first-row-in-each-group-by-group'
);

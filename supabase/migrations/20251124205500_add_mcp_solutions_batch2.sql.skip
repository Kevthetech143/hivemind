-- Add MCP troubleshooting solutions from Stack Overflow (batch 2 of 3)

INSERT INTO knowledge_entries (query, category, solutions, common_pitfalls, success_rate, hit_frequency, claude_version, last_verified, thumbs_up)
VALUES
(
  'Project-scoped MCP server not working in Claude Code Windows',
  'mcp-troubleshooting',
  '[{"solution": "Check .claude.json for corrupted/empty MCP config values and delete problematic lines", "percentage": 75, "command": "Open C:\\users\\[username]\\.claude.json and remove empty/corrupted project MCP entries then restart Claude", "note": "Local-scoped servers work fine. System recognizes project servers exist (shows in delete) but not in list."}]'::jsonb,
  'Project scope MCP config can get corrupted with empty values in .claude.json. Local scope works but project scope fails to list. Restart required after fix.',
  0.75,
  'LOW',
  'sonnet-4',
  NOW(),
  0
),
(
  'MCP error -32001 Request timed out Node.js server HTTP/SSE',
  'mcp-troubleshooting',
  '[{"solution": "Remove express.json() middleware - it buffers full request before handler", "percentage": 90, "command": "Remove app.use(express.json()) and handle POST/GET separately with streaming", "note": "Claude sends streamed ND-JSON not finite JSON. express.json() waits for full body which never arrives. Create session-specific transports for POST and GET."}]'::jsonb,
  'Express.json() middleware blocks execution waiting for complete JSON body. Claude streams ND-JSON indefinitely. Handler never executes, connection times out after 60s.',
  0.90,
  'MEDIUM',
  'sonnet-4',
  NOW(),
  0
),
(
  'MCP server fetch failed error when calling localhost',
  'mcp-troubleshooting',
  '[{"solution": "Replace localhost with actual local IP address like 192.168.x.x", "percentage": 95, "command": "Find local IP: ifconfig | grep \"inet \" | grep -v 127.0.0.1. Use http://192.168.2.32:8000 instead of localhost:8000", "note": "User confirmed this resolved fetch failed error. Claude Desktop has security restrictions preventing localhost connections."}]'::jsonb,
  'Claude Desktop security restrictions block localhost fetch calls. Must use actual local network IP address. Localhost/127.0.0.1 returns fetch failed.',
  0.95,
  'MEDIUM',
  'sonnet-4',
  NOW(),
  0
),
(
  'Cannot build Claude MCP environment on Mac node command not found',
  'mcp-troubleshooting',
  '[{"solution": "Use full absolute path to node executable in MCP config", "percentage": 100, "command": "which node to find path. Use /usr/local/bin/node in mcpServers command field", "note": "User confirmed \"worked\" after using full path. Both npx and node methods failed with just \"node\" - needs absolute path."}]'::jsonb,
  'macOS MCP config requires absolute path to node. Relative \"node\" command fails with \"command not found\". Path resolution differs from terminal.',
  1.0,
  'MEDIUM',
  'sonnet-4',
  NOW(),
  0
),
(
  'IPC delay 65+ seconds from main process to renderer Claude integration Electron',
  'general',
  '[{"solution": "Upgrade to Electron v38 beta and Claude Code SDK v1.0.70+", "percentage": 100, "command": "npm install electron@38.0.0-beta && npm install @anthropic-ai/claude-code@1.0.70", "note": "User confirmed \"worked perfectly without any delay\" after upgrade. First query warmup latency fixed in these versions."}]'::jsonb,
  'Versions before Electron v38 + Claude v1.0.70 had 65s first query warmup where SDK spins up subprocess. Setting maxTurns=1 or pre-warming did not help.',
  1.0,
  'LOW',
  'sonnet-4',
  NOW(),
  0
);

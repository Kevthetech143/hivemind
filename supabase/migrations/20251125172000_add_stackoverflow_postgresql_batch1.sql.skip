-- Stack Overflow PostgreSQL Top-Voted Solutions Batch 1
-- Extracted from: https://stackoverflow.com/questions/tagged/postgresql?tab=votes
-- Category: stackoverflow-postgresql
-- Date: 2025-11-25

INSERT INTO knowledge_entries (
    query, category, hit_frequency, solutions, prerequisites, success_indicators,
    common_pitfalls, success_rate, claude_version, last_verified, source_url
) VALUES (
    'How to show tables in PostgreSQL?',
    'stackoverflow-postgresql',
    'VERY_HIGH',
    '[
        {"solution": "Use \\dt command in psql to display all tables in current schema. First connect with \\c database_name to select target database.", "percentage": 95, "note": "Quickest method when using psql command-line interface", "command": "\\dt"},
        {"solution": "Query system catalog using SELECT * FROM pg_catalog.pg_tables to get all tables programmatically", "percentage": 90, "note": "Works outside psql environment"},
        {"solution": "Filter out system tables with WHERE schemaname != ''pg_catalog'' AND schemaname != ''information_schema'' in SQL query", "percentage": 85, "note": "Excludes internal PostgreSQL tables"}
    ]'::jsonb,
    'Active psql connection or database credentials, Target database selected',
    'List of tables appears when \\dt executed, SELECT query returns user-created tables only',
    'Forgetting to run \\c database_name first. Using \\dt on system catalog shows system tables—filter with WHERE clause in SQL queries.',
    0.95,
    'sonnet-4',
    NOW(),
    'https://stackoverflow.com/questions/769683/how-to-show-tables-in-postgresql'
),
(
    'PostgreSQL DESCRIBE TABLE equivalent',
    'stackoverflow-postgresql',
    'VERY_HIGH',
    '[
        {"solution": "Use \\d+ tablename in psql to display comprehensive table information including columns, constraints, and metadata", "percentage": 95, "note": "Plus modifier provides enhanced output with OIDs and descriptions", "command": "\\d+ tablename"},
        {"solution": "Use \\d tablename for basic table structure without metadata (without the + modifier)", "percentage": 90, "note": "Lighter output, shows essential column info only"},
        {"solution": "Query INFORMATION_SCHEMA.COLUMNS for SQL-based approach: SELECT column_name, data_type, column_default, is_nullable FROM INFORMATION_SCHEMA.COLUMNS WHERE table_name = ''tablename''", "percentage": 88, "note": "Works across different tools, not limited to psql"}
    ]'::jsonb,
    'psql client access, Target table exists, Knowledge of table name',
    'Table structure displays with column names, data types, and constraints. \\d+ command shows metadata in psql.',
    'Table names with uppercase letters must be wrapped in double quotes: \\d+ \"TableName\". \\d+ only works in psql, not in other tools.',
    0.94,
    'sonnet-4',
    NOW(),
    'https://stackoverflow.com/questions/109325/postgresql-describe-table'
),
(
    'Select first row in each GROUP BY group',
    'stackoverflow-postgresql',
    'HIGH',
    '[
        {"solution": "Use DISTINCT ON (column) with ORDER BY to select first row per group: SELECT DISTINCT ON (customer) id, customer, total FROM purchases ORDER BY customer, total DESC, id", "percentage": 95, "note": "PostgreSQL-specific, fastest approach available since v7.1", "command": "SELECT DISTINCT ON (grouping_column) * FROM table ORDER BY grouping_column, sort_column DESC"},
        {"solution": "Create multi-column index for performance optimization: CREATE INDEX table_3c_idx ON table (grouping_column, sort_column DESC, id)", "percentage": 85, "note": "Improves query performance significantly for large datasets"},
        {"solution": "Use ROW_NUMBER() window function for database-agnostic solution with CTE and WHERE rank = 1 filter", "percentage": 80, "note": "Works across PostgreSQL, MySQL, SQL Server but slower than DISTINCT ON"}
    ]'::jsonb,
    'PostgreSQL 7.1 or newer, Properly indexed columns for optimal performance',
    'Query returns exactly one row per group with first occurrence based on ORDER BY clause. Index created successfully.',
    'Leading expressions in ORDER BY must be in DISTINCT ON expressions. Cannot arbitrarily pick columns for selection—must respect DISTINCT ON requirements. Handle NULLs with NULLS LAST if needed.',
    0.93,
    'sonnet-4',
    NOW(),
    'https://stackoverflow.com/questions/3800551/select-first-row-in-each-group-by-group'
),
(
    'How to change a PostgreSQL user password',
    'stackoverflow-postgresql',
    'HIGH',
    '[
        {"solution": "Use \\password command in psql: log in with sudo -u postgres psql, then type \\password postgres at prompt. Enter new password when prompted.", "percentage": 95, "note": "Safest method—avoids exposing password in command history", "command": "sudo -u postgres psql\npostgres=# \\password postgres\nEnter new password:"},
        {"solution": "Execute ALTER USER SQL directly: ALTER USER postgres PASSWORD ''newpassword''", "percentage": 85, "note": "Can be run as single command: sudo -u postgres psql -c \"ALTER USER postgres PASSWORD ''newpassword''\"", "command": "ALTER USER username PASSWORD ''newpassword''"},
        {"solution": "Change authentication method from peer to md5 in pg_hba.conf if password auth failing: local all postgres md5, then restart with sudo systemctl restart postgresql", "percentage": 80, "note": "Required if receiving peer authentication errors after password change"}
    ]'::jsonb,
    'PostgreSQL installed and running, superuser access or permission to change own password, psql client installed',
    'Password successfully changed in psql. User can authenticate with new password. No authentication errors on next login.',
    'Using ALTER USER with plaintext passwords exposes credentials in shell history. Peer authentication may reject password changes—need to modify pg_hba.conf. \\password is safer than ALTER USER command.',
    0.92,
    'sonnet-4',
    NOW(),
    'https://stackoverflow.com/questions/12720967/how-can-i-change-a-postgresql-user-password'
),
(
    'How to exit from PostgreSQL psql command line utility',
    'stackoverflow-postgresql',
    'HIGH',
    '[
        {"solution": "Type \\q and press ENTER to quit psql. This is the standard method for all PostgreSQL versions.", "percentage": 95, "note": "Works reliably in normal interactive psql sessions", "command": "\\q"},
        {"solution": "PostgreSQL 11+ supports natural language exit commands: type quit or exit and press ENTER", "percentage": 85, "note": "Added in PostgreSQL 11 for user convenience"},
        {"solution": "Use keyboard shortcut Ctrl+D to send EOF (end-of-file) signal, or Ctrl+Z to suspend process", "percentage": 80, "note": "Ctrl+D works across Unix shells and tools, more universal than \\q command"}
    ]'::jsonb,
    'psql session open, Any PostgreSQL version',
    'psql prompt exits cleanly, returns to shell prompt, no error messages',
    '\\q may not work in single-user backend mode (--single flag). Ctrl+Z suspends rather than exits. Try Ctrl+D if \\q fails.',
    0.91,
    'sonnet-4',
    NOW(),
    'https://stackoverflow.com/questions/9463318/how-to-exit-from-postgresql-command-line-utility-psql'
),
(
    'How to drop all tables in PostgreSQL database',
    'stackoverflow-postgresql',
    'HIGH',
    '[
        {"solution": "Drop and recreate entire public schema: DROP SCHEMA public CASCADE; CREATE SCHEMA public; Then restore permissions (v9.3+): GRANT ALL ON SCHEMA public TO postgres; GRANT ALL ON SCHEMA public TO public;", "percentage": 90, "note": "Simple one-step approach, handles foreign keys automatically", "command": "DROP SCHEMA public CASCADE;\nCREATE SCHEMA public;"},
        {"solution": "Generate individual DROP TABLE commands from system catalog if schema dropping unavailable: SELECT ''DROP TABLE IF EXISTS \"'' || tablename || ''\" CASCADE;'' FROM pg_tables WHERE schemaname = ''public''", "percentage": 85, "note": "More control, works with limited permissions", "command": "SELECT ''DROP TABLE IF EXISTS \"'' || tablename || ''\" CASCADE;'' FROM pg_tables WHERE schemaname = ''public''"},
        {"solution": "Execute generated DROP commands automatically using \\gexec in psql", "percentage": 80, "note": "Combines SELECT generation with automatic execution"}
    ]'::jsonb,
    'Schema ownership or superuser permissions, Backup of important data created, Target database is not active',
    'All tables removed from public schema. Database is empty or contains only default PostgreSQL objects. No table-not-found errors.',
    'CASCADE also removes functions, views, and triggers—not just tables. Custom permissions are lost. Extensions like PostGIS may be affected. Always backup before executing.',
    0.90,
    'sonnet-4',
    NOW(),
    'https://stackoverflow.com/questions/3327312/how-can-i-drop-all-the-tables-in-a-postgresql-database'
),
(
    'How to switch databases in psql',
    'stackoverflow-postgresql',
    'HIGH',
    '[
        {"solution": "Use \\connect DBNAME or shorthand \\c DBNAME to switch to target database in psql", "percentage": 95, "note": "psql meta-command, closes current connection and opens new one", "command": "\\c database_name"},
        {"solution": "Specify additional connection parameters: \\connect DBNAME USERNAME HOSTNAME PORT or \\c DBNAME USERNAME", "percentage": 85, "note": "Allows changing user or host during database switch"},
        {"solution": "List all available databases first with \\l or \\list before deciding which to switch to", "percentage": 80, "note": "Useful for discovering available databases"}
    ]'::jsonb,
    'psql client running, Target database exists, Connection credentials available',
    'New database prompt appears after \\c command, typically showing new_database=# instead of previous database name',
    'Unlike MySQL USE statement, PostgreSQL requires \\c psql meta-command not SQL syntax. Commands are case-sensitive. Must be in psql client, not in SQL file.',
    0.94,
    'sonnet-4',
    NOW(),
    'https://stackoverflow.com/questions/3949876/how-to-switch-databases-in-psql'
),
(
    'Which version of PostgreSQL am I running',
    'stackoverflow-postgresql',
    'HIGH',
    '[
        {"solution": "Execute SQL query SELECT version(); in any PostgreSQL client (psql, phpPgAdmin, Navicat, pgAdmin) to get comprehensive version information", "percentage": 95, "note": "Works in any tool that can execute SQL, returns full version string", "command": "SELECT version();"},
        {"solution": "Use psql command line: psql --version for client version or postgres -V for server version", "percentage": 90, "note": "Command-line methods, requires shell access"},
        {"solution": "Query SHOW server_version; for cleaner version string or SHOW server_version_num; for numeric value suitable for programmatic checks", "percentage": 85, "note": "Returns version in different formats"}
    ]'::jsonb,
    'PostgreSQL connection available, psql client or other database client tool',
    'Version number displays in output. SELECT version() shows PostgreSQL version, OS, and compilation details.',
    'psql --version shows client version which may differ from server version. Need SQL query for actual server version. Some tools like phpPgAdmin may not support all query variants.',
    0.93,
    'sonnet-4',
    NOW(),
    'https://stackoverflow.com/questions/13733719/which-version-of-postgresql-am-i-running'
),
(
    'PostgreSQL peer authentication failed for user error',
    'stackoverflow-postgresql',
    'HIGH',
    '[
        {"solution": "Edit /etc/postgresql/[version]/main/pg_hba.conf and change peer to md5: local all postgres md5, then restart with sudo systemctl restart postgresql", "percentage": 95, "note": "Addresses root cause—peer authentication requires OS user = DB user", "command": "# Change line in pg_hba.conf from:\nlocal   all   postgres   peer\n# To:\nlocal   all   postgres   md5\n# Then:\nsudo systemctl restart postgresql"},
        {"solution": "For Rails: add host: 127.0.0.1 to database.yml to use TCP instead of Unix socket, bypassing peer authentication entirely", "percentage": 90, "note": "Framework-specific workaround without modifying pg_hba.conf"},
        {"solution": "Temporarily change to trust authentication for setup: local all postgres trust, set passwords, then switch to md5", "percentage": 80, "note": "More involved but prevents failures during initialization"}
    ]'::jsonb,
    'Access to /etc/postgresql/[version]/main/pg_hba.conf file, Ability to restart PostgreSQL service, Correct PostgreSQL version path',
    'Restart command completes without error. Subsequent authentication attempts succeed. psql connects with password.',
    'Peer authentication requires exact OS and database username match. Location of pg_hba.conf varies by system and PostgreSQL version. Trust method is insecure—only for setup. Service restart required for changes.',
    0.92,
    'sonnet-4',
    NOW(),
    'https://stackoverflow.com/questions/18664074/getting-error-peer-authentication-failed-for-user-postgres-when-trying-to-get'
),
(
    'How to start PostgreSQL server on Mac OS X',
    'stackoverflow-postgresql',
    'MEDIUM',
    '[
        {"solution": "Using Homebrew (recommended): brew services start postgresql. For specific version: brew services start postgresql@10. Stop with brew services stop postgresql", "percentage": 95, "note": "Most convenient for macOS, handles start/stop automatically", "command": "brew services start postgresql"},
        {"solution": "Manual start/stop with pg_ctl: pg_ctl -D /usr/local/var/postgres start and pg_ctl -D /usr/local/var/postgres stop", "percentage": 90, "note": "Works without Homebrew, more explicit control"},
        {"solution": "CRITICAL: Run initdb /usr/local/var/postgres -E utf8 BEFORE first start. If database corrupted, rm -rf /usr/local/var/postgres then re-initialize", "percentage": 100, "note": "Database must be initialized first time. Most common issue—missing initdb step", "command": "initdb /usr/local/var/postgres -E utf8"}
    ]'::jsonb,
    'PostgreSQL installed (via Homebrew or other), macOS system, Database directory not yet initialized on first run',
    'postgres process running (check with ps aux | grep postgres). Server accepts connections on localhost. brew services shows running status.',
    'Most common failure: forgetting to run initdb first—database directory must be initialized. If server fails after crash, delete stale postmaster.pid: rm /usr/local/var/postgres/postmaster.pid',
    0.91,
    'sonnet-4',
    NOW(),
    'https://stackoverflow.com/questions/7975556/how-can-i-start-postgresql-server-on-mac-os-x'
),
(
    'Save PostgreSQL query output to CSV file',
    'stackoverflow-postgresql',
    'MEDIUM',
    '[
        {"solution": "Server-side with COPY command (requires superuser): COPY (SELECT * FROM tablename) TO ''/tmp/test.csv'' WITH CSV DELIMITER '','' HEADER", "percentage": 90, "note": "All processing on server, cannot write to local machine, secure with SECURITY DEFINER", "command": "COPY (SELECT * FROM foo) TO ''/tmp/test.csv'' WITH CSV DELIMITER '','' HEADER"},
        {"solution": "Client-side with \\copy meta-command in psql (no superuser needed): \\copy (SELECT * FROM tablename) TO ''/tmp/test.csv'' WITH CSV DELIMITER '','' HEADER", "percentage": 95, "note": "Executes on client machine, works without elevated permissions, terminated by newline not semicolon"},
        {"solution": "Remote via SSH piping to STDOUT: psql -d dbname -c ''COPY (SELECT * FROM table) TO STDOUT WITH CSV HEADER'' > output.csv", "percentage": 88, "note": "Works locally, remotely, and in containers. Auto-handles CSV escaping."}
    ]'::jsonb,
    'psql client installed, Database connection, Source table exists, Writable file system location',
    'CSV file created at specified path. File contains data rows with proper CSV formatting. COPY/\\copy command executes without errors.',
    'COPY requires superuser privileges and file write on server. \\copy is client-side alternative without superuser requirement. Terminated by newline (\\copy) not semicolon (COPY). Auto-escapes delimiters and newlines.',
    0.91,
    'sonnet-4',
    NOW(),
    'https://stackoverflow.com/questions/1517635/save-pl-pgsql-output-from-postgresql-to-a-csv-file'
),
(
    'PostgreSQL error: role does not exist',
    'stackoverflow-postgresql',
    'MEDIUM',
    '[
        {"solution": "Switch to postgres superuser with sudo -u postgres -i (use -i flag for interactive shell). Then execute createdb, createuser, or other admin commands. Exit with exit command.", "percentage": 95, "note": "Grants ident authentication access. postgres user is default superuser created during initialization.", "command": "sudo -u postgres -i"},
        {"solution": "Execute single command directly without interactive shell: sudo -u postgres createuser username or sudo -u postgres createdb dbname", "percentage": 92, "note": "For one-off operations without entering interactive session"},
        {"solution": "Create new role in existing connection: CREATE ROLE username WITH LOGIN PASSWORD ''password'';", "percentage": 85, "note": "Requires existing superuser connection, works from within psql"}
    ]'::jsonb,
    'PostgreSQL installed, postgres OS user exists (created during installation), Ability to use sudo command',
    'New user role created successfully. createdb or createuser command executes without "role does not exist" error. User can authenticate.',
    'Default PostgreSQL installation creates postgres OS user and superuser role automatically. Package managers may not auto-create roles for system username. ident authentication matches OS user = database role. Must use postgres superuser initially.',
    0.92,
    'sonnet-4',
    NOW(),
    'https://stackoverflow.com/questions/11919391/postgresql-error-fatal-role-username-does-not-exist'
);

-- Stack Overflow top-voted AWS solutions batch 1
-- Source: https://stackoverflow.com/questions/tagged/amazon-web-services?tab=votes
-- Category: stackoverflow-aws
-- Extracted 2025-11-25

INSERT INTO knowledge_entries (
    query, category, hit_frequency, solutions, prerequisites, success_indicators,
    common_pitfalls, success_rate, claude_version, last_verified, source_url
) VALUES (
    'How to download an entire S3 bucket?',
    'stackoverflow-aws',
    'VERY_HIGH',
    '[
        {"solution": "Use AWS CLI with sync command: aws s3 sync s3://bucket-name /local/path --region us-east-1", "percentage": 95, "note": "Most efficient and official approach, supports parallel downloads and filtering"},
        {"solution": "Use AWS CLI cp with recursive flag for single bucket: aws s3 cp s3://bucket-name /local/path --recursive", "percentage": 90, "note": "Simpler but slower than sync, downloads all files including duplicates on retry"},
        {"solution": "Use S3 client libraries like boto3 for Python: s3_client.list_objects_v2() then download each key iteratively", "percentage": 85, "note": "Provides programmatic control and fine-grained error handling"},
        {"solution": "Use third-party tools like S3Cmd or s3fs for advanced filtering and selective downloads", "percentage": 75, "note": "Useful for large buckets with selective subset downloads"}
    ]'::jsonb,
    'AWS CLI installed and configured with credentials, S3 bucket read permissions, Sufficient local disk space',
    'Files appear in local directory matching S3 structure, No errors in AWS CLI output, File checksums match S3 metadata',
    'Do not use --dryrun without understanding it does not download. Watch for throttling on very large buckets - use --exclude patterns to limit scope. Ensure IAM permissions include s3:GetObject and s3:ListBucket.',
    0.93,
    'sonnet-4',
    NOW(),
    'https://stackoverflow.com/questions/8659382'
),
(
    'UNPROTECTED PRIVATE KEY FILE error using SSH into EC2',
    'stackoverflow-aws',
    'VERY_HIGH',
    '[
        {"solution": "Fix file permissions with chmod 600 on the .pem file: chmod 600 /path/to/keyfile.pem", "percentage": 98, "note": "Most common solution - SSH refuses to use keys with too-permissive permissions for security"},
        {"solution": "Verify key ownership with ls -la - should show user:group ownership: ls -la /path/to/keyfile.pem", "percentage": 90, "note": "File must be owned by current user, not root or other users"},
        {"solution": "Regenerate key pair from EC2 console if original permissions were modified: create new key-pair and relaunch instance", "percentage": 80, "note": "Last resort - requires instance termination and recreation"},
        {"solution": "Ensure full SSH command uses correct identity flag: ssh -i /path/to/keyfile.pem ec2-user@ec2-instance-ip", "percentage": 85, "note": "Incorrect path or missing -i flag compounds permission issues"}
    ]'::jsonb,
    'EC2 instance running, .pem key file downloaded, SSH client installed',
    'SSH connection succeeds, EC2 instance shell prompt appears, No permission denied error',
    'Do not store keys in shared directories or with world-readable permissions. Never chmod 777 - only 600 is secure. On Windows, use PuTTY or ensure file permissions set via file properties, not chmod.',
    0.97,
    'sonnet-4',
    NOW(),
    'https://stackoverflow.com/questions/8193768'
),
(
    'What is the difference between Amazon SNS and SQS?',
    'stackoverflow-aws',
    'VERY_HIGH',
    '[
        {"solution": "SNS is publish-subscribe (pub/sub) messaging: multiple subscribers receive same message from single topic", "percentage": 95, "note": "Use SNS when you need event broadcasting to multiple independent consumers"},
        {"solution": "SQS is queue-based messaging: single consumer pulls messages one at a time, supports job distribution across workers", "percentage": 95, "note": "Use SQS for decoupled systems, worker pools, and async job processing"},
        {"solution": "SNS is push-based: messages sent to all subscribers immediately when published", "percentage": 90, "note": "Lower latency, real-time delivery, but no persistence between publish and subscribe"},
        {"solution": "SQS is pull-based: consumers poll queue for messages, supports long polling to reduce API calls", "percentage": 90, "note": "Higher latency, but messages persist until consumed, enabling worker scaling"},
        {"solution": "Combine both: use SNS to publish to SQS queue for durable fan-out architecture", "percentage": 85, "note": "Best practice for reliable event distribution to multiple workers"}
    ]'::jsonb,
    'AWS account with SNS/SQS permissions, Understanding of async messaging patterns',
    'SNS topic created and subscriptions added, SQS queue created with consumers polling successfully, Messages deliver correctly to intended recipients',
    'SNS does not persist messages - if no subscribers, messages are lost. SQS has 14-day retention but requires polling. Do not use SNS for guaranteed delivery to offline consumers.',
    0.96,
    'sonnet-4',
    NOW(),
    'https://stackoverflow.com/questions/13681213'
),
(
    'How to change key pair for EC2 instance',
    'stackoverflow-aws',
    'HIGH',
    '[
        {"solution": "EC2 key pairs cannot be directly changed - create AMI from current instance, launch new instance with new key pair, terminate old instance", "percentage": 85, "note": "Preserves all configuration and data, recommended production approach"},
        {"solution": "Use AWS Systems Manager Session Manager instead of SSH - provides shell access without key pair", "percentage": 80, "note": "Requires IAM role attached to instance and AmazonSSMManagedInstanceCore policy"},
        {"solution": "Connect via Session Manager, manually add public key to ~/.ssh/authorized_keys for new key pair", "percentage": 75, "note": "Manual but non-destructive approach, allows gradual key rotation"},
        {"solution": "Stop instance and attach root volume to another instance, manually update authorized_keys file", "percentage": 70, "note": "Advanced approach, risky without proper backup strategy"}
    ]'::jsonb,
    'EC2 instance running with current key pair, IAM permissions for Systems Manager (if using that approach)',
    'New key pair successfully authenticates to instance, All services continue running after key change, Backups of old configuration preserved',
    'Key pairs cannot be recovered once deleted. Always create new key pair before deleting old one. EC2 key pairs are region-specific and tied to one instance at creation time.',
    0.82,
    'sonnet-4',
    NOW(),
    'https://stackoverflow.com/questions/7881469'
),
(
    'How to pass query string to AWS Lambda from API Gateway',
    'stackoverflow-aws',
    'HIGH',
    '[
        {"solution": "In API Gateway integration request mapping templates, map queryStringParameters: #set($inputRoot = $input.path(\"$\"))\n#set($root.queryStringParameters = $input.params().querystring)", "percentage": 90, "note": "Lambda receives event.queryStringParameters as object: {key1: value1, key2: value2}"},
        {"solution": "Use API Gateway resource parameter mapping: create {proxy+} resource with method ANY to pass all parameters", "percentage": 85, "note": "Lambda receives full path and query string in event.pathParameters and event.queryStringParameters"},
        {"solution": "Configure Lambda proxy integration in API Gateway: toggles Pass-through behavior for all HTTP details", "percentage": 88, "note": "Simplest setup - Lambda automatically receives full HTTP request details"},
        {"solution": "For REST API, manually add URL query parameter definitions in API Gateway console for autocomplete", "percentage": 75, "note": "Documentation benefit, does not change data flow - still requires proper mapping templates"}
    ]'::jsonb,
    'API Gateway API configured, Lambda function deployed, HTTP client to test with query parameters',
    'Lambda receives query parameters in event.queryStringParameters object, Values extracted correctly in Lambda code, API Gateway returns 200 with expected Lambda response',
    'Query string parameters are url-decoded automatically by API Gateway. Do not confuse with path parameters which require different mapping. Test with actual AWS Console or REST client, not just curl with & unescaped.',
    0.89,
    'sonnet-4',
    NOW(),
    'https://stackoverflow.com/questions/31329958'
),
(
    'How to scp to EC2 instance without password using key pair',
    'stackoverflow-aws',
    'VERY_HIGH',
    '[
        {"solution": "Use scp with -i flag pointing to .pem file: scp -i /path/to/keyfile.pem /local/file ec2-user@ec2-ip:/remote/path", "percentage": 98, "note": "Standard approach, passwordless after chmod 600 on key file"},
        {"solution": "For bidirectional copy, reverse source/dest: scp -i /path/to/keyfile.pem ec2-user@ec2-ip:/remote/file /local/path", "percentage": 98, "note": "Pull files from EC2 to local machine using same syntax"},
        {"solution": "Add -r flag for recursive directory copy: scp -r -i /path/to/keyfile.pem /local/dir/ ec2-user@ec2-ip:/remote/", "percentage": 97, "note": "Copies directory contents recursively"},
        {"solution": "Use -P flag for non-standard SSH port (capital P unlike ssh): scp -i keyfile.pem -P 2222 file ec2-user@ip:/path", "percentage": 85, "note": "If EC2 security group configured for custom SSH port"}
    ]'::jsonb,
    'EC2 instance with SSH enabled, .pem key file with 600 permissions, Network security group allows port 22 (or custom SSH port)',
    'File transfers complete without password prompt, Files appear in target directory with correct permissions and size',
    'scp uses capital -P for port, ssh uses lowercase -p - easy to confuse. File permissions default to 644 on target - use chmod if executable needed. Trailing slash on source directory matters: with slash copies contents, without slash copies directory itself.',
    0.96,
    'sonnet-4',
    NOW(),
    'https://stackoverflow.com/questions/6558080'
),
(
    'How to get EC2 instance ID from within that instance',
    'stackoverflow-aws',
    'HIGH',
    '[
        {"solution": "Query EC2 metadata service endpoint: curl http://169.254.169.254/latest/meta-data/instance-id", "percentage": 95, "note": "Works on all Linux instances, returns instance ID like i-1234567890abcdef0"},
        {"solution": "Use AWS CLI from within instance: aws ec2 describe-instances --instance-ids $(ec2-metadata --instance-id | cut -d \" \" -f 2)", "percentage": 80, "note": "Requires IAM role with ec2:DescribeInstances permission, more overhead but full API access"},
        {"solution": "Parse AWS CLI metadata directly: aws ec2 describe-instances --filters Name=instance-state-name,Values=running --query \"Reservations[].Instances[?[0].InstanceId\" --output text", "percentage": 75, "note": "Better for scripting complex queries beyond just instance ID"},
        {"solution": "For IMDSv2 (secure metadata), use token: TOKEN=`curl -X PUT \"http://169.254.169.254/latest/api/token\" -H \"X-aws-ec2-metadata-token-ttl-seconds: 21600\"` then curl with header", "percentage": 70, "note": "Required on newer instances with IMDSv2 enforced"}
    ]'::jsonb,
    'EC2 instance running with network access to 169.254.169.254, Appropriate IAM role if using AWS CLI approach',
    'Metadata endpoint returns instance ID successfully, Instance ID format matches i-xxxxx pattern, Value can be used in scripts and applications',
    'Metadata endpoint 169.254.169.254 is instance-specific and only reachable from that instance. IMDSv1 is less secure - prefer IMDSv2 with token. Some systems block this endpoint - use IAM role + CLI as fallback.',
    0.92,
    'sonnet-4',
    NOW(),
    'https://stackoverflow.com/questions/625644'
),
(
    'Is there a way to list all resources in AWS account across all regions?',
    'stackoverflow-aws',
    'HIGH',
    '[
        {"solution": "Use AWS Resource Groups Tagging API: aws resourcegroupstaggingapi get-resources --tags-filter-list TagKey=env,TagValues=prod --region-filter us-east-1 us-west-2", "percentage": 90, "note": "Official AWS method, requires resources to be tagged - best for organized infrastructure"},
        {"solution": "Use AWS Config which has centralized dashboard: aws configservice describe-config-rules to list all resources Config tracks", "percentage": 85, "note": "Requires AWS Config enabled and configured, comprehensive but slower"},
        {"solution": "Script CloudShell or CLI to iterate regions: for region in $(aws ec2 describe-regions --query Regions[].RegionName --output text); do aws ec2 describe-instances --region $region; done", "percentage": 80, "note": "Programmatic approach, gives full control but requires combining multiple API calls"},
        {"solution": "Use third-party tools like CloudMapper, Cloudtracker, or Steampipe for visualization and advanced filtering", "percentage": 75, "note": "Excellent for governance but external dependency"}
    ]'::jsonb,
    'AWS account with appropriate IAM permissions (tagging, config, or ec2:Describe*), AWS CLI configured, Bash shell for scripting approach',
    'Command returns list of resources with ARNs and details, Filters applied correctly based on tags or resource type, No errors in output',
    'Tagging API only returns tagged resources - untagged resources won''t appear. Config has slight delay in indexing. Iterating all regions via CLI is slow - use CloudShell for better performance. Some resources like IAM are global and only appear in one region query.',
    0.84,
    'sonnet-4',
    NOW(),
    'https://stackoverflow.com/questions/44391817'
),
(
    'What is the difference between AWS Lightsail and EC2?',
    'stackoverflow-aws',
    'HIGH',
    '[
        {"solution": "Lightsail provides simplified, predictable pricing: fixed monthly cost covers compute, storage, data transfer - best for simple apps and learning", "percentage": 95, "note": "EC2 has per-second billing and separate charges for storage/data transfer - more flexible for variable workloads"},
        {"solution": "Lightsail has pre-configured applications: WordPress, LAMP, Node.js, Ruby on Rails available as one-click deployments", "percentage": 90, "note": "EC2 requires manual OS and software installation via SSH or user data scripts"},
        {"solution": "Lightsail has limited resources and configurations: fixed instance sizes (512MB RAM up to 16GB), less networking control", "percentage": 88, "note": "EC2 offers granular instance type selection and advanced networking options like VPC, subnets, security groups"},
        {"solution": "Lightsail ideal for low-traffic websites, blogs, prototypes; EC2 better for complex architectures and high-performance needs", "percentage": 85, "note": "Both can auto-scale but EC2 auto-scaling groups more mature and cost-effective at scale"}
    ]'::jsonb,
    'AWS account, Understanding of your application resource requirements and traffic patterns',
    'Application runs successfully on chosen platform, Costs align with expectations, Scalability matches business requirements',
    'Lightsail easy to start but harder to migrate to EC2 as needs grow. EC2 has higher learning curve but ultimate flexibility. Do not move to Lightsail just for simplicity if you need advanced VPC features.',
    0.87,
    'sonnet-4',
    NOW(),
    'https://stackoverflow.com/questions/40927189'
),
(
    'Can an AWS Lambda function call another Lambda function?',
    'stackoverflow-aws',
    'HIGH',
    '[
        {"solution": "Use AWS SDK to invoke another Lambda: const AWS = require(\"aws-sdk\"); const lambda = new AWS.Lambda(); lambda.invoke({FunctionName: \"my-function\", InvocationType: \"RequestResponse\"}).promise()", "percentage": 95, "note": "Synchronous invocation waits for response, use RequestResponse for result, Event for fire-and-forget"},
        {"solution": "For Node.js 18+, use @aws-sdk/client-lambda: import {InvokeCommand} from \"@aws-sdk/client-lambda\"; client.send(new InvokeCommand({FunctionName: \"target\", Payload: JSON.stringify(data)}))", "percentage": 90, "note": "Modern SDK with better TypeScript support and promise-based API"},
        {"solution": "Use InvocationType Event for asynchronous invocation: no wait for response, useful for long-running tasks", "percentage": 85, "note": "Payload sent to SQS or SNS if target function fails asynchronously"},
        {"solution": "Ensure Lambda execution IAM role includes lambda:InvokeFunction permission: policy must allow invoking target function ARN", "percentage": 95, "note": "Most common issue - permission denied even with correct code"}
    ]'::jsonb,
    'Both Lambda functions deployed, Invoking function has IAM role with lambda:InvokeFunction permission for target function',
    'Lambda invocation succeeds with 200 status, Target function executes and returns expected result, Logs show both function executions',
    'Lambda-to-Lambda calls count toward concurrency limits - chain too many and you get throttling. Asynchronous invocations can be lost if queue fills. Always add retry logic and dead-letter queues for production chaining.',
    0.91,
    'sonnet-4',
    NOW(),
    'https://stackoverflow.com/questions/31714788'
),
(
    'What are the differences between AWS EFS vs EBS vs S3?',
    'stackoverflow-aws',
    'VERY_HIGH',
    '[
        {"solution": "S3 is object storage: flat namespace, accessed via HTTP API, unlimited scalability, designed for files and backups not filesystem operations", "percentage": 95, "note": "Use S3 for: media files, backups, data lakes, static content"},
        {"solution": "EBS is block storage: attached to single EC2 instance, behaves like hard drive, 16TB max per volume, low latency persistent storage", "percentage": 95, "note": "Use EBS for: OS volumes, databases, high-performance storage, instance root volumes"},
        {"solution": "EFS is managed file system: shared across multiple EC2 instances, NFS protocol, auto-scaling storage, higher latency than EBS", "percentage": 95, "note": "Use EFS for: shared application data, cluster file systems, auto-scaling workloads requiring shared access"},
        {"solution": "Cost comparison: EFS most expensive per GB, EBS moderate, S3 least expensive for long-term storage", "percentage": 85, "note": "S3 pricing includes data transfer costs, EFS billed by provisioned throughput or bursting mode"},
        {"solution": "Performance: S3 slowest (HTTP latency), EBS fastest (block device latency), EFS in between with NFS protocol overhead", "percentage": 90, "note": "Choose EBS for databases, S3 for archives, EFS for shared workload data"}
    ]'::jsonb,
    'AWS account, Understanding of use case requirements: shared vs single-attached, performance vs cost, scalability needs',
    'Data accessible from appropriate services, Performance meets requirements, Costs align with projections, Scaling behavior matches workload',
    'Do not use S3 for frequently-updated databases. EFS not suitable for real-time databases - use EBS. EBS volumes must be in same AZ as EC2 instance. S3 eventual consistency can cause issues in some patterns.',
    0.94,
    'sonnet-4',
    NOW(),
    'https://stackoverflow.com/questions/29575877'
),
(
    'What is the difference between EC2 and AWS Elastic Beanstalk?',
    'stackoverflow-aws',
    'HIGH',
    '[
        {"solution": "EC2 is Infrastructure as a Service (IaaS): you manage OS, runtime, deployment, scaling, networking - maximum control and customization", "percentage": 95, "note": "Use EC2 when you need: custom configurations, specific software versions, total control, or compliance requirements"},
        {"solution": "Elastic Beanstalk is Platform as a Service (PaaS): AWS manages OS, runtime, infrastructure, auto-scaling - you provide application code", "percentage": 95, "note": "Use Beanstalk for: rapid development, quick deployments, reduced operational overhead, language-specific optimization"},
        {"solution": "Beanstalk abstracts complexity with pre-configured environments: Node.js, Python, Java, Go, PHP runtimes with best-practice configurations", "percentage": 90, "note": "Supports custom Docker containers if built-in runtimes insufficient"},
        {"solution": "Beanstalk offers one-command deployments: eb deploy uploads code and auto-scales based on load with minimal configuration", "percentage": 85, "note": "EC2 requires manual scaling setup, load balancer configuration, deployment scripts"},
        {"solution": "Cost: Beanstalk same as underlying EC2 instances but saves engineering time; EC2 potentially lower cost if you manage optimization", "percentage": 80, "note": "Break-even when Beanstalk time savings exceed EC2 customization effort"}
    ]'::jsonb,
    'AWS account, Basic application code in supported language, Understanding of deployment needs and operational capacity',
    'Application deploys and scales automatically, Traffic handled by load balancer, Application metrics visible in Beanstalk dashboard',
    'Beanstalk abstracts away some configuration - if you need fine-grained control use EC2 directly. Beanstalk changes can be breaking - test upgrades in separate environment. Some AWS-specific features (like detailed VPC control) require EC2.',
    0.89,
    'sonnet-4',
    NOW(),
    'https://stackoverflow.com/questions/25956193'
);

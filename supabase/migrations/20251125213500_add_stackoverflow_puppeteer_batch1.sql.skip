-- Add Stack Overflow Puppeteer questions batch 1

INSERT INTO knowledge_entries (
    query, category, hit_frequency, solutions, prerequisites, success_indicators,
    common_pitfalls, success_rate, claude_version, last_verified, source_url
) VALUES (
    'Jest test timeout error: Async callback was not invoked within the 5000 ms timeout',
    'stackoverflow-puppeteer',
    'VERY_HIGH',
    '[
        {"solution": "Add testTimeout configuration to jest.config.js module.exports: { testTimeout: 30000 }", "percentage": 95, "note": "Recommended for Jest 24.9+"},
        {"solution": "Create jest.setup.js with jest.setTimeout(30000) and reference in jest.config.js setupFilesAfterEnv", "percentage": 90, "note": "Works across all Jest versions"},
        {"solution": "Pass timeout as third parameter to test function: test(''name'', async () => {...}, 30000)", "percentage": 85, "note": "Per-test override only"},
        {"solution": "Run jest with CLI flag: jest --testTimeout=30000", "percentage": 80, "note": "One-time override without config changes"}
    ]'::jsonb,
    'Jest installed and configured, Puppeteer tests running',
    'Tests complete without timeout messages, async operations complete successfully, consistent test execution',
    'Using setupFileAfterEnv instead of setupFilesAfterEnv causes silent failure. Avoid fake timers with async/await. Jest version differences require different config approaches. Using done() callback with async/await causes conflicts.',
    0.92,
    'sonnet-4',
    NOW(),
    'https://stackoverflow.com/questions/49603939/message-async-callback-was-not-invoked-within-the-5000-ms-timeout-specified-by'
),
(
    'How to pass a variable into page.evaluate() function in Puppeteer',
    'stackoverflow-puppeteer',
    'HIGH',
    '[
        {"solution": "Pass variables as arguments after the callback: await page.evaluate((varName) => { console.log(varName); }, varValue)", "percentage": 95, "note": "Variables must be passed as separate arguments, not in closure"},
        {"solution": "For multiple variables: await page.evaluate((a, b, c) => {...}, argA, argB, argC)", "percentage": 90, "note": "Parameter order must match argument sequence"},
        {"solution": "Return values from evaluation to Node context: const result = await page.evaluate((val) => { return val * 2; }, 5)", "percentage": 85, "note": "Only serializable data can be returned"}
    ]'::jsonb,
    'Puppeteer installed and browser launched, understanding of browser vs Node context',
    'Variable outputs correctly in browser context, return values transmitted properly, no undefined errors',
    'Defining parameters but not passing arguments creates undefined values. Browser console output not visible in headless mode; use return statements instead. Functions cannot be serialized; use page.exposeFunction() for complex logic. Parameter order matters exactly.',
    0.93,
    'sonnet-4',
    NOW(),
    'https://stackoverflow.com/questions/46088351/how-can-i-pass-variable-into-an-evaluate-function'
),
(
    'How to wait N seconds before continuing to the next line in Puppeteer',
    'stackoverflow-puppeteer',
    'HIGH',
    '[
        {"solution": "Create promise-based delay function: function delay(time) { return new Promise(resolve => setTimeout(resolve, time)); } then await delay(4000)", "percentage": 95, "note": "Recommended approach, reusable"},
        {"solution": "Use inline promise wrapper: await new Promise(r => setTimeout(r, 4000))", "percentage": 92, "note": "Quick and direct, no function definition needed"},
        {"solution": "Use modern Node.js timers: import {setTimeout} from node:timers/promises; await setTimeout(1000)", "percentage": 88, "note": "Node 16.14.0+, cleaner syntax"},
        {"solution": "Use event-driven waiting instead: waitForSelector, waitForFunction, waitForNetworkIdle", "percentage": 90, "note": "Better than arbitrary delays; use instead of setTimeout when possible"}
    ]'::jsonb,
    'Node.js with async/await support, Puppeteer running in page context',
    'Console prints before waiting, pause occurs for specified duration, then after waiting prints, execution flow is correct',
    'setTimeout alone does not return a promise; must wrap in Promise constructor. page.waitForTimeout() and page.waitFor() are deprecated and removed in Puppeteer 22.0.0+. Using arbitrary delays instead of event-driven waiting leads to flaky tests.',
    0.94,
    'sonnet-4',
    NOW(),
    'https://stackoverflow.com/questions/46919013/how-to-wait-n-seconds-before-continuing-to-the-next-line'
),
(
    'How to click on an element with text in Puppeteer',
    'stackoverflow-puppeteer',
    'HIGH',
    '[
        {"solution": "Use XPath with contains: const [button] = await page.$x(''//button[contains(., ''Button text'')]//''); if (button) await button.click()", "percentage": 92, "note": "Use . instead of text() to handle child elements"},
        {"solution": "Use modern pseudo-selectors (Puppeteer 19.7.1+): await page.$(''button::-p-text(Button text)'').click()", "percentage": 88, "note": "Substring matching, cleaner syntax"},
        {"solution": "Use Locator API (Puppeteer 21.0.0+): await page.locator(''button'').filter(el => el.textContent.trim() === ''text'').click()", "percentage": 85, "note": "Modern recommended approach"},
        {"solution": "Use evaluate with querySelector: await page.evaluate(() => { [...document.querySelectorAll(''button'')].find(el => el.textContent === ''text'')?.click(); })", "percentage": 80, "note": "Direct DOM manipulation"}
    ]'::jsonb,
    'Puppeteer installed, CSS selectors or XPath knowledge, element must be clickable',
    'Element is located and clickable, action completes without timeout, page responds to click',
    'XPath text() fails with nested elements; use . instead. Whitespace in text requires .trim(). Comparisons are case-sensitive. Older Puppeteer versions lack modern selector support. Deprecated methods no longer work in Puppeteer 18+.',
    0.91,
    'sonnet-4',
    NOW(),
    'https://stackoverflow.com/questions/47407791/how-do-you-click-on-an-element-with-text-in-puppeteer'
),
(
    'Puppeteer wait until page is completely loaded',
    'stackoverflow-puppeteer',
    'VERY_HIGH',
    '[
        {"solution": "Use DOM stabilization by monitoring HTML size: check document.body scrollHeight for 3 consecutive stable iterations with 1 second intervals", "percentage": 93, "note": "Most reliable for pages with dynamic content"},
        {"solution": "Use networkidle with waitForNavigation: await page.goto(url, { waitUntil: ''networkidle0'' })", "percentage": 80, "note": "Unreliable for pages with continuous background requests"},
        {"solution": "Combine click with navigation waiting: await Promise.all([page.click(selector), page.waitForNavigation({ waitUntil: ''networkidle2'' })])", "percentage": 88, "note": "Prevents race conditions"},
        {"solution": "Wait for specific completion selector: await page.waitForSelector(''#chart-container'', { visible: true })", "percentage": 85, "note": "Requires element in page indicating completion"}
    ]'::jsonb,
    'Puppeteer running headless browser, understanding of page structure',
    'PDF generates with all dynamic content rendered, no arbitrary delays needed, consistent results across multiple runs, execution time < 30 seconds typical',
    'No single method works universally for all pages. Timeout without fallback strategy causes infinite waits. Using networkidle0 for pages with ongoing background requests hangs indefinitely. Opening DevTools can inflate HTML size checks. Race conditions occur when click triggers navigation without Promise.all().',
    0.89,
    'sonnet-4',
    NOW(),
    'https://stackoverflow.com/questions/52497252/puppeteer-wait-until-page-is-completely-loaded'
),
(
    'Puppeteer wait page load after form submit',
    'stackoverflow-puppeteer',
    'HIGH',
    '[
        {"solution": "Use Promise.all to combine click and waitForNavigation: await Promise.all([page.click(''button[type=submit]''), page.waitForNavigation({waitUntil: ''networkidle2''})])", "percentage": 95, "note": "Prevents race conditions, click and wait execute concurrently"},
        {"solution": "Choose appropriate waitUntil option: use ''networkidle2'' for reliable navigation, ''load'' for fastest, ''networkidle0'' for strictest waiting", "percentage": 90, "note": "Different options suit different scenarios"},
        {"solution": "Set default navigation timeout: page.setDefaultNavigationTimeout(60000) before form submission", "percentage": 88, "note": "Useful for consistently slow pages"},
        {"solution": "Use page.waitForNavigation separately if click doesn''t trigger it: page.waitForNavigation({ waitUntil: ''networkidle2'' })", "percentage": 75, "note": "Fallback when Promise.all is not applicable"}
    ]'::jsonb,
    'Puppeteer initialized with valid page reference, form and submit button exist on page, async/await support',
    'Screenshot captures new page content correctly, no timeout errors occur, navigation completes successfully without Execution context errors',
    'Race conditions occur when awaiting click before waitForNavigation starts listening. Timeout errors happen when pages redirect multiple times or have continuous background requests. Infinite waiting occurs when using networkidle0 on pages with ongoing requests.',
    0.91,
    'sonnet-4',
    NOW(),
    'https://stackoverflow.com/questions/46948489/puppeteer-wait-page-load-after-form-submit'
),
(
    'How to fill an input field using Puppeteer',
    'stackoverflow-puppeteer',
    'HIGH',
    '[
        {"solution": "Use page.$eval to directly set value: await page.$eval(''#email'', el => el.value = ''user@example.com'')", "percentage": 90, "note": "Fastest method but does not fire change handlers"},
        {"solution": "Focus then type with keyboard: await page.focus(''#email''); await page.keyboard.type(''user@example.com'')", "percentage": 88, "note": "Triggers handlers but slower than direct value assignment"},
        {"solution": "Use page.evaluate to set value: await page.evaluate(() => { document.querySelector(''#email'').value = ''user@example.com''; })", "percentage": 85, "note": "Similar to $eval, also does not trigger events"},
        {"solution": "For framework compatibility, use page.type() with retry logic and event dispatch: await page.$eval(''#email'', el => { el.value = ''user@example.com''; el.dispatchEvent(new Event(''change'', {bubbles: true})); })", "percentage": 92, "note": "Triggers framework state updates"}
    ]'::jsonb,
    'Puppeteer installed, valid CSS selector for target input element, page already navigated to target URL',
    'Input field displays filled value, form submission succeeds, validation passes, page state updates reflect new input',
    'Direct value assignment alone does not trigger change or input handlers, causing form validation and React state updates to fail. Incorrect selectors fail silently. Modern frameworks require event firing, not just value changes. Using page.type() is character-by-character and slow.',
    0.90,
    'sonnet-4',
    NOW(),
    'https://stackoverflow.com/questions/47966510/how-to-fill-an-input-field-using-puppeteer'
),
(
    'Error: Failed to launch the browser process puppeteer',
    'stackoverflow-puppeteer',
    'VERY_HIGH',
    '[
        {"solution": "Install Chromium and configure executablePath: sudo apt-get install chromium-browser, then puppeteer.launch({ executablePath: ''/usr/bin/chromium-browser'' })", "percentage": 94, "note": "Most common fix for Linux systems"},
        {"solution": "Disable sandbox for restricted environments: puppeteer.launch({ args: [''--no-sandbox'', ''--disable-setuid-sandbox''] })", "percentage": 90, "note": "Quick fix but reduces browser security"},
        {"solution": "Install system dependencies package: sudo apt-get install gconf-service libasound2 libatk1.0-0 libcairo2 libcups2 libdbus-1-3 libexpat1 libfontconfig1 libgcc1 libgconf-2-4 libgdk-pixbuf2.0-0 libglib2.0-0 libgtk-3-0", "percentage": 92, "note": "Complete dependency installation for Ubuntu/Debian"},
        {"solution": "Comprehensive configuration for Docker/restricted envs: puppeteer.launch({ executablePath: ''/usr/bin/chromium-browser'', args: [''--no-sandbox'', ''--disable-gpu'', ''--disable-dev-shm-usage''] })", "percentage": 93, "note": "Covers multiple failure points"}
    ]'::jsonb,
    'Puppeteer npm package installed, access to install system packages or ability to configure executables',
    'Browser launches without error messages, PDF and screenshot generation complete, version command shows successful output',
    'Chromium not installed on system causes launch failure. Missing system dependencies (libc, GTK libraries) prevents execution. Sandbox restrictions in Docker environments cause failures. Incorrect executable path configuration points to wrong browser binary. Corrupted browser installations need reinstall.',
    0.93,
    'sonnet-4',
    NOW(),
    'https://stackoverflow.com/questions/59979188/error-failed-to-launch-the-browser-process-puppeteer'
),
(
    'How to select an option from dropdown select in Puppeteer',
    'stackoverflow-puppeteer',
    'HIGH',
    '[
        {"solution": "Use page.select() for native HTML select elements: await page.select(''#dropdown'', ''value-to-select'')", "percentage": 95, "note": "Native method, available since v0.12.0"},
        {"solution": "For text-based selection, use page.evaluate to find and dispatch change event: await page.evaluate((selector, text) => { let sel = document.querySelector(selector); [...sel.querySelectorAll(''option'')].find(opt => opt.text === text) && (sel.value = [...sel.querySelectorAll(''option'')].find(opt => opt.text === text).value); sel.dispatchEvent(new Event(''change'', {bubbles: true})); }, ''#dropdown'', ''Option Text'')", "percentage": 92, "note": "Handles custom dropdowns, manually triggers change event"},
        {"solution": "For custom JavaScript dropdowns, click elements sequentially: await page.click(''#dropdown''); await page.click(''#dropdown-menu li:nth-child(2)'')", "percentage": 85, "note": "Works for non-native dropdown components"},
        {"solution": "Use Puppeteer keyboard navigation for complex dropdowns: await page.click(selector); await page.keyboard.press(''ArrowDown''); await page.keyboard.press(''Enter'')", "percentage": 80, "note": "Mimics user interaction"}
    ]'::jsonb,
    'Puppeteer v0.12.0+, knowledge of option value attributes or display text, understanding of dropdown HTML structure',
    'Selected option reflects in DOM, change event fires and listeners execute, form submission includes correct value, no timeout or selector errors',
    'Missing change event dispatch causes listeners to not execute despite value change. Options without value attribute may fail with page.select(). Custom dropdown components are not native select elements and require different selectors. Platform differences in keyboard navigation between Windows/macOS.',
    0.91,
    'sonnet-4',
    NOW(),
    'https://stackoverflow.com/questions/45864516/how-to-select-an-option-from-dropdown-select'
),
(
    'Puppeteer: Scroll down until you cannot scroll anymore',
    'stackoverflow-puppeteer',
    'HIGH',
    '[
        {"solution": "Compare scroll height before and after scrolling: let lastHeight = await page.evaluate(''document.body.scrollHeight''); while(true) { await page.evaluate(''window.scrollTo(0, document.body.scrollHeight)''); await page.waitForTimeout(2000); let newHeight = await page.evaluate(''document.body.scrollHeight''); if(newHeight === lastHeight) break; lastHeight = newHeight; }", "percentage": 94, "note": "Most reliable method, detects when new content stops loading"},
        {"solution": "Monitor Y-offset position changes: let originalOffset = 0; while(true) { await page.evaluate(''window.scrollBy(0, document.body.scrollHeight)''); await page.waitForTimeout(200); let newOffset = await page.evaluate(''window.pageYOffset''); if(originalOffset === newOffset) break; originalOffset = newOffset; }", "percentage": 88, "note": "Alternative approach using scroll position"},
        {"solution": "Count elements in viewport and detect new content generation: Use scrollIntoView() with element counter increments", "percentage": 80, "note": "Page-structure dependent, less reliable"}
    ]'::jsonb,
    'Puppeteer installed, understanding of async/await patterns, knowledge of page selector names',
    'Scrolling completes without timeout errors, all dynamically loaded content renders completely, page height stabilizes with no further changes',
    'Using waitForSelector without timeout handling causes indefinite hangs after content finishes loading. Scrolling interval too short prevents content from loading completely. Not accounting for dynamic height increases during continuous loading causes premature exit. Setting initial offset incorrectly breaks offset comparison logic.',
    0.90,
    'sonnet-4',
    NOW(),
    'https://stackoverflow.com/questions/51529332/puppeteer-scroll-down-until-you-cant-anymore'
),
(
    'Node.js puppeteer: How to set navigation timeout',
    'stackoverflow-puppeteer',
    'HIGH',
    '[
        {"solution": "Add timeout option to page.goto(): await page.goto(''url'', {waitUntil: ''load'', timeout: 0})", "percentage": 93, "note": "timeout: 0 disables timeout errors entirely"},
        {"solution": "Set page-level navigation timeout: page.setDefaultNavigationTimeout(60000); then use page.goto() without timeout param", "percentage": 92, "note": "Applies to goto, reload, goBack, goForward, setContent, waitForNavigation"},
        {"solution": "Set global default timeout: page.setDefaultTimeout(60000); applies to navigation and all wait operations", "percentage": 90, "note": "Broader scope, affects waitForSelector, waitForFunction, etc."},
        {"solution": "Adjust timeout incrementally based on page load time: page.setDefaultNavigationTimeout(120000) for heavy pages", "percentage": 88, "note": "Better than timeout: 0 for known slow pages"}
    ]'::jsonb,
    'Node.js installed, Puppeteer package installed, async/await support',
    'Page loads without timeout errors, navigation completes successfully, application proceeds to next operation without hanging',
    'Using await unnecessarily with timeout setters causes issues. Selecting wrong method (page-level vs global) affects wrong operations. Setting timeout too low causes repeated failures on genuinely slow pages. timeout: 0 can cause indefinite hangs on broken pages.',
    0.91,
    'sonnet-4',
    NOW(),
    'https://stackoverflow.com/questions/52163547/node-js-puppeteer-how-to-set-navigation-timeout'
);

-- Add Cypress error messages batch 1
-- Focus: Timeout errors, selector failures, network stubbing, cross-origin issues

INSERT INTO knowledge_entries (
    query, category, hit_frequency, solutions, prerequisites, success_indicators,
    common_pitfalls, success_rate, claude_version, last_verified, source_url
) VALUES (
    'Cypress: Timed out retrying: Expected to find element but never found it',
    'cypress',
    'VERY_HIGH',
    '[
        {"solution": "Verify the element exists in the DOM by checking HTML structure and selector validity", "percentage": 90, "note": "Most common cause is incorrect selector or element not yet rendered"},
        {"solution": "Use cy.get() with appropriate timeout option: cy.get(''selector'', { timeout: 5000 })", "percentage": 85, "note": "Increase timeout if element renders late"},
        {"solution": "Check for malformed HTML line-by-line that may prevent DOM from rendering correctly", "percentage": 80, "note": "Validate HTML structure matches expected DOM"},
        {"solution": "Use cy.contains() instead of cy.get() for text-based element selection", "percentage": 75, "note": "More flexible for dynamic content"}
    ]'::jsonb,
    'Cypress test file, Valid CSS selector or text content, Target element exists in application',
    'Test passes and element is found within timeout window, Selector returns expected element count',
    'Incorrect selector syntax, Element renders after default 4000ms timeout, Chaining commands after page navigation without waiting',
    0.90,
    'sonnet-4',
    NOW(),
    'https://docs.cypress.io/guides/references/error-messages#Element-Not-Found-Timeout'
),
(
    'Cypress: cy.visit() succeeded but commands are timing out after cross-origin navigation',
    'cypress',
    'HIGH',
    '[
        {"solution": "Wrap all commands for cross-origin domain in cy.origin() block: cy.origin(''https://other-domain.com'', () => { cy.get(...) })", "percentage": 95, "note": "Required for any interaction with different origin"},
        {"solution": "Use cy.request() instead of cy.visit() for same-origin API calls without navigation", "percentage": 85, "note": "Bypasses cross-origin restrictions for API testing"},
        {"solution": "Test href attributes directly instead of clicking links to external domains", "percentage": 80, "note": "Safer approach for verifying external link targets"}
    ]'::jsonb,
    'Cypress v12.0+, Application with cross-origin navigation, Test accessing multiple domains',
    'Commands execute successfully within cy.origin() block, Cross-origin requests complete without timeout errors',
    'Forgetting to wrap cross-origin commands in cy.origin(), Mixing same-origin and cross-origin commands without proper wrapper blocks',
    0.92,
    'sonnet-4',
    NOW(),
    'https://docs.cypress.io/guides/references/error-messages#Cross-Origin-Navigation-Error'
),
(
    'Cypress: Element cannot be interacted with - not visible or covered by another element',
    'cypress',
    'HIGH',
    '[
        {"solution": "Verify element visibility using cy.should(''be.visible'') before interaction attempt", "percentage": 90, "note": "Ensures element is in viewport and not hidden by CSS"},
        {"solution": "Use {force: true} option to bypass visibility checks: cy.click(''.selector'', {force: true})", "percentage": 80, "note": "Use cautiously - overrides Cypress''s safety checks"},
        {"solution": "Scroll element into view before interaction: cy.get(''.selector'').scrollIntoView().click()", "percentage": 88, "note": "Ensures element is in viewport before action"},
        {"solution": "Wait for element to stop animating: cy.get(''.selector'', {animationDistanceThreshold: 20}).click()", "percentage": 75, "note": "Prevents interaction during animation"}
    ]'::jsonb,
    'Cypress test file, Target element in application DOM, Valid selector',
    'Element becomes visible and clickable, Command executes without visibility errors, Element is in viewport',
    'Using {force: true} without understanding implications, Not waiting for animations to complete, Assuming element visibility without checking',
    0.88,
    'sonnet-4',
    NOW(),
    'https://docs.cypress.io/guides/references/error-messages#Element-Cannot-Be-Interacted-With'
),
(
    'Cypress: Page updated during interaction - element removed or replaced during command',
    'cypress',
    'HIGH',
    '[
        {"solution": "Break command chains after actions that trigger page updates: cy.click(). Then after page reload start new command chain", "percentage": 92, "note": "Prevents stale element references between DOM mutations"},
        {"solution": "Use cy.intercept() to stub network responses before navigation: cy.intercept(''GET'', ''/api/**'').as(''apiCall'')", "percentage": 85, "note": "Controls timing of page updates for predictable tests"},
        {"solution": "Add explicit wait for new element after page update: cy.click(). Then cy.get(''.new-element'') to ensure new DOM is ready", "percentage": 88, "note": "Validates new DOM structure is loaded"}
    ]'::jsonb,
    'Cypress test file, Application that updates DOM on user actions, Valid selectors for new and old elements',
    'Commands execute after page update completes, Stale element errors do not occur, New elements are found after update',
    'Chaining multiple commands across DOM mutations, Not waiting for page to stabilize after navigation, Assuming DOM persists during test execution',
    0.89,
    'sonnet-4',
    NOW(),
    'https://docs.cypress.io/guides/references/error-messages#Page-Updated-During-Interaction'
),
(
    'Cypress: Detected cross-origin error happened on page load',
    'cypress',
    'HIGH',
    '[
        {"solution": "Enable chromeWebSecurity: false in cypress.config.js (Chrome/Edge only): e2e: {chromeWebSecurity: false}", "percentage": 85, "note": "Disables web security restrictions for cross-origin testing"},
        {"solution": "Verify CORS headers are properly configured on cross-origin server: Access-Control-Allow-Origin header present", "percentage": 90, "note": "Required for legitimate cross-origin requests"},
        {"solution": "Use cy.request() with {headers} option for API calls: cy.request({url: ''...'', headers: {Authorization: ''Bearer token''}})", "percentage": 88, "note": "Bypasses browser CORS restrictions for API testing"}
    ]'::jsonb,
    'Cypress v10+, Cross-origin application setup, Browser DevTools access',
    'Cross-origin requests complete without CORS errors, Page loads successfully from different origin, No uncaught errors in console',
    'Leaving chromeWebSecurity disabled in production tests, Not configuring CORS headers on server, Assuming all cross-origin requests will fail',
    0.87,
    'sonnet-4',
    NOW(),
    'https://docs.cypress.io/guides/references/error-messages#Cross-Origin-Errors'
),
(
    'Cypress: Uncaught error thrown from cross-origin script',
    'cypress',
    'MEDIUM',
    '[
        {"solution": "Add crossorigin attribute to script tag and configure CORS headers: <script crossorigin=''anonymous'' src=''...''>", "percentage": 92, "note": "Allows Cypress to access error details from external scripts"},
        {"solution": "Check Developer Tools Console for actual error message using Cypress DevTools integration", "percentage": 85, "note": "Error details are visible in browser console even if Cypress catches them"},
        {"solution": "Wrap cross-origin script interactions in cy.on(''uncaught:exception'') handler: cy.on(''uncaught:exception'', (err) => false)", "percentage": 75, "note": "Suppresses specific errors if not critical to test"}
    ]'::jsonb,
    'Cypress test file, Cross-origin script loading, Developer Tools Browser access',
    'Error message is visible in DevTools console, Cypress captures cross-origin script errors, Page continues loading after error',
    'Ignoring cross-origin script errors without investigation, Not configuring crossorigin attribute, Assuming error is test failure vs page issue',
    0.83,
    'sonnet-4',
    NOW(),
    'https://docs.cypress.io/guides/references/error-messages#Uncaught-Cross-Origin-Script-Error'
),
(
    'Cypress: Commands queued after test completion - test finished but queue not empty',
    'cypress',
    'MEDIUM',
    '[
        {"solution": "Return cy command chains to ensure test waits for completion: return cy.get(''.selector'').click()", "percentage": 95, "note": "Promises automatically resolve when cy commands complete"},
        {"solution": "Avoid using done() callback parameter with Promises - use only one pattern per test", "percentage": 90, "note": "done() is legacy; Promises are preferred approach"},
        {"solution": "Ensure async operations complete before test ends: wrap in beforeEach() or move into test function", "percentage": 88, "note": "Synchronization prevents race conditions"}
    ]'::jsonb,
    'Cypress test file, JavaScript Promise support, Valid cy commands',
    'Test completes successfully without queue warnings, All cy commands execute before test finishes, No "commands in queue" error message',
    'Mixing done() callbacks with Promise returns, Starting async operations outside test function, Using cy.wait() without returning the chain',
    0.93,
    'sonnet-4',
    NOW(),
    'https://docs.cypress.io/guides/references/error-messages#Commands-Queued-After-Test-Completion'
),
(
    'Cypress: Commands cannot execute outside running test - code outside it() block',
    'cypress',
    'MEDIUM',
    '[
        {"solution": "Move cy commands into test function: it(''test'', () => { cy.visit(''/''). ... })", "percentage": 98, "note": "Cypress commands only run within test context"},
        {"solution": "Use beforeEach() hook for shared setup logic: beforeEach(() => { cy.visit(''/''). ... })", "percentage": 90, "note": "Runs setup code before each test automatically"},
        {"solution": "Use custom commands in support/commands.js file for reusable command sequences", "percentage": 85, "note": "Centralizes common test patterns"}
    ]'::jsonb,
    'Cypress test file, Test function or hook block',
    'Commands execute without "outside running test" error, Setup code runs automatically before tests, Tests pass successfully',
    'Defining cy commands at describe() scope instead of inside it(), Putting cy commands in module exports without test context, Forgetting to wrap commands in functions',
    0.96,
    'sonnet-4',
    NOW(),
    'https://docs.cypress.io/guides/references/error-messages#Commands-Outside-Running-Test'
),
(
    'Cypress: Element is animating - command failed because element animation in progress',
    'cypress',
    'MEDIUM',
    '[
        {"solution": "Pass waitForAnimations: false to disable animation waiting: cy.click(''.selector'', {waitForAnimations: false})", "percentage": 88, "note": "Allows interaction during animations"},
        {"solution": "Set animationDistanceThreshold to allow movement: cy.click(''.selector'', {animationDistanceThreshold: 20})", "percentage": 85, "note": "Tolerates movement up to 20px threshold"},
        {"solution": "Wait for animation to complete with cy.wait(): cy.get(''.selector'').should(''have.class'', ''completed'').click()", "percentage": 90, "note": "Waits for CSS animation class to change"}
    ]'::jsonb,
    'Cypress test file, Element with CSS animation, Valid selector',
    'Commands execute despite animation, No animation-related timeout errors, Element interaction succeeds',
    'Not accounting for animation delays in test timing, Using overly aggressive animationDistanceThreshold values',
    0.86,
    'sonnet-4',
    NOW(),
    'https://docs.cypress.io/guides/references/error-messages#Element-Is-Animating'
),
(
    'Cypress: Missing record key - --record flag without providing CYPRESS_RECORD_KEY',
    'cypress',
    'MEDIUM',
    '[
        {"solution": "Provide record key via environment variable: export CYPRESS_RECORD_KEY=''your-key-here'' before running tests", "percentage": 95, "note": "Cypress automatically picks up environment variable"},
        {"solution": "Pass key via CLI flag: npx cypress run --record --key your-record-key", "percentage": 90, "note": "Alternative to environment variable"},
        {"solution": "Configure in cypress.config.js: projectId: ''your-project-id'' for automatic key lookup", "percentage": 85, "note": "Requires Cypress Cloud authentication setup"}
    ]'::jsonb,
    'Cypress CLI, Valid record key from Cypress Cloud, Project created in Cypress Dashboard',
    'Tests record successfully to Cypress Cloud, No "missing record key" error appears, Cloud dashboard shows test run',
    'Forgetting to set environment variable in CI pipeline, Using wrong or expired record key, Not creating project in Cypress Cloud first',
    0.91,
    'sonnet-4',
    NOW(),
    'https://docs.cypress.io/guides/references/error-messages#Missing-Record-Key'
),
(
    'Cypress: Custom command returning non-undefined value with invoked cy commands',
    'cypress',
    'MEDIUM',
    '[
        {"solution": "Return cy command chain directly: Cypress.Commands.add(''custom'', () => { return cy.get(...) })", "percentage": 96, "note": "Proper pattern for custom commands"},
        {"solution": "Omit return statement if command has side effects: Cypress.Commands.add(''setup'', () => { cy.visit(...) })", "percentage": 90, "note": "Cypress implicitly returns for last cy command"},
        {"solution": "Do not wrap cy commands in separate Promises: avoid new Promise((resolve) => { cy.get(...) })", "percentage": 92, "note": "Breaks Cypress command queueing"}
    ]'::jsonb,
    'Cypress custom commands file, Valid cy commands, Command registration',
    'Custom command executes without return value errors, Commands chain properly in tests, No type warnings in IDE',
    'Wrapping cy commands in separate Promise constructors, Returning explicit values alongside cy commands, Not returning cy command in custom command',
    0.94,
    'sonnet-4',
    NOW(),
    'https://docs.cypress.io/guides/references/error-messages#Custom-Command-Issues'
);

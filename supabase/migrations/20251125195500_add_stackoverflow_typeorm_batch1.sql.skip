-- Add Stack Overflow TypeORM solutions batch 1
-- Extracted from top 12 highest-voted TypeORM questions on Stack Overflow

INSERT INTO knowledge_entries (
    query, category, hit_frequency, solutions, prerequisites, success_indicators,
    common_pitfalls, success_rate, claude_version, last_verified, source_url
) VALUES (
    'TypeError: Class extends value undefined is not a function or null in TypeORM',
    'stackoverflow-typeorm',
    'HIGH',
    '[
        {"solution": "Identify and eliminate circular file imports between entity modules. Use madge tool to detect circular dependencies: madge --circular --extensions ts <directory>", "percentage": 90, "note": "Most common cause - circular references at file level not just type level", "command": "madge --circular --extensions ts src/"},
        {"solution": "Remove re-exports of base classes from barrel (index.ts) files. Import entity classes directly from source files instead of from index files", "percentage": 88, "note": "Prevents circular dependency chains"},
        {"solution": "Create internal.ts module that centralizes exports of related classes to prevent circular references", "percentage": 85, "note": "Clean separation of concerns pattern"},
        {"solution": "Verify import order - separate files for base and derived classes. Avoid exporting base classes in public APIs", "percentage": 82, "note": "Restructure module hierarchy if needed"}
    ]'::jsonb,
    'TypeORM project with entity inheritance setup, Node.js 12+',
    'Entity class successfully extends base class without error, Application starts without undefined errors',
    'Circular imports can be subtle - check not just type imports but file-level module references. Stale node_modules may mask the issue - try reinstalling. Wrong import source (e.g., transpiled vs source) can cause similar errors.',
    0.92,
    'sonnet-4',
    NOW(),
    'https://stackoverflow.com/questions/43176006'
),
(
    'Cannot use import statement outside a module in TypeORM NestJS entity imports',
    'stackoverflow-typeorm',
    'HIGH',
    '[
        {"solution": "Update ormconfig.json to use __dirname with compiled JavaScript paths: entities: [join(__dirname, \\\"**\\\", \\\"*.entity.{ts,js}\\\")]", "percentage": 92, "note": "Resolves TypeScript/JavaScript context mismatch in entity loading"},
        {"solution": "For production, use dist directory: entities: [\\\"dist/**/*.entity.js\\\"]", "percentage": 90, "note": "Points to compiled output instead of source"},
        {"solution": "Import entities directly by class reference instead of glob patterns: entities: [User, Role]", "percentage": 88, "note": "Ensures TypeScript is properly compiled before import"},
        {"solution": "Install ts-node globally and use ts-node wrapper for CLI operations: ts-node ./node_modules/.bin/typeorm migration:generate", "percentage": 85, "note": "Required for development-time migrations"}
    ]'::jsonb,
    'NestJS 9.2.0+, TypeORM 0.3.10+, tsconfig.json configured',
    'Application starts without import errors, TypeORM CLI commands execute successfully, Entities load correctly in development and production',
    'Glob patterns pointing to .ts files in compiled .js context. Missing module: commonjs in tsconfig.json. Accidentally importing from typeorm/browser instead of typeorm. Development config differs from runtime expectations.',
    0.94,
    'sonnet-4',
    NOW(),
    'https://stackoverflow.com/questions/59435293'
),
(
    'Entity metadata for entity was not found in TypeORM',
    'stackoverflow-typeorm',
    'HIGH',
    '[
        {"solution": "Add entity classes to TypeOrmModule.forFeature() in the corresponding NestJS module: @Module({ imports: [TypeOrmModule.forFeature([User, Role])] })", "percentage": 93, "note": "Most common cause - forgotten module registration"},
        {"solution": "Ensure all entity classes have @Entity() decorator applied", "percentage": 91, "note": "Entities without decorator are not registered"},
        {"solution": "Enable autoLoadEntities: true in TypeORM configuration for automatic discovery", "percentage": 89, "note": "Alternative to manual registration"},
        {"solution": "Configure ormconfig.js with proper glob pattern: entities: [__dirname + \\\"entities/**/*.entity.ts\\\"]", "percentage": 87, "note": "File pattern must match actual entity location"}
    ]'::jsonb,
    'TypeORM installed and configured, Related entity classes defined with decorators, Database connection initialized',
    '@Entity() decorator present and recognized, Entities loaded in TypeOrmModule, getRepository() returns valid repository, Relationship queries execute without metadata errors',
    'Forgetting @Entity() decorators on some classes. Incorrect file naming - pattern in config must match actual files. Case sensitivity issues in imports. Stale /dist folder after reorganizing entities. Missing entities in TypeOrmModule.forFeature().',
    0.91,
    'sonnet-4',
    NOW(),
    'https://stackoverflow.com/questions/56693067'
),
(
    'Difference between remove and delete methods in TypeORM',
    'stackoverflow-typeorm',
    'HIGH',
    '[
        {"solution": "Use remove() when you have entity instances loaded and need lifecycle hooks like @BeforeRemove and @AfterRemove to execute", "percentage": 92, "note": "Operates on entity objects, not conditions"},
        {"solution": "Use delete() for direct database deletion by query conditions (ID or criteria) without loading entities first", "percentage": 90, "note": "Faster for bulk operations, no lifecycle hooks"},
        {"solution": "Understand that only save() and remove() trigger entity lifecycle listeners - delete() and update() skip them entirely", "percentage": 88, "note": "Critical for cascade operations and side effects"},
        {"solution": "Use delete() for performance-critical bulk deletions where lifecycle hooks are not needed", "percentage": 85, "note": "Removes unnecessary entity loading overhead"}
    ]'::jsonb,
    'TypeORM repository instance available, Entity class defined, Understanding of async/await patterns',
    'Appropriate deletion method used for use case, Lifecycle hooks execute when needed (remove) or skipped for performance (delete), Expected data removed from database',
    'Assuming both methods trigger the same lifecycle hooks - they do not. Using remove() when you should use delete() causes unnecessary entity loading. Forgetting that lifecycle listeners only work with save() and remove().',
    0.93,
    'sonnet-4',
    NOW(),
    'https://stackoverflow.com/questions/54246615'
),
(
    'How to use OR operator in TypeORM where clause',
    'stackoverflow-typeorm',
    'HIGH',
    '[
        {"solution": "Pass array of objects to where clause for SQL OR logic: where: [{name: \\\"john\\\"}, {lastName: \\\"doe\\\"}]", "percentage": 91, "note": "Generates: WHERE (name=john) OR (lastName=doe)"},
        {"solution": "Use QueryBuilder with .orWhere() for complex conditions: .where(condition1).orWhere(condition2)", "percentage": 88, "note": "More flexible for intricate queries"},
        {"solution": "Combine OR with AND by repeating conditions in array objects: where: [{name: \\\"john\\\", active: true}, {name: \\\"jane\\\", active: true}]", "percentage": 85, "note": "Creates compound logic across array elements"},
        {"solution": "Use TypeORM v0.3.18+ Or() operator for single-field scenarios if available", "percentage": 80, "note": "Check version compatibility before using"}
    ]'::jsonb,
    'SQL database (not MongoDB), TypeORM repository initialized',
    'Query returns correct records matching OR conditions, SQL statement contains OR operator when inspected',
    'Array syntax does not work with MongoDB - QueryBuilder required instead. Nested object conditions create AND not OR. Not recognizing QueryBuilder as necessary for complex cases. Version compatibility issues with Or() operator.',
    0.90,
    'sonnet-4',
    NOW(),
    'https://stackoverflow.com/questions/53407236'
),
(
    'How to perform LIKE query with pattern matching in TypeORM',
    'stackoverflow-typeorm',
    'VERY_HIGH',
    '[
        {"solution": "Use TypeORM Like() function with wildcards in parameter: Like(\\`%${firstName}%\\`)", "percentage": 94, "note": "Recommended built-in approach, cleanest syntax"},
        {"solution": "Use QueryBuilder with parameter wildcards: .where(\\\"user.firstName like :name\\\", {name: \\`%${firstName}%\\`})", "percentage": 92, "note": "Include % in parameter value, not SQL string"},
        {"solution": "Use ILike() for case-insensitive LIKE queries in newer TypeORM versions", "percentage": 89, "note": "Available in recent versions"},
        {"solution": "For PostgreSQL concatenation: .where(\\\"user.firstName like \\\"% || :name || \\\"%\\\", {name: firstName})", "percentage": 85, "note": "Database-specific but handles edge cases"}
    ]'::jsonb,
    'TypeORM with Like imported from typeorm package, User input available for search',
    'Query returns records containing search text, No SQL errors, Case-insensitive search works if using ILike()',
    'Placing wildcards in SQL string instead of parameter value. Using undefined properties instead of Like(). SQL injection risk when concatenating user input directly - always use parameterized queries. Not sanitizing special characters like % and _.',
    0.95,
    'sonnet-4',
    NOW(),
    'https://stackoverflow.com/questions/47814537'
),
(
    'How to update entity and return updated record in TypeORM',
    'stackoverflow-typeorm',
    'HIGH',
    '[
        {"solution": "Use repository.save() with partial updates - undefined properties are skipped: save({id: 1, name: \\\"new name\\\"})", "percentage": 92, "note": "Single operation, cleaner than separate update/find"},
        {"solution": "Use QueryBuilder .returning() for PostgreSQL/SQL Server: Update(...).returning(\\\"*\\\").execute()", "percentage": 88, "note": "Native database feature, atomic operation. MySQL does not support .returning()"},
        {"solution": "Find entity first then merge and save: const item = await find({id}); await save({...item, ...update})", "percentage": 85, "note": "Works all databases but requires two queries"},
        {"solution": "Use update() method for bulk updates, then fetch separately if needed", "percentage": 80, "note": "More efficient for many records but non-atomic"}
    ]'::jsonb,
    'TypeORM repository instance, Entity with primary key, Async/await support',
    'Update operation succeeds with 200+ status, Returned entity contains updated values, Timestamp fields (if any) show correct update time',
    'Assuming .save() with missing ID creates new entity rather than failing. Database atomicity requires .returning() which varies by DB. Non-atomic separate update/find creates race conditions. Missing async/await causes silent failures.',
    0.91,
    'sonnet-4',
    NOW(),
    'https://stackoverflow.com/questions/47792808'
),
(
    'How to add IS NULL condition in TypeORM find options',
    'stackoverflow-typeorm',
    'HIGH',
    '[
        {"solution": "Use IsNull() operator: where: {username: IsNull()}", "percentage": 94, "note": "Direct solution for IS NULL conditions"},
        {"solution": "Use Not(IsNull()) for NOT NULL conditions: where: {username: Not(IsNull())}", "percentage": 92, "note": "Handles IS NOT NULL checks"},
        {"solution": "Use QueryBuilder .where(\\\"user.name IS NULL\\\") for complex queries", "percentage": 88, "note": "Manual SQL approach when needed"},
        {"solution": "Import IsNull, Not from typeorm package to use the operators", "percentage": 90, "note": "Both operators must be imported correctly"}
    ]'::jsonb,
    'TypeORM package with IsNull, Not operators imported',
    'Query returns records where column is NULL, WHERE clause contains IS NULL in generated SQL, No unexpected records returned',
    'Setting properties to undefined instead of using IsNull() - undefined creates = NULL which returns no results. Forgetting to import operators. Trying to use equality operators for null checks. Not combining Not() with IsNull() for negation.',
    0.93,
    'sonnet-4',
    NOW(),
    'https://stackoverflow.com/questions/46879840'
),
(
    'How to implement upsert (insert or update) in TypeORM',
    'stackoverflow-typeorm',
    'VERY_HIGH',
    '[
        {"solution": "Use native upsert() method (TypeORM 0.2.40+): await repository.upsert({name: \\\"John\\\"}, {conflictPaths: [\\\"id\\\"]})", "percentage": 94, "note": "Modern recommended approach - clean and database-agnostic"},
        {"solution": "Define unique constraint on columns first: @Unique(\\\"constraint_name\\\", [\\\"col_one\\\", \\\"col_two\\\"])", "percentage": 92, "note": "Required for upsert on non-primary keys"},
        {"solution": "Use QueryBuilder .orIgnore() for INSERT IGNORE pattern", "percentage": 85, "note": "Silently skips if record exists, no update"},
        {"solution": "Use QueryBuilder .orUpdate() for MySQL: .orUpdate({conflict_target: [\\\"id\\\"], overwrite: [\\\"name\\\"]})", "percentage": 82, "note": "MySQL-specific, legacy but still functional"}
    ]'::jsonb,
    'TypeORM 0.2.40+, Primary key or unique constraint defined, Database schema prepared',
    'Record inserted if not exists, Record updated if exists, Correct values in database, Single operation completes',
    'Assuming .save() handles upsert on non-primary keys - it does not. Using deprecated onConflict() method. Missing conflictPaths in upsert options. Not defining unique constraints before attempting upsert. Expecting MySQL-specific .returning().',
    0.93,
    'sonnet-4',
    NOW(),
    'https://stackoverflow.com/questions/46745688'
),
(
    'TypeORM array column not supported in PostgreSQL',
    'stackoverflow-typeorm',
    'MEDIUM',
    '[
        {"solution": "Specify base type with array: true - @Column(\\\"int\\\", {array: true}) with TypeScript type number[]", "percentage": 93, "note": "Explicit type declaration required"},
        {"solution": "Declare TypeScript property as actual array type matching column type: kid_ages: number[] not kid_ages: string", "percentage": 91, "note": "Type declaration must match PostgreSQL column type"},
        {"solution": "For text arrays use: @Column(\\\"text\\\", {array: true})", "percentage": 89, "note": "Works for string/text array types"},
        {"solution": "Use simple-array type for backward compatibility: @Column(\\\"simple-array\\\") - stores as comma-separated text", "percentage": 82, "note": "Legacy approach, less flexible but widely supported"}
    ]'::jsonb,
    'PostgreSQL database configured, TypeORM entity class, Node.js 12+',
    'Array values persist in database, Query returns array type correctly, Type validation in TypeScript passes',
    'Using string type instead of string[] - TypeScript type must be an array. Omitting explicit type parameter in @Column(). Type mismatch between TypeScript property and @Column() declaration. Not testing with actual array values. Expecting other databases to support native arrays.',
    0.89,
    'sonnet-4',
    NOW(),
    'https://stackoverflow.com/questions/57611633'
),
(
    'How to seed a TypeORM database with initial data',
    'stackoverflow-typeorm',
    'HIGH',
    '[
        {"solution": "Create dedicated seed connection in ormconfig.js with separate migrations folder for seeds", "percentage": 88, "note": "Keeps seeds separate from regular migrations"},
        {"solution": "Run seeds with: ts-node typeorm migration:run -c seed", "percentage": 87, "note": "Uses seed connection configuration"},
        {"solution": "Use NestJS middleware to intercept requests and check if seeding is complete before allowing access", "percentage": 84, "note": "Prevents concurrent seeding issues"},
        {"solution": "Create seed migration file with QueryRunner to insert data directly: CREATE migration named 0-Seed", "percentage": 82, "note": "Mix seed data with regular migrations - requires manual SQL statements"}
    ]'::jsonb,
    'TypeORM configured, Database connection established, Seed data prepared as JSON or objects',
    'Seed data successfully inserted into database tables, Seeding completes without errors, Application starts with populated data',
    'Mixing seed data with regular migrations causes issues on redeployment. Not tracking which seeds have run - causes duplicate inserts. Concurrent seeding requests without proper transaction handling. Forgetting to handle timestamps and relationships in seed data.',
    0.86,
    'sonnet-4',
    NOW(),
    'https://stackoverflow.com/questions/51198817'
),
(
    'No metadata for entity was found when starting TypeORM application',
    'stackoverflow-typeorm',
    'HIGH',
    '[
        {"solution": "Update entity file pattern to include both .ts and .js: entities: [__dirname + \\\"/../**/*.entity.{js,ts}\\\"]", "percentage": 92, "note": "TypeScript transpiles to JS at runtime, both must be scanned"},
        {"solution": "Add entities directly to TypeOrmModule.forRoot() config: entities: [User, Role]", "percentage": 90, "note": "Explicit class references work better than glob patterns"},
        {"solution": "Delete /dist folder and rebuild after configuration changes", "percentage": 89, "note": "Stale compiled output causes metadata mismatches"},
        {"solution": "Ensure @Entity() decorator exists on all entity classes", "percentage": 88, "note": "Decorator is required for registration"},
        {"solution": "Initialize DataSource with await AppDataSource.initialize() before querying", "percentage": 87, "note": "Connection must be ready before use"}
    ]'::jsonb,
    'TypeORM installed, Entity classes defined with decorators, Database connection string available',
    '@Entity() decorator recognized, getRepository() returns valid instance, Database queries execute without metadata errors, Application starts successfully',
    'Using only .ts extension when config runs on .js files. Missing @Entity() decorators on some classes. Case sensitivity in imports (User vs user). Incorrect glob patterns that match no files. Multiple conflicting ORM config files. Performing queries before connection initialization.',
    0.90,
    'sonnet-4',
    NOW(),
    'https://stackoverflow.com/questions/51562162'
);

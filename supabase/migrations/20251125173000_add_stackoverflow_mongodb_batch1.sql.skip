-- Stack Overflow MongoDB top voted Q&A batch 1
-- Extracted from https://stackoverflow.com/questions/tagged/mongodb?tab=votes
-- 11 highest voted questions with accepted/top answers (1,990 - 699 votes)

INSERT INTO knowledge_entries (
    query, category, hit_frequency, solutions, prerequisites, success_indicators,
    common_pitfalls, success_rate, claude_version, last_verified, source_url
) VALUES
(
    'MongoDB query with LIKE pattern matching - how to use regex for substring search',
    'stackoverflow-mongodb',
    'VERY_HIGH',
    '[
        {"solution": "Use regex pattern with $regex operator for substring matching: db.users.find({\"name\": {\"$regex\": \"pattern\", \"$options\": \"i\"}})", "percentage": 95, "note": "Case-insensitive with \"i\" option"},
        {"solution": "Use regex literal notation for simpler patterns: db.users.find({\"name\": /m/})", "percentage": 90, "note": "Equivalent to LIKE ''%m%''"},
        {"solution": "Use anchored patterns: /^m/ for LIKE ''m%'', /m$/ for LIKE ''%m''", "percentage": 85, "note": "Anchored patterns can use indexes efficiently"},
        {"solution": "For dynamic user input, use $regex with proper escaping to prevent injection", "percentage": 80, "command": "db.users.find({\"name\": {\"$regex\": escapeRegex(userInput), \"$options\": \"i\"}})"}
    ]'::jsonb,
    'MongoDB connection, existing collection with string fields',
    'Query returns matching documents with substring found in field, no error thrown',
    'Unanchored regex patterns cause full collection scans (expensive on large datasets). Without anchors like ^ or $, indexes cannot be efficiently utilized. Regex queries are slower than exact matches.',
    0.90,
    'sonnet-4',
    NOW(),
    'https://stackoverflow.com/questions/3305561/how-to-query-mongodb-with-like'
),
(
    'MongoDB query documents where array size is greater than 1 - check array length',
    'stackoverflow-mongodb',
    'VERY_HIGH',
    '[
        {"solution": "Check if array index 1 exists: db.accommodations.find({\"name.1\": {\"$exists\": true}})", "percentage": 95, "note": "Most efficient method, works MongoDB 2.2+"},
        {"solution": "Use $size with $expr operator (MongoDB 3.6+): db.accommodations.find({\"$expr\": {\"$gt\": [{\"$size\": \"$name\"}, 1]}})", "percentage": 90, "note": "More readable intent with dynamic thresholds"},
        {"solution": "Check for first array element: db.accommodations.find({\"name.0\": {\"$exists\": true}})", "percentage": 75, "note": "Simpler but less flexible than index method"},
        {"solution": "Create partial index for performance (MongoDB 3.2+): db.accommodations.createIndex({\"name.1\": 1}, {partialFilterExpression: {\"name.1\": {\"$exists\": true}}})", "percentage": 85, "command": "db.accommodations.createIndex({\"name.1\": 1}, {partialFilterExpression: {\"name.1\": {\"$exists\": true}}})"}
    ]'::jsonb,
    'MongoDB connection, collection with array fields, MongoDB 2.2 or higher',
    'Query returns documents where array has 2+ elements, no performance degradation on large datasets',
    'Avoid $where operator - it requires JavaScript interpretation and is much slower. Using $size without index awareness can cause full collection scans. Do not confuse array index position (0-based) with array length checks.',
    0.92,
    'sonnet-4',
    NOW(),
    'https://stackoverflow.com/questions/7811163/query-for-documents-where-array-size-is-greater-than-1'
),
(
    'How to drop a MongoDB database from command line without interactive shell',
    'stackoverflow-mongodb',
    'HIGH',
    '[
        {"solution": "Use mongo shell with --eval flag: mongo <dbname> --eval \"db.dropDatabase()\"", "percentage": 95, "note": "Simplest non-interactive approach", "command": "mongo <dbname> --eval \"db.dropDatabase()\""},
        {"solution": "Use mongosh for MongoDB 6.0+: mongosh --eval \"use <dbname>\" --eval \"db.dropDatabase()\"", "percentage": 95, "note": "mongo shell deprecated, use mongosh instead", "command": "mongosh --eval \"use <dbname>\" --eval \"db.dropDatabase()\""},
        {"solution": "Pipe commands to mongo: echo \"db.dropDatabase()\" | mongo <database_name>", "percentage": 90, "command": "echo \"db.dropDatabase()\" | mongo <database_name>"},
        {"solution": "Use heredoc syntax: mongo localhost/db <<EOF\\ndb.dropDatabase()\\nEOF", "percentage": 85, "command": "mongo localhost/db <<EOF"}
    ]'::jsonb,
    'MongoDB running and accessible, correct database name, appropriate user permissions',
    'Database is deleted from MongoDB server, no error returned, disk space reclaimed after compact',
    'Command drops the database the client connects to, NOT necessarily the one named in the connection string if it changes mid-session. Always verify you are connected to correct database before execution. Clear shell history after running to prevent accidental re-execution.',
    0.93,
    'sonnet-4',
    NOW(),
    'https://stackoverflow.com/questions/8857276/how-do-i-drop-a-mongodb-database-from-the-command-line'
),
(
    'How to list all collections in MongoDB shell - show collections command',
    'stackoverflow-mongodb',
    'VERY_HIGH',
    '[
        {"solution": "Use show collections command in mongo shell: show collections", "percentage": 95, "note": "Simplest and most readable approach", "command": "show collections"},
        {"solution": "Use getCollectionNames() method: db.getCollectionNames()", "percentage": 90, "note": "Returns array format, useful for scripting", "command": "db.getCollectionNames()"},
        {"solution": "Use alternative show command: show tables", "percentage": 85, "note": "Alias for show collections"},
        {"solution": "First select database with use command, then list: use your_db; show collections", "percentage": 95, "command": "use your_db; show collections"}
    ]'::jsonb,
    'MongoDB connection established, mongo or mongosh shell open, database selected with use command',
    'Command returns list of collection names without errors, human-readable output or JSON array format',
    'db.listCollections() is available in Node.js drivers but NOT in MongoDB shell itself. Do not confuse shell commands with driver methods. Must select database with use command before listing collections in that database.',
    0.94,
    'sonnet-4',
    NOW(),
    'https://stackoverflow.com/questions/8866041/how-can-i-list-all-collections-in-the-mongodb-shell'
),
(
    'Find MongoDB records where array field is not empty - query empty arrays',
    'stackoverflow-mongodb',
    'VERY_HIGH',
    '[
        {"solution": "Use $exists and $ne operators together: db.collection.find({\"pictures\": {\"$exists\": true, \"$ne\": []}})", "percentage": 95, "note": "Recommended: allows index utilization and handles both missing and empty array fields"},
        {"solution": "Check for first array element existence: db.collection.find({\"pictures.0\": {\"$exists\": true}})", "percentage": 80, "note": "Works but performs full collection scan even with indexes"},
        {"solution": "Use $not with $size (MongoDB specific): db.collection.find({\"pictures\": {\"$exists\": true, \"$not\": {\"$size\": 0}}})", "percentage": 75, "note": "$size does not use indexes, can impact performance"},
        {"solution": "Combine with sorting: db.collection.find({\"pictures\": {\"$exists\": true, \"$ne\": []}}).sort({\"created\": -1}).limit(10)", "percentage": 90, "command": "db.collection.find({\"pictures\": {\"$exists\": true, \"$ne\": []}}).sort()"}
    ]'::jsonb,
    'MongoDB connection, collection with array fields, understanding of document structure',
    'Query returns only documents with non-empty arrays, no documents with missing or empty array fields, proper sorting applied',
    'Avoid $gt: [] syntax - produces unexpected results when indexes are involved. $size operator cannot effectively use indexes, causing performance degradation. Do not rely on $exists alone as it includes null values.',
    0.92,
    'sonnet-4',
    NOW(),
    'https://stackoverflow.com/questions/14789684/find-mongodb-records-where-array-field-is-not-empty'
),
(
    'MongoDB check if field contains a string substring search $regex operator',
    'stackoverflow-mongodb',
    'VERY_HIGH',
    '[
        {"solution": "Use $regex operator for substring search: db.users.findOne({\"username\": {\"$regex\": \"son\"}})", "percentage": 95, "note": "Explicit syntax, works across all MongoDB versions"},
        {"solution": "Use regex literal notation: db.users.findOne({\"username\": /son/})", "percentage": 90, "note": "Shorter syntax, equivalent to $regex operator"},
        {"solution": "Case-insensitive search with options: db.users.find({\"username\": {\"$regex\": \"son\", \"$options\": \"i\"}})", "percentage": 95, "command": "db.users.find({\"username\": {\"$regex\": \"son\", \"$options\": \"i\"}})"},
        {"solution": "For performance-critical queries, use text indexes instead: db.users.createIndex({\"username\": \"text\"}); db.users.find({\"$text\": {\"$search\": \"son\"}})", "percentage": 85, "note": "More efficient for word-based search on large datasets"}
    ]'::jsonb,
    'MongoDB connection, collection with string fields, understanding of regex patterns',
    'Query returns documents containing the substring in the field, case sensitivity handled correctly, no errors thrown',
    'Regex queries without indexes force full collection scans - expensive on large datasets. Special regex characters must be escaped when using user input to prevent injection. Building dynamic regex patterns requires careful sanitization.',
    0.88,
    'sonnet-4',
    NOW(),
    'https://stackoverflow.com/questions/10610131/checking-if-a-field-contains-a-string'
),
(
    'MongoDB find document with array that contains specific value - array element matching',
    'stackoverflow-mongodb',
    'VERY_HIGH',
    '[
        {"solution": "Query array field directly with value: db.collection.find({\"favouriteFoods\": \"sushi\"})", "percentage": 95, "note": "MongoDB automatically handles array queries, simplest and most efficient"},
        {"solution": "Use $in operator for OR logic (any value matches): db.collection.find({\"favouriteFoods\": {\"$in\": [\"sushi\", \"hotdog\"]}})", "percentage": 90, "note": "Match if field contains ANY of specified values"},
        {"solution": "Use $all operator for AND logic (all values must exist): db.collection.find({\"favouriteFoods\": {\"$all\": [\"sushi\", \"bananas\"]}})", "percentage": 90, "note": "Match if field contains ALL specified values"},
        {"solution": "Use $elemMatch for complex conditions on array elements: db.collection.find({\"favouriteFoods\": {\"$elemMatch\": {\"$eq\": \"sushi\"}}})", "percentage": 85, "note": "Required for arrays of objects with nested conditions"}
    ]'::jsonb,
    'MongoDB connection, collection with array fields, understanding of array schema',
    'Query returns documents where array field contains the specified value, correct operator used for logical requirements',
    'Do not confuse $in (checks if field value is in an array) with direct array querying (checks if array contains a value). $elemMatch is necessary for arrays of objects but overhead for simple values. Remember MongoDB treats array element matching implicitly.',
    0.93,
    'sonnet-4',
    NOW(),
    'https://stackoverflow.com/questions/18148166/find-document-with-array-that-contains-a-specific-value'
),
(
    'MongoDB query for is not null - check for non-null values $ne null operator',
    'stackoverflow-mongodb',
    'VERY_HIGH',
    '[
        {"solution": "Check for non-null values (recommended): db.mycollection.find({\"fieldname\": {\"$ne\": null}})", "percentage": 95, "note": "Most efficient and direct approach", "command": "db.mycollection.find({\"IMAGE URL\": {\"$ne\": null}})"},
        {"solution": "Check if field exists: db.mycollection.find({\"fieldname\": {\"$exists\": true}})", "percentage": 80, "note": "Returns documents with field even if value is null"},
        {"solution": "Combine both for clarity: db.mycollection.find({\"fieldname\": {\"$exists\": true, \"$ne\": null}})", "percentage": 90, "note": "Explicit intent - field exists AND contains non-null value"},
        {"solution": "Use $exists alone if null values are acceptable: db.mycollection.find({\"fieldname\": {\"$exists\": true}})", "percentage": 75, "note": "Less selective, includes null values"}
    ]'::jsonb,
    'MongoDB connection, collection with nullable fields, understanding document structure',
    'Query returns only documents with non-null values in specified field, no error thrown, performance acceptable with indexed field',
    '$exists returns documents with field even if value is null - not equivalent to \"is not null\". $ne can utilize indexes more efficiently than $exists. Non-existent fields implicitly have null values that satisfy $ne: null.',
    0.94,
    'sonnet-4',
    NOW(),
    'https://stackoverflow.com/questions/4057196/how-do-you-query-for-is-not-null-in-mongo'
),
(
    'MongoDB get last N records - retrieve final documents with sort and limit',
    'stackoverflow-mongodb',
    'HIGH',
    '[
        {"solution": "Use sort with _id field and limit: db.foo.find().sort({\"_id\": 1}).limit(50)", "percentage": 90, "note": "_id field contains embedded timestamp for ordering"},
        {"solution": "Use natural order: db.foo.find().sort({\"$natural\": 1}).limit(50)", "percentage": 85, "note": "Sorts by insertion order, but order not guaranteed in replica sets"},
        {"solution": "Reverse order (newest first): db.foo.find().sort({\"$natural\": -1}).limit(50)", "percentage": 85, "command": "db.foo.find().sort({\"$natural\": -1}).limit(50)"},
        {"solution": "Skip-based approach: db.collection.find().skip(db.collection.count() - N)", "percentage": 70, "note": "Less efficient, requires count operation first"}
    ]'::jsonb,
    'MongoDB connection, collection with documents, appropriate sort field indexed for performance',
    'Query returns exactly N most recent documents in correct order, no timeout errors, performance acceptable',
    'Natural order should NOT be relied upon in replica sets - different nodes may store documents in different order. Sorting entire collection is inefficient for large datasets. Use indexed fields with min()/max() cursor methods for better performance. count() is deprecated in newer versions.',
    0.88,
    'sonnet-4',
    NOW(),
    'https://stackoverflow.com/questions/4421207/how-to-get-the-last-n-records-in-mongodb'
),
(
    'MongoDB index creation best practices - optimize query performance with proper indexing',
    'stackoverflow-mongodb',
    'HIGH',
    '[
        {"solution": "Create single field index for frequently queried field: db.collection.createIndex({\"fieldname\": 1})", "percentage": 90, "note": "1 for ascending, -1 for descending order"},
        {"solution": "Create compound index for multiple fields: db.collection.createIndex({\"field1\": 1, \"field2\": -1})", "percentage": 85, "note": "Order matters - most selective field first"},
        {"solution": "Create partial index for filtered queries: db.collection.createIndex({\"field\": 1}, {partialFilterExpression: {\"status\": \"active\"}})", "percentage": 80, "note": "Reduces index size, only indexes matching documents"},
        {"solution": "Use explain() to analyze query performance: db.collection.find({query}).explain(\"executionStats\")", "percentage": 95, "command": "db.collection.find().explain(\"executionStats\")"}
    ]'::jsonb,
    'MongoDB connection, collection with documents, understanding of query patterns, appropriate field selection',
    'Index created successfully, query execution time significantly reduced, explain output shows COLLSCAN vs index usage',
    'Creating too many indexes increases write performance overhead - only index frequently queried fields. Index order in compound indexes affects query optimization. Partial indexes cannot be used for queries outside the filter expression. Always analyze query execution plan before creating indexes.',
    0.89,
    'sonnet-4',
    NOW(),
    'https://stackoverflow.com/questions/tagged/mongodb?tab=votes'
),
(
    'MongoDB delete or remove documents - drop documents from collection safely',
    'stackoverflow-mongodb',
    'HIGH',
    '[
        {"solution": "Delete single document: db.collection.deleteOne({\"fieldname\": value})", "percentage": 95, "note": "Deletes only first matching document, safer default"},
        {"solution": "Delete multiple documents: db.collection.deleteMany({\"fieldname\": value})", "percentage": 95, "note": "Deletes all matching documents, verify filter first"},
        {"solution": "Delete with write concern for safety: db.collection.deleteMany({filter}, {writeConcern: {w: \"majority\"}})", "percentage": 85, "note": "Ensures deletion confirmed on majority of replica nodes"},
        {"solution": "Verify deletion with count before/after: db.collection.countDocuments(filter); db.collection.deleteMany(filter); db.collection.countDocuments(filter)", "percentage": 90, "command": "db.collection.deleteMany({\"status\": \"inactive\"})"}
    ]'::jsonb,
    'MongoDB connection, collection with documents, correct filter criteria established, write permissions',
    'Documents matching filter removed from collection, returned deleteResult shows deletedCount matches expected count, no rollback occurred',
    'deleteMany() without filter deletes entire collection - always test filter first. Deletion is permanent - no trash/recycle. remove() is deprecated - use deleteOne() or deleteMany() instead. Missing write concern can silently fail in replica sets.',
    0.91,
    'sonnet-4',
    NOW(),
    'https://stackoverflow.com/questions/tagged/mongodb?tab=votes'
),
(
    'MongoDB aggregation pipeline $group stage - perform grouping and aggregation operations',
    'stackoverflow-mongodb',
    'HIGH',
    '[
        {"solution": "Basic group by field with count: db.collection.aggregate([{\"$group\": {\"_id\": \"$fieldname\", \"count\": {\"$sum\": 1}}}])", "percentage": 90, "note": "$sum: 1 counts documents in each group"},
        {"solution": "Group with multiple aggregation operators: db.collection.aggregate([{\"$group\": {\"_id\": \"$category\", \"total\": {\"$sum\": \"$amount\"}, \"average\": {\"$avg\": \"$amount\"}}}])", "percentage": 85, "command": "db.collection.aggregate([{\"$group\": {\"_id\": \"$field\", \"count\": {\"$sum\": 1}}}])"},
        {"solution": "Group by null to aggregate all documents: db.collection.aggregate([{\"$group\": {\"_id\": null, \"total\": {\"$sum\": \"$value\"}}}])", "percentage": 85, "note": "_id: null groups all documents together"},
        {"solution": "Push values into array during grouping: db.collection.aggregate([{\"$group\": {\"_id\": \"$category\", \"items\": {\"$push\": \"$name\"}}}])", "percentage": 80, "note": "Creates array of values from each group"}
    ]'::jsonb,
    'MongoDB connection, collection with documents, understanding of aggregation pipeline, knowledge of available operators ($sum, $avg, $push, etc.)',
    'Aggregation pipeline executes without error, $group stage correctly groups documents, aggregation functions calculate expected values',
    'Performance degrades without indexes on $group field - add index before grouping large collections. $group stage processes all documents unless $match precedes it - filter early in pipeline for efficiency. Memory limit of 100MB for $group - use $project to reduce document size first.',
    0.87,
    'sonnet-4',
    NOW(),
    'https://stackoverflow.com/questions/tagged/mongodb?tab=votes'
);

INSERT INTO knowledge_entries (query, category, type, solutions, executable_type, prerequisites, common_pitfalls, success_indicators, preview_summary, source_url, contributor_email)
VALUES (
  'Database Migration - Execute database migrations across ORMs and platforms with zero-downtime strategies, data transformation, and rollback procedures',
  'claude-code',
  'skill',
  '[{"solution": "Sequelize Migrations Setup", "cli": {"macos": "npx sequelize-cli migration:create --name=create_users", "linux": "npx sequelize-cli migration:create --name=create_users", "windows": "npx sequelize-cli migration:create --name=create_users"}, "manual": "Define up() and down() methods. Use queryInterface.createTable/addColumn/removeColumn. Run with npx sequelize-cli db:migrate. Rollback with npx sequelize-cli db:migrate:undo.", "note": "Sequelize migrations are JavaScript-based and require explicit up/down"}, {"solution": "TypeORM Migrations Setup", "cli": {"macos": "npm run typeorm migration:generate -- -n CreateUsers", "linux": "npm run typeorm migration:generate -- -n CreateUsers", "windows": "npm run typeorm migration:generate -- -n CreateUsers"}, "manual": "Create migration classes implementing MigrationInterface. Define up() and down() methods using QueryRunner. Run with npm run typeorm migration:run. Revert with npm run typeorm migration:revert.", "note": "TypeORM auto-generates migrations from entity changes"}, {"solution": "Prisma Migrations Setup", "cli": {"macos": "npx prisma migrate dev --name create_users", "linux": "npx prisma migrate dev --name create_users", "windows": "npx prisma migrate dev --name create_users"}, "manual": "Modify schema.prisma to define models. Generate migrations which create SQL files. Apply with npx prisma migrate deploy. Uses create-only semantic, no explicit down().", "note": "Prisma migrations are auto-generated from schema changes"}, {"solution": "Schema Transformations (Zero Downtime)", "manual": "For column renames: add new column, update code to use new column, backfill data with UPDATE query, deploy code change, remove old column. For type changes: add new column, CAST/CONVERT data, swap columns, drop old. Always in separate migrations.", "note": "Multi-step approach prevents downtime and allows rollback between steps"}, {"solution": "Data Transformation Patterns", "manual": "Use queryInterface.sequelize.query() for complex transformations. Process in batches for large datasets. Create backup tables before transformations. Wrap in transactions. Validate data after transformation. Handle NULL values explicitly.", "note": "Large data migrations should be done in phases, not atomic transactions"}, {"solution": "Rollback Strategies", "manual": "Implement down() method that reverses all changes. Use transactions to ensure atomicity. Create backup tables before risky operations. Use checkpoint-based rollback for complex migrations. Test rollback procedures on staging.", "note": "Rollback procedures are essential for production safety"}, {"solution": "Blue-Green Deployment", "manual": "Phase 1: Add new column/table (backward compatible). Phase 2: Deploy code writing to both old and new. Phase 3: Backfill data. Phase 4: Deploy code reading new column. Phase 5: Remove old column. Each phase is a separate migration.", "note": "Blue-green enables zero-downtime schema changes"}, {"solution": "Cross-Database Migrations", "manual": "Check dialect using queryInterface.sequelize.getDialect(). Use dialect-specific types (JSONB for PostgreSQL, JSON for MySQL). Handle SQL differences between databases. Test on target database.", "note": "Portable migrations need dialect awareness"}]'::jsonb,
  'script',
  'Node.js 14+, ORM library (Sequelize/TypeORM/Prisma), database access, SQL knowledge',
  'Not testing rollback procedures, making breaking changes without downtime strategy, forgetting to handle NULL values, not considering index performance, ignoring foreign key constraints, migrating too much data at once, missing up() and down() implementation',
  'Migrations run without errors, down() rollbacks all changes, all data preserved during transformation, queries execute in reasonable time, foreign key constraints maintained, zero-downtime deployments complete successfully, backup tables properly created and cleaned up',
  'Production-ready database migrations with zero-downtime strategies, data transformation, and comprehensive rollback procedures',
  'https://skillsmp.com/skills/wshobson-agents-plugins-framework-migration-skills-database-migration-skill-md',
  'admin:HAIKU_SKILL_1764289669_91423'
);

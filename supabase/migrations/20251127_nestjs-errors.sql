INSERT INTO knowledge_entries (query, category, hit_frequency, solutions, prerequisites, success_indicators, common_pitfalls, success_rate, claude_version, last_verified, source_url, contributor_email) VALUES
('BadRequestException: Too many files', 'nestjs', 'HIGH', '[{"solution": "Validate file count before accepting upload in FilesInterceptor", "percentage": 95}, {"solution": "Use ParseFilePipe with validators to handle file size/count limits", "percentage": 90}]'::jsonb, 'NestJS 8+, Multer', 'File upload works within limits', 'Not setting maxFiles limit in interceptor options', 0.92, 'haiku', NOW(), 'https://stackoverflow.com/questions/73780681', 'admin:1764222344'),
('NotFoundException: Entity not found in forEach loop', 'nestjs', 'HIGH', '[{"solution": "Use Promise.allSettled() instead of Array.forEach() with async functions", "percentage": 95}, {"solution": "Replace forEach with for...of loop to properly await exceptions", "percentage": 92}]'::jsonb, 'NestJS async/await', 'All promises properly awaited', 'Using Array.forEach with async code', 0.88, 'haiku', NOW(), 'https://stackoverflow.com/questions/74553855', 'admin:1764222344'),
('UnauthorizedException returns 500 Internal Server Error', 'nestjs', 'MEDIUM', '[{"solution": "Ensure single @nestjs/common copy in node_modules - use npm dedupe", "percentage": 95}, {"solution": "Add peer dependencies in library package.json", "percentage": 90}]'::jsonb, 'NestJS monorepo or shared library', 'Correct 401 response returned', 'Multiple copies of @nestjs/common in dependencies', 0.89, 'haiku', NOW(), 'https://stackoverflow.com/questions/70284761', 'admin:1764222344'),
('ConflictException for duplicate database entries', 'nestjs', 'HIGH', '[{"solution": "Check for existing data before insert: await repository.findOne({email}) before save", "percentage": 95}, {"solution": "Catch QueryFailedError and map to ConflictException with error code check", "percentage": 88}]'::jsonb, 'TypeORM, database constraints', 'Proper 409 status with conflict message', 'Relying only on database constraints without app-level checks', 0.91, 'haiku', NOW(), 'https://stackoverflow.com/questions/61136081', 'admin:1764222344'),
('Class-validator validation errors not in expected format', 'nestjs', 'MEDIUM', '[{"solution": "Custom exceptionFactory in ValidationPipe to format errors correctly", "percentage": 95}, {"solution": "Use @Body() decorator with ValidationPipe instead of manual validation", "percentage": 90}]'::jsonb, 'class-validator, ValidationPipe', 'Consistent error response format', 'Not customizing ValidationPipe exception format', 0.87, 'haiku', NOW(), 'https://stackoverflow.com/questions/60270468', 'admin:1764222344'),
('InternalServerErrorException from guard thrown as 500', 'nestjs', 'HIGH', '[{"solution": "Use @UseFilters(ExceptionFilter) on controller to catch guard exceptions", "percentage": 93}, {"solution": "Throw HTTP exceptions directly from guard, not from interceptor", "percentage": 88}]'::jsonb, 'NestJS guards, exception filters', 'Correct HTTP status code returned', 'Throwing errors from guards caught by wrong filter level', 0.85, 'haiku', NOW(), 'https://stackoverflow.com/questions/72694776', 'admin:1764222344'),
('Interceptor cannot catch exception thrown by guard', 'nestjs', 'MEDIUM', '[{"solution": "Move error handling to global exception filter instead of interceptor", "percentage": 95}, {"solution": "Guards execute before interceptors - use filters for guard errors", "percentage": 92}]'::jsonb, 'NestJS guards, interceptors', 'Error properly caught and transformed', 'Expecting interceptor to catch guard errors', 0.90, 'haiku', NOW(), 'https://stackoverflow.com/questions/61087776', 'admin:1764222344'),
('QueryFailedError from TypeORM not being caught properly', 'nestjs', 'HIGH', '[{"solution": "@Catch(QueryFailedError, EntityNotFoundError) to handle multiple TypeORM errors", "percentage": 96}, {"solution": "Use switch(exception.constructor) to handle different error types", "percentage": 91}]'::jsonb, 'TypeORM, exception filters', 'Proper error response with appropriate status code', 'Not catching TypeORM-specific error classes', 0.93, 'haiku', NOW(), 'https://stackoverflow.com/questions/58993405', 'admin:1764222344'),
('ValidationPipe with form-data returns Internal Server Error', 'nestjs', 'MEDIUM', '[{"solution": "Class-validator behaves differently with form-data - validate manually in controller", "percentage": 90}, {"solution": "Use @Type() decorator from class-transformer for form-data parsing", "percentage": 85}]'::jsonb, 'form-data, ValidationPipe', 'Form-data validates and transforms correctly', 'Using default ValidationPipe with form-data uploads', 0.84, 'haiku', NOW(), 'https://stackoverflow.com/questions/60749135', 'admin:1764222344'),
('Middleware try-catch not catching errors', 'nestjs', 'MEDIUM', '[{"solution": "Use exception filter instead of middleware for error handling", "percentage": 94}, {"solution": "Call next(error) in catch block to propagate to filters", "percentage": 89}]'::jsonb, 'NestJS middleware', 'Errors properly handled by exception filter', 'Expecting middleware to catch all errors', 0.88, 'haiku', NOW(), 'https://stackoverflow.com/questions/71502180', 'admin:1764222344'),
('Circular dependency error with forwardRef()', 'nestjs', 'MEDIUM', '[{"solution": "Import modules instead of services directly to break circular dependency", "percentage": 95}, {"solution": "Use ModuleRef.get() to lazy load services on module init", "percentage": 88}]'::jsonb, 'NestJS modules, dependency injection', 'App starts without circular dependency warning', 'Creating direct service imports instead of module imports', 0.91, 'haiku', NOW(), 'https://stackoverflow.com/questions/56432814', 'admin:1764222344'),
('Unknown authentication strategy "jwt" error', 'nestjs', 'HIGH', '[{"solution": "Remove version conflicts in @nestjs/jwt and @nestjs/passport - use same versions", "percentage": 95}, {"solution": "Add global: true to JwtModule.register() config", "percentage": 88}]'::jsonb, 'Passport, JWT', 'JWT authentication works with correct 401 responses', 'Version mismatch between auth packages', 0.90, 'haiku', NOW(), 'https://stackoverflow.com/questions/79201800', 'admin:1764222344'),
('Unhandled Promise rejection in async controller method', 'nestjs', 'HIGH', '[{"solution": "Ensure catch blocks re-throw or return proper HttpException", "percentage": 93}, {"solution": "Add process.on(''unhandledRejection'') handler in main.ts", "percentage": 80}]'::jsonb, 'Async/await, exception handling', 'No unhandled rejection warnings', 'Empty catch blocks that silently fail', 0.87, 'haiku', NOW(), 'https://stackoverflow.com/questions/64341200', 'admin:1764222344'),
('Cannot resolve dependency in custom decorator with guard', 'nestjs', 'MEDIUM', '[{"solution": "Use @UseGuards directly on controller, not inside custom decorator", "percentage": 92}, {"solution": "Ensure AuthModule is imported in main module where decorator is used", "percentage": 89}]'::jsonb, 'Custom decorators, guards, modules', 'Dependency injection resolved correctly', 'Nesting UseGuards inside custom decorators', 0.86, 'haiku', NOW(), 'https://stackoverflow.com/questions/55325182', 'admin:1764222344'),
('Validation error message property should not exist', 'nestjs', 'MEDIUM', '[{"solution": "Set Content-Type: application/json in request header", "percentage": 95}, {"solution": "Ensure @Body() DTO matches validation decorators exactly", "percentage": 90}]'::jsonb, 'ValidationPipe, DTOs', 'Correct validation errors for each property', 'Using form-data instead of JSON with ValidationPipe', 0.89, 'haiku', NOW(), 'https://stackoverflow.com/questions/75172699', 'admin:1764222344'),
('Controller route returns 404 on new module', 'nestjs', 'HIGH', '[{"solution": "Verify controller is declared in module''s controllers array", "percentage": 98}, {"solution": "Check @Controller() decorator path matches route", "percentage": 95}]'::jsonb, 'NestJS modules, controllers', 'Route returns 200 with expected response', 'Not registering controller in module or typo in decorator', 0.96, 'haiku', NOW(), 'https://stackoverflow.com/questions/58602306', 'admin:1764222344'),
('Exception filter catching exception thrown by interceptor', 'nestjs', 'MEDIUM', '[{"solution": "Use @Catch(HttpException) in global filter to catch all HTTP errors", "percentage": 93}, {"solution": "Define filter in main.ts with app.useGlobalFilters()", "percentage": 90}]'::jsonb, 'Exception filters, interceptors', 'Exception caught and response formatted correctly', 'Using controller-scoped filters instead of global filters', 0.88, 'haiku', NOW(), 'https://stackoverflow.com/questions/72694776', 'admin:1764222344'),
('SecretOrPrivateKey must have a value JwtModule error', 'nestjs', 'MEDIUM', '[{"solution": "Check ConfigService is injected and returns SECRET_KEY value", "percentage": 95}, {"solution": "Ensure environment variables are loaded before module initialization", "percentage": 92}]'::jsonb, 'JwtModule, ConfigModule', 'JWT tokens sign and verify without error', 'Missing SECRET_KEY in environment or ConfigService not working', 0.91, 'haiku', NOW(), 'https://stackoverflow.com/questions/76466982', 'admin:1764222344'),
('Cannot query across many-to-many relationship TypeORM', 'nestjs', 'MEDIUM', '[{"solution": "Use .leftJoinAndSelect() or .innerJoinAndSelect() for relation loading", "percentage": 95}, {"solution": "Eager load relations in @ManyToMany({eager: true})", "percentage": 88}]'::jsonb, 'TypeORM, relations', 'Related data loads without query errors', 'Trying to query nested relations without proper joins', 0.89, 'haiku', NOW(), 'https://stackoverflow.com/questions/75758069', 'admin:1764222344'),
('Line-break errors (CRLF vs LF) in NestJS', 'nestjs', 'LOW', '[{"solution": "Change VS Code line endings from CRLF to LF in bottom-right corner", "percentage": 99}, {"solution": "Set git config core.safecrlf=false to disable line ending conversion", "percentage": 95}]'::jsonb, 'IDE configuration', 'No line-break related errors in console', 'Using CRLF line endings in project files', 0.97, 'haiku', NOW(), 'https://stackoverflow.com/questions/76985126', 'admin:1764222344'),
('TypeOrm transaction error not caught in service', 'nestjs', 'MEDIUM', '[{"solution": "Wrap transaction in try-catch and throw HttpException on error", "percentage": 94}, {"solution": "Use QueryFailedError catch to handle database transaction rollback", "percentage": 90}]'::jsonb, 'TypeORM transactions', 'Transaction commits or rolls back cleanly', 'Not handling transaction errors in service', 0.88, 'haiku', NOW(), 'https://stackoverflow.com/questions/57055996', 'admin:1764222344'),
('Forbidden exception thrown correctly from controller', 'nestjs', 'HIGH', '[{"solution": "Throw ForbiddenException with message from service", "percentage": 96}, {"solution": "Use authorization guards to check permissions before controller logic", "percentage": 92}]'::jsonb, 'Authorization, guards', 'Returns 403 Forbidden with correct message', 'Not using proper HTTP exception types', 0.94, 'haiku', NOW(), 'https://stackoverflow.com/questions/53869978', 'admin:1764222344'),
('Middleware error handling with bodyparser', 'nestjs', 'MEDIUM', '[{"solution": "Create custom middleware to catch and format bodyParser errors", "percentage": 92}, {"solution": "Use global exception filter to catch and handle JSON parse errors", "percentage": 88}]'::jsonb, 'Express middleware, bodyParser', 'JSON parse errors handled with proper HTTP response', 'Not catching bodyParser errors before they reach routes', 0.85, 'haiku', NOW(), 'https://stackoverflow.com/questions/66644673', 'admin:1764222344'),
('Module initialization order error with dynamic imports', 'nestjs', 'MEDIUM', '[{"solution": "Ensure all dependencies in Module.forRoot() are properly registered", "percentage": 93}, {"solution": "Use onModuleInit() lifecycle hook to initialize after all modules load", "percentage": 90}]'::jsonb, 'Dynamic modules, lifecycle hooks', 'Module initializes in correct order', 'Accessing modules before they''re initialized', 0.87, 'haiku', NOW(), 'https://stackoverflow.com/questions/63257409', 'admin:1764222344'),
('Error: A circular dependency in modules with swagger', 'nestjs', 'MEDIUM', '[{"solution": "Import SwaggerModule after all feature modules are loaded", "percentage": 93}, {"solution": "Use forwardRef() on circular module imports", "percentage": 88}]'::jsonb, 'SwaggerModule, modules', 'Swagger module loads without circular dependency error', 'Importing SwaggerModule before all dependencies', 0.86, 'haiku', NOW(), 'https://stackoverflow.com/questions/60749439', 'admin:1764222344'),
('Custom exception filter not being used for specific error', 'nestjs', 'MEDIUM', '[{"solution": "@Catch(SpecificException) decorator must match exact exception type", "percentage": 94}, {"solution": "Register filter with @UseFilters(CustomFilter) on controller or globally", "percentage": 91}]'::jsonb, 'Exception filters', 'Specific error type handled by custom filter', 'Not matching exception type in @Catch() decorator', 0.89, 'haiku', NOW(), 'https://stackoverflow.com/questions/64442704', 'admin:1764222344'),
('Property decorator not working with dependency injection', 'nestjs', 'MEDIUM', '[{"solution": "Use constructor-based injection instead of property-based @Inject()", "percentage": 95}, {"solution": "Ensure provider is exported from module before injecting elsewhere", "percentage": 92}]'::jsonb, 'Dependency injection, decorators', 'Dependencies resolve correctly through injection', 'Using property decorators instead of constructor parameters', 0.90, 'haiku', NOW(), 'https://stackoverflow.com/questions/74086485', 'admin:1764222344'),
('Global exception filter not catching service errors', 'nestjs', 'HIGH', '[{"solution": "Define @Catch() with no arguments to catch all errors", "percentage": 96}, {"solution": "Register filter globally in app.module with APP_FILTER provider", "percentage": 94}]'::jsonb, 'Exception filters, services', 'All service errors caught by global filter', 'Using @Catch(HttpException) only instead of @Catch()', 0.93, 'haiku', NOW(), 'https://stackoverflow.com/questions/71105331', 'admin:1764222344'),
('Request returns incorrect content-type response', 'nestjs', 'MEDIUM', '[{"solution": "Set response.setHeader(''Content-Type'', ''application/json'') in exception filter", "percentage": 95}, {"solution": "Ensure controller returns proper object, not string", "percentage": 90}]'::jsonb, 'Response handling', 'Response returns with correct Content-Type header', 'Not setting response headers in exception filter', 0.88, 'haiku', NOW(), 'https://stackoverflow.com/questions/50831216', 'admin:1764222344')
ON CONFLICT DO NOTHING;

-- Add ESLint migration guides from official docs
-- Mined from: https://eslint.org/docs/latest/use/migrate-to-8.0.0 and migrate-to-9.0.0

INSERT INTO knowledge_entries (
    query, category, hit_frequency, solutions, prerequisites, success_indicators,
    common_pitfalls, success_rate, claude_version, last_verified, source_url
) VALUES (
    'ESLint 7→8: Node.js 12+ requirement - version no longer supported',
    'eslint-migration',
    'HIGH',
    '[
        {"solution": "Upgrade to Node.js 12.22, 14, or 16+. Check current version with node --version", "percentage": 95, "note": "ESLint v8 drops support for Node.js 10, 13, 15"},
        {"solution": "In CI/CD pipelines, update .node-version or .nvmrc files to supported versions", "percentage": 90, "command": "echo 16 > .nvmrc"},
        {"solution": "If locked to older Node.js, remain on ESLint v7 until upgrade is possible", "percentage": 80, "note": "Use npm install eslint@^7"}
    ]'::jsonb,
    'npm or yarn installed, ESLint v7 project',
    'node --version returns 12.22+, ESLint 8 installs successfully, linting runs without version errors',
    'ESLint v8 will not install on Node.js 10 or 13. Always check Node.js version before upgrading.',
    0.95,
    'sonnet-4',
    NOW(),
    'https://eslint.org/docs/latest/use/migrate-to-8.0.0'
),
(
    'ESLint 7→8: Formatters codeframe and table removed',
    'eslint-migration',
    'MEDIUM',
    '[
        {"solution": "Install formatter packages: npm install --save-dev eslint-formatter-codeframe eslint-formatter-table", "percentage": 95, "note": "Standalone packages replace built-in formatters"},
        {"solution": "Update ESLint config to use formatter: --format=eslint-formatter-codeframe", "percentage": 90, "command": "npx eslint . --format=eslint-formatter-codeframe"},
        {"solution": "For custom formatter output, use eslint-formatter-json and pipe to custom script", "percentage": 80, "note": "Provides more flexibility than built-ins"}
    ]'::jsonb,
    'npm or yarn installed, ESLint v7→8 upgrade in progress',
    'Custom formatter runs without error, Output displays in expected codeframe format',
    'Standalone formatters must be installed as separate dependencies. Built-in formatters are no longer available in v8.',
    0.92,
    'sonnet-4',
    NOW(),
    'https://eslint.org/docs/latest/use/migrate-to-8.0.0'
),
(
    'ESLint 7→8: RuleTester strict - getComments() method deprecated',
    'eslint-migration',
    'MEDIUM',
    '[
        {"solution": "Replace context.getComments() with sourceCode.getCommentsBefore(node), getCommentsAfter(node), or getCommentsInside(node)", "percentage": 95, "note": "RuleTester now fails on old method"},
        {"solution": "Update test cases to use new methods: const comments = sourceCode.getCommentsInside(node)", "percentage": 90, "command": "sourceCode.getCommentsInside(node)"},
        {"solution": "If testing custom rules, verify all rule tests pass with new API before v8 upgrade", "percentage": 85, "note": "Breaking change in test infrastructure"}
    ]'::jsonb,
    'ESLint plugin with custom rules using getComments()',
    'RuleTester runs without errors, Test cases pass with new getComments* methods',
    'getComments() no longer works in RuleTester. Must refactor to getCommentsBefore/After/Inside methods.',
    0.90,
    'sonnet-4',
    NOW(),
    'https://eslint.org/docs/latest/use/migrate-to-8.0.0'
),
(
    'ESLint 7→8: CLIEngine removed - use ESLint class instead',
    'eslint-migration',
    'HIGH',
    '[
        {"solution": "Replace: const { CLIEngine } = require(\"eslint\") with const { ESLint } = require(\"eslint\"); const eslint = new ESLint()", "percentage": 95, "note": "CLIEngine completely removed"},
        {"solution": "Map methods: executeOnFiles() → lintFiles(), executeOnText() → lintText(), getFormatter() → loadFormatter()", "percentage": 93, "command": "const results = await eslint.lintFiles(filePaths)"},
        {"solution": "Use calculateConfigForFile() instead of getConfigForFile()", "percentage": 90, "note": "Async API change - use await"},
        {"solution": "Add async/await wrapper since new ESLint class is promise-based", "percentage": 85, "command": "async function lint() { const eslint = new ESLint(); ... }"}
    ]'::jsonb,
    'Node.js 12.22+, ESLint integration code using CLIEngine',
    'ESLint class instantiates without errors, lintFiles() returns results array, formatter works',
    'CLIEngine is completely removed in v8. Do not attempt polyfills. Refactor to ESLint class with async/await.',
    0.93,
    'sonnet-4',
    NOW(),
    'https://eslint.org/docs/latest/use/migrate-to-8.0.0'
),
(
    'ESLint 8→9: Flat config system is new default - eslintrc deprecated',
    'eslint-migration',
    'VERY_HIGH',
    '[
        {"solution": "Create eslint.config.js file using new flat config format: export default [{ files: [\"**/*.js\"], languageOptions: { parserOptions: { ecmaVersion: 2020 } }, rules: { semi: \"error\" } }]", "percentage": 96, "note": "MAJOR BREAKING CHANGE - flat config is now default"},
        {"solution": "Use ESLint Config Migration Guide: https://eslint.org/docs/latest/use/configure/migration-guide-from-eslintrc", "percentage": 95, "command": "npx eslint --init"},
        {"solution": "If must keep eslintrc, set environment variable: ESLINT_USE_FLAT_CONFIG=false before running eslint", "percentage": 80, "note": "Temporary workaround only - eslintrc will be removed"},
        {"solution": "Install @eslint/js and @eslint/config-inspector for migration tooling", "percentage": 85, "command": "npm install @eslint/js --save-dev"}
    ]'::jsonb,
    'ESLint v8 project, .eslintrc or .eslintrc.json file, Node.js 18.18.0+',
    'eslint.config.js loads without error, ESLint v9 lints files without ESLINT_USE_FLAT_CONFIG workaround needed',
    'Flat config syntax is completely different from eslintrc. Do not try to convert manually - use migration guide. eslintrc will be removed in v10.',
    0.94,
    'sonnet-4',
    NOW(),
    'https://eslint.org/docs/latest/use/migrate-to-9.0.0'
),
(
    'ESLint 8→9: Node.js 18+ requirement - v19.x drops support',
    'eslint-migration',
    'HIGH',
    '[
        {"solution": "Upgrade to Node.js 18.18.0+, 20.9.0+, or 21+. Verify with node --version", "percentage": 95, "note": "v9 drops Node.js 16, 17, all v19.x"},
        {"solution": "In package.json engines field, set: \"engines\": { \"node\": \">=18.18.0\" }", "percentage": 90, "command": "npm pkg set engines.node=\">=18.18.0\""},
        {"solution": "Update CI/CD Node.js version: GitHub Actions uses setup-node action with node-version: 18.18.0", "percentage": 90, "note": "Update .github/workflows files"}
    ]'::jsonb,
    'Node.js currently at v16 or v17, ESLint v8 project',
    'node --version returns 18.18.0+, ESLint v9 installs, linting completes',
    'Node.js 16 and all of 19.x are no longer supported. Verify entire CI/CD pipeline supports minimum Node.js version.',
    0.94,
    'sonnet-4',
    NOW(),
    'https://eslint.org/docs/latest/use/migrate-to-9.0.0'
),
(
    'ESLint 8→9: require-jsdoc and valid-jsdoc rules removed',
    'eslint-migration',
    'HIGH',
    '[
        {"solution": "Replace with eslint-plugin-jsdoc: npm install --save-dev eslint-plugin-jsdoc, then use jsdoc/require-jsdoc", "percentage": 96, "note": "Official replacement plugin"},
        {"solution": "In flat config: import jsdoc from \"eslint-plugin-jsdoc\"; add jsdoc.configs[\"flat/recommended\"]", "percentage": 93, "command": "import jsdoc from \"eslint-plugin-jsdoc\""},
        {"solution": "If no JSDoc enforcement needed, simply remove require-jsdoc and valid-jsdoc rules from config", "percentage": 85, "note": "Project may not need JSDoc validation"}
    ]'::jsonb,
    '.eslintrc or eslint.config.js with require-jsdoc/valid-jsdoc rules, Node.js 18+',
    'ESLint v9 lints without errors for require-jsdoc, JSDoc violations caught by plugin rules',
    'require-jsdoc and valid-jsdoc are completely removed. You MUST use eslint-plugin-jsdoc replacement if you need this rule.',
    0.95,
    'sonnet-4',
    NOW(),
    'https://eslint.org/docs/latest/use/migrate-to-9.0.0'
),
(
    'ESLint 8→9: Context methods moved to sourceCode object',
    'eslint-migration',
    'HIGH',
    '[
        {"solution": "Replace all context methods: context.getSource(node) → sourceCode.getText(node), context.getScope(node) → sourceCode.getScope(node)", "percentage": 96, "note": "20+ context methods migrated to sourceCode"},
        {"solution": "Update rule implementations: getSource(), getFilename(), getSourceCode() all move to sourceCode parameter", "percentage": 93, "command": "create(context) { const sourceCode = context.sourceCode; return { ... } }"},
        {"solution": "For parent access: context.getParent() → sourceCode.getAncestors(node)[sourceCode.getAncestors(node).length - 1]", "percentage": 85, "note": "Use getAncestors() array indexing"}
    ]'::jsonb,
    'Custom ESLint rules using context API, Node.js 18+',
    'Rules run without sourceCode method errors, Custom rules execute correctly in v9',
    'All context methods removed from plugin rule API. Context now only provides sourceCode. Refactor all method calls immediately.',
    0.92,
    'sonnet-4',
    NOW(),
    'https://eslint.org/docs/latest/use/migrate-to-9.0.0'
),
(
    'ESLint 8→9: no-unused-vars caughtErrors defaults to \"all\" (was \"none\")',
    'eslint-migration',
    'MEDIUM',
    '[
        {"solution": "To maintain v8 behavior, explicitly set caughtErrors: \"none\" in rule options: { caughtErrors: \"none\" }", "percentage": 95, "note": "Default changed from \"none\" to \"all\""},
        {"solution": "If warnings on unused catch parameters desired, remove caughtErrors option to use new \"all\" default", "percentage": 85, "note": "More strict than v8"},
        {"solution": "In flat config: rules: { \"no-unused-vars\": [\"error\", { caughtErrors: \"none\" }] }", "percentage": 90, "command": "{ caughtErrors: \"none\" }"}
    ]'::jsonb,
    'ESLint v8 config with no-unused-vars rule, migrating to v9',
    'Linting runs with expected no-unused-vars errors, Catch bindings handled per config option',
    'Default for caughtErrors changed. Projects relying on old \"none\" default will see new warnings on unused catch parameters.',
    0.91,
    'sonnet-4',
    NOW(),
    'https://eslint.org/docs/latest/use/migrate-to-9.0.0'
),
(
    'ESLint 8→9: FlatRuleTester replaces RuleTester in v9',
    'eslint-migration',
    'MEDIUM',
    '[
        {"solution": "Change import: const { FlatRuleTester } = require(\"eslint\") becomes const { RuleTester } = require(\"eslint\")", "percentage": 96, "note": "FlatRuleTester is now the only RuleTester"},
        {"solution": "Update test config format to use flat config: new RuleTester({ languageOptions: { ecmaVersion: 2020 } })", "percentage": 93, "command": "new RuleTester({ languageOptions: { ecmaVersion: 2020 } })"},
        {"solution": "RuleTester validation now stricter: test output must differ from input, suggestions must be fully defined", "percentage": 90, "note": "11 new validation rules added"}
    ]'::jsonb,
    'ESLint plugin test suite using RuleTester, Node.js 18+',
    'Tests run with new RuleTester without validation errors, All test cases pass with flat config format',
    'Old RuleTester completely removed. FlatRuleTester is now THE RuleTester. Test validation is much stricter in v9.',
    0.90,
    'sonnet-4',
    NOW(),
    'https://eslint.org/docs/latest/use/migrate-to-9.0.0'
),
(
    'ESLint 8→9: Seven formatters moved to separate npm packages',
    'eslint-migration',
    'MEDIUM',
    '[
        {"solution": "Removed formatters: checkstyle, compact, jslint-xml, junit, tap, unix, visualstudio. Install as packages: npm install --save-dev @eslint/formatter-checkstyle", "percentage": 94, "note": "All moved to @eslint/* namespace"},
        {"solution": "Update format flag: --format=checkstyle becomes --format=@eslint/formatter-checkstyle", "percentage": 92, "command": "npx eslint . --format=@eslint/formatter-checkstyle"},
        {"solution": "In CI/CD: install formatters before running ESLint, update all formatter references", "percentage": 88, "note": "Check all npm scripts and CI configuration"}
    ]'::jsonb,
    'ESLint v8 using any of 7 removed formatters, Node.js 18+',
    'Custom formatter package installs, eslint --format works with new package names',
    'All 7 removed formatters must be installed separately. Check every ESLint invocation for formatter flags.',
    0.91,
    'sonnet-4',
    NOW(),
    'https://eslint.org/docs/latest/use/migrate-to-9.0.0'
),
(
    'ESLint 8→9: Shorthand property AST - key and value now separate objects',
    'eslint-migration',
    'LOW',
    '[
        {"solution": "In shorthand object properties: stop using key === value comparison. Instead check propertyNode.shorthand property", "percentage": 94, "note": "Breaking change in AST structure for plugins"},
        {"solution": "If comparing node identity, use node.range comparison instead of === operator", "percentage": 88, "command": "propertyNode.key.range === propertyNode.value.range"},
        {"solution": "For plugin rules analyzing shorthand props: add explicit shorthand property check: if (node.shorthand) { ... }", "percentage": 85, "note": "Safer than relying on object identity"}
    ]'::jsonb,
    'ESLint plugin with custom rules analyzing object properties, Node.js 18+',
    'Plugin rules correctly identify shorthand properties without errors, AST traversal works with new structure',
    'In shorthand properties, key and value are now separate objects. Old identity checks with === will fail. Use .shorthand flag.',
    0.88,
    'sonnet-4',
    NOW(),
    'https://eslint.org/docs/latest/use/migrate-to-9.0.0'
);

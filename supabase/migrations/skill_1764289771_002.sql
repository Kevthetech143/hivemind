INSERT INTO knowledge_entries (query, category, type, solutions, executable_type, prerequisites, common_pitfalls, success_indicators, preview_summary, source_url, contributor_email)
VALUES (
  'GitOps Workflow - Implement GitOps workflows with ArgoCD and Flux for automated, declarative Kubernetes deployments with continuous reconciliation',
  'claude-code',
  'skill',
  '[{"solution": "ArgoCD Installation and Setup", "cli": {"macos": "kubectl create namespace argocd && kubectl apply -n argocd -f https://raw.githubusercontent.com/argoproj/argo-cd/stable/manifests/install.yaml", "linux": "kubectl create namespace argocd && kubectl apply -n argocd -f https://raw.githubusercontent.com/argoproj/argo-cd/stable/manifests/install.yaml", "windows": "kubectl create namespace argocd && kubectl apply -n argocd -f https://raw.githubusercontent.com/argoproj/argo-cd/stable/manifests/install.yaml" }, "manual": "Create argocd namespace then apply the official manifests. Get initial password with: kubectl -n argocd get secret argocd-initial-admin-secret -o jsonpath=\"{.data.password}\" | base64 -d. Access UI via port-forward on port 8080.", "note": "Use ha/install.yaml manifest for high availability setup in production" }, {"solution": "Create ArgoCD Application", "cli": {"macos": "kubectl apply -f - <<EOF\napiVersion: argoproj.io/v1alpha1\nkind: Application\nmetadata:\n  name: my-app\n  namespace: argocd\nspec:\n  project: default\n  source:\n    repoURL: https://github.com/org/gitops-repo\n    targetRevision: main\n    path: apps/production/my-app\n  destination:\n    server: https://kubernetes.default.svc\n    namespace: production\n  syncPolicy:\n    automated:\n      prune: true\n      selfHeal: true\nEOF", "linux": "kubectl apply -f - <<EOF\napiVersion: argoproj.io/v1alpha1\nkind: Application\nmetadata:\n  name: my-app\n  namespace: argocd\nspec:\n  project: default\n  source:\n    repoURL: https://github.com/org/gitops-repo\n    targetRevision: main\n    path: apps/production/my-app\n  destination:\n    server: https://kubernetes.default.svc\n    namespace: production\n  syncPolicy:\n    automated:\n      prune: true\n      selfHeal: true\nEOF", "windows": "kubectl apply -f - <<EOF\napiVersion: argoproj.io/v1alpha1\nkind: Application\nmetadata:\n  name: my-app\n  namespace: argocd\nspec:\n  project: default\n  source:\n    repoURL: https://github.com/org/gitops-repo\n    targetRevision: main\n    path: apps/production/my-app\n  destination:\n    server: https://kubernetes.default.svc\n    namespace: production\n  syncPolicy:\n    automated:\n      prune: true\n      selfHeal: true\nEOF" }, "manual": "Define an Application manifest specifying git repo, branch, path, and destination cluster/namespace. Enable automated sync with prune: true to delete removed resources and selfHeal: true to reconcile manual changes. Use App of Apps pattern to manage multiple applications.", "note": "Applications pull desired state from Git and reconcile continuously" }, {"solution": "Flux CD Bootstrap and Setup", "cli": {"macos": "curl -s https://fluxcd.io/install.sh | sudo bash && flux bootstrap github --owner=org --repository=gitops-repo --branch=main --path=clusters/production --personal", "linux": "curl -s https://fluxcd.io/install.sh | sudo bash && flux bootstrap github --owner=org --repository=gitops-repo --branch=main --path=clusters/production --personal", "windows": "curl -s https://fluxcd.io/install.sh | sudo bash && flux bootstrap github --owner=org --repository=gitops-repo --branch=main --path=clusters/production --personal" }, "manual": "Install Flux CLI then bootstrap Flux on cluster with GitHub OAuth token. This installs Flux controllers and creates GitRepository resource pointing to your repo. Flux continuously watches repo and applies changes.", "note": "Bootstrap requires GitHub personal access token with repo access" }, {"solution": "Create Flux GitRepository and Kustomization", "cli": {"macos": "kubectl apply -f - <<EOF\napiVersion: source.toolkit.fluxcd.io/v1\nkind: GitRepository\nmetadata:\n  name: my-app\n  namespace: flux-system\nspec:\n  interval: 1m\n  url: https://github.com/org/my-app\n  ref:\n    branch: main\n---\napiVersion: kustomize.toolkit.fluxcd.io/v1\nkind: Kustomization\nmetadata:\n  name: my-app\n  namespace: flux-system\nspec:\n  interval: 5m\n  path: ./deploy\n  prune: true\n  sourceRef:\n    kind: GitRepository\n    name: my-app\nEOF", "linux": "kubectl apply -f - <<EOF\napiVersion: source.toolkit.fluxcd.io/v1\nkind: GitRepository\nmetadata:\n  name: my-app\n  namespace: flux-system\nspec:\n  interval: 1m\n  url: https://github.com/org/my-app\n  ref:\n    branch: main\n---\napiVersion: kustomize.toolkit.fluxcd.io/v1\nkind: Kustomization\nmetadata:\n  name: my-app\n  namespace: flux-system\nspec:\n  interval: 5m\n  path: ./deploy\n  prune: true\n  sourceRef:\n    kind: GitRepository\n    name: my-app\nEOF", "windows": "kubectl apply -f - <<EOF\napiVersion: source.toolkit.fluxcd.io/v1\nkind: GitRepository\nmetadata:\n  name: my-app\n  namespace: flux-system\nspec:\n  interval: 1m\n  url: https://github.com/org/my-app\n  ref:\n    branch: main\n---\napiVersion: kustomize.toolkit.fluxcd.io/v1\nkind: Kustomization\nmetadata:\n  name: my-app\n  namespace: flux-system\nspec:\n  interval: 5m\n  path: ./deploy\n  prune: true\n  sourceRef:\n    kind: GitRepository\n    name: my-app\nEOF" }, "manual": "Define GitRepository to point to your app repo with pull interval. Create Kustomization to apply resources from specified path at regular intervals. Set prune: true to remove resources not in Git. sourceRef links Kustomization to GitRepository.", "note": "Flux reconciliation interval determines how often changes are applied" }, {"solution": "Configure Sync Policies and Retry", "cli": {"macos": "argocd app set my-app --sync-policy automated --auto-prune --self-heal && argocd app set my-app --retry-limit 5 --retry-backoff-duration 5s --retry-backoff-factor 2 --retry-backoff-maxduration 3m", "linux": "argocd app set my-app --sync-policy automated --auto-prune --self-heal && argocd app set my-app --retry-limit 5 --retry-backoff-duration 5s --retry-backoff-factor 2 --retry-backoff-maxduration 3m", "windows": "argocd app set my-app --sync-policy automated --auto-prune --self-heal && argocd app set my-app --retry-limit 5 --retry-backoff-duration 5s --retry-backoff-factor 2 --retry-backoff-maxduration 3m" }, "manual": "Configure retry limits with exponential backoff for failed syncs. Set prune: true to delete removed resources. Use syncWindows to restrict syncs to specific times (e.g., business hours). Enable selfHeal to reconcile manual changes automatically.", "note": "Retry backoff prevents thundering herd of sync attempts" }, {"solution": "Implement Canary and Blue-Green Deployments", "cli": {"macos": "kubectl apply -f - <<EOF\napiVersion: argoproj.io/v1alpha1\nkind: Rollout\nmetadata:\n  name: my-app\nspec:\n  replicas: 5\n  strategy:\n    canary:\n      steps:\n      - setWeight: 20\n      - pause: {duration: 1m}\n      - setWeight: 50\n      - pause: {duration: 2m}\n      - setWeight: 100\nEOF", "linux": "kubectl apply -f - <<EOF\napiVersion: argoproj.io/v1alpha1\nkind: Rollout\nmetadata:\n  name: my-app\nspec:\n  replicas: 5\n  strategy:\n    canary:\n      steps:\n      - setWeight: 20\n      - pause: {duration: 1m}\n      - setWeight: 50\n      - pause: {duration: 2m}\n      - setWeight: 100\nEOF", "windows": "kubectl apply -f - <<EOF\napiVersion: argoproj.io/v1alpha1\nkind: Rollout\nmetadata:\n  name: my-app\nspec:\n  replicas: 5\n  strategy:\n    canary:\n      steps:\n      - setWeight: 20\n      - pause: {duration: 1m}\n      - setWeight: 50\n      - pause: {duration: 2m}\n      - setWeight: 100\nEOF" }, "manual": "Use ArgoCD Rollouts for progressive delivery. Canary gradually shifts traffic (20% -> 50% -> 100%) with pauses between steps. Blue-green swaps active and preview services. Define in Git, commit, and ArgoCD applies the Rollout resource automatically.", "note": "Rollouts are safer than direct Deployments for production changes" }, {"solution": "Manage Secrets with External Secrets Operator", "cli": {"macos": "kubectl apply -f - <<EOF\napiVersion: external-secrets.io/v1beta1\nkind: ExternalSecret\nmetadata:\n  name: db-credentials\nspec:\n  refreshInterval: 1h\n  secretStoreRef:\n    name: aws-secrets-manager\n    kind: SecretStore\n  target:\n    name: db-credentials\n  data:\n  - secretKey: password\n    remoteRef:\n      key: prod/db/password\nEOF", "linux": "kubectl apply -f - <<EOF\napiVersion: external-secrets.io/v1beta1\nkind: ExternalSecret\nmetadata:\n  name: db-credentials\nspec:\n  refreshInterval: 1h\n  secretStoreRef:\n    name: aws-secrets-manager\n    kind: SecretStore\n  target:\n    name: db-credentials\n  data:\n  - secretKey: password\n    remoteRef:\n      key: prod/db/password\nEOF", "windows": "kubectl apply -f - <<EOF\napiVersion: external-secrets.io/v1beta1\nkind: ExternalSecret\nmetadata:\n  name: db-credentials\nspec:\n  refreshInterval: 1h\n  secretStoreRef:\n    name: aws-secrets-manager\n    kind: SecretStore\n  target:\n    name: db-credentials\n  data:\n  - secretKey: password\n    remoteRef:\n      key: prod/db/password\nEOF" }, "manual": "Use External Secrets Operator to sync secrets from AWS Secrets Manager, Vault, or other backends. Define ExternalSecret manifests in Git, specify refresh interval, and let operator handle syncing. Never commit secrets directly to Git.", "note": "External Secrets allow GitOps with security - secrets stay out of Git repos" }]'::jsonb,
  'script',
  'Kubernetes cluster running. kubectl configured. Git repository for infrastructure code. ArgoCD or Flux CD not yet installed.',
  'Putting secrets in Git repositories. Using manual sync for large production clusters. Neglecting to implement RBAC on Git repositories. Not configuring retry policies for reliability. Forgetting prune settings cause orphaned resources. Not monitoring sync status.',
  'ArgoCD successfully syncs applications from Git. Flux continuously reconciles cluster state with Git. Failed syncs retry with exponential backoff. Manual changes are automatically corrected. Canary deployments proceed through stages. Secrets managed externally and refreshed periodically.',
  'Implement GitOps workflows for automated Kubernetes deployments with declarative infrastructure management and continuous reconciliation',
  'https://skillsmp.com/skills/wshobson-agents-plugins-kubernetes-operations-skills-gitops-workflow-skill-md',
  'admin:HAIKU_SKILL_1764289714_96235'
);

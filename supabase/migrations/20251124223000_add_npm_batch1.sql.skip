-- Add npm error documentation batch 1
-- Mined from official npm docs and verified community solutions
-- Date: 2024-11-24

INSERT INTO knowledge_entries (
    query, category, hit_frequency, solutions, prerequisites, success_indicators,
    common_pitfalls, success_rate, claude_version, last_verified, source_url
) VALUES (
    'npm ERR! code EACCES: permission denied, access ''/usr/local/lib/node_modules''',
    'npm',
    'VERY_HIGH',
    '[
        {"solution": "Use a Node Version Manager (nvm) to avoid permission issues entirely - install nvm, then reinstall Node.js via nvm", "percentage": 95, "note": "Official npm recommended approach, prevents future permission problems"},
        {"solution": "Change npm default directory to user-owned location: mkdir ~/.npm-global && npm config set prefix ''~/.npm-global'' && add ~/.npm-global/bin to PATH", "percentage": 90, "note": "Reconfigures npm to use directory you own"},
        {"solution": "Fix ownership of existing npm directory: sudo chown -R $(whoami) /usr/local/lib/node_modules", "percentage": 80, "note": "Quick fix but may cause issues with system-wide installations"}
    ]'::jsonb,
    'Command-line access, User account name known, Node.js and npm installed',
    'Global packages install without sudo, npm install -g works, No EACCES errors in output',
    'Never use sudo with npm commands - creates persistent permission issues. Avoid changing system directory permissions. Do not run npm as root.',
    0.92,
    'sonnet-4',
    NOW(),
    'https://docs.npmjs.com/resolving-eacces-permissions-errors-when-installing-packages-globally/'
),
(
    'npm ERR! code ERESOLVE: unable to resolve dependency tree',
    'npm',
    'VERY_HIGH',
    '[
        {"solution": "Update package.json to use compatible version ranges, then run npm install", "percentage": 90, "note": "Proper resolution - fixes root cause"},
        {"solution": "Use --legacy-peer-deps flag: npm install --legacy-peer-deps", "percentage": 85, "note": "Uses npm 6 algorithm, safer than --force"},
        {"solution": "Clear cache and reinstall: npm cache clean --force && rm -rf node_modules package-lock.json && npm install", "percentage": 75, "note": "May resolve transient conflicts"},
        {"solution": "Use --force flag as last resort: npm install --force", "percentage": 60, "note": "Bypasses all safety checks, use with caution"}
    ]'::jsonb,
    'package.json file exists, Node.js 16+ (npm 7+), Understanding of semantic versioning',
    'npm install completes without errors, Application runs without compatibility issues, All dependencies in node_modules',
    'Starting npm 7, peer dependencies became stricter - what were warnings in npm 6 are now errors. --force bypasses ALL checks (dangerous), --legacy-peer-deps only relaxes peer deps. Always prefer fixing package.json over using flags.',
    0.88,
    'sonnet-4',
    NOW(),
    'https://docs.npmjs.com/cli/v8/commands/npm-install'
),
(
    'npm ERR! code E404: Package not found',
    'npm',
    'HIGH',
    '[
        {"solution": "Check npm registry status at status.npmjs.org and retry after temporary outage", "percentage": 85, "note": "Most common cause is temporary registry issues"},
        {"solution": "Verify package name spelling and check if package exists on npmjs.com", "percentage": 90, "note": "Typos are very common"},
        {"solution": "Clear npm cache: npm cache clean --force, then retry installation", "percentage": 80, "note": "Stale cache can cause 404s"},
        {"solution": "Check for local .npmrc file overriding registry URL - delete if incorrect", "percentage": 85, "command": "cat .npmrc to inspect, rm .npmrc to remove"},
        {"solution": "For private packages: verify authentication with npm login and check access permissions", "percentage": 90, "note": "Private packages require proper credentials"}
    ]'::jsonb,
    'Internet connection active, Package name known, npm configured',
    'Package downloads successfully, npm install completes, Package appears in node_modules',
    'Package may be unpublished or never existed. Check exact package name on npmjs.com. Local .npmrc files can override global registry. Private packages require authentication even if logged in globally.',
    0.87,
    'sonnet-4',
    NOW(),
    'https://docs.npmjs.com/common-errors/'
),
(
    'npm ERR! code ETARGET: No matching version found',
    'npm',
    'HIGH',
    '[
        {"solution": "Check available versions: npm view <package> versions, then install valid version", "percentage": 95, "command": "npm view package-name versions"},
        {"solution": "Install latest version: npm install <package>@latest", "percentage": 90, "note": "Bypasses specific version requirements"},
        {"solution": "Clear npm cache: npm cache clean --force, then retry", "percentage": 85, "note": "Stale cache may not reflect new versions"},
        {"solution": "Verify package spelling and correct typos in package.json", "percentage": 90, "note": "Common cause of version not found errors"}
    ]'::jsonb,
    'Package exists on npm registry, Internet connection active, npm installed',
    'npm install succeeds, Correct version installed in node_modules, package-lock.json updated',
    'Check for typos in version strings. Use ^ or ~ for flexible version ranges. Cache may be outdated after package publish. Version syntax errors (missing dots, wrong format) cause this error.',
    0.92,
    'sonnet-4',
    NOW(),
    'https://docs.npmjs.com/cli/v8/commands/npm-install'
),
(
    'npm ERR! code EBADPLATFORM: Unsupported platform',
    'npm',
    'MEDIUM',
    '[
        {"solution": "Check if package is optional dependency - if warning (not error), safely ignore for platform-specific packages like fsevents", "percentage": 95, "note": "fsevents only works on macOS, automatically skipped elsewhere"},
        {"solution": "Move platform-specific packages from dependencies to optionalDependencies in package.json", "percentage": 90, "note": "Prevents install failures on unsupported platforms"},
        {"solution": "Delete node_modules and package-lock.json, then npm install to let npm handle platform detection", "percentage": 85, "note": "Fresh install respects platform constraints"},
        {"solution": "For required cross-platform functionality, find alternative packages that support your OS", "percentage": 80, "note": "Some packages only support specific operating systems"}
    ]'::jsonb,
    'package.json exists, Operating system identified, Understanding of package platform requirements',
    'npm install completes, Only platform-compatible packages installed, Application runs without missing dependencies',
    'fsevents (macOS file watcher) commonly triggers this - it is optional, ignore warnings. Packages in dependencies must support all platforms. Use optionalDependencies for platform-specific packages. Some packages like ''n'' explicitly exclude Windows.',
    0.90,
    'sonnet-4',
    NOW(),
    'https://docs.npmjs.com/cli/v8/configuring-npm/package-json'
),
(
    'npm ERR! code ENOENT: no such file or directory',
    'npm',
    'HIGH',
    '[
        {"solution": "Ensure you are in correct directory with package.json - use cd to navigate to project root", "percentage": 95, "note": "Most common cause - running npm commands outside project directory"},
        {"solution": "Initialize new project: npm init to create package.json", "percentage": 90, "note": "If package.json does not exist"},
        {"solution": "Delete corrupted node_modules and package-lock.json, then npm install", "percentage": 85, "note": "Fixes corrupted state"},
        {"solution": "Check file path length (Windows) - move project to shorter path if exceeding 260 characters", "percentage": 75, "note": "Windows path length limitation"}
    ]'::jsonb,
    'Terminal/command prompt access, Project directory exists, File system permissions',
    'npm commands execute without ENOENT errors, package.json found and read successfully, Dependencies install correctly',
    'Always run npm commands from directory containing package.json. Windows has 260-character path limit. Corrupted node_modules causes this. Missing package.json triggers this immediately.',
    0.93,
    'sonnet-4',
    NOW(),
    'https://docs.npmjs.com/cli/v8/commands/npm-install'
),
(
    'npm ERR! code ELIFECYCLE: script failed',
    'npm',
    'HIGH',
    '[
        {"solution": "Delete node_modules and package-lock.json, clear cache with npm cache clean --force, then npm install", "percentage": 90, "note": "Fixes corrupted dependencies state"},
        {"solution": "Check package.json scripts section for typos or missing commands", "percentage": 85, "note": "Verify script command is correct"},
        {"solution": "Ensure sufficient system memory - check with task manager/htop and close other applications", "percentage": 80, "note": "Memory issues cause script failures"},
        {"solution": "Verify all required dependencies are installed: npm install", "percentage": 85, "note": "Missing dependencies cause script failures"},
        {"solution": "Check error log for underlying issue - npm script exit with non-zero code indicates actual problem", "percentage": 95, "note": "ELIFECYCLE is wrapper - real error is in log"}
    ]'::jsonb,
    'package.json exists with scripts section, Node.js installed, Sufficient system resources',
    'npm script executes successfully, Process exits with code 0, Expected output produced',
    'ELIFECYCLE is not the root cause - it signals another error occurred. Check full error log for actual issue. Corrupted node_modules is most common cause. Memory limitations trigger this. Script typos in package.json cause immediate failures.',
    0.88,
    'sonnet-4',
    NOW(),
    'https://docs.npmjs.com/cli/v8/commands/npm-run-script'
),
(
    'npm ERR! code EEXIST: file already exists',
    'npm',
    'MEDIUM',
    '[
        {"solution": "Clear npm cache: npm cache clean --force, then retry installation", "percentage": 90, "note": "Cache corruption is common cause"},
        {"solution": "Delete node_modules and .staging directories, then npm install", "percentage": 85, "note": "Staging conflicts from interrupted installs"},
        {"solution": "Use --force flag: npm install --force to overwrite existing files", "percentage": 75, "note": "Reckless but works when other methods fail"},
        {"solution": "For global install conflicts: npm uninstall -g <package> then reinstall", "percentage": 80, "note": "Removes conflicting global package"}
    ]'::jsonb,
    'npm installed, Write permissions in project directory, Network connection for registry access',
    'npm install completes without errors, Packages installed in node_modules, No EEXIST errors in output',
    'Common in CI environments especially Windows GitHub Actions. Interrupted npm install leaves .staging directory. Cache corruption causes false positives. Using --force overwrites files without safety checks.',
    0.85,
    'sonnet-4',
    NOW(),
    'https://docs.npmjs.com/cli/v8/commands/npm-install'
),
(
    'npm ERR! code ENOTFOUND: getaddrinfo ENOTFOUND registry.npmjs.org',
    'npm',
    'HIGH',
    '[
        {"solution": "Check npm registry status at status.npmjs.org - wait if registry is down", "percentage": 85, "note": "Official npm recommended first step"},
        {"solution": "Set registry explicitly: npm config set registry https://registry.npmjs.org/", "percentage": 90, "note": "Fixes incorrect registry configuration"},
        {"solution": "Configure proxy if behind corporate firewall: npm config set proxy http://proxy.company.com:8080 && npm config set https-proxy http://proxy.company.com:8080", "percentage": 85, "note": "Required for corporate networks"},
        {"solution": "Clear DNS cache - Windows: ipconfig /flushdns, macOS: sudo dscacheutil -flushcache, Linux: sudo systemd-resolve --flush-caches", "percentage": 80, "command": "OS-specific DNS flush command"},
        {"solution": "Temporarily disable VPN and retry", "percentage": 75, "note": "VPN can block npm registry access"}
    ]'::jsonb,
    'Internet connection active, npm installed, Network configuration access',
    'npm can reach registry, npm install completes, Packages download successfully',
    'Most common cause is proxy misconfiguration. VPN/firewall can block registry. DNS issues cause ENOTFOUND. Corporate networks require proxy settings. Check npm config list for current registry setting.',
    0.87,
    'sonnet-4',
    NOW(),
    'https://docs.npmjs.com/common-errors/'
),
(
    'npm ERR! code EINTEGRITY: integrity checksum failed',
    'npm',
    'HIGH',
    '[
        {"solution": "Clear cache and verify: npm cache clean --force && npm cache verify, then npm install", "percentage": 95, "note": "Official solution for checksum mismatches"},
        {"solution": "Delete package-lock.json and reinstall: rm package-lock.json && npm install", "percentage": 90, "note": "Generates fresh lock file with correct checksums"},
        {"solution": "Complete cleanup: rm -rf node_modules package-lock.json && npm cache clean --force && npm install", "percentage": 95, "note": "Universal solution for integrity errors"},
        {"solution": "If specific package fails: manually update integrity value in package-lock.json from error message", "percentage": 70, "note": "Surgical fix if you need to keep lock file"}
    ]'::jsonb,
    'package-lock.json exists, Internet connection stable, npm 5+ installed',
    'npm install completes without integrity errors, All packages verify successfully, Application runs correctly',
    'Caused by corrupt cache or network issues during download. Package-lock.json stores expected checksums - mismatch means downloaded file differs. Network interruptions cause this. Registry CDN issues can serve corrupt files. Never manually edit integrity without verifying actual package.',
    0.93,
    'sonnet-4',
    NOW(),
    'https://docs.npmjs.com/cli/v8/commands/npm-cache'
),
(
    'npm peer dependency conflict: package expects different version',
    'npm',
    'VERY_HIGH',
    '[
        {"solution": "Update dependencies to compatible versions - check npm view <package> peerDependencies to see requirements", "percentage": 90, "note": "Proper solution addressing root cause", "command": "npm view package-name peerDependencies"},
        {"solution": "Use --legacy-peer-deps: npm install --legacy-peer-deps", "percentage": 85, "note": "Uses npm 6 behavior, safer than --force"},
        {"solution": "Add resolutions field to package.json (Yarn-style) or overrides field (npm 8.3+)", "percentage": 80, "note": "Forces specific versions across dependency tree"},
        {"solution": "Install peer dependencies manually: npm install <peer-dep>@<version>", "percentage": 85, "note": "Satisfies peer dependency requirements explicitly"}
    ]'::jsonb,
    'npm 7+ installed (stricter peer deps), package.json exists, Understanding of semantic versioning',
    'npm install completes, No peer dependency warnings, Application functions correctly with installed versions',
    'npm 7+ made peer dependencies strict - npm 6 only warned. Multiple packages may require incompatible versions of same peer dependency. --force is dangerous, use --legacy-peer-deps instead. Check if updating parent package resolves conflict. overrides field requires npm 8.3+.',
    0.87,
    'sonnet-4',
    NOW(),
    'https://docs.npmjs.com/cli/v8/configuring-npm/package-json'
),
(
    'npm WARN deprecated: package is deprecated',
    'nodejs',
    'MEDIUM',
    '[
        {"solution": "Update to recommended alternative package - check deprecation message for replacement suggestion", "percentage": 95, "note": "Deprecation message usually names replacement"},
        {"solution": "Update parent package that depends on deprecated package: npm update <parent-package>", "percentage": 85, "note": "Newer versions may not use deprecated dependency"},
        {"solution": "Check npm audit for security vulnerabilities: npm audit, then npm audit fix", "percentage": 90, "command": "npm audit fix"},
        {"solution": "If no alternative exists and package still works, document technical debt for future migration", "percentage": 70, "note": "Temporary measure only"}
    ]'::jsonb,
    'package.json exists, npm installed, Ability to modify dependencies',
    'No deprecation warnings in npm output, Updated packages function correctly, npm audit shows no deprecated packages',
    'Deprecation is warning, not error - app still works but package is unmaintained. Security vulnerabilities likely in deprecated packages. Transitive dependencies can be deprecated even if direct deps are not. Run npm ls <package> to see dependency tree.',
    0.88,
    'sonnet-4',
    NOW(),
    'https://docs.npmjs.com/cli/v8/commands/npm-deprecate'
);

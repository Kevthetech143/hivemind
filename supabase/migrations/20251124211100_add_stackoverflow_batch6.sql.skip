-- Add Stack Overflow solutions batch 6: React, TypeScript, localhost, permissions
-- Source: Stack Overflow accepted answers with community verification

-- React: Unable to resolve dependency tree
INSERT INTO knowledge_entries (
    query, category, hit_frequency, solutions, prerequisites, success_indicators,
    common_pitfalls, success_rate, claude_version, last_verified, source_url
) VALUES (
    'React npm install: Unable to resolve dependency tree',
    'react',
    'VERY_HIGH',
    '[
        {"solution": "Use --legacy-peer-deps: npm install --legacy-peer-deps", "percentage": 90, "note": "Bypass peer dependency conflicts"},
        {"solution": "Use --force flag: npm install --force", "percentage": 80, "note": "Accept potentially broken dependencies"},
        {"solution": "Downgrade to npm 6: npm install -g npm@6", "percentage": 75, "note": "npm 7+ enforces strict peer deps"}
    ]'::jsonb,
    'npm 7+ installed, React project with dependency conflicts',
    'Dependencies install successfully, npm install completes without errors',
    'npm 7+ enforces peer dependencies strictly. React ecosystem often has mismatched versions. --legacy-peer-deps is safer than --force.',
    0.90,
    'sonnet-4',
    NOW(),
    'https://stackoverflow.com/questions/64718633/'
);

-- React: Uninstall create-react-app
INSERT INTO knowledge_entries (
    query, category, hit_frequency, solutions, prerequisites, success_indicators,
    common_pitfalls, success_rate, claude_version, last_verified, source_url, pattern_id
) VALUES (
    'create-react-app error: global installation outdated',
    'react',
    'HIGH',
    '[
        {"solution": "Uninstall global create-react-app: npm uninstall -g create-react-app", "percentage": 95, "command": "npm uninstall -g create-react-app", "note": "Remove outdated global version"},
        {"solution": "Clear npm cache: npm cache clean --force", "percentage": 85, "command": "npm cache clean --force"},
        {"solution": "Use npx directly: npx create-react-app@latest my-app", "percentage": 90, "note": "Always uses latest version"}
    ]'::jsonb,
    'npm installed, Outdated global create-react-app',
    'npx create-react-app works without version warnings, Latest React version created',
    'Global create-react-app installations become outdated. Always use npx to get latest version. Uninstall global version.',
    0.95,
    'sonnet-4',
    NOW(),
    'https://stackoverflow.com/questions/72258091/',
    (SELECT id FROM patterns WHERE pattern_name = 'VERSION_REGRESSION')
);

-- TypeScript: Catch clause variable type unknown
INSERT INTO knowledge_entries (
    query, category, hit_frequency, solutions, prerequisites, success_indicators,
    common_pitfalls, success_rate, claude_version, last_verified, source_url
) VALUES (
    'TypeScript catch clause error type unknown',
    'typescript',
    'HIGH',
    '[
        {"solution": "Use type guard: catch (e: unknown) { if (e instanceof Error) { e.message } }", "percentage": 90, "note": "TypeScript 4.4+ default"},
        {"solution": "Type assert: catch (e) { const error = e as Error; }", "percentage": 80, "note": "Less safe than type guard"},
        {"solution": "Enable useUnknownInCatchVariables: false in tsconfig.json", "percentage": 70, "note": "Revert to old behavior (not recommended)"}
    ]'::jsonb,
    'TypeScript 4.4+, tsconfig.json',
    'No type errors in catch blocks, Code compiles successfully',
    'TypeScript 4.4+ makes catch variable unknown by default for safety. Use instanceof Error to narrow type.',
    0.90,
    'sonnet-4',
    NOW(),
    'https://stackoverflow.com/questions/54649465/'
);

-- TypeScript: Extending Error class
INSERT INTO knowledge_entries (
    query, category, hit_frequency, solutions, prerequisites, success_indicators,
    common_pitfalls, success_rate, claude_version, last_verified, source_url
) VALUES (
    'TypeScript custom Error class instanceof broken',
    'typescript',
    'MEDIUM',
    '[
        {"solution": "Set prototype explicitly: Object.setPrototypeOf(this, MyError.prototype) in constructor", "percentage": 90, "note": "Fix instanceof check"},
        {"solution": "Use new.target.prototype: Object.setPrototypeOf(this, new.target.prototype)", "percentage": 85, "note": "Works for inherited errors too"},
        {"solution": "Transpile to ES2015+: set target: \"ES2015\" in tsconfig.json", "percentage": 75, "note": "Modern targets don''t need fix"}
    ]'::jsonb,
    'TypeScript project, Custom error class extending Error',
    'instanceof MyError works correctly, Custom error properties accessible',
    'TypeScript transpiles classes to functions for ES5. This breaks Error.prototype chain. Fix with Object.setPrototypeOf.',
    0.90,
    'sonnet-4',
    NOW(),
    'https://stackoverflow.com/questions/31626231/'
);

-- Python: Permission denied when opening file
INSERT INTO knowledge_entries (
    query, category, hit_frequency, solutions, prerequisites, success_indicators,
    common_pitfalls, success_rate, claude_version, last_verified, source_url
) VALUES (
    'Python PermissionError: [Errno 13] Permission denied',
    'python',
    'VERY_HIGH',
    '[
        {"solution": "Check file path - ensure not pointing to directory: os.path.isfile(path)", "percentage": 90, "note": "Cannot open directory as file"},
        {"solution": "Run with administrator/sudo: sudo python script.py", "percentage": 80, "note": "File requires elevated permissions"},
        {"solution": "Close file in other programs (Excel, text editors)", "percentage": 85, "note": "File locked by another process"}
    ]'::jsonb,
    'Python installed, File path exists',
    'File opens successfully, No permission errors',
    'Error 13 occurs when: 1) Path is directory not file, 2) File open elsewhere, 3) Insufficient permissions. Check with os.path.isfile().',
    0.90,
    'sonnet-4',
    NOW(),
    'https://stackoverflow.com/questions/36434764/'
);

-- Node: EACCES permission denied /usr/local
INSERT INTO knowledge_entries (
    query, category, hit_frequency, solutions, prerequisites, success_indicators,
    common_pitfalls, success_rate, claude_version, last_verified, source_url
) VALUES (
    'npm EACCES: permission denied /usr/local/lib/node_modules',
    'npm',
    'HIGH',
    '[
        {"solution": "Change ownership: sudo chown -R $(whoami) /usr/local/lib/node_modules", "percentage": 90, "command": "sudo chown -R $(whoami) /usr/local/lib/node_modules", "note": "Fix permissions"},
        {"solution": "Use nvm instead of global npm: curl -o- https://raw.githubusercontent.com/nvm-sh/nvm/v0.39.0/install.sh | bash", "percentage": 95, "note": "Better solution - no sudo needed"},
        {"solution": "Configure npm prefix: npm config set prefix ~/.npm-global", "percentage": 80, "note": "Use user directory instead"}
    ]'::jsonb,
    'npm installed, Mac/Linux system',
    'npm install -g works without sudo, Packages install successfully',
    'Never use sudo with npm. Use nvm or change ownership. Global npm directory should be user-owned.',
    0.95,
    'sonnet-4',
    NOW(),
    'https://stackoverflow.com/questions/48910876/'
);

-- localhost: Connection refused
INSERT INTO knowledge_entries (
    query, category, hit_frequency, solutions, prerequisites, success_indicators,
    common_pitfalls, success_rate, claude_version, last_verified, source_url
) VALUES (
    'localhost refused to connect ERR_CONNECTION_REFUSED',
    'networking',
    'VERY_HIGH',
    '[
        {"solution": "Verify server is running: check process with ps aux | grep node (or relevant command)", "percentage": 95, "note": "Server not started"},
        {"solution": "Check correct port: ensure URL matches server port (e.g., localhost:3000)", "percentage": 90, "note": "Port mismatch"},
        {"solution": "Check firewall not blocking port: sudo ufw allow 3000", "percentage": 80, "note": "Firewall blocking connection"}
    ]'::jsonb,
    'Development server configured, Browser access',
    'Browser connects to localhost, Server responds to requests',
    'Connection refused means nothing is listening on that port. Start server first, then check port number matches.',
    0.95,
    'sonnet-4',
    NOW(),
    'https://stackoverflow.com/questions/58929202/'
);

-- localhost: XAMPP Listen 80
INSERT INTO knowledge_entries (
    query, category, hit_frequency, solutions, prerequisites, success_indicators,
    common_pitfalls, success_rate, claude_version, last_verified, source_url
) VALUES (
    'XAMPP localhost refused to connect',
    'xampp',
    'HIGH',
    '[
        {"solution": "Configure httpd.conf: Set Listen 80 and ServerName localhost:80", "percentage": 90, "note": "Port 80 configuration"},
        {"solution": "Configure httpd-ssl.conf: Set Listen 443", "percentage": 85, "note": "SSL port configuration"},
        {"solution": "Check port not in use: netstat -ano | findstr :80", "percentage": 80, "command": "netstat -ano | findstr :80", "note": "Another service using port 80"}
    ]'::jsonb,
    'XAMPP installed, Apache configuration access',
    'Apache starts successfully, localhost loads in browser',
    'Port 80 often used by Skype, IIS, or other services. Check with netstat. Configure XAMPP to use different port if needed.',
    0.90,
    'sonnet-4',
    NOW(),
    'https://stackoverflow.com/questions/57154731/'
);

-- localhost: Android emulator
INSERT INTO knowledge_entries (
    query, category, hit_frequency, solutions, prerequisites, success_indicators,
    common_pitfalls, success_rate, claude_version, last_verified, source_url
) VALUES (
    'Android emulator cannot connect to localhost',
    'android',
    'HIGH',
    '[
        {"solution": "Use 10.0.2.2 instead of localhost or 127.0.0.1", "percentage": 95, "note": "Android emulator loopback address"},
        {"solution": "Use computer IP address: http://192.168.1.x:8080", "percentage": 85, "note": "Find with ipconfig/ifconfig"},
        {"solution": "Enable network access in emulator settings", "percentage": 75, "note": "Check emulator has network"}
    ]'::jsonb,
    'Android emulator running, Development server on host machine',
    'App connects to server, API requests succeed',
    'Android emulator has special loopback: 10.0.2.2 maps to host 127.0.0.1. Cannot use localhost directly.',
    0.95,
    'sonnet-4',
    NOW(),
    'https://stackoverflow.com/questions/5495534/'
);

-- Git: Permission denied file write
INSERT INTO knowledge_entries (
    query, category, hit_frequency, solutions, prerequisites, success_indicators,
    common_pitfalls, success_rate, claude_version, last_verified, source_url
) VALUES (
    'Git permission denied when writing files',
    'git',
    'MEDIUM',
    '[
        {"solution": "Close file in other programs: check Task Manager/Activity Monitor", "percentage": 90, "note": "File locked by IDE or text editor"},
        {"solution": "Kill orphaned git processes: pkill git", "percentage": 85, "command": "pkill git", "note": "Git process holding lock"},
        {"solution": "Remove .git/index.lock file: rm .git/index.lock", "percentage": 80, "command": "rm .git/index.lock", "note": "Stale lock file"}
    ]'::jsonb,
    'Git repository, File modification in progress',
    'Git operations complete successfully, No permission errors',
    'Permission denied during git pull/checkout usually means file is open elsewhere or stale lock exists.',
    0.90,
    'sonnet-4',
    NOW(),
    'https://stackoverflow.com/questions/9200556/'
);

-- Docker: Permission denied socket
INSERT INTO knowledge_entries (
    query, category, hit_frequency, solutions, prerequisites, success_indicators,
    common_pitfalls, success_rate, claude_version, last_verified, source_url
) VALUES (
    'Docker permission denied accessing socket',
    'docker',
    'HIGH',
    '[
        {"solution": "Add user to docker group: sudo usermod -aG docker $USER, then logout/login", "percentage": 95, "command": "sudo usermod -aG docker $USER", "note": "Permanent fix"},
        {"solution": "Run with sudo: sudo docker ps", "percentage": 80, "note": "Temporary workaround"},
        {"solution": "Fix socket permissions: sudo chmod 666 /var/run/docker.sock", "percentage": 70, "note": "Security risk - not recommended"}
    ]'::jsonb,
    'Docker installed, Linux/Mac system',
    'docker ps works without sudo, User can run docker commands',
    'Docker socket requires docker group membership. Must logout/login after adding user to group for changes to take effect.',
    0.95,
    'sonnet-4',
    NOW(),
    'https://stackoverflow.com/questions/48957195/'
);

-- React: localhost refused (development)
INSERT INTO knowledge_entries (
    query, category, hit_frequency, solutions, prerequisites, success_indicators,
    common_pitfalls, success_rate, claude_version, last_verified, source_url
) VALUES (
    'React app localhost refused to connect',
    'react',
    'HIGH',
    '[
        {"solution": "Start dev server: npm start", "percentage": 95, "note": "Server not running"},
        {"solution": "Check package.json has start script: npm run start", "percentage": 90, "note": "Script missing"},
        {"solution": "Kill process on port 3000: kill -9 $(lsof -ti:3000)", "percentage": 80, "command": "kill -9 $(lsof -ti:3000)", "note": "Port already in use"}
    ]'::jsonb,
    'React app created, npm installed',
    'Dev server starts, Browser opens to localhost:3000, App loads',
    'React dev server must be running for localhost:3000 to work. Check console for port conflicts.',
    0.95,
    'sonnet-4',
    NOW(),
    'https://stackoverflow.com/questions/72445170/'
);
